'use strict';const _0x2a2ee9=_0x1ffc;(function(_0xdff4eb,_0x2b4193){const _0x46228b=_0x1ffc,_0x30bfad=_0xdff4eb();while(!![]){try{const _0x52bfe2=-parseInt(_0x46228b(0x200))/0x1+-parseInt(_0x46228b(0x113))/0x2+parseInt(_0x46228b(0x189))/0x3+parseInt(_0x46228b(0x1a3))/0x4+-parseInt(_0x46228b(0x12c))/0x5+parseInt(_0x46228b(0x145))/0x6+parseInt(_0x46228b(0x1be))/0x7;if(_0x52bfe2===_0x2b4193)break;else _0x30bfad['push'](_0x30bfad['shift']());}catch(_0x3c3f3b){_0x30bfad['push'](_0x30bfad['shift']());}}}(_0x5836,0x7eba5));function _0x1ffc(_0x5a98c4,_0x36ba9a){const _0x5836c9=_0x5836();return _0x1ffc=function(_0x1ffc90,_0x51209c){_0x1ffc90=_0x1ffc90-0x10a;let _0x2c08a3=_0x5836c9[_0x1ffc90];return _0x2c08a3;},_0x1ffc(_0x5a98c4,_0x36ba9a);}var __decorate=this&&this[_0x2a2ee9(0x16e)]||function(_0x39dcf3,_0x558962,_0x473b72,_0x5849f6){const _0x7efb97=_0x2a2ee9;var _0x27ddd8=arguments[_0x7efb97(0x180)],_0xcdb699=_0x27ddd8<0x3?_0x558962:_0x5849f6===null?_0x5849f6=Object['getOwnPropertyDescriptor'](_0x558962,_0x473b72):_0x5849f6,_0x5da57a;if(typeof Reflect===_0x7efb97(0x11a)&&typeof Reflect['decorate']===_0x7efb97(0x157))_0xcdb699=Reflect[_0x7efb97(0x1d1)](_0x39dcf3,_0x558962,_0x473b72,_0x5849f6);else{for(var _0x2a9a6d=_0x39dcf3['length']-0x1;_0x2a9a6d>=0x0;_0x2a9a6d--)if(_0x5da57a=_0x39dcf3[_0x2a9a6d])_0xcdb699=(_0x27ddd8<0x3?_0x5da57a(_0xcdb699):_0x27ddd8>0x3?_0x5da57a(_0x558962,_0x473b72,_0xcdb699):_0x5da57a(_0x558962,_0x473b72))||_0xcdb699;}return _0x27ddd8>0x3&&_0xcdb699&&Object[_0x7efb97(0x161)](_0x558962,_0x473b72,_0xcdb699),_0xcdb699;},__metadata=this&&this['__metadata']||function(_0x2414a3,_0x4be569){const _0x28c619=_0x2a2ee9;if(typeof Reflect===_0x28c619(0x11a)&&typeof Reflect[_0x28c619(0x155)]==='function')return Reflect['metadata'](_0x2414a3,_0x4be569);},__param=this&&this['__param']||function(_0x599351,_0x558ce4){return function(_0x2d2c98,_0x14bde3){_0x558ce4(_0x2d2c98,_0x14bde3,_0x599351);};};Object[_0x2a2ee9(0x161)](exports,_0x2a2ee9(0x1c4),{'value':!![]}),exports[_0x2a2ee9(0x127)]=void 0x0;const common_1=require('@nestjs/common'),axios_1=require(_0x2a2ee9(0x18e)),uuid=require(_0x2a2ee9(0x1de)),upload_service_1=require(_0x2a2ee9(0x144)),typeorm_1=require(_0x2a2ee9(0x1a7)),draw_entity_1=require('./draw.entity'),typeorm_2=require(_0x2a2ee9(0x1b8)),config_entity_1=require(_0x2a2ee9(0x133)),utils_1=require(_0x2a2ee9(0x131)),utils_2=require(_0x2a2ee9(0x150)),chatgpt_service_1=require('./../chatgpt/chatgpt.service'),models_service_1=require(_0x2a2ee9(0x1d2)),date_1=require('../../common/utils/date'),globalConfig_service_1=require(_0x2a2ee9(0x138)),user_entity_1=require(_0x2a2ee9(0x15c)),image_size_1=require('image-size'),userBalance_service_1=require('../userBalance/userBalance.service'),sharp=require(_0x2a2ee9(0x1fb));let DrawService=class DrawService{constructor(_0x9b38f5,_0xeeb593,_0x3a09da,_0xc43d5c,_0x71c8ab,_0x1a7d99,_0x273d5f,_0x5d18fd){const _0x563531=_0x2a2ee9;this[_0x563531(0x1cc)]=_0x9b38f5,this[_0x563531(0x151)]=_0xeeb593,this[_0x563531(0x1ff)]=_0x3a09da,this['userEntity']=_0xc43d5c,this[_0x563531(0x1f1)]=_0x71c8ab,this[_0x563531(0x196)]=_0x1a7d99,this['globalConfigService']=_0x273d5f,this['userBalanceService']=_0x5d18fd;}async[_0x2a2ee9(0x1cf)](){setTimeout(()=>{const _0x41ed00=_0x1ffc;this[_0x41ed00(0x178)]();},0x1388);}async[_0x2a2ee9(0x178)](){const _0x2d4b83=_0x2a2ee9;console['log'](_0x2d4b83(0x173));try{const _0x4cd1de=await this[_0x2d4b83(0x151)][_0x2d4b83(0x1e1)]({'where':{'thumb':(0x0,typeorm_2['In'])([null,'']),'isDelete':0x1,'status':_0x2d4b83(0x1ba),'originalImgUrl':(0x0,typeorm_2[_0x2d4b83(0x17a)])(''),'sysRec':'1'},'select':['id',_0x2d4b83(0x1ea)]}),_0x26f26e=await this['getMjImageProxyUrl']();console[_0x2d4b83(0x11e)](_0x2d4b83(0x14b),_0x4cd1de[_0x2d4b83(0x180)]);for(const _0x41d499 of _0x4cd1de){const _0x8c4e12=_0x26f26e?_0x41d499['originalImgUrl']['replace'](_0x2d4b83(0x170),_0x26f26e):_0x41d499[_0x2d4b83(0x1ea)],_0xafd07b=await this[_0x2d4b83(0x1dd)](_0x8c4e12);if(!_0xafd07b)return;const _0x5c5a99={'originalname':_0x2d4b83(0x172)+_0x41d499['id']+']-'+uuid['v4']()['slice'](0x0,0xa)+_0x2d4b83(0x191),'filename':_0x2d4b83(0x172)+_0x41d499['id']+']-'+uuid['v4']()[_0x2d4b83(0x13f)](0x0,0xa)+_0x2d4b83(0x191),'buffer':_0xafd07b},_0x578278=await this['uploadService'][_0x2d4b83(0x11f)](_0x5c5a99);console['log']('--------------->\x20\x20id:\x20'+_0x41d499['id']+_0x2d4b83(0x18d),_0x578278),_0x578278&&await this[_0x2d4b83(0x151)]['update']({'id':_0x41d499['id']},{'thumb':_0x578278});}}catch(_0x49f1e3){console[_0x2d4b83(0x11e)](_0x2d4b83(0x167),_0x49f1e3);}}async[_0x2a2ee9(0x12f)](){const _0x2ab92c=_0x2a2ee9,{mjProxyUrl:_0x3fb24a,mjSecretKey:_0x102f75}=await this[_0x2ab92c(0x1e7)]['getConfigs']([_0x2ab92c(0x193),_0x2ab92c(0x174)]);return(!_0x3fb24a||!_0x102f75)&&(0x0,utils_2[_0x2ab92c(0x165)])({'NineErrMsg':_0x2ab92c(0x1b4)}),axios_1['default'][_0x2ab92c(0x1c3)]({'timeout':0x3e8*0x3c,'headers':{'Content-Type':_0x2ab92c(0x199),'mj-api-secret':_0x102f75},'baseURL':_0x3fb24a[_0x2ab92c(0x1a6)]('/')?_0x3fb24a[_0x2ab92c(0x13f)](0x0,_0x3fb24a[_0x2ab92c(0x180)]-0x1):_0x3fb24a});}async['recSysList'](_0x2477f2){const _0x4c199e=_0x2a2ee9,{page:page=0x1,size:size=0x14}=_0x2477f2,[_0x574862,_0x4aee85]=await this[_0x4c199e(0x151)][_0x4c199e(0x10e)]({'where':{'sysRec':'1'},'skip':(page-0x1)*size,'take':size,'order':{'id':_0x4c199e(0x18b)}}),_0x345c67=await this['getMjImageProxyUrl'](),_0x5b891b=_0x574862['map'](_0x55596a=>_0x55596a[_0x4c199e(0x1cd)]),_0x381cae=await this[_0x4c199e(0x1d6)]['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x5b891b)},'select':['id',_0x4c199e(0x1e5),_0x4c199e(0x17b),_0x4c199e(0x1b5)]});return{'count':_0x4aee85,'rows':(0x0,date_1['formatCreateOrUpdateDate'])(_0x574862[_0x4c199e(0x16f)]())[_0x4c199e(0x1a2)](_0x2e4b2d=>{const _0x447b8a=_0x4c199e;return _0x2e4b2d[_0x447b8a(0x1ea)]&&_0x2e4b2d[_0x447b8a(0x1ea)]['includes'](_0x447b8a(0x170))&&_0x345c67&&(_0x2e4b2d[_0x447b8a(0x1ea)]=_0x2e4b2d[_0x447b8a(0x1ea)]['replace']('https://cdn.discordapp.com',_0x345c67)),_0x2e4b2d['userInfo']=_0x381cae[_0x447b8a(0x1e1)](_0x4a3a3f=>_0x4a3a3f['id']===_0x2e4b2d[_0x447b8a(0x1cd)]),_0x2e4b2d;})};}async[_0x2a2ee9(0x141)](_0x2831c9){const _0x457200=_0x2a2ee9,{page:page=0x1,size:size=0xa}=_0x2831c9,[_0x3722c6,_0x1f1752]=await this[_0x457200(0x151)][_0x457200(0x10e)]({'skip':(page-0x1)*size,'take':size,'order':{'id':_0x457200(0x18b)}}),_0x56ee85=await this[_0x457200(0x177)](),_0x270986=_0x3722c6[_0x457200(0x1a2)](_0x967216=>_0x967216[_0x457200(0x1cd)]),_0x45b513=await this[_0x457200(0x1d6)][_0x457200(0x1e1)]({'where':{'id':(0x0,typeorm_2['In'])(_0x270986)},'select':['id',_0x457200(0x1e5),'avatar','email']});return{'count':_0x1f1752,'rows':(0x0,date_1[_0x457200(0x182)])(_0x3722c6)[_0x457200(0x1a2)](_0x4bace0=>{const _0x1e489a=_0x457200;return _0x4bace0[_0x1e489a(0x1ea)]&&_0x4bace0[_0x1e489a(0x1ea)][_0x1e489a(0x187)]('https://cdn.discordapp.com')&&_0x56ee85&&(_0x4bace0['originalImgUrl']=_0x4bace0[_0x1e489a(0x1ea)][_0x1e489a(0x118)]('https://cdn.discordapp.com',_0x56ee85)),_0x4bace0['userInfo']=_0x45b513[_0x1e489a(0x1e1)](_0x39aa32=>_0x39aa32['id']===_0x4bace0[_0x1e489a(0x1cd)]),_0x4bace0;})};}async[_0x2a2ee9(0x19c)](_0x5dff1c,_0x1d3462){const _0x8624f9=_0x2a2ee9,{id:_0x21ed83}=_0x5dff1c[_0x8624f9(0x126)],{id:_0xead79}=_0x1d3462,_0x5ca091=await this[_0x8624f9(0x151)][_0x8624f9(0x1c0)]({'where':{'id':_0xead79}});if(!_0x5ca091)throw new common_1['HttpException'](_0x8624f9(0x1a1),common_1['HttpStatus'][_0x8624f9(0x1e2)]);const {userId:_0x18b806}=_0x5ca091;if(_0x21ed83!==_0x18b806)throw new common_1[(_0x8624f9(0x121))](_0x8624f9(0x124),common_1[_0x8624f9(0x1df)][_0x8624f9(0x1e2)]);return await this[_0x8624f9(0x151)][_0x8624f9(0x13e)]({'id':_0xead79},{'isDelete':-0x1}),!![];}async[_0x2a2ee9(0x1b6)](_0x4ddd90,_0x20c573){const _0x5b3e04=_0x2a2ee9,{id:_0x1c238c}=_0x4ddd90['user'],{page:page=0x1,size:size=0xa,sysRec:_0x35fe1f,status:_0x1a96aa}=_0x20c573,_0x6d6b5c={'userId':_0x1c238c,'isDelete':0x1};_0x35fe1f&&(_0x6d6b5c['sysRec']=_0x35fe1f),_0x1a96aa&&(_0x6d6b5c[_0x5b3e04(0x117)]=_0x1a96aa);const [_0x379f52,_0xca54d]=await this[_0x5b3e04(0x151)][_0x5b3e04(0x10e)]({'where':_0x6d6b5c,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x5b3e04(0x18b)}}),_0xb2f23a=await this[_0x5b3e04(0x177)]();return{'count':_0xca54d,'rows':(0x0,date_1[_0x5b3e04(0x182)])(_0x379f52[_0x5b3e04(0x16f)]())[_0x5b3e04(0x1a2)](_0x9b0744=>{const _0xf62d4c=_0x5b3e04;return _0x9b0744['originalImgUrl']&&_0x9b0744[_0xf62d4c(0x1ea)][_0xf62d4c(0x187)](_0xf62d4c(0x170))&&_0xb2f23a&&(_0x9b0744[_0xf62d4c(0x1ea)]=_0x9b0744[_0xf62d4c(0x1ea)][_0xf62d4c(0x118)](_0xf62d4c(0x170),_0xb2f23a)),_0x9b0744;})};}async['mjPlusNotify'](_0x2b9281){const _0x28a812=_0x2a2ee9;try{process[_0x28a812(0x13a)][_0x28a812(0x1c7)]==='1'&&console[_0x28a812(0x11e)](_0x28a812(0x185),JSON[_0x28a812(0x153)](_0x2b9281));const _0x330a49=_0x2b9281===null||_0x2b9281===void 0x0?void 0x0:_0x2b9281['id'];if(!_0x330a49)return;const {id:_0x50875b,properties:_0x1a9ddb,action:_0x4a18f6,status:_0x99018d,promptEn:_0xbda465,description:_0x2b5614,submitTime:_0x413c5a,startTime:_0x255d11,finishTime:_0x405cbe,progress:_0x1adc30,imageUrl:_0x580ca6,failReason:_0x3d5c45,state:_0x4b25df,buttons:_0x47e5a9}=_0x2b9281,{discordInstanceId:_0x3054dc,finalPrompt:_0x27f090,messageContent:_0x5ec5fd}=_0x1a9ddb,_0x463c51={'discordInstanceId':_0x3054dc,'action':_0x4a18f6,'status':_0x99018d,'promptEn':_0x27f090,'requestTextTips':_0x2b5614,'requestErrTextTips':_0x3d5c45,'submitTime':_0x413c5a,'startTime':_0x255d11,'finishTime':_0x405cbe,'progress':_0x1adc30,'originalImgUrl':_0x580ca6,'state':_0x4b25df,'buttons':JSON[_0x28a812(0x153)](_0x47e5a9),'detail':JSON[_0x28a812(0x153)](_0x2b9281),'messageContent':_0x5ec5fd};await this['drawEntity'][_0x28a812(0x13e)]({'result':_0x50875b},_0x463c51);if(_0x99018d===_0x28a812(0x1d5)){const _0x3c0574=await this[_0x28a812(0x177)](),_0x3caf13=_0x3c0574?_0x580ca6[_0x28a812(0x118)](_0x28a812(0x170),_0x3c0574):_0x580ca6,{width:_0x377d50,height:_0x3de5da}=await this[_0x28a812(0x176)](_0x3caf13);await this['drawEntity'][_0x28a812(0x13e)]({'result':_0x50875b},{'width':_0x377d50,'height':_0x3de5da});const _0x41fefe=await this[_0x28a812(0x1dd)](_0x3caf13),_0x3f6449=_0x28a812(0x172)+_0x50875b+']-'+uuid['v4']()[_0x28a812(0x13f)](0x0,0xa)+_0x28a812(0x191),_0x56312c=await this['uploadService'][_0x28a812(0x11f)]({'originalname':_0x3f6449,'filename':_0x3f6449,'buffer':_0x41fefe});this[_0x28a812(0x151)][_0x28a812(0x13e)]({'result':_0x50875b},{'thumb':_0x56312c});}if(_0x99018d==='FAILURE'){const [_0xea11d9,_0x24fcdd]=_0x4b25df['split']('|');await this[_0x28a812(0x19e)]['drawFailRefund'](_0xea11d9,_0x24fcdd);}}catch(_0x3fc81d){console[_0x28a812(0x11e)](_0x28a812(0x15b),_0x3fc81d);}}async[_0x2a2ee9(0x16b)](_0x485357,_0x34a1b1){const _0x254b97=_0x2a2ee9,{id:_0x3dfb71}=_0x34a1b1;if(!_0x3dfb71)throw new common_1[(_0x254b97(0x121))](_0x254b97(0x184),common_1[_0x254b97(0x1df)][_0x254b97(0x1e2)]);const _0x195c68=await this[_0x254b97(0x151)][_0x254b97(0x1c0)]({'where':{'id':_0x3dfb71}});if(!_0x195c68)throw new common_1['HttpException'](_0x254b97(0x1a1),common_1[_0x254b97(0x1df)][_0x254b97(0x1e2)]);const {originalImgUrl:_0x40b563,sysRec:_0x420f89}=_0x195c68;if(Number(_0x420f89)===0x1)return await this['drawEntity'][_0x254b97(0x13e)]({'id':_0x3dfb71},{'sysRec':'-1'}),_0x254b97(0x19b);else{const _0x4ab84a=await this[_0x254b97(0x177)](),_0x508ae4=_0x40b563&&_0x4ab84a?_0x40b563[_0x254b97(0x118)]('https://cdn.discordapp.com',_0x4ab84a):_0x40b563,{width:_0x3cbf2b,height:_0x1e8cb7}=await this[_0x254b97(0x176)](_0x508ae4);return await this[_0x254b97(0x151)]['update']({'id':_0x3dfb71},{'sysRec':'1','width':_0x3cbf2b,'height':_0x1e8cb7}),_0x254b97(0x148);}}async[_0x2a2ee9(0x140)](_0x2b8591,_0x3869e5){const _0x48837c=_0x2a2ee9,{id:_0x2bbbcd}=_0x3869e5;if(!_0x2bbbcd)throw new common_1[(_0x48837c(0x121))](_0x48837c(0x184),common_1['HttpStatus'][_0x48837c(0x1e2)]);const _0x3f4140=await this[_0x48837c(0x151)]['findOne']({'where':{'id':_0x2bbbcd}});if(!_0x3f4140)throw new common_1[(_0x48837c(0x121))](_0x48837c(0x1a1),common_1['HttpStatus'][_0x48837c(0x1e2)]);return await this[_0x48837c(0x151)][_0x48837c(0x19d)]({'id':_0x2bbbcd}),'删除成功';}async['textToImage'](_0x59c411,_0x4ef322){const _0xf37321=_0x2a2ee9;var _0x376495,_0x476bbb,_0x421584,_0x3c548c,_0x4620aa,_0x1bdd1e;await this['drawValidateBalance'](_0x59c411,_0x4ef322),await this['checkUserDrawLimit'](_0x59c411['user']['id']);try{const {id:_0x4c614b}=_0x59c411[_0xf37321(0x126)],{autoOptimize:_0x2e1721,prompt:_0x186fbb,taskType:_0x2843dc,speed:_0x2cd6a2,version:_0x4b925b,quality:_0x4a79d5,chaos:_0x32d24e,stylize:_0x227823,style:_0x2067a2,scale:_0x595fbe,model:_0x55e218,seed:_0x25c2d2,iw:_0xc8ace5,referencePic:_0x3e3a0f,no:_0x3974c3,cameraShot:_0x463189,light:_0x49cda,view:_0x1f040e,autoTranslate:_0x3a77a6,customInstruct:_0x1bccd2}=_0x4ef322;if(Number(_0x2843dc)===0x4){const {version:_0x2c7312}=_0x4ef322;return await this[_0xf37321(0x1f0)](_0x59c411,_0x4ef322);}let _0x1a38e9=_0x186fbb;_0x2e1721&&!(_0x4ef322===null||_0x4ef322===void 0x0?void 0x0:_0x4ef322[_0xf37321(0x1d7)])&&(_0x1a38e9=await this[_0xf37321(0x1f1)][_0xf37321(0x1c5)]({'prompt':_0xf37321(0x1d0)+_0x186fbb}));_0x3a77a6&&!(_0x4ef322===null||_0x4ef322===void 0x0?void 0x0:_0x4ef322['customInstruct'])&&(_0x1a38e9=await this[_0xf37321(0x1f1)][_0xf37321(0x1c5)]({'prompt':_0xf37321(0x18c)+_0x186fbb}));const _0x1af9f2=await this[_0xf37321(0x112)](Object['assign'](Object[_0xf37321(0x1b9)]({},_0x4ef322),{'parsePrompt':_0x1a38e9})),_0xc86eae=await this[_0xf37321(0x156)]('mjBlendImageMoney'),_0x19616d={'botType':_0xf37321(0x1b1),'prompt':_0x1af9f2,'base64Array':_0x3e3a0f,'notifyHook':await this['getNotifyUrl'](),'state':_0x59c411[_0xf37321(0x126)]['id']+'|'+_0xc86eae},_0x225fa9=await(await this[_0xf37321(0x12f)]())[_0xf37321(0x201)](_0xf37321(0x10a),_0x19616d),_0x7536b8=_0x225fa9===null||_0x225fa9===void 0x0?void 0x0:_0x225fa9['data'];console['log'](_0xf37321(0x1d4),JSON[_0xf37321(0x153)](_0x225fa9===null||_0x225fa9===void 0x0?void 0x0:_0x225fa9[_0xf37321(0x1e6)]));const {code:_0x2f241d,result:_0x5f33e7,discordInstanceId:_0x55b161}=_0x7536b8;if(_0x2f241d===0x1){const _0x403c48={'drawType':0x1,'taskType':_0x2843dc,'status':_0xf37321(0x163),'prompt':_0x186fbb,'promptEn':_0x1a38e9,'fullPrompt':_0x1af9f2,'userId':_0x4c614b,'result':_0x5f33e7,'discordInstanceId':_0x55b161,'speed':_0x2cd6a2,'version':_0x4b925b,'quality':_0x4a79d5,'chaos':_0x32d24e,'stylize':_0x227823,'style':_0x2067a2,'scale':_0x595fbe['join'](':'),'model':_0x55e218,'seed':_0x25c2d2,'iw':_0xc8ace5,'referencePic':'','no':_0x3974c3,'cameraShot':_0x463189,'light':_0x49cda,'view':_0x1f040e};await this[_0xf37321(0x151)][_0xf37321(0x132)](_0x403c48),await this[_0xf37321(0x19e)][_0xf37321(0x1d8)](_0x59c411[_0xf37321(0x126)]['id'],_0xf37321(0x194),_0xc86eae,_0xc86eae);}else{const _0x262d0d=(_0x7536b8===null||_0x7536b8===void 0x0?void 0x0:_0x7536b8[_0xf37321(0x1fa)])||(_0x7536b8===null||_0x7536b8===void 0x0?void 0x0:_0x7536b8[_0xf37321(0x13d)])||_0xf37321(0x12b);(0x0,utils_2[_0xf37321(0x165)])({'NineErrMsg':_0x262d0d});}}catch(_0x1b02a1){console[_0xf37321(0x11e)](_0xf37321(0x159),(_0x376495=_0x1b02a1===null||_0x1b02a1===void 0x0?void 0x0:_0x1b02a1[_0xf37321(0x125)])===null||_0x376495===void 0x0?void 0x0:_0x376495[_0xf37321(0x1e6)]);const _0x5832a8=(_0x1b02a1===null||_0x1b02a1===void 0x0?void 0x0:_0x1b02a1[_0xf37321(0x149)])||((_0x3c548c=(_0x421584=(_0x476bbb=_0x1b02a1===null||_0x1b02a1===void 0x0?void 0x0:_0x1b02a1['response'])===null||_0x476bbb===void 0x0?void 0x0:_0x476bbb[_0xf37321(0x1e6)])===null||_0x421584===void 0x0?void 0x0:_0x421584['error'])===null||_0x3c548c===void 0x0?void 0x0:_0x3c548c[_0xf37321(0x160)])||((_0x1bdd1e=(_0x4620aa=_0x1b02a1===null||_0x1b02a1===void 0x0?void 0x0:_0x1b02a1[_0xf37321(0x125)])===null||_0x4620aa===void 0x0?void 0x0:_0x4620aa['data'])===null||_0x1bdd1e===void 0x0?void 0x0:_0x1bdd1e[_0xf37321(0x13d)])||_0xf37321(0x12b);throw new common_1['HttpException'](_0x5832a8,common_1[_0xf37321(0x1df)][_0xf37321(0x1e2)]);}}async[_0x2a2ee9(0x1ee)](_0x4f9588,_0x34c5c9){const _0x57fd95=_0x2a2ee9;var _0x1f409e,_0x50183a,_0x2967f1,_0x2ecdce;const {id:_0x2d6a9f}=_0x4f9588['user'],{customId:_0x1713de,taskId:_0x51d13a,label:_0x21ef2e}=_0x34c5c9;await this['checkUserDrawLimit'](_0x4f9588['user']['id']);let _0x45a918=0x1;_0x1713de[_0x57fd95(0x187)]('variation')&&(_0x45a918=await this[_0x57fd95(0x156)](_0x57fd95(0x1a8)));_0x1713de[_0x57fd95(0x187)]('upsample')&&(_0x45a918=await this[_0x57fd95(0x156)](_0x57fd95(0x1ce)));_0x1713de['includes'](_0x57fd95(0x1a5))&&(_0x45a918=await this[_0x57fd95(0x156)]('mjRedrawMoney'));_0x1713de[_0x57fd95(0x187)](_0x57fd95(0x1d3))&&(_0x45a918=await this[_0x57fd95(0x156)](_0x57fd95(0x166)));(_0x1713de[_0x57fd95(0x187)](_0x57fd95(0x15a))||_0x1713de[_0x57fd95(0x187)](_0x57fd95(0x195)))&&(_0x45a918=await this[_0x57fd95(0x156)](_0x57fd95(0x116)));_0x1713de[_0x57fd95(0x187)](_0x57fd95(0x129))&&(_0x45a918=await this[_0x57fd95(0x156)]('mjPanMoney'));await this['userBalanceService']['validateBalance'](_0x4f9588,_0x57fd95(0x194),_0x45a918);try{const _0x501dcc=await this[_0x57fd95(0x151)][_0x57fd95(0x1c0)]({'where':{'result':_0x51d13a}});!_0x501dcc&&(0x0,utils_2[_0x57fd95(0x165)])({'NineErrMsg':_0x57fd95(0x1db)});_0x501dcc[_0x57fd95(0x1cd)]!==_0x2d6a9f&&(0x0,utils_2['throwError'])({'NineErrMsg':'无权操作他人作品！'});const _0x50a556={'customId':_0x1713de,'taskId':_0x51d13a,'notifyHook':await this[_0x57fd95(0x1ec)](),'state':_0x4f9588[_0x57fd95(0x126)]['id']+'|'+_0x45a918},_0x2b7888=await(await this[_0x57fd95(0x12f)]())['post'](_0x57fd95(0x15e),_0x50a556),{code:_0x30a08d,result:_0x3a9486,discordInstanceId:_0x9d358e}=_0x2b7888===null||_0x2b7888===void 0x0?void 0x0:_0x2b7888['data'];if([0x1,0x15][_0x57fd95(0x187)](_0x30a08d)){if(_0x30a08d===0x15){!_0x34c5c9['zoomPrompt']&&!_0x34c5c9['maskBase64']&&(0x0,utils_2['throwError'])({'NineErrMsg':_0x57fd95(0x190)});const _0x4c3cbc={'taskId':_0x3a9486};_0x34c5c9[_0x57fd95(0x198)]&&(_0x4c3cbc[_0x57fd95(0x16c)]=_0x34c5c9[_0x57fd95(0x198)]),_0x34c5c9[_0x57fd95(0x1bc)]&&(_0x4c3cbc['maskBase64']=_0x34c5c9[_0x57fd95(0x1bc)]);const _0xf6ac6c=Object[_0x57fd95(0x1b9)]({'notifyHook':await this[_0x57fd95(0x1ec)](),'state':_0x4f9588[_0x57fd95(0x126)]['id']+'|'+_0x45a918},_0x4c3cbc),_0x4579b0=await(await this[_0x57fd95(0x12f)]())[_0x57fd95(0x201)](_0x57fd95(0x15f),_0xf6ac6c);console['log'](_0x57fd95(0x14a),JSON[_0x57fd95(0x153)](_0x4579b0[_0x57fd95(0x1e6)]));}await this[_0x57fd95(0x19e)][_0x57fd95(0x1d8)](_0x4f9588[_0x57fd95(0x126)]['id'],'mjDraw',_0x45a918,_0x45a918);const {operateButtons:_0x43717b,prompt:_0x25a4ea,promptEn:_0x6f3a44,fullPrompt:_0x8bdc06,speed:_0x101db4,drawType:_0xe9021c,version:_0x5e320b,model:_0x5123ca,scale:_0x182a55,quality:_0x503aed,chaos:_0x24acb0,stylize:_0x492a1c,cameraShot:_0x5354c0,iw:_0x18fa5c,light:_0x4c0645,no:_0x53f83d,view:_0x1e26a3}=_0x501dcc;let _0x5d526f=[];try{_0x5d526f=_0x43717b?[...JSON[_0x57fd95(0x192)](_0x43717b),_0x1713de]:[_0x1713de];}catch(_0xeca756){_0x5d526f=[_0x1713de];}await this[_0x57fd95(0x151)][_0x57fd95(0x13e)]({'result':_0x51d13a},{'operateButtons':JSON[_0x57fd95(0x153)](_0x5d526f)});const _0x588f44=await this[_0x57fd95(0x151)]['save']({'version':_0x5e320b,'model':_0x5123ca,'scale':_0x182a55,'quality':_0x503aed,'chaos':_0x24acb0,'stylize':_0x492a1c,'drawType':_0xe9021c,'speed':_0x101db4,'status':_0x57fd95(0x163),'prompt':_0x25a4ea,'promptEn':_0x6f3a44,'fullPrompt':_0x8bdc06,'customId':_0x1713de,'userId':_0x2d6a9f,'result':_0x3a9486,'discordInstanceId':_0x9d358e,'cameraShot':_0x5354c0,'iw':_0x18fa5c,'light':_0x4c0645,'no':_0x53f83d,'view':_0x1e26a3});}else{console['log']('drawAction\x20code\x20!=\x201:\x20\x20441',_0x2b7888===null||_0x2b7888===void 0x0?void 0x0:_0x2b7888[_0x57fd95(0x1e6)]);let _0x733659=((_0x1f409e=_0x2b7888===null||_0x2b7888===void 0x0?void 0x0:_0x2b7888[_0x57fd95(0x1e6)])===null||_0x1f409e===void 0x0?void 0x0:_0x1f409e['description'])||_0x57fd95(0x12b);_0x733659===_0x57fd95(0x1fd)&&(_0x733659=_0x57fd95(0x1cb)),console[_0x57fd95(0x11e)](_0x57fd95(0x1e3),_0x733659),(0x0,utils_2[_0x57fd95(0x165)])({'NineErrMsg':_0x733659});}}catch(_0xba8482){console[_0x57fd95(0x11e)](_0x57fd95(0x134),_0xba8482);const _0x2e4f0c=(_0xba8482===null||_0xba8482===void 0x0?void 0x0:_0xba8482[_0x57fd95(0x149)])||((_0x2ecdce=(_0x2967f1=(_0x50183a=_0xba8482===null||_0xba8482===void 0x0?void 0x0:_0xba8482['response'])===null||_0x50183a===void 0x0?void 0x0:_0x50183a[_0x57fd95(0x1e6)])===null||_0x2967f1===void 0x0?void 0x0:_0x2967f1[_0x57fd95(0x13d)])===null||_0x2ecdce===void 0x0?void 0x0:_0x2ecdce[_0x57fd95(0x160)])||'提交Action任务失败、请检查系统日志';throw new common_1['HttpException'](_0x2e4f0c,common_1['HttpStatus'][_0x57fd95(0x1e2)]);}}async[_0x2a2ee9(0x122)](_0x361b28,_0x242a23){const _0x1f323a=_0x2a2ee9;var _0xca0feb,_0x1278cf,_0x3ed686,_0x8ca092,_0xff1abc,_0x2ff8ed;const {id:_0x581878}=_0x361b28[_0x1f323a(0x126)],{base64Arr:_0x34e141,dimensions:_0x324bd2}=_0x242a23;await this[_0x1f323a(0x12d)](_0x361b28[_0x1f323a(0x126)]['id']);if(!_0x34e141||_0x34e141[_0x1f323a(0x180)]<0x2)throw new common_1[(_0x1f323a(0x121))](_0x1f323a(0x1b0),common_1[_0x1f323a(0x1df)][_0x1f323a(0x1e2)]);if(_0x34e141[_0x1f323a(0x180)]>0x6)throw new common_1[(_0x1f323a(0x121))](_0x1f323a(0x1eb),common_1[_0x1f323a(0x1df)][_0x1f323a(0x1e2)]);const _0x571a77=await this[_0x1f323a(0x156)]('mjBlendImageMoney');await this[_0x1f323a(0x19e)][_0x1f323a(0x17c)](_0x361b28,_0x1f323a(0x194),_0x571a77);try{const _0x3df270={'botType':_0x1f323a(0x1b1),'base64Array':_0x34e141,'dimensions':_0x324bd2,'notifyHook':await this[_0x1f323a(0x1ec)](),'state':_0x361b28['user']['id']+'|'+_0x571a77},_0x39b910=await(await this[_0x1f323a(0x12f)]())[_0x1f323a(0x201)](_0x1f323a(0x143),_0x3df270);console[_0x1f323a(0x11e)](_0x1f323a(0x164),_0x39b910[_0x1f323a(0x1e6)]);const {data:_0x37a729}=_0x39b910,{code:_0x58a771,result:_0x566806,discordInstanceId:_0x27d5c5}=_0x37a729;if(_0x58a771===0x1){const _0x188499=await this[_0x1f323a(0x151)][_0x1f323a(0x132)]({'drawType':0x1,'status':'NOT_START','mixPic':JSON[_0x1f323a(0x153)]([]),'userId':_0x581878,'result':_0x566806,'discordInstanceId':_0x27d5c5,'speed':_0x1f323a(0x1ac),'prompt':_0x1f323a(0x12e),'promptEn':_0x1f323a(0x1ca),'fullPrompt':_0x1f323a(0x1ca)});await this[_0x1f323a(0x19e)][_0x1f323a(0x1d8)](_0x361b28[_0x1f323a(0x126)]['id'],'mjDraw',_0x571a77,_0x571a77);}else{console[_0x1f323a(0x11e)](_0x1f323a(0x186),_0x39b910===null||_0x39b910===void 0x0?void 0x0:_0x39b910[_0x1f323a(0x1e6)]);let _0x40666c=((_0xca0feb=_0x39b910===null||_0x39b910===void 0x0?void 0x0:_0x39b910[_0x1f323a(0x1e6)])===null||_0xca0feb===void 0x0?void 0x0:_0xca0feb[_0x1f323a(0x1fa)])||_0x1f323a(0x1af);_0x40666c==='quota_not_enough'&&(_0x40666c=_0x1f323a(0x1cb)),console['log'](_0x1f323a(0x1e3),_0x40666c),(0x0,utils_2[_0x1f323a(0x165)])({'NineErrMsg':_0x40666c});}}catch(_0x23e49e){console[_0x1f323a(0x11e)](_0x1f323a(0x11c),_0x23e49e);const _0x44a826=(_0x23e49e===null||_0x23e49e===void 0x0?void 0x0:_0x23e49e[_0x1f323a(0x149)])||((_0x8ca092=(_0x3ed686=(_0x1278cf=_0x23e49e===null||_0x23e49e===void 0x0?void 0x0:_0x23e49e['response'])===null||_0x1278cf===void 0x0?void 0x0:_0x1278cf[_0x1f323a(0x1e6)])===null||_0x3ed686===void 0x0?void 0x0:_0x3ed686['error'])===null||_0x8ca092===void 0x0?void 0x0:_0x8ca092[_0x1f323a(0x160)])||((_0x2ff8ed=(_0xff1abc=_0x23e49e===null||_0x23e49e===void 0x0?void 0x0:_0x23e49e['response'])===null||_0xff1abc===void 0x0?void 0x0:_0xff1abc[_0x1f323a(0x1e6)])===null||_0x2ff8ed===void 0x0?void 0x0:_0x2ff8ed[_0x1f323a(0x13d)])||_0x1f323a(0x12b);throw new common_1['HttpException'](_0x44a826,common_1['HttpStatus']['BAD_REQUEST']);}}async['drawSwapDace'](_0x431192,_0x29e1a){const _0x3c4c86=_0x2a2ee9;var _0xf158bf,_0x31b9b2,_0xcef721,_0x90e1e4,_0x13b6fd,_0x11c8e6;const {id:_0x3190d8}=_0x431192[_0x3c4c86(0x126)],{sourceBase:_0x1f062a,targetBase:_0x2ce4d1}=_0x29e1a;await this[_0x3c4c86(0x12d)](_0x431192[_0x3c4c86(0x126)]['id']);const _0x17b6e0=await(0x0,utils_1[_0x3c4c86(0x1a9)])([_0x1f062a,_0x2ce4d1]);if(_0x17b6e0[_0x3c4c86(0x180)]!==0x2)throw new common_1[(_0x3c4c86(0x121))]('图片资源转换失败、请检查系统日志',common_1[_0x3c4c86(0x1df)]['BAD_REQUEST']);const _0x226bec=await this['getDrawDecutConfig'](_0x3c4c86(0x142));await this[_0x3c4c86(0x19e)][_0x3c4c86(0x17c)](_0x431192,_0x3c4c86(0x194),_0x226bec);try{const _0x1550cf={'sourceBase64':_0x1f062a,'targetBase64':_0x2ce4d1,'accountFilter':{'instanceId':''},'notifyHook':await this['getNotifyUrl'](),'state':_0x431192[_0x3c4c86(0x126)]['id']+'|'+_0x226bec},_0x2957da=await(await this[_0x3c4c86(0x12f)]())[_0x3c4c86(0x201)](_0x3c4c86(0x1fe),_0x1550cf);console[_0x3c4c86(0x11e)](_0x3c4c86(0x11d),_0x2957da[_0x3c4c86(0x1e6)]);const {data:_0x306cfe}=_0x2957da,{code:_0x503d13,result:_0x6a1ab7,discordInstanceId:_0x331fa8}=_0x306cfe,_0xc6b4cc=[];if(_0x503d13===0x1){const _0x25d381=await this[_0x3c4c86(0x151)]['save']({'drawType':0x1,'status':'NOT_START','swapFacePic':JSON[_0x3c4c86(0x153)](_0xc6b4cc),'userId':_0x3190d8,'result':_0x6a1ab7,'discordInstanceId':_0x331fa8,'speed':_0x3c4c86(0x1ac),'prompt':'正在执行AI换脸中......','promptEn':_0x3c4c86(0x1f6),'fullPrompt':_0x3c4c86(0x1f6)});await this[_0x3c4c86(0x19e)][_0x3c4c86(0x1d8)](_0x431192[_0x3c4c86(0x126)]['id'],_0x3c4c86(0x194),_0x226bec,_0x226bec);}else{console[_0x3c4c86(0x11e)](_0x3c4c86(0x186),_0x2957da===null||_0x2957da===void 0x0?void 0x0:_0x2957da['data']);let _0x48469b=((_0xf158bf=_0x2957da===null||_0x2957da===void 0x0?void 0x0:_0x2957da[_0x3c4c86(0x1e6)])===null||_0xf158bf===void 0x0?void 0x0:_0xf158bf[_0x3c4c86(0x1fa)])||_0x3c4c86(0x1da);_0x48469b===_0x3c4c86(0x1fd)&&(_0x48469b=_0x3c4c86(0x1cb)),(0x0,utils_2['throwError'])({'NineErrMsg':_0x48469b});}}catch(_0x5820d8){console[_0x3c4c86(0x11e)](_0x3c4c86(0x11c),_0x5820d8);const _0x5120ca=(_0x5820d8===null||_0x5820d8===void 0x0?void 0x0:_0x5820d8[_0x3c4c86(0x149)])||((_0x90e1e4=(_0xcef721=(_0x31b9b2=_0x5820d8===null||_0x5820d8===void 0x0?void 0x0:_0x5820d8[_0x3c4c86(0x125)])===null||_0x31b9b2===void 0x0?void 0x0:_0x31b9b2['data'])===null||_0xcef721===void 0x0?void 0x0:_0xcef721[_0x3c4c86(0x13d)])===null||_0x90e1e4===void 0x0?void 0x0:_0x90e1e4[_0x3c4c86(0x160)])||((_0x11c8e6=(_0x13b6fd=_0x5820d8===null||_0x5820d8===void 0x0?void 0x0:_0x5820d8[_0x3c4c86(0x125)])===null||_0x13b6fd===void 0x0?void 0x0:_0x13b6fd[_0x3c4c86(0x1e6)])===null||_0x11c8e6===void 0x0?void 0x0:_0x11c8e6[_0x3c4c86(0x13d)])||_0x3c4c86(0x12b);throw new common_1[(_0x3c4c86(0x121))](_0x5120ca,common_1[_0x3c4c86(0x1df)]['BAD_REQUEST']);}}async[_0x2a2ee9(0x1ad)](_0x318ebe,_0xa2987a){const _0x446912=_0x2a2ee9,{id:_0x3f998d}=_0x318ebe[_0x446912(0x126)],{base64:_0x1466bd}=_0xa2987a;if(!_0x1466bd)throw new common_1['HttpException'](_0x446912(0x119),common_1[_0x446912(0x1df)][_0x446912(0x1e2)]);await this[_0x446912(0x12d)](_0x318ebe[_0x446912(0x126)]['id']);const _0x31f54f=await this[_0x446912(0x156)](_0x446912(0x13c));await this[_0x446912(0x19e)][_0x446912(0x17c)](_0x318ebe,_0x446912(0x194),_0x31f54f);try{const _0xdc5c51={'botType':_0x446912(0x1b1),'base64':_0x1466bd,'notifyHook':await this[_0x446912(0x1ec)](),'state':_0x318ebe[_0x446912(0x126)]['id']+'|'+_0x31f54f},_0xc60202=await(await this[_0x446912(0x12f)]())[_0x446912(0x201)](_0x446912(0x1bb),_0xdc5c51);console[_0x446912(0x11e)]('res:\x20',_0xc60202[_0x446912(0x1e6)]);const {data:_0x1f775e}=_0xc60202,{code:_0x230b3c,result:_0x2deb2c,discordInstanceId:_0x3eb330}=_0x1f775e;if(_0x230b3c===0x1){const _0x433e3b=await this['drawEntity']['save']({'drawType':0x1,'status':_0x446912(0x163),'file':'','userId':_0x3f998d,'result':_0x2deb2c,'discordInstanceId':_0x3eb330,'prompt':'正在对上传图片进行咒语解析中...','promptEn':_0x446912(0x14c),'fullPrompt':_0x446912(0x14c)});await this[_0x446912(0x19e)]['deductFromBalance'](_0x318ebe['user']['id'],_0x446912(0x194),_0x31f54f,_0x31f54f);}else throw new common_1[(_0x446912(0x121))](_0x446912(0x1c6),common_1[_0x446912(0x1df)][_0x446912(0x1e2)]);}catch(_0x37619a){console[_0x446912(0x11e)]('error:\x20',_0x37619a);throw new common_1[(_0x446912(0x121))]('提交图生文任务失败、请检查系统日志',common_1[_0x446912(0x1df)]['BAD_REQUEST']);}}async[_0x2a2ee9(0x1f9)](_0x755334,_0x527c77){const _0x5f0ce9=_0x2a2ee9;try{const {id:_0x40e82c}=_0x755334[_0x5f0ce9(0x126)],{prompt:_0x4f4df2}=_0x527c77,_0x1e0a91={'botType':_0x5f0ce9(0x1b1),'prompt':_0x4f4df2,'notifyHook':await this[_0x5f0ce9(0x1ec)](),'state':''},_0x1885b1=await(await this['getAxiosInstance']())[_0x5f0ce9(0x201)](_0x5f0ce9(0x16a),_0x1e0a91),{data:_0x150c77}=_0x1885b1,{code:_0x2525d1,result:_0x18ba90,discordInstanceId:_0x5bfd97}=_0x150c77;if(_0x2525d1===0x1){const _0x371200=await this['drawEntity'][_0x5f0ce9(0x132)]({'drawType':0x1,'status':'NOT_START','prompt':_0x4f4df2,'userId':_0x40e82c,'result':_0x18ba90,'discordInstanceId':_0x5bfd97});}else throw new common_1[(_0x5f0ce9(0x121))](_0x5f0ce9(0x15d),common_1['HttpStatus'][_0x5f0ce9(0x1e2)]);}catch(_0x23ab80){console[_0x5f0ce9(0x11e)]('error:\x20',_0x23ab80);throw new common_1[(_0x5f0ce9(0x121))](_0x5f0ce9(0x15d),common_1[_0x5f0ce9(0x1df)][_0x5f0ce9(0x1e2)]);}}async[_0x2a2ee9(0x135)](_0x13948c,_0x360d11){const _0x34542c=_0x2a2ee9;var _0x4f0f61,_0x539579,_0x1e2c80,_0x10f6a0,_0x2093ac;try{const {resultId:_0x533f77}=_0x360d11;if(!_0x533f77)return;console[_0x34542c(0x11e)]('resultId:\x20',_0x533f77);const _0x38303f=await(await this[_0x34542c(0x12f)]())[_0x34542c(0x1e0)](_0x34542c(0x1bf)+_0x533f77+_0x34542c(0x10f));if(_0x38303f[_0x34542c(0x1e6)][_0x34542c(0x10d)]===0x1){const _0x382cf1=_0x38303f[_0x34542c(0x1e6)][_0x34542c(0x162)];return await this['drawEntity'][_0x34542c(0x13e)]({'result':_0x533f77},{'seed':_0x382cf1}),_0x382cf1;}else(0x0,utils_2[_0x34542c(0x165)])({'NineErrMsg':_0x34542c(0x17f)});}catch(_0x4d9402){const _0x32d5c1=(_0x4d9402===null||_0x4d9402===void 0x0?void 0x0:_0x4d9402[_0x34542c(0x149)])||((_0x1e2c80=(_0x539579=(_0x4f0f61=_0x4d9402===null||_0x4d9402===void 0x0?void 0x0:_0x4d9402[_0x34542c(0x125)])===null||_0x4f0f61===void 0x0?void 0x0:_0x4f0f61['data'])===null||_0x539579===void 0x0?void 0x0:_0x539579['error'])===null||_0x1e2c80===void 0x0?void 0x0:_0x1e2c80['message'])||((_0x2093ac=(_0x10f6a0=_0x4d9402===null||_0x4d9402===void 0x0?void 0x0:_0x4d9402[_0x34542c(0x125)])===null||_0x10f6a0===void 0x0?void 0x0:_0x10f6a0[_0x34542c(0x1e6)])===null||_0x2093ac===void 0x0?void 0x0:_0x2093ac['error'])||_0x34542c(0x12b);throw new common_1[(_0x34542c(0x121))](_0x32d5c1,common_1[_0x34542c(0x1df)][_0x34542c(0x1e2)]);}}async[_0x2a2ee9(0x110)](_0x1f5264,_0x5c65cc){return 0x1;}async[_0x2a2ee9(0x1bd)](_0x3f03e4){const _0xa09b9e=_0x2a2ee9,_0x1edf18=await this['uploadBase64ToMj'](_0x3f03e4);console[_0xa09b9e(0x11e)]('第一张上传图:\x20',_0x1edf18[0x0]);if(!_0x1edf18||!_0x1edf18[_0xa09b9e(0x180)])return'';return _0x1edf18[_0xa09b9e(0x19a)]('\x20\x20');}async[_0x2a2ee9(0x139)](_0x5ef7da){const _0x527fed=_0x2a2ee9;var _0x45a4b5;if(!_0x5ef7da[_0x527fed(0x180)])return[];const _0xc39892={'base64Array':_0x5ef7da},_0x39d3dd=await(await this[_0x527fed(0x12f)]())['post'](_0x527fed(0x1e9),_0xc39892);return(_0x45a4b5=_0x39d3dd===null||_0x39d3dd===void 0x0?void 0x0:_0x39d3dd[_0x527fed(0x1e6)])===null||_0x45a4b5===void 0x0?void 0x0:_0x45a4b5[_0x527fed(0x162)];}async['notifyDalleDraw'](_0x40112d,_0x106dc4){const _0x2f0dbf=_0x2a2ee9,{id:_0xcebd46}=_0x40112d[_0x2f0dbf(0x126)],{prompt:_0x21b403,taskType:_0x1126d7,version:_0x4a81b4,scale:_0x1a4855,quality:_0x3651f4,autoOptimize:_0x2f7605,style:_0x5a9606}=_0x106dc4,_0x4030f0=await this[_0x2f0dbf(0x196)][_0x2f0dbf(0x136)]();!_0x4030f0&&(0x0,utils_2[_0x2f0dbf(0x165)])({'NineErrMsg':'当前DallE绘画模型暂未上架、请联系管理员上架此模型！'});let _0x388fb2=_0x21b403;_0x2f7605?_0x388fb2=await this[_0x2f0dbf(0x1f1)]['chatGlobaltools']({'prompt':'现在请你担任Ai绘画的prompt\x20creator，主要任务是我会给您一个主题，然后请你根据主题\x20来书写提示词，提示词的格式如下：\x0a\x20\x20\x20\x20\x20\x20\x20\x20Style\x20+\x20Subject\x20+\x20Setting\x20+\x20Composition\x20+\x20Lighting\x20+\x20Additional\x20Info\x0a\x20\x20\x20\x20\x20\x20\x20\x20Style:\x20Photo\x20of\x0a\x20\x20\x20\x20\x20\x20\x20\x20Subject:An\x20astronaut\x20in\x20a\x20white\x20space\x20suit,\x20helmet\x20visor\x20reflecting\x20stars,\x0a\x20\x20\x20\x20\x20\x20\x20\x20Setting:\x20Standing\x20on\x20a\x20moon\x20with\x20Earth\x20visible\x20in\x20the\x20starry\x20sky,\x0a\x20\x20\x20\x20\x20\x20\x20\x20Composition:Astronaut\x20centered,\x20Earth\x20in\x20the\x20background,\x0a\x20\x20\x20\x20\x20\x20\x20\x20Lighting:Bright\x20sunlight\x20with\x20soft\x20moonlight\x20reflections,\x0a\x20\x20\x20\x20\x20\x20\x20\x20Additional\x20Info:\x20Moon\x20rocks\x20and\x20small\x20craters\x20nearby,\x0a\x20\x20\x20\x20\x20\x20\x20\x20参考上述的模板、将我给你的这段内容进行优化、对照上面格式、按着我的这段话发散思维、最后返回英文格式、不要返回其他任何东西、请优化这段内容\x20'+_0x21b403}):_0x388fb2=await this[_0x2f0dbf(0x1f1)][_0x2f0dbf(0x1c5)]({'prompt':'请将下面这句话翻译为英文、并且只回复我英文、不要回复任何别的内容、翻译这句话\x20'+_0x21b403});const {key:_0x37cc17}=_0x4030f0;let _0xae912d=_0x4030f0[_0x2f0dbf(0x152)];_0xae912d['endsWith']('/')&&(_0xae912d=_0xae912d[_0x2f0dbf(0x13f)](0x0,_0xae912d[_0x2f0dbf(0x180)]-0x1));const _0x2040f5=_0xae912d+_0x2f0dbf(0x183);let _0x17b49e={};Number(_0x4a81b4)===0x3?_0x17b49e={'prompt':_0x388fb2,'model':_0x2f0dbf(0x1f4),'size':_0x1a4855,'quality':_0x3651f4,'response_format':_0x2f0dbf(0x14d),'style':_0x5a9606,'n':0x1}:_0x17b49e={'prompt':_0x388fb2,'model':'dall-e-2','size':_0x1a4855,'response_format':_0x2f0dbf(0x14d),'n':0x1};const _0x1cf008={'drawType':0x2,'taskType':_0x1126d7,'prompt':_0x21b403,'promptEn':_0x388fb2,'scale':_0x1a4855,'quality':_0x3651f4,'userId':_0xcebd46,'version':_0x4a81b4,'model':'dalle','fullPrompt':_0x388fb2,'progress':'0%','status':'IN_PROGRESS'},_0x4af7f5=await this[_0x2f0dbf(0x151)]['save'](_0x1cf008);await this[_0x2f0dbf(0x196)]['saveUseLog'](_0x4030f0['id'],_0x4030f0[_0x2f0dbf(0x169)],0x0);const _0x22f169=Number(_0x4a81b4)===0x2?_0x2f0dbf(0x111):_0x2f0dbf(0x175),_0xbcedfb=await this['getDrawDecutConfig'](_0x22f169);return await this[_0x2f0dbf(0x19e)][_0x2f0dbf(0x1d8)](_0x40112d[_0x2f0dbf(0x126)]['id'],_0x2f0dbf(0x194),_0xbcedfb,_0xbcedfb),this[_0x2f0dbf(0x1e4)]({'api':_0x2040f5,'params':_0x17b49e,'key':_0x37cc17,'version':_0x4a81b4,'saveRes':_0x4af7f5,'userId':_0xcebd46,'amount':_0xbcedfb}),_0x4af7f5;}async[_0x2a2ee9(0x1e4)]({api:_0x49e4af,params:_0x295ff7,key:_0x3cef03,version:_0x5a4043,saveRes:_0x35256a,userId:_0x1a975a,amount:_0x1eca5a}){const _0x4ae580=_0x2a2ee9;var _0x2f3cac,_0x5e5120,_0x3fcfb4,_0x40dab0,_0x319145,_0x1023ee,_0x52c355,_0xfab215,_0x4ad6dc,_0x1e6826;try{const {id:_0x41c4fe}=_0x35256a,_0x1b5a5c=await axios_1[_0x4ae580(0x120)][_0x4ae580(0x201)](_0x49e4af,_0x295ff7,{'headers':{'Authorization':_0x4ae580(0x171)+_0x3cef03}});if(!_0x1b5a5c[_0x4ae580(0x1e6)][_0x4ae580(0x1e6)]||!((_0x5e5120=(_0x2f3cac=_0x1b5a5c===null||_0x1b5a5c===void 0x0?void 0x0:_0x1b5a5c[_0x4ae580(0x1e6)])===null||_0x2f3cac===void 0x0?void 0x0:_0x2f3cac[_0x4ae580(0x1e6)])===null||_0x5e5120===void 0x0?void 0x0:_0x5e5120[_0x4ae580(0x180)])){const _0x4cfee6=((_0x40dab0=(_0x3fcfb4=_0x1b5a5c===null||_0x1b5a5c===void 0x0?void 0x0:_0x1b5a5c[_0x4ae580(0x1e6)])===null||_0x3fcfb4===void 0x0?void 0x0:_0x3fcfb4['error'])===null||_0x40dab0===void 0x0?void 0x0:_0x40dab0[_0x4ae580(0x160)])||((_0x319145=_0x1b5a5c[_0x4ae580(0x1e6)])===null||_0x319145===void 0x0?void 0x0:_0x319145['error'])||_0x4ae580(0x12b);(0x0,utils_2[_0x4ae580(0x165)])({'NineErrMsg':_0x4cfee6});}const _0x411f4d=_0x1b5a5c[_0x4ae580(0x1e6)][_0x4ae580(0x1e6)][0x0][_0x4ae580(0x14d)]||_0x1b5a5c['data'][_0x4ae580(0x1e6)][0x0]['url'],_0x1fe2a8=_0x411f4d['replace'](/^data:image\/webp;base64,/,''),_0x2e341b=_0x4ae580(0x1ae)+_0x5a4043+'-'+uuid['v4']()[_0x4ae580(0x13f)](0x0,0xa)+_0x4ae580(0x191),_0x2f0a2d=Buffer['from'](_0x1fe2a8,_0x4ae580(0x128)),_0x39f200=await this[_0x4ae580(0x1cc)][_0x4ae580(0x11f)]({'originalname':_0x2e341b,'filename':_0x2e341b,'base64':_0x1fe2a8,'buffer':_0x2f0a2d}),_0x3dffcf={'status':_0x4ae580(0x1d5),'progress':'100%','originalImgUrl':_0x39f200,'url':_0x39f200};await this[_0x4ae580(0x151)]['update']({'id':_0x41c4fe},_0x3dffcf);}catch(_0x44c4e2){console['log']('drawDalleAndSave\x20--->:\x20',_0x44c4e2===null||_0x44c4e2===void 0x0?void 0x0:_0x44c4e2[_0x4ae580(0x125)]);const _0x532161=(_0x44c4e2===null||_0x44c4e2===void 0x0?void 0x0:_0x44c4e2[_0x4ae580(0x149)])||((_0xfab215=(_0x52c355=(_0x1023ee=_0x44c4e2===null||_0x44c4e2===void 0x0?void 0x0:_0x44c4e2[_0x4ae580(0x125)])===null||_0x1023ee===void 0x0?void 0x0:_0x1023ee[_0x4ae580(0x1e6)])===null||_0x52c355===void 0x0?void 0x0:_0x52c355['error'])===null||_0xfab215===void 0x0?void 0x0:_0xfab215[_0x4ae580(0x160)])||((_0x1e6826=(_0x4ad6dc=_0x44c4e2===null||_0x44c4e2===void 0x0?void 0x0:_0x44c4e2[_0x4ae580(0x125)])===null||_0x4ad6dc===void 0x0?void 0x0:_0x4ad6dc['data'])===null||_0x1e6826===void 0x0?void 0x0:_0x1e6826['error'])||_0x4ae580(0x154),_0x5dcd50={'status':'FAILURE','progress':'','requestErrTextTips':_0x532161};await this['userBalanceService'][_0x4ae580(0x1c2)](_0x1a975a,_0x1eca5a),await this[_0x4ae580(0x151)][_0x4ae580(0x13e)]({'id':_0x35256a['id']},_0x5dcd50);}}async[_0x2a2ee9(0x1ef)](_0x3f8b6b){const _0x8a93a7=_0x2a2ee9,_0x5c107e=/--\w+\s\S+/g;return _0x3f8b6b[_0x8a93a7(0x118)](_0x5c107e,'');}async['formatMjDrawPrompt'](_0x472ba9){const _0x10c1df=_0x2a2ee9,{parsePrompt:_0x20a264,version:_0x3ec4d8,quality:_0x54f2b9,chaos:_0x25261e,stylize:_0x2fe382,style:_0x28f57c,scale:_0x549f9d,model:_0x3843c2,seed:_0x19b819,iw:_0x343606,referencePic:_0x4d6edb,no:_0x4b8108,cameraShot:_0x1a43a8,light:_0x3a64b5,view:_0xc282ba}=_0x472ba9;if(_0x472ba9===null||_0x472ba9===void 0x0?void 0x0:_0x472ba9[_0x10c1df(0x1d7)])return _0x20a264;let _0x59ffe5=await this[_0x10c1df(0x1ef)](_0x20a264);const _0x3fb235=[_0x1a43a8,_0x3a64b5,_0xc282ba]['filter'](_0x5b8d4d=>_0x5b8d4d)[_0x10c1df(0x19a)](',');return _0x3fb235&&(_0x59ffe5=_0x59ffe5+'\x20\x20'+_0x3fb235),_0x4b8108&&(_0x59ffe5=_0x59ffe5+_0x10c1df(0x18f)+_0x4b8108),_0x549f9d&&(_0x59ffe5=_0x59ffe5+_0x10c1df(0x1aa)+_0x549f9d[_0x10c1df(0x19a)](':')),_0x19b819&&(_0x59ffe5=_0x59ffe5+_0x10c1df(0x179)+_0x19b819),_0x3843c2===_0x10c1df(0x17e)&&(_0x59ffe5=_0x59ffe5+_0x10c1df(0x123)+_0x3ec4d8),_0x4d6edb&&_0x4d6edb['length']&&(_0x59ffe5=_0x59ffe5+'\x20--iw\x20'+_0x343606),_0x54f2b9&&(_0x59ffe5=_0x59ffe5+_0x10c1df(0x197)+_0x54f2b9),_0x25261e&&(_0x59ffe5=_0x59ffe5+_0x10c1df(0x1b7)+_0x25261e),_0x2fe382&&Number(_0x3ec4d8)!==0x5&&(_0x59ffe5=_0x59ffe5+_0x10c1df(0x1fc)+_0x2fe382),_0x3843c2==='mj'&&(_0x59ffe5=_0x59ffe5+_0x10c1df(0x1dc)+_0x3ec4d8,Number(_0x3ec4d8)===0x5&&_0x28f57c&&(_0x59ffe5=_0x59ffe5+_0x10c1df(0x1f2)+_0x28f57c)),_0x59ffe5=_0x59ffe5+'\x20',_0x59ffe5;}async['getImageDimensionsFromUrl'](_0xa727f0){const _0x214d8d=_0x2a2ee9;try{const _0x324818=await axios_1[_0x214d8d(0x120)][_0x214d8d(0x1e0)](_0xa727f0,{'responseType':_0x214d8d(0x1c1)}),_0x3e0a1c=Buffer[_0x214d8d(0x1f5)](_0x324818[_0x214d8d(0x1e6)],_0x214d8d(0x14e)),_0x59a4fd=(0x0,image_size_1['default'])(_0x3e0a1c);return{'width':_0x59a4fd[_0x214d8d(0x1e8)],'height':_0x59a4fd[_0x214d8d(0x1f7)]};}catch(_0xe686a8){return console[_0x214d8d(0x13d)](_0x214d8d(0x146),_0xe686a8),{'width':0x0,'height':0x0};}}async[_0x2a2ee9(0x177)](){const _0x37be2f=_0x2a2ee9,_0x4c5022=await this[_0x37be2f(0x1e7)][_0x37be2f(0x168)]([_0x37be2f(0x181)]);if(!_0x4c5022)return'';const _0x15abbb=_0x4c5022[_0x37be2f(0x1a6)]('/')?_0x4c5022[_0x37be2f(0x13f)](0x0,_0x4c5022[_0x37be2f(0x180)]-0x1):_0x4c5022;return _0x15abbb;}async[_0x2a2ee9(0x1ec)](){const _0x2460a1=_0x2a2ee9,_0x242dcd=await this[_0x2460a1(0x1e7)][_0x2460a1(0x168)]([_0x2460a1(0x115)]);if(!_0x242dcd)return'';if(_0x242dcd){const _0x2fd5db=_0x242dcd[_0x2460a1(0x1a6)]('/')?_0x242dcd['slice'](0x0,_0x242dcd[_0x2460a1(0x180)]-0x1):_0x242dcd;return _0x2fd5db+_0x2460a1(0x11b);}}async[_0x2a2ee9(0x1c8)](_0xd62caa){const _0x228615=_0x2a2ee9;try{const _0x1f0baf=[];for(let _0xeb9ec9=0x0;_0xeb9ec9<_0xd62caa[_0x228615(0x180)];_0xeb9ec9++){const _0xa025fc=_0xd62caa[_0xeb9ec9],_0xde38f7='random-'+uuid['v4']()[_0x228615(0x13f)](0x0,0xa)+_0x228615(0x191),_0x441faa=Buffer[_0x228615(0x1f5)](_0xa025fc,_0x228615(0x128)),_0x334fbb=await this['uploadService'][_0x228615(0x11f)]({'originalname':_0xde38f7,'filename':_0xde38f7,'base64':_0xa025fc,'buffer':_0x441faa});_0x1f0baf['push'](_0x334fbb);}return _0x1f0baf;}catch(_0xdd1a57){return[];}}async[_0x2a2ee9(0x156)](_0x5675a5){const _0x229b9d=_0x2a2ee9,_0x317543=await this[_0x229b9d(0x1e7)][_0x229b9d(0x168)]([_0x229b9d(0x1a0),_0x229b9d(0x17d),'mjBlendImageMoney',_0x229b9d(0x142),_0x229b9d(0x1ce),_0x229b9d(0x1a8),_0x229b9d(0x1b3),_0x229b9d(0x116),_0x229b9d(0x137),_0x229b9d(0x111),_0x229b9d(0x175),'mjDescribeMoney']);if(Number(_0x317543['mjFreeUse'])===0x1)return 0x0;return _0x317543[_0x5675a5]?Number(_0x317543[_0x5675a5]):0x1;}async[_0x2a2ee9(0x19f)](_0x4a4676,_0x1c2d53){const _0x5edd3c=_0x2a2ee9,{taskType:_0x5c58f9,version:_0x592b55}=_0x1c2d53;let _0x4d8110=0x1;_0x5c58f9===0x1&&(_0x4d8110=await this[_0x5edd3c(0x156)](_0x5edd3c(0x17d)));_0x5c58f9===0x2&&(_0x4d8110=await this[_0x5edd3c(0x156)](_0x5edd3c(0x130)));_0x5c58f9===0x3&&(_0x4d8110=await this[_0x5edd3c(0x156)](_0x5edd3c(0x142)));if(_0x5c58f9===0x4){const _0x3229bf=Number(_0x592b55)===0x2?'dalleModel2Meney':'dalleModel3Meney';_0x4d8110=await this[_0x5edd3c(0x156)](_0x3229bf);}await this[_0x5edd3c(0x19e)][_0x5edd3c(0x17c)](_0x4a4676,_0x5edd3c(0x194),_0x4d8110);}async[_0x2a2ee9(0x12d)](_0x4ceb37){const _0x3ca520=_0x2a2ee9,_0x3944d0=await this[_0x3ca520(0x151)][_0x3ca520(0x1d9)]({'where':{'userId':_0x4ceb37,'status':(0x0,typeorm_2['In'])([_0x3ca520(0x163),_0x3ca520(0x10b),_0x3ca520(0x158)])}});console[_0x3ca520(0x11e)](_0x3ca520(0x147),_0x3944d0);const _0x544537=await this[_0x3ca520(0x1e7)][_0x3ca520(0x168)](['mjUserLimit']),_0x2c9219=_0x544537?Number(_0x544537):0x2;if(_0x3944d0>=_0x2c9219)throw new common_1[(_0x3ca520(0x121))]('当前管理员限制同时最大任务数量为'+_0x2c9219+'、请等待任务结束后继续！',common_1[_0x3ca520(0x1df)][_0x3ca520(0x1e2)]);}async[_0x2a2ee9(0x1a4)](_0x2aff8c){const _0x1de4fb=_0x2a2ee9,{page:page=0x1,size:size=0x14,sysRec:_0x3898fa,userId:_0x4e4ce8,status:_0x490fda}=_0x2aff8c,_0x4cfaf1={'isDelete':0x1};_0x3898fa&&Object['assign'](_0x4cfaf1,{'sysRec':Number(_0x3898fa)}),_0x4e4ce8&&Object[_0x1de4fb(0x1b9)](_0x4cfaf1,{'userId':_0x4e4ce8}),_0x490fda&&Object[_0x1de4fb(0x1b9)](_0x4cfaf1,{'status':_0x490fda});const [_0x4392a5,_0xb9a51]=await this['drawEntity'][_0x1de4fb(0x10e)]({'where':_0x4cfaf1,'order':{'id':_0x1de4fb(0x18b)},'take':size,'skip':(page-0x1)*size}),_0x279414=await this[_0x1de4fb(0x177)]();_0x4392a5[_0x1de4fb(0x1b2)](_0x4a0a8b=>{const _0x1d367a=_0x1de4fb;try{_0x4a0a8b[_0x1d367a(0x1ea)]&&_0x4a0a8b[_0x1d367a(0x1ea)]['includes'](_0x1d367a(0x170))&&_0x279414&&(_0x4a0a8b[_0x1d367a(0x1ea)]=_0x4a0a8b[_0x1d367a(0x1ea)][_0x1d367a(0x118)](_0x1d367a(0x170),_0x279414));}catch(_0x2f0549){}});const _0x1e20ae={'rows':_0x4392a5,'count':_0xb9a51};return _0x1e20ae;}async['detail'](_0x4cd929){const _0xc86ea2=_0x2a2ee9,{id:_0x1d4180}=_0x4cd929,_0x41944a=await this[_0xc86ea2(0x151)]['findOne']({'where':{'id':_0x1d4180},'select':['prompt',_0xc86ea2(0x1f3),'id']});return _0x41944a;}async['getDectDetail'](){const _0x3ba65e=_0x2a2ee9,_0x4aca9a=await this['globalConfigService'][_0x3ba65e(0x168)](['mjFreeUse',_0x3ba65e(0x17d),_0x3ba65e(0x130),'mjSwapFaceImageMoney',_0x3ba65e(0x1ce),_0x3ba65e(0x1a8),_0x3ba65e(0x1b3),_0x3ba65e(0x116),_0x3ba65e(0x137),_0x3ba65e(0x111),'dalleModel3Meney',_0x3ba65e(0x13c),_0x3ba65e(0x1c9)]);return Number(_0x4aca9a[_0x3ba65e(0x1a0)])===0x1&&Object['keys'](_0x4aca9a)[_0x3ba65e(0x1b2)](_0x1185df=>{const _0x2498b8=_0x3ba65e;![_0x2498b8(0x1a0),_0x2498b8(0x1c9)]['includes'](_0x1185df)&&(_0x4aca9a[_0x1185df]=0x0);}),_0x4aca9a;}async[_0x2a2ee9(0x10c)](){const _0x19f005=_0x2a2ee9,_0x1552ea=await this[_0x19f005(0x1e7)]['getConfigs']([_0x19f005(0x1c9)]);return _0x1552ea;}async[_0x2a2ee9(0x1dd)](_0x4f918e,_0x17037c=0x1e){const _0x8845bf=_0x2a2ee9;try{const _0x16452d=await(0x0,axios_1[_0x8845bf(0x120)])({'method':_0x8845bf(0x1e0),'url':_0x4f918e,'responseType':'arraybuffer'}),_0x48768e=Buffer[_0x8845bf(0x1f5)](_0x16452d[_0x8845bf(0x1e6)],_0x8845bf(0x14e)),_0x31c242=await sharp(_0x48768e)['jpeg']({'quality':_0x17037c})[_0x8845bf(0x1ab)]();return _0x31c242;}catch(_0x369890){return null;}}};DrawService=__decorate([(0x0,common_1['Injectable'])(),__param(0x1,(0x0,typeorm_1[_0x2a2ee9(0x1ed)])(draw_entity_1[_0x2a2ee9(0x1f8)])),__param(0x2,(0x0,typeorm_1[_0x2a2ee9(0x1ed)])(config_entity_1[_0x2a2ee9(0x18a)])),__param(0x3,(0x0,typeorm_1[_0x2a2ee9(0x1ed)])(user_entity_1[_0x2a2ee9(0x13b)])),__metadata('design:paramtypes',[upload_service_1[_0x2a2ee9(0x16d)],typeorm_2[_0x2a2ee9(0x14f)],typeorm_2['Repository'],typeorm_2['Repository'],chatgpt_service_1[_0x2a2ee9(0x114)],models_service_1[_0x2a2ee9(0x12a)],globalConfig_service_1[_0x2a2ee9(0x188)],userBalance_service_1['UserBalanceService']])],DrawService),exports[_0x2a2ee9(0x127)]=DrawService;function _0x5836(){const _0x1bd069=['niji','获取seed失败','length','mjImageProxy','formatCreateOrUpdateDate','/v1/images/generations','id不能为空','notify\x20-------->','drawSwapFaceAction\x20code\x20!=\x201:\x20\x20441','includes','GlobalConfigService','2489685CzPrrT','ConfigEntity','DESC','请将下面这句话翻译为英文、并且只回复我英文、不要回复任何别的内容、翻译这句话\x20','\x20裁剪缩略图任务完成:\x20','axios','\x20--no\x20','确认弹窗任务失败、缺失必要参数！','.png','parse','mjProxyUrl','mjDraw','CustomZoom','modelsService','\x20--q\x20','zoomPrompt','application/json','join','取消推荐成功','delItem','delete','userBalanceService','drawValidateBalance','mjFreeUse','未找到该项','map','15252lRVqRK','getList','reroll','endsWith','@nestjs/typeorm','mjVariationMoney','convertUrlsToBase64','\x20--ar\x20','toBuffer','fast','imgToText','dall-e-','执行混图任务失败、请检查系统日志','混图任务至少需要两张图片!','MID_JOURNEY','forEach','mjPanMoney','未配置当前模式绘画服务','email','mineList','\x20--c\x20','typeorm','assign','SUCCESS','/mj/submit/describe','maskBase64','getFormatString','3214953RoDGXr','/mj/task/','findOne','arraybuffer','drawFailRefund','create','__esModule','chatGlobaltools','提交图生文任务失败、请检查系统日志','DEBUG','getUrlByUploadBase','mjNotice','Executing\x20mixed\x20image\x20task...','管理员配置模型余额不足\x20请联系管理员！','uploadService','userId','mjUpscaleMoney','onModuleInit','现在请你担任Ai绘画的prompt\x20creator，主要任务是我会给您一个主题，然后请你根据主题\x20来书写提示词，提示词的格式如下：\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Style\x20+\x20Subject\x20+\x20Setting\x20+\x20Composition\x20+\x20Lighting\x20+\x20Additional\x20Info\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Style:\x20Photo\x20of\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Subject:An\x20astronaut\x20in\x20a\x20white\x20space\x20suit,\x20helmet\x20visor\x20reflecting\x20stars,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Setting:\x20Standing\x20on\x20a\x20moon\x20with\x20Earth\x20visible\x20in\x20the\x20starry\x20sky,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Composition:Astronaut\x20centered,\x20Earth\x20in\x20the\x20background,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Lighting:Bright\x20sunlight\x20with\x20soft\x20moonlight\x20reflections,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Additional\x20Info:\x20Moon\x20rocks\x20and\x20small\x20craters\x20nearby,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20参考上述的模板、将我给你的这段内容进行优化、对照上面格式、按着我的这段话发散思维、最后返回英文格式、不要返回其他任何东西、请优化这段内容\x20','decorate','../models/models.service','Inpaint','res?.data:\x20','FINISH','userEntity','customInstruct','deductFromBalance','count','执行换脸任务失败、请检查系统日志','未知图片！','\x20--v\x20','compressionImg','uuid','HttpStatus','get','find','BAD_REQUEST','NineErrMsg:\x20','drawDalleAndSave','username','data','globalConfigService','width','/mj/submit/upload-discord-images','originalImgUrl','混图任务最多支持6张图片!','getNotifyUrl','InjectRepository','drawAction','removeParameters','notifyDalleDraw','chatgptService','\x20--style\x20','promptEn','dall-e-3','from','Executing\x20AI\x20face\x20swap...','height','DrawEntity','drawShorten','description','sharp','\x20--s\x20','quota_not_enough','/mj/insight-face/swap','configEntity','873986GYTWiS','post','/mj/submit/imagine','IN_PROGRESS','notice','code','findAndCount','/image-seed','describe','dalleModel2Meney','formatMjDrawPrompt','216300rQimaA','ChatgptService','mjNotifyUrl','mjZoomMoney','status','replace','缺少解析图！','object','/api/draw/mjPlusNotify','error:\x20','res:\x20','log','uploadFile','default','HttpException','drawBlend','\x20--niji\x20','无权删除他人作品','response','user','DrawService','base64','pan','ModelsService','提交Action任务失败、请检查系统日志','1124805yEUNVN','checkUserDrawLimit','正在执行混图任务中......','getAxiosInstance','mjBlendImageMoney','./utils','save','../globalConfig/config.entity','drawAction\x20error:\x20','getSeed','getUseDrawModelKey','mjRedrawMoney','../globalConfig/globalConfig.service','uploadBase64ToMj','env','UserEntity','mjDescribeMoney','error','update','slice','delDrawItem','adminDrawList','mjSwapFaceImageMoney','/mj/submit/blend','../upload/upload.service','2599122CNnKru','Error\x20in\x20getImageDimensionsFromUrl:','当前绘制中任务:\x20','推荐成功','NineErrMsg','moadl\x20confirm\x20res.data:\x20','定时裁剪缩略图任务扫描中----->\x20待裁剪长度-------->:\x20','Analyzing\x20the\x20uploaded\x20image...','b64_json','binary','Repository','../../common/utils','drawEntity','proxyUrl','stringify','提交Dall-E绘画任务失败、已退还你的余额、请检查系统日志','metadata','getDrawDecutConfig','function','SUBMITTED','textToImage\x20error:\x20','Outpaint','mj\x20notify\x20err:\x20','../user/user.entity','提交任务失败、请检查系统配置','/mj/submit/action','/mj/submit/modal','message','defineProperty','result','NOT_START','drawBlend:\x20','throwError','mjPartDrawMoney','裁剪缩略图任务失败:\x20','getConfigs','modelTypeId','/mj/submit/shorten','sysRec','prompt','UploadService','__decorate','reverse','https://cdn.discordapp.com','Bearer\x20','thumb-mj-[','定时裁剪缩略图任务扫描中..........','mjSecretKey','dalleModel3Meney','getImageDimensionsFromUrl','getMjImageProxyUrl','taskCroppingThumbUrl','\x20--seed\x20','Not','avatar','validateBalance','mjImageMoney'];_0x5836=function(){return _0x1bd069;};return _0x5836();}