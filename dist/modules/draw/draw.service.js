'use strict';function _0x267e(_0x5cbb33,_0x12cefb){const _0x25f202=_0x25f2();return _0x267e=function(_0x267eb1,_0xd7236a){_0x267eb1=_0x267eb1-0xe8;let _0x428c6a=_0x25f202[_0x267eb1];return _0x428c6a;},_0x267e(_0x5cbb33,_0x12cefb);}const _0x741979=_0x267e;(function(_0x354abf,_0x409032){const _0x442e07=_0x267e,_0x559e94=_0x354abf();while(!![]){try{const _0x11e400=parseInt(_0x442e07(0x15e))/0x1*(parseInt(_0x442e07(0x1a4))/0x2)+parseInt(_0x442e07(0x1ec))/0x3*(-parseInt(_0x442e07(0x19a))/0x4)+-parseInt(_0x442e07(0x1df))/0x5*(-parseInt(_0x442e07(0x1ed))/0x6)+-parseInt(_0x442e07(0x136))/0x7+-parseInt(_0x442e07(0xea))/0x8*(-parseInt(_0x442e07(0xfd))/0x9)+-parseInt(_0x442e07(0x1c5))/0xa+-parseInt(_0x442e07(0x193))/0xb*(-parseInt(_0x442e07(0xef))/0xc);if(_0x11e400===_0x409032)break;else _0x559e94['push'](_0x559e94['shift']());}catch(_0x4b3bac){_0x559e94['push'](_0x559e94['shift']());}}}(_0x25f2,0xaf59a));var __decorate=this&&this[_0x741979(0x185)]||function(_0x3dc72d,_0x14fab2,_0x40e66a,_0x4472a6){const _0x77c92b=_0x741979;var _0x2d634e=arguments[_0x77c92b(0x1cd)],_0x5aafbc=_0x2d634e<0x3?_0x14fab2:_0x4472a6===null?_0x4472a6=Object[_0x77c92b(0xfc)](_0x14fab2,_0x40e66a):_0x4472a6,_0x4968e0;if(typeof Reflect==='object'&&typeof Reflect[_0x77c92b(0x10a)]===_0x77c92b(0x1d6))_0x5aafbc=Reflect[_0x77c92b(0x10a)](_0x3dc72d,_0x14fab2,_0x40e66a,_0x4472a6);else{for(var _0x37a19d=_0x3dc72d[_0x77c92b(0x1cd)]-0x1;_0x37a19d>=0x0;_0x37a19d--)if(_0x4968e0=_0x3dc72d[_0x37a19d])_0x5aafbc=(_0x2d634e<0x3?_0x4968e0(_0x5aafbc):_0x2d634e>0x3?_0x4968e0(_0x14fab2,_0x40e66a,_0x5aafbc):_0x4968e0(_0x14fab2,_0x40e66a))||_0x5aafbc;}return _0x2d634e>0x3&&_0x5aafbc&&Object[_0x77c92b(0x178)](_0x14fab2,_0x40e66a,_0x5aafbc),_0x5aafbc;},__metadata=this&&this[_0x741979(0x1d1)]||function(_0x10521f,_0x52bf6a){const _0x5cd3f0=_0x741979;if(typeof Reflect==='object'&&typeof Reflect['metadata']==='function')return Reflect[_0x5cd3f0(0x144)](_0x10521f,_0x52bf6a);},__param=this&&this['__param']||function(_0x4925ab,_0x4e393f){return function(_0x37f767,_0x4f2983){_0x4e393f(_0x37f767,_0x4f2983,_0x4925ab);};};Object[_0x741979(0x178)](exports,_0x741979(0x197),{'value':!![]}),exports[_0x741979(0x1bb)]=void 0x0;const common_1=require('@nestjs/common'),axios_1=require(_0x741979(0x11a)),uuid=require(_0x741979(0x13c)),upload_service_1=require(_0x741979(0x153)),typeorm_1=require('@nestjs/typeorm'),draw_entity_1=require(_0x741979(0x137)),typeorm_2=require(_0x741979(0x174)),config_entity_1=require(_0x741979(0x1ae)),utils_1=require('./utils'),utils_2=require(_0x741979(0xe9)),chatgpt_service_1=require('./../chatgpt/chatgpt.service'),models_service_1=require(_0x741979(0x1a3)),date_1=require('../../common/utils/date'),globalConfig_service_1=require(_0x741979(0x1aa)),user_entity_1=require(_0x741979(0x11f)),image_size_1=require(_0x741979(0x143)),userBalance_service_1=require(_0x741979(0x19d)),sharp=require(_0x741979(0x15a));let DrawService=class DrawService{constructor(_0x266d59,_0x2f1982,_0x318be9,_0x308692,_0x12ccba,_0x24d8f1,_0x34ae0e,_0x3dce08){const _0x21a156=_0x741979;this['uploadService']=_0x266d59,this[_0x21a156(0x133)]=_0x2f1982,this[_0x21a156(0x140)]=_0x318be9,this[_0x21a156(0x1ce)]=_0x308692,this[_0x21a156(0x107)]=_0x12ccba,this[_0x21a156(0x154)]=_0x24d8f1,this['globalConfigService']=_0x34ae0e,this[_0x21a156(0x10e)]=_0x3dce08;}async['onModuleInit'](){setTimeout(()=>{const _0x35d7b6=_0x267e;this[_0x35d7b6(0x186)]();},0x3e8);}async[_0x741979(0x186)](){const _0x4e3557=_0x741979;console[_0x4e3557(0x194)](_0x4e3557(0x1a0));try{const _0x35e437=await this[_0x4e3557(0x133)][_0x4e3557(0x124)]({'where':{'isThumb':-0x1,'isDelete':0x1,'status':_0x4e3557(0xf7),'originalImgUrl':(0x0,typeorm_2[_0x4e3557(0x1bf)])('')},'select':['id',_0x4e3557(0x163),_0x4e3557(0x10d)]}),_0x51f7d6=await this[_0x4e3557(0x17c)]();console[_0x4e3557(0x194)](_0x4e3557(0x112),_0x35e437[_0x4e3557(0x1cd)]);for(const _0x2405e8 of _0x35e437){const _0x3ce9e3=_0x51f7d6?_0x2405e8[_0x4e3557(0x163)]['replace'](_0x4e3557(0x17a),_0x51f7d6):_0x2405e8['originalImgUrl'],_0x700b44=await this[_0x4e3557(0x175)](_0x3ce9e3);if(!_0x700b44)return;const _0x491aaa={'originalname':_0x4e3557(0x164)+_0x2405e8['id']+']-'+uuid['v4']()['slice'](0x0,0xa)+_0x4e3557(0x119),'filename':_0x4e3557(0x164)+_0x2405e8['id']+']-'+uuid['v4']()[_0x4e3557(0xff)](0x0,0xa)+_0x4e3557(0x119),'buffer':_0x700b44},_0x3c0b10=await this[_0x4e3557(0x1e0)]['uploadFile'](_0x491aaa);console[_0x4e3557(0x194)]('--------------->\x20\x20id:\x20'+_0x2405e8['id']+_0x4e3557(0xf0),_0x3c0b10),_0x3c0b10&&await this[_0x4e3557(0x133)]['update']({'id':_0x2405e8['id']},{'thumb':_0x3c0b10,'isThumb':0x1});}}catch(_0x34e9cb){console['log'](_0x4e3557(0x16f),_0x34e9cb);}}async['getAxiosInstance'](){const _0xb511ef=_0x741979,{mjProxyUrl:_0xb112d9,mjSecretKey:_0x3a7e73}=await this['globalConfigService'][_0xb511ef(0x18d)]([_0xb511ef(0x1c4),_0xb511ef(0x12f)]);return(!_0xb112d9||!_0x3a7e73)&&(0x0,utils_2[_0xb511ef(0x195)])({'NineErrMsg':'未配置当前模式绘画服务'}),axios_1[_0xb511ef(0x161)]['create']({'timeout':0x3e8*0x3c,'headers':{'Content-Type':_0xb511ef(0x1b3),'mj-api-secret':_0x3a7e73},'baseURL':_0xb112d9['endsWith']('/')?_0xb112d9[_0xb511ef(0xff)](0x0,_0xb112d9[_0xb511ef(0x1cd)]-0x1):_0xb112d9});}async[_0x741979(0x1e7)](_0x144ec3){const _0xbe93ba=_0x741979,{page:page=0x1,size:size=0x14}=_0x144ec3,[_0x5dccc3,_0x2e322f]=await this['drawEntity'][_0xbe93ba(0x1c0)]({'where':{'sysRec':'1'},'skip':(page-0x1)*size,'take':size,'order':{'id':_0xbe93ba(0x116)}}),_0x3e6776=await this[_0xbe93ba(0x17c)](),_0x33235=_0x5dccc3[_0xbe93ba(0x14a)](_0x27500b=>_0x27500b['userId']),_0x5379b0=await this[_0xbe93ba(0x1ce)][_0xbe93ba(0x124)]({'where':{'id':(0x0,typeorm_2['In'])(_0x33235)},'select':['id',_0xbe93ba(0x141),_0xbe93ba(0x18e),_0xbe93ba(0x15b)]});return{'count':_0x2e322f,'rows':(0x0,date_1[_0xbe93ba(0x17b)])(_0x5dccc3['reverse']())[_0xbe93ba(0x14a)](_0x39abda=>{const _0x418378=_0xbe93ba;return _0x39abda[_0x418378(0x163)]&&_0x39abda[_0x418378(0x163)][_0x418378(0x125)](_0x418378(0x17a))&&_0x3e6776&&(_0x39abda[_0x418378(0x163)]=_0x39abda['originalImgUrl'][_0x418378(0x1b1)](_0x418378(0x17a),_0x3e6776)),_0x39abda['userInfo']=_0x5379b0[_0x418378(0x124)](_0x5c7883=>_0x5c7883['id']===_0x39abda[_0x418378(0x1a5)]),_0x39abda;})};}async[_0x741979(0x1c9)](_0x54cca1){const _0x435465=_0x741979,{page:page=0x1,size:size=0xa,sysRec:_0x1dbf61,userId:_0x1752c5,status:_0x20f454}=_0x54cca1,_0x1d23e8={};_0x1dbf61&&Object[_0x435465(0x1c1)](_0x1d23e8,{'sysRec':_0x1dbf61}),_0x1752c5&&Object[_0x435465(0x1c1)](_0x1d23e8,{'userId':_0x1752c5}),_0x20f454&&Object[_0x435465(0x1c1)](_0x1d23e8,{'status':_0x20f454});const [_0x4b0215,_0x148d98]=await this[_0x435465(0x133)][_0x435465(0x1c0)]({'where':_0x1d23e8,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x435465(0x116)}}),_0x38ce71=await this['getMjImageProxyUrl'](),_0x18cddd=_0x4b0215['map'](_0x543c0b=>_0x543c0b['userId']),_0x41d75a=await this[_0x435465(0x1ce)][_0x435465(0x124)]({'where':{'id':(0x0,typeorm_2['In'])(_0x18cddd)},'select':['id',_0x435465(0x141),_0x435465(0x18e),_0x435465(0x15b)]});return{'count':_0x148d98,'rows':(0x0,date_1['formatCreateOrUpdateDate'])(_0x4b0215)['map'](_0x3ad982=>{const _0x3ce0a5=_0x435465;return _0x3ad982[_0x3ce0a5(0x163)]&&_0x3ad982[_0x3ce0a5(0x163)][_0x3ce0a5(0x125)](_0x3ce0a5(0x17a))&&_0x38ce71&&(_0x3ad982[_0x3ce0a5(0x163)]=_0x3ad982[_0x3ce0a5(0x163)][_0x3ce0a5(0x1b1)]('https://cdn.discordapp.com',_0x38ce71)),_0x3ad982[_0x3ce0a5(0x147)]=_0x41d75a['find'](_0x5d7611=>_0x5d7611['id']===_0x3ad982[_0x3ce0a5(0x1a5)]),_0x3ad982;})};}async[_0x741979(0x160)](_0x38d267,_0x3d4dcb){const _0x55e651=_0x741979,{id:_0x11b474}=_0x38d267['user'],{id:_0x34e287}=_0x3d4dcb,_0x491616=await this[_0x55e651(0x133)][_0x55e651(0x1c8)]({'where':{'id':_0x34e287}});if(!_0x491616)throw new common_1['HttpException']('未找到该项',common_1[_0x55e651(0x19c)][_0x55e651(0x170)]);const {userId:_0x588909}=_0x491616;if(_0x11b474!==_0x588909)throw new common_1[(_0x55e651(0x15d))]('无权删除他人作品',common_1[_0x55e651(0x19c)]['BAD_REQUEST']);return await this[_0x55e651(0x133)]['update']({'id':_0x34e287},{'isDelete':-0x1}),!![];}async['mineList'](_0x4a2efa,_0x5652e9){const _0x2dbb3f=_0x741979,{id:_0x48184b}=_0x4a2efa[_0x2dbb3f(0x1c7)],{page:page=0x1,size:size=0xa,sysRec:_0x3de01a,status:_0x2f504f}=_0x5652e9,_0xb2456e={'userId':_0x48184b,'isDelete':0x1};_0x3de01a&&(_0xb2456e[_0x2dbb3f(0x1f0)]=_0x3de01a),_0x2f504f&&(_0xb2456e[_0x2dbb3f(0x187)]=_0x2f504f);const [_0x4aded9,_0x51a2d0]=await this[_0x2dbb3f(0x133)]['findAndCount']({'where':_0xb2456e,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x2dbb3f(0x116)}}),_0x32c2b5=await this['getMjImageProxyUrl']();return{'count':_0x51a2d0,'rows':(0x0,date_1[_0x2dbb3f(0x17b)])(_0x4aded9[_0x2dbb3f(0x16b)]())[_0x2dbb3f(0x14a)](_0x1a8942=>{const _0x397266=_0x2dbb3f;return _0x1a8942[_0x397266(0x163)]&&_0x1a8942[_0x397266(0x163)][_0x397266(0x125)]('https://cdn.discordapp.com')&&_0x32c2b5&&(_0x1a8942[_0x397266(0x163)]=_0x1a8942[_0x397266(0x163)][_0x397266(0x1b1)](_0x397266(0x17a),_0x32c2b5)),_0x1a8942;})};}async[_0x741979(0x184)](_0x3c3bb2){const _0x33084a=_0x741979;try{process[_0x33084a(0x11c)][_0x33084a(0x1ee)]==='1'&&console[_0x33084a(0x194)](_0x33084a(0x126),JSON[_0x33084a(0x1d0)](_0x3c3bb2));const _0x84c49d=_0x3c3bb2===null||_0x3c3bb2===void 0x0?void 0x0:_0x3c3bb2['id'];if(!_0x84c49d)return;const {id:_0x285978,properties:_0x11ae55,action:_0x9fa129,status:_0x465b61,promptEn:_0x42e8ab,description:_0x35bf56,submitTime:_0x2d6698,startTime:_0x1229fb,finishTime:_0x40c541,progress:_0x5cb0d3,imageUrl:_0x26d817,failReason:_0x2c0a13,state:_0x502aad,buttons:_0x26df53}=_0x3c3bb2,{discordInstanceId:_0x52cbcf,finalPrompt:_0x1eb2a7,messageContent:_0x141f28}=_0x11ae55,_0x4d4eb7={'discordInstanceId':_0x52cbcf,'action':_0x9fa129,'status':_0x465b61,'promptEn':_0x1eb2a7,'requestTextTips':_0x35bf56,'requestErrTextTips':_0x2c0a13,'submitTime':_0x2d6698,'startTime':_0x1229fb,'finishTime':_0x40c541,'progress':_0x5cb0d3,'originalImgUrl':_0x26d817,'state':_0x502aad,'buttons':JSON[_0x33084a(0x1d0)](_0x26df53),'detail':JSON['stringify'](_0x3c3bb2),'messageContent':_0x141f28};await this[_0x33084a(0x133)][_0x33084a(0x11d)]({'result':_0x285978},_0x4d4eb7);if(_0x465b61==='SUCCESS'){const [_0x530f89,_0x49a53f]=_0x502aad[_0x33084a(0x198)]('|'),_0x17e41a=await this['getMjImageProxyUrl'](),_0x5de6c4=_0x17e41a?_0x26d817['replace']('https://cdn.discordapp.com',_0x17e41a):_0x26d817,{width:_0x55b2b0,height:_0x4c0a7e}=await this[_0x33084a(0x130)](_0x5de6c4);await this[_0x33084a(0x133)][_0x33084a(0x11d)]({'result':_0x285978},{'width':_0x55b2b0,'height':_0x4c0a7e});const _0x888f79=await this[_0x33084a(0x175)](_0x5de6c4),_0x4b2b4d=_0x33084a(0x164)+_0x530f89+']-'+uuid['v4']()[_0x33084a(0xff)](0x0,0xa)+_0x33084a(0x119),_0x25d205=await this[_0x33084a(0x1e0)][_0x33084a(0x1db)]({'originalname':_0x4b2b4d,'filename':_0x4b2b4d,'buffer':_0x888f79});console[_0x33084a(0x194)](_0x33084a(0x111)+_0x530f89+_0x33084a(0x1b5)+_0x25d205),this['drawEntity'][_0x33084a(0x11d)]({'result':_0x285978},{'thumb':_0x25d205});}if(_0x465b61===_0x33084a(0xfe)){const [_0x4f49c7,_0x3bdc4e]=_0x502aad[_0x33084a(0x198)]('|');await this['userBalanceService'][_0x33084a(0x180)](_0x4f49c7,_0x3bdc4e);}}catch(_0xe5a19){console[_0x33084a(0x194)](_0x33084a(0x176),_0xe5a19);}}async[_0x741979(0x1f0)](_0x4819e1,_0x321b72){const _0x5c07dc=_0x741979,{id:_0x535f2e}=_0x321b72;if(!_0x535f2e)throw new common_1[(_0x5c07dc(0x15d))]('id不能为空',common_1[_0x5c07dc(0x19c)]['BAD_REQUEST']);const _0x33af82=await this['drawEntity']['findOne']({'where':{'id':_0x535f2e}});if(!_0x33af82)throw new common_1[(_0x5c07dc(0x15d))](_0x5c07dc(0x15f),common_1[_0x5c07dc(0x19c)]['BAD_REQUEST']);const {originalImgUrl:_0xd9894f,sysRec:_0x5cbb1f}=_0x33af82;if(Number(_0x5cbb1f)===0x1)return await this['drawEntity'][_0x5c07dc(0x11d)]({'id':_0x535f2e},{'sysRec':'-1'}),_0x5c07dc(0x12e);else{const _0xc8fb63=await this[_0x5c07dc(0x17c)](),_0x362853=_0xd9894f&&_0xc8fb63?_0xd9894f['replace'](_0x5c07dc(0x17a),_0xc8fb63):_0xd9894f,{width:_0x3a304b,height:_0x2d8b79}=await this[_0x5c07dc(0x130)](_0x362853);return await this[_0x5c07dc(0x133)]['update']({'id':_0x535f2e},{'sysRec':'1','width':_0x3a304b,'height':_0x2d8b79}),_0x5c07dc(0x11e);}}async[_0x741979(0x1e6)](_0x2ee6a5,_0x29201c){const _0x4b7d40=_0x741979,{id:_0x15b919}=_0x29201c;if(!_0x15b919)throw new common_1['HttpException'](_0x4b7d40(0x192),common_1[_0x4b7d40(0x19c)][_0x4b7d40(0x170)]);const _0x4a2a2d=await this[_0x4b7d40(0x133)][_0x4b7d40(0x1c8)]({'where':{'id':_0x15b919}});if(!_0x4a2a2d)throw new common_1['HttpException']('未找到该项',common_1[_0x4b7d40(0x19c)]['BAD_REQUEST']);return await this['drawEntity'][_0x4b7d40(0x14c)]({'id':_0x15b919}),_0x4b7d40(0x142);}async['textToImage'](_0x2774bb,_0x17a636){const _0x1f1cd4=_0x741979;var _0x550838,_0xfdf863,_0x112faa,_0xe2af27,_0x296bf1,_0x6ece6e;await this[_0x1f1cd4(0xf6)](_0x2774bb,_0x17a636),await this['checkUserDrawLimit'](_0x2774bb[_0x1f1cd4(0x1c7)]['id']);try{const {id:_0x5bcdd1}=_0x2774bb[_0x1f1cd4(0x1c7)],{autoOptimize:_0x882a1c,prompt:_0x436c5b,taskType:_0x1c5eaa,speed:_0x41f2f7,version:_0x54db73,quality:_0x5f01a5,chaos:_0x3ed881,stylize:_0x5c9b2b,style:_0x1b8081,scale:_0x83b9aa,model:_0x3b51c2,seed:_0x221595,iw:_0x16b31f,referencePic:_0x52da91,no:_0x2bca85,cameraShot:_0x11c7fe,light:_0x41b22e,view:_0x40ec72,autoTranslate:_0x11cc0c,customInstruct:_0xd3ba6f}=_0x17a636;if(Number(_0x1c5eaa)===0x4){const {version:_0x2675fd}=_0x17a636;return await this[_0x1f1cd4(0x1a7)](_0x2774bb,_0x17a636);}let _0x2f75f8=_0x436c5b;_0x882a1c&&!(_0x17a636===null||_0x17a636===void 0x0?void 0x0:_0x17a636[_0x1f1cd4(0x103)])&&(_0x2f75f8=await this[_0x1f1cd4(0x107)][_0x1f1cd4(0x1b4)]({'prompt':_0x1f1cd4(0x1d5)+_0x436c5b}));_0x11cc0c&&!(_0x17a636===null||_0x17a636===void 0x0?void 0x0:_0x17a636[_0x1f1cd4(0x103)])&&(_0x2f75f8=await this[_0x1f1cd4(0x107)][_0x1f1cd4(0x1b4)]({'prompt':_0x1f1cd4(0x1e8)+_0x436c5b}));const _0x24512d=await this['formatMjDrawPrompt'](Object[_0x1f1cd4(0x1c1)](Object[_0x1f1cd4(0x1c1)]({},_0x17a636),{'parsePrompt':_0x2f75f8})),_0x270415=await this[_0x1f1cd4(0x106)]('mjBlendImageMoney'),_0x1b846a={'botType':_0x1f1cd4(0x162),'prompt':_0x24512d,'base64Array':_0x52da91,'notifyHook':await this[_0x1f1cd4(0x12c)](),'state':_0x2774bb[_0x1f1cd4(0x1c7)]['id']+'|'+_0x270415},_0x348842=await(await this[_0x1f1cd4(0x1cc)]())[_0x1f1cd4(0x1a6)](_0x1f1cd4(0x19e),_0x1b846a),_0x2174a6=_0x348842===null||_0x348842===void 0x0?void 0x0:_0x348842[_0x1f1cd4(0x13e)];console[_0x1f1cd4(0x194)](_0x1f1cd4(0x139),JSON['stringify'](_0x348842===null||_0x348842===void 0x0?void 0x0:_0x348842[_0x1f1cd4(0x13e)]));const {code:_0x701541,result:_0x522545,discordInstanceId:_0x9dfcda}=_0x2174a6;if(_0x701541===0x1){const _0x201dbb={'drawType':0x1,'taskType':_0x1c5eaa,'status':'NOT_START','prompt':_0x436c5b,'promptEn':_0x2f75f8,'fullPrompt':_0x24512d,'userId':_0x5bcdd1,'result':_0x522545,'discordInstanceId':_0x9dfcda,'speed':_0x41f2f7,'version':_0x54db73,'quality':_0x5f01a5,'chaos':_0x3ed881,'stylize':_0x5c9b2b,'style':_0x1b8081,'scale':_0x83b9aa[_0x1f1cd4(0x17f)](':'),'model':_0x3b51c2,'seed':_0x221595,'iw':_0x16b31f,'referencePic':'','no':_0x2bca85,'cameraShot':_0x11c7fe,'light':_0x41b22e,'view':_0x40ec72};await this[_0x1f1cd4(0x133)][_0x1f1cd4(0x1b2)](_0x201dbb),await this['userBalanceService'][_0x1f1cd4(0x109)](_0x2774bb[_0x1f1cd4(0x1c7)]['id'],_0x1f1cd4(0x1c2),_0x270415,_0x270415);}else{const _0x2f2c78=(_0x2174a6===null||_0x2174a6===void 0x0?void 0x0:_0x2174a6[_0x1f1cd4(0x155)])||(_0x2174a6===null||_0x2174a6===void 0x0?void 0x0:_0x2174a6[_0x1f1cd4(0x122)])||_0x1f1cd4(0x1ca);(0x0,utils_2[_0x1f1cd4(0x195)])({'NineErrMsg':_0x2f2c78});}}catch(_0x20b0e7){console[_0x1f1cd4(0x194)](_0x1f1cd4(0x11b),(_0x550838=_0x20b0e7===null||_0x20b0e7===void 0x0?void 0x0:_0x20b0e7[_0x1f1cd4(0x102)])===null||_0x550838===void 0x0?void 0x0:_0x550838[_0x1f1cd4(0x13e)]);const _0x3f205b=(_0x20b0e7===null||_0x20b0e7===void 0x0?void 0x0:_0x20b0e7[_0x1f1cd4(0x105)])||((_0xe2af27=(_0x112faa=(_0xfdf863=_0x20b0e7===null||_0x20b0e7===void 0x0?void 0x0:_0x20b0e7[_0x1f1cd4(0x102)])===null||_0xfdf863===void 0x0?void 0x0:_0xfdf863[_0x1f1cd4(0x13e)])===null||_0x112faa===void 0x0?void 0x0:_0x112faa['error'])===null||_0xe2af27===void 0x0?void 0x0:_0xe2af27[_0x1f1cd4(0x1b6)])||((_0x6ece6e=(_0x296bf1=_0x20b0e7===null||_0x20b0e7===void 0x0?void 0x0:_0x20b0e7['response'])===null||_0x296bf1===void 0x0?void 0x0:_0x296bf1['data'])===null||_0x6ece6e===void 0x0?void 0x0:_0x6ece6e[_0x1f1cd4(0x122)])||_0x1f1cd4(0x1ca);throw new common_1[(_0x1f1cd4(0x15d))](_0x3f205b,common_1[_0x1f1cd4(0x19c)]['BAD_REQUEST']);}}async[_0x741979(0x1a1)](_0x51ab45,_0x20ca01){const _0xc76a3=_0x741979;var _0x16cab3,_0x29606e,_0x36c495,_0x46c1e2;const {id:_0x509445}=_0x51ab45[_0xc76a3(0x1c7)],{customId:_0x26cded,taskId:_0x1f2a4f,label:_0x54bc73}=_0x20ca01;await this[_0xc76a3(0x10c)](_0x51ab45[_0xc76a3(0x1c7)]['id']);let _0xd6894c=0x1;_0x26cded[_0xc76a3(0x125)]('variation')&&(_0xd6894c=await this[_0xc76a3(0x106)](_0xc76a3(0x127)));_0x26cded['includes']('upsample')&&(_0xd6894c=await this[_0xc76a3(0x106)](_0xc76a3(0x1e4)));_0x26cded[_0xc76a3(0x125)](_0xc76a3(0x156))&&(_0xd6894c=await this['getDrawDecutConfig'](_0xc76a3(0x114)));_0x26cded[_0xc76a3(0x125)](_0xc76a3(0x190))&&(_0xd6894c=await this[_0xc76a3(0x106)]('mjPartDrawMoney'));(_0x26cded['includes'](_0xc76a3(0x19f))||_0x26cded[_0xc76a3(0x125)](_0xc76a3(0x172)))&&(_0xd6894c=await this['getDrawDecutConfig'](_0xc76a3(0x1bc)));_0x26cded[_0xc76a3(0x125)]('pan')&&(_0xd6894c=await this[_0xc76a3(0x106)](_0xc76a3(0x17e)));await this[_0xc76a3(0x10e)]['validateBalance'](_0x51ab45,_0xc76a3(0x1c2),_0xd6894c);try{const _0x309291=await this[_0xc76a3(0x133)][_0xc76a3(0x1c8)]({'where':{'result':_0x1f2a4f}});!_0x309291&&(0x0,utils_2[_0xc76a3(0x195)])({'NineErrMsg':_0xc76a3(0x14b)});_0x309291[_0xc76a3(0x1a5)]!==_0x509445&&(0x0,utils_2[_0xc76a3(0x195)])({'NineErrMsg':'无权操作他人作品！'});const _0x1347b5={'customId':_0x26cded,'taskId':_0x1f2a4f,'notifyHook':await this['getNotifyUrl'](),'state':_0x51ab45[_0xc76a3(0x1c7)]['id']+'|'+_0xd6894c},_0x42016c=await(await this[_0xc76a3(0x1cc)]())[_0xc76a3(0x1a6)](_0xc76a3(0x1d8),_0x1347b5),{code:_0x27f36a,result:_0x383807,discordInstanceId:_0xe6eb25}=_0x42016c===null||_0x42016c===void 0x0?void 0x0:_0x42016c[_0xc76a3(0x13e)];if([0x1,0x15][_0xc76a3(0x125)](_0x27f36a)){if(_0x27f36a===0x15){!_0x20ca01['zoomPrompt']&&!_0x20ca01[_0xc76a3(0x166)]&&(0x0,utils_2[_0xc76a3(0x195)])({'NineErrMsg':_0xc76a3(0x123)});const _0x29d5f1={'taskId':_0x383807};_0x20ca01[_0xc76a3(0xe8)]&&(_0x29d5f1[_0xc76a3(0xf3)]=_0x20ca01[_0xc76a3(0xe8)]),_0x20ca01['maskBase64']&&(_0x29d5f1[_0xc76a3(0x166)]=_0x20ca01[_0xc76a3(0x166)]);const _0x3293a0=Object['assign']({'notifyHook':await this[_0xc76a3(0x12c)](),'state':_0x51ab45['user']['id']+'|'+_0xd6894c},_0x29d5f1),_0x1c2175=await(await this['getAxiosInstance']())[_0xc76a3(0x1a6)](_0xc76a3(0xeb),_0x3293a0);console[_0xc76a3(0x194)]('moadl\x20confirm\x20res.data:\x20',JSON[_0xc76a3(0x1d0)](_0x1c2175[_0xc76a3(0x13e)]));}await this[_0xc76a3(0x10e)][_0xc76a3(0x109)](_0x51ab45[_0xc76a3(0x1c7)]['id'],_0xc76a3(0x1c2),_0xd6894c,_0xd6894c);const {operateButtons:_0x303eaf,prompt:_0x147839,promptEn:_0x53b494,fullPrompt:_0x20fde1,speed:_0x487458,drawType:_0x38229a,version:_0x4ac8a3,model:_0x46a3a6,scale:_0x2595c0,quality:_0x515e0c,chaos:_0xe7916c,stylize:_0x6d1a8,cameraShot:_0x2f2758,iw:_0x472a6e,light:_0x302938,no:_0x423ac7,view:_0x47d57a}=_0x309291;let _0x1333c5=[];try{_0x1333c5=_0x303eaf?[...JSON[_0xc76a3(0x18f)](_0x303eaf),_0x26cded]:[_0x26cded];}catch(_0x32d03d){_0x1333c5=[_0x26cded];}await this['drawEntity'][_0xc76a3(0x11d)]({'result':_0x1f2a4f},{'operateButtons':JSON[_0xc76a3(0x1d0)](_0x1333c5)});const _0x3bde6e=await this[_0xc76a3(0x133)]['save']({'version':_0x4ac8a3,'model':_0x46a3a6,'scale':_0x2595c0,'quality':_0x515e0c,'chaos':_0xe7916c,'stylize':_0x6d1a8,'drawType':_0x38229a,'speed':_0x487458,'status':_0xc76a3(0x173),'prompt':_0x147839,'promptEn':_0x53b494,'fullPrompt':_0x20fde1,'customId':_0x26cded,'userId':_0x509445,'result':_0x383807,'discordInstanceId':_0xe6eb25,'cameraShot':_0x2f2758,'iw':_0x472a6e,'light':_0x302938,'no':_0x423ac7,'view':_0x47d57a});}else{console[_0xc76a3(0x194)]('drawAction\x20code\x20!=\x201:\x20\x20441',_0x42016c===null||_0x42016c===void 0x0?void 0x0:_0x42016c[_0xc76a3(0x13e)]);let _0xb6f013=((_0x16cab3=_0x42016c===null||_0x42016c===void 0x0?void 0x0:_0x42016c['data'])===null||_0x16cab3===void 0x0?void 0x0:_0x16cab3[_0xc76a3(0x155)])||_0xc76a3(0x1ca);_0xb6f013===_0xc76a3(0x1d2)&&(_0xb6f013=_0xc76a3(0xec)),console[_0xc76a3(0x194)](_0xc76a3(0x13d),_0xb6f013),(0x0,utils_2['throwError'])({'NineErrMsg':_0xb6f013});}}catch(_0x45250a){console[_0xc76a3(0x194)]('drawAction\x20error:\x20',_0x45250a);const _0x62a3f0=(_0x45250a===null||_0x45250a===void 0x0?void 0x0:_0x45250a[_0xc76a3(0x105)])||((_0x46c1e2=(_0x36c495=(_0x29606e=_0x45250a===null||_0x45250a===void 0x0?void 0x0:_0x45250a[_0xc76a3(0x102)])===null||_0x29606e===void 0x0?void 0x0:_0x29606e[_0xc76a3(0x13e)])===null||_0x36c495===void 0x0?void 0x0:_0x36c495[_0xc76a3(0x122)])===null||_0x46c1e2===void 0x0?void 0x0:_0x46c1e2[_0xc76a3(0x1b6)])||'提交Action任务失败、请检查系统日志';throw new common_1[(_0xc76a3(0x15d))](_0x62a3f0,common_1[_0xc76a3(0x19c)][_0xc76a3(0x170)]);}}async[_0x741979(0x1a9)](_0x56dd6e,_0x22cd9d){const _0x1c5a3b=_0x741979;var _0x3beda3,_0x5cb5bc,_0x4af42d,_0x3e6a31,_0x2f0863,_0x18ef10;const {id:_0x2f8cea}=_0x56dd6e[_0x1c5a3b(0x1c7)],{base64Arr:_0x2b9b3e,dimensions:_0x46a232}=_0x22cd9d;await this[_0x1c5a3b(0x10c)](_0x56dd6e['user']['id']);if(!_0x2b9b3e||_0x2b9b3e[_0x1c5a3b(0x1cd)]<0x2)throw new common_1[(_0x1c5a3b(0x15d))]('混图任务至少需要两张图片!',common_1['HttpStatus'][_0x1c5a3b(0x170)]);if(_0x2b9b3e[_0x1c5a3b(0x1cd)]>0x6)throw new common_1[(_0x1c5a3b(0x15d))](_0x1c5a3b(0xfa),common_1['HttpStatus'][_0x1c5a3b(0x170)]);const _0x10084a=await this['getDrawDecutConfig'](_0x1c5a3b(0x15c));await this[_0x1c5a3b(0x10e)][_0x1c5a3b(0x158)](_0x56dd6e,'mjDraw',_0x10084a);try{const _0x4c02a7={'botType':_0x1c5a3b(0x162),'base64Array':_0x2b9b3e,'dimensions':_0x46a232,'notifyHook':await this[_0x1c5a3b(0x12c)](),'state':_0x56dd6e['user']['id']+'|'+_0x10084a},_0x4f9fb1=await(await this['getAxiosInstance']())[_0x1c5a3b(0x1a6)](_0x1c5a3b(0x188),_0x4c02a7);console['log'](_0x1c5a3b(0x100),_0x4f9fb1[_0x1c5a3b(0x13e)]);const {data:_0x435b14}=_0x4f9fb1,{code:_0x3d3009,result:_0x31facc,discordInstanceId:_0x43297f}=_0x435b14;if(_0x3d3009===0x1){const _0x3862fe=await this['drawEntity'][_0x1c5a3b(0x1b2)]({'drawType':0x1,'status':'NOT_START','mixPic':JSON[_0x1c5a3b(0x1d0)]([]),'userId':_0x2f8cea,'result':_0x31facc,'discordInstanceId':_0x43297f,'speed':'fast','prompt':_0x1c5a3b(0x148),'promptEn':'Executing\x20mixed\x20image\x20task...','fullPrompt':_0x1c5a3b(0x1dc)});await this['userBalanceService']['deductFromBalance'](_0x56dd6e[_0x1c5a3b(0x1c7)]['id'],_0x1c5a3b(0x1c2),_0x10084a,_0x10084a);}else{console['log']('drawSwapFaceAction\x20code\x20!=\x201:\x20\x20441',_0x4f9fb1===null||_0x4f9fb1===void 0x0?void 0x0:_0x4f9fb1['data']);let _0x1fa8b0=((_0x3beda3=_0x4f9fb1===null||_0x4f9fb1===void 0x0?void 0x0:_0x4f9fb1[_0x1c5a3b(0x13e)])===null||_0x3beda3===void 0x0?void 0x0:_0x3beda3[_0x1c5a3b(0x155)])||_0x1c5a3b(0x1d7);_0x1fa8b0===_0x1c5a3b(0x1d2)&&(_0x1fa8b0='管理员配置模型余额不足\x20请联系管理员！'),console['log']('NineErrMsg:\x20',_0x1fa8b0),(0x0,utils_2[_0x1c5a3b(0x195)])({'NineErrMsg':_0x1fa8b0});}}catch(_0x3257b9){console[_0x1c5a3b(0x194)](_0x1c5a3b(0x1b9),_0x3257b9);const _0x503be9=(_0x3257b9===null||_0x3257b9===void 0x0?void 0x0:_0x3257b9['NineErrMsg'])||((_0x3e6a31=(_0x4af42d=(_0x5cb5bc=_0x3257b9===null||_0x3257b9===void 0x0?void 0x0:_0x3257b9[_0x1c5a3b(0x102)])===null||_0x5cb5bc===void 0x0?void 0x0:_0x5cb5bc[_0x1c5a3b(0x13e)])===null||_0x4af42d===void 0x0?void 0x0:_0x4af42d[_0x1c5a3b(0x122)])===null||_0x3e6a31===void 0x0?void 0x0:_0x3e6a31['message'])||((_0x18ef10=(_0x2f0863=_0x3257b9===null||_0x3257b9===void 0x0?void 0x0:_0x3257b9[_0x1c5a3b(0x102)])===null||_0x2f0863===void 0x0?void 0x0:_0x2f0863[_0x1c5a3b(0x13e)])===null||_0x18ef10===void 0x0?void 0x0:_0x18ef10[_0x1c5a3b(0x122)])||_0x1c5a3b(0x1ca);throw new common_1['HttpException'](_0x503be9,common_1[_0x1c5a3b(0x19c)]['BAD_REQUEST']);}}async[_0x741979(0x1cf)](_0x455843,_0x590b8c){const _0xa8a32d=_0x741979;var _0x1a8df7,_0xe539f1,_0x569b18,_0x2fb4b4,_0x28fd97,_0x100b69;const {id:_0x55987b}=_0x455843['user'],{sourceBase:_0x34fcaa,targetBase:_0x1866ed}=_0x590b8c;await this[_0xa8a32d(0x10c)](_0x455843[_0xa8a32d(0x1c7)]['id']);const _0x2bf8f5=await(0x0,utils_1[_0xa8a32d(0x1ab)])([_0x34fcaa,_0x1866ed]);if(_0x2bf8f5['length']!==0x2)throw new common_1[(_0xa8a32d(0x15d))]('图片资源转换失败、请检查系统日志',common_1[_0xa8a32d(0x19c)][_0xa8a32d(0x170)]);const _0x250927=await this['getDrawDecutConfig'](_0xa8a32d(0x16e));await this['userBalanceService'][_0xa8a32d(0x158)](_0x455843,'mjDraw',_0x250927);try{const _0x1b7b80={'sourceBase64':_0x34fcaa,'targetBase64':_0x1866ed,'accountFilter':{'instanceId':''},'notifyHook':await this[_0xa8a32d(0x12c)](),'state':_0x455843[_0xa8a32d(0x1c7)]['id']+'|'+_0x250927},_0x12f5f9=await(await this['getAxiosInstance']())['post'](_0xa8a32d(0x1e3),_0x1b7b80);console[_0xa8a32d(0x194)](_0xa8a32d(0x12d),_0x12f5f9[_0xa8a32d(0x13e)]);const {data:_0x3bd17f}=_0x12f5f9,{code:_0x77bb04,result:_0x30c301,discordInstanceId:_0x1b5073}=_0x3bd17f,_0x94a9ac=[];if(_0x77bb04===0x1){const _0x5eccc4=await this['drawEntity'][_0xa8a32d(0x1b2)]({'drawType':0x1,'status':_0xa8a32d(0x173),'swapFacePic':JSON[_0xa8a32d(0x1d0)](_0x94a9ac),'userId':_0x55987b,'result':_0x30c301,'discordInstanceId':_0x1b5073,'speed':_0xa8a32d(0x1a8),'prompt':'正在执行AI换脸中......','promptEn':_0xa8a32d(0x1de),'fullPrompt':_0xa8a32d(0x1de)});await this[_0xa8a32d(0x10e)][_0xa8a32d(0x109)](_0x455843[_0xa8a32d(0x1c7)]['id'],_0xa8a32d(0x1c2),_0x250927,_0x250927);}else{console[_0xa8a32d(0x194)](_0xa8a32d(0x1b7),_0x12f5f9===null||_0x12f5f9===void 0x0?void 0x0:_0x12f5f9[_0xa8a32d(0x13e)]);let _0x8da91f=((_0x1a8df7=_0x12f5f9===null||_0x12f5f9===void 0x0?void 0x0:_0x12f5f9['data'])===null||_0x1a8df7===void 0x0?void 0x0:_0x1a8df7[_0xa8a32d(0x155)])||_0xa8a32d(0x14e);_0x8da91f===_0xa8a32d(0x1d2)&&(_0x8da91f=_0xa8a32d(0xec)),(0x0,utils_2[_0xa8a32d(0x195)])({'NineErrMsg':_0x8da91f});}}catch(_0x521fb2){console[_0xa8a32d(0x194)](_0xa8a32d(0x1b9),_0x521fb2);const _0x356be4=(_0x521fb2===null||_0x521fb2===void 0x0?void 0x0:_0x521fb2['NineErrMsg'])||((_0x2fb4b4=(_0x569b18=(_0xe539f1=_0x521fb2===null||_0x521fb2===void 0x0?void 0x0:_0x521fb2[_0xa8a32d(0x102)])===null||_0xe539f1===void 0x0?void 0x0:_0xe539f1[_0xa8a32d(0x13e)])===null||_0x569b18===void 0x0?void 0x0:_0x569b18['error'])===null||_0x2fb4b4===void 0x0?void 0x0:_0x2fb4b4[_0xa8a32d(0x1b6)])||((_0x100b69=(_0x28fd97=_0x521fb2===null||_0x521fb2===void 0x0?void 0x0:_0x521fb2[_0xa8a32d(0x102)])===null||_0x28fd97===void 0x0?void 0x0:_0x28fd97[_0xa8a32d(0x13e)])===null||_0x100b69===void 0x0?void 0x0:_0x100b69['error'])||'提交Action任务失败、请检查系统日志';throw new common_1['HttpException'](_0x356be4,common_1[_0xa8a32d(0x19c)]['BAD_REQUEST']);}}async[_0x741979(0x138)](_0x36e59b,_0x294dd6){const _0x4efaff=_0x741979,{id:_0x52558e}=_0x36e59b[_0x4efaff(0x1c7)],{base64:_0x33028a}=_0x294dd6;if(!_0x33028a)throw new common_1[(_0x4efaff(0x15d))](_0x4efaff(0x108),common_1[_0x4efaff(0x19c)]['BAD_REQUEST']);await this[_0x4efaff(0x10c)](_0x36e59b['user']['id']);const _0x3d34ce=await this[_0x4efaff(0x106)](_0x4efaff(0x1be));await this[_0x4efaff(0x10e)]['validateBalance'](_0x36e59b,'mjDraw',_0x3d34ce);try{const _0x25078e={'botType':_0x4efaff(0x162),'base64':_0x33028a,'notifyHook':await this[_0x4efaff(0x12c)](),'state':_0x36e59b['user']['id']+'|'+_0x3d34ce},_0x509926=await(await this[_0x4efaff(0x1cc)]())[_0x4efaff(0x1a6)](_0x4efaff(0x10b),_0x25078e);console[_0x4efaff(0x194)](_0x4efaff(0x12d),_0x509926[_0x4efaff(0x13e)]);const {data:_0x121962}=_0x509926,{code:_0x93bb9c,result:_0x2b14c2,discordInstanceId:_0x314bc9}=_0x121962;if(_0x93bb9c===0x1){const _0x2708ce=await this['drawEntity'][_0x4efaff(0x1b2)]({'drawType':0x1,'status':_0x4efaff(0x173),'file':'','userId':_0x52558e,'result':_0x2b14c2,'discordInstanceId':_0x314bc9,'prompt':_0x4efaff(0x183),'promptEn':'Analyzing\x20the\x20uploaded\x20image...','fullPrompt':_0x4efaff(0xf5)});await this[_0x4efaff(0x10e)][_0x4efaff(0x109)](_0x36e59b[_0x4efaff(0x1c7)]['id'],_0x4efaff(0x1c2),_0x3d34ce,_0x3d34ce);}else throw new common_1[(_0x4efaff(0x15d))](_0x4efaff(0x104),common_1[_0x4efaff(0x19c)][_0x4efaff(0x170)]);}catch(_0x330b9b){console[_0x4efaff(0x194)]('error:\x20',_0x330b9b);throw new common_1[(_0x4efaff(0x15d))](_0x4efaff(0x104),common_1['HttpStatus'][_0x4efaff(0x170)]);}}async[_0x741979(0x118)](_0x1cc124,_0x17ad53){const _0x5f3ba7=_0x741979;try{const {id:_0x221241}=_0x1cc124['user'],{prompt:_0x255c65}=_0x17ad53,_0x389304={'botType':_0x5f3ba7(0x162),'prompt':_0x255c65,'notifyHook':await this[_0x5f3ba7(0x12c)](),'state':''},_0xc1a2bb=await(await this['getAxiosInstance']())['post'](_0x5f3ba7(0x157),_0x389304),{data:_0x10dcd2}=_0xc1a2bb,{code:_0x8e887c,result:_0x13ae25,discordInstanceId:_0x47f70a}=_0x10dcd2;if(_0x8e887c===0x1){const _0x3dbecb=await this['drawEntity'][_0x5f3ba7(0x1b2)]({'drawType':0x1,'status':'NOT_START','prompt':_0x255c65,'userId':_0x221241,'result':_0x13ae25,'discordInstanceId':_0x47f70a});}else throw new common_1[(_0x5f3ba7(0x15d))](_0x5f3ba7(0x179),common_1[_0x5f3ba7(0x19c)][_0x5f3ba7(0x170)]);}catch(_0x9f224e){console[_0x5f3ba7(0x194)]('error:\x20',_0x9f224e);throw new common_1['HttpException']('提交任务失败、请检查系统配置',common_1[_0x5f3ba7(0x19c)]['BAD_REQUEST']);}}async[_0x741979(0x191)](_0x1eef26,_0x31e1a0){const _0x4ebd00=_0x741979;var _0x22a9e9,_0x37bfe3,_0x56cfda,_0x412220,_0x178eed;try{const {resultId:_0x384e47}=_0x31e1a0;if(!_0x384e47)return;const _0x2bfab1=await(await this[_0x4ebd00(0x1cc)]())[_0x4ebd00(0x135)](_0x4ebd00(0x1d3)+_0x384e47+_0x4ebd00(0x1c6));if(_0x2bfab1[_0x4ebd00(0x13e)][_0x4ebd00(0x17d)]===0x1){const _0x41b1c6=_0x2bfab1[_0x4ebd00(0x13e)][_0x4ebd00(0x128)];return await this[_0x4ebd00(0x133)]['update']({'result':_0x384e47},{'seed':_0x41b1c6}),_0x41b1c6;}else(0x0,utils_2['throwError'])({'NineErrMsg':_0x4ebd00(0x151)});}catch(_0x5ca747){const _0xf33060=(_0x5ca747===null||_0x5ca747===void 0x0?void 0x0:_0x5ca747[_0x4ebd00(0x105)])||((_0x56cfda=(_0x37bfe3=(_0x22a9e9=_0x5ca747===null||_0x5ca747===void 0x0?void 0x0:_0x5ca747[_0x4ebd00(0x102)])===null||_0x22a9e9===void 0x0?void 0x0:_0x22a9e9[_0x4ebd00(0x13e)])===null||_0x37bfe3===void 0x0?void 0x0:_0x37bfe3[_0x4ebd00(0x122)])===null||_0x56cfda===void 0x0?void 0x0:_0x56cfda[_0x4ebd00(0x1b6)])||((_0x178eed=(_0x412220=_0x5ca747===null||_0x5ca747===void 0x0?void 0x0:_0x5ca747[_0x4ebd00(0x102)])===null||_0x412220===void 0x0?void 0x0:_0x412220['data'])===null||_0x178eed===void 0x0?void 0x0:_0x178eed[_0x4ebd00(0x122)])||'提交Action任务失败、请检查系统日志';throw new common_1['HttpException'](_0xf33060,common_1[_0x4ebd00(0x19c)][_0x4ebd00(0x170)]);}}async[_0x741979(0x150)](_0xe5e79a,_0x1f249d){return 0x1;}async[_0x741979(0xf8)](_0x3780b3){const _0x2db597=_0x741979,_0x49dcfd=await this[_0x2db597(0x1bd)](_0x3780b3);console['log'](_0x2db597(0x168),_0x49dcfd[0x0]);if(!_0x49dcfd||!_0x49dcfd[_0x2db597(0x1cd)])return'';return _0x49dcfd[_0x2db597(0x17f)]('\x20\x20');}async[_0x741979(0x1bd)](_0x48f2cf){const _0x2ba51c=_0x741979;var _0x23529d;if(!_0x48f2cf['length'])return[];const _0x4442de={'base64Array':_0x48f2cf},_0x1a6d4a=await(await this[_0x2ba51c(0x1cc)]())[_0x2ba51c(0x1a6)](_0x2ba51c(0x1ea),_0x4442de);return(_0x23529d=_0x1a6d4a===null||_0x1a6d4a===void 0x0?void 0x0:_0x1a6d4a[_0x2ba51c(0x13e)])===null||_0x23529d===void 0x0?void 0x0:_0x23529d[_0x2ba51c(0x128)];}async['notifyDalleDraw'](_0x1bbe62,_0x1b939c){const _0x485477=_0x741979,{id:_0x23b2a1}=_0x1bbe62['user'],{prompt:_0x5e18f7,taskType:_0x5597b1,version:_0x1cf2eb,scale:_0xf613d1,quality:_0x5b684f,autoOptimize:_0x117fa3,style:_0x2f31ad}=_0x1b939c,_0x19b4d6=await this['modelsService'][_0x485477(0x12b)]();!_0x19b4d6&&(0x0,utils_2['throwError'])({'NineErrMsg':_0x485477(0x101)});let _0x1a9f0b=_0x5e18f7;_0x117fa3?_0x1a9f0b=await this['chatgptService'][_0x485477(0x1b4)]({'prompt':_0x485477(0x181)+_0x5e18f7}):_0x1a9f0b=await this[_0x485477(0x107)][_0x485477(0x1b4)]({'prompt':_0x485477(0x1e8)+_0x5e18f7});const {key:_0x30f6af}=_0x19b4d6;let _0x82c809=_0x19b4d6[_0x485477(0x169)];_0x82c809[_0x485477(0x1cb)]('/')&&(_0x82c809=_0x82c809[_0x485477(0xff)](0x0,_0x82c809[_0x485477(0x1cd)]-0x1));const _0x5440e8=_0x82c809+_0x485477(0x110);let _0x783e4c={};Number(_0x1cf2eb)===0x3?_0x783e4c={'prompt':_0x1a9f0b,'model':_0x485477(0x1ba),'size':_0xf613d1,'quality':_0x5b684f,'response_format':_0x485477(0x10f),'style':_0x2f31ad,'n':0x1}:_0x783e4c={'prompt':_0x1a9f0b,'model':_0x485477(0x18b),'size':_0xf613d1,'response_format':'b64_json','n':0x1};const _0x2ac9c9={'drawType':0x2,'taskType':_0x5597b1,'prompt':_0x5e18f7,'promptEn':_0x1a9f0b,'scale':_0xf613d1,'quality':_0x5b684f,'userId':_0x23b2a1,'version':_0x1cf2eb,'model':_0x485477(0x1b8),'fullPrompt':_0x1a9f0b,'progress':'0%','status':_0x485477(0x1af)},_0x3b26fe=await this[_0x485477(0x133)][_0x485477(0x1b2)](_0x2ac9c9);await this[_0x485477(0x154)][_0x485477(0x182)](_0x19b4d6['id'],_0x19b4d6[_0x485477(0xf9)],0x0);const _0x39c97e=Number(_0x1cf2eb)===0x2?_0x485477(0x1e2):_0x485477(0x1ac),_0x27d72d=await this[_0x485477(0x106)](_0x39c97e);return await this[_0x485477(0x10e)][_0x485477(0x109)](_0x1bbe62[_0x485477(0x1c7)]['id'],_0x485477(0x1c2),_0x27d72d,_0x27d72d),this[_0x485477(0x12a)]({'api':_0x5440e8,'params':_0x783e4c,'key':_0x30f6af,'version':_0x1cf2eb,'saveRes':_0x3b26fe,'userId':_0x23b2a1,'amount':_0x27d72d}),_0x3b26fe;}async['drawDalleAndSave']({api:_0x127c70,params:_0x2135df,key:_0x351d39,version:_0xdae447,saveRes:_0xd0652e,userId:_0x4b7d5e,amount:_0x235d97}){const _0x34c94d=_0x741979;var _0x5efda0,_0x37a966,_0x4988b5,_0x1b30b8,_0x1709c3,_0x322d7b,_0x4c105f,_0x4dddbf,_0x1287dd,_0x25a96b;try{const {id:_0x593342}=_0xd0652e,_0x3d199a=await axios_1[_0x34c94d(0x161)][_0x34c94d(0x1a6)](_0x127c70,_0x2135df,{'headers':{'Authorization':_0x34c94d(0x1e5)+_0x351d39}});if(!_0x3d199a[_0x34c94d(0x13e)][_0x34c94d(0x13e)]||!((_0x37a966=(_0x5efda0=_0x3d199a===null||_0x3d199a===void 0x0?void 0x0:_0x3d199a[_0x34c94d(0x13e)])===null||_0x5efda0===void 0x0?void 0x0:_0x5efda0['data'])===null||_0x37a966===void 0x0?void 0x0:_0x37a966[_0x34c94d(0x1cd)])){const _0x143bb4=((_0x1b30b8=(_0x4988b5=_0x3d199a===null||_0x3d199a===void 0x0?void 0x0:_0x3d199a[_0x34c94d(0x13e)])===null||_0x4988b5===void 0x0?void 0x0:_0x4988b5[_0x34c94d(0x122)])===null||_0x1b30b8===void 0x0?void 0x0:_0x1b30b8[_0x34c94d(0x1b6)])||((_0x1709c3=_0x3d199a[_0x34c94d(0x13e)])===null||_0x1709c3===void 0x0?void 0x0:_0x1709c3['error'])||'提交Action任务失败、请检查系统日志';(0x0,utils_2[_0x34c94d(0x195)])({'NineErrMsg':_0x143bb4});}const _0x5d7679=_0x3d199a[_0x34c94d(0x13e)][_0x34c94d(0x13e)][0x0]['b64_json']||_0x3d199a[_0x34c94d(0x13e)][_0x34c94d(0x13e)][0x0][_0x34c94d(0xf1)],_0x4a30d1=_0x5d7679[_0x34c94d(0x1b1)](/^data:image\/webp;base64,/,''),_0x1a5494=_0x34c94d(0x115)+_0xdae447+'-'+uuid['v4']()[_0x34c94d(0xff)](0x0,0xa)+_0x34c94d(0x119),_0x58b1cd=Buffer['from'](_0x4a30d1,'base64'),_0xb3ff77=await this['uploadService']['uploadFile']({'originalname':_0x1a5494,'filename':_0x1a5494,'base64':_0x4a30d1,'buffer':_0x58b1cd}),_0x5c28c0={'status':_0x34c94d(0x159),'progress':'100%','originalImgUrl':_0xb3ff77,'url':_0xb3ff77};await this['drawEntity'][_0x34c94d(0x11d)]({'id':_0x593342},_0x5c28c0);}catch(_0x283728){console['log']('drawDalleAndSave\x20--->:\x20',_0x283728===null||_0x283728===void 0x0?void 0x0:_0x283728[_0x34c94d(0x102)]);const _0x24e50a=(_0x283728===null||_0x283728===void 0x0?void 0x0:_0x283728['NineErrMsg'])||((_0x4dddbf=(_0x4c105f=(_0x322d7b=_0x283728===null||_0x283728===void 0x0?void 0x0:_0x283728[_0x34c94d(0x102)])===null||_0x322d7b===void 0x0?void 0x0:_0x322d7b[_0x34c94d(0x13e)])===null||_0x4c105f===void 0x0?void 0x0:_0x4c105f[_0x34c94d(0x122)])===null||_0x4dddbf===void 0x0?void 0x0:_0x4dddbf[_0x34c94d(0x1b6)])||((_0x25a96b=(_0x1287dd=_0x283728===null||_0x283728===void 0x0?void 0x0:_0x283728[_0x34c94d(0x102)])===null||_0x1287dd===void 0x0?void 0x0:_0x1287dd['data'])===null||_0x25a96b===void 0x0?void 0x0:_0x25a96b[_0x34c94d(0x122)])||'提交Dall-E绘画任务失败、已退还你的余额、请检查系统日志',_0x58a532={'status':'FAILURE','progress':'','requestErrTextTips':_0x24e50a};await this['userBalanceService'][_0x34c94d(0x180)](_0x4b7d5e,_0x235d97),await this['drawEntity'][_0x34c94d(0x11d)]({'id':_0xd0652e['id']},_0x58a532);}}async[_0x741979(0x117)](_0x333bcd){const _0xb1b253=_0x741979,_0x4fecc3=/--\w+\s\S+/g;return _0x333bcd[_0xb1b253(0x1b1)](_0x4fecc3,'');}async['formatMjDrawPrompt'](_0x2e6f66){const _0x318fe1=_0x741979,{parsePrompt:_0x513502,version:_0x537b8d,quality:_0x5c3edf,chaos:_0x445fef,stylize:_0x2cf3a2,style:_0x1ba99d,scale:_0x1647c0,model:_0x5a618c,seed:_0x1c91af,iw:_0x5b910e,referencePic:_0x24cdf1,no:_0xc5b007,cameraShot:_0x193040,light:_0x5e1512,view:_0x3ed1a0}=_0x2e6f66;if(_0x2e6f66===null||_0x2e6f66===void 0x0?void 0x0:_0x2e6f66[_0x318fe1(0x103)])return _0x513502;let _0x15c641=await this[_0x318fe1(0x117)](_0x513502);const _0x2f9d39=[_0x193040,_0x5e1512,_0x3ed1a0]['filter'](_0x394199=>_0x394199)['join'](',');return _0x2f9d39&&(_0x15c641=_0x15c641+'\x20\x20'+_0x2f9d39),_0xc5b007&&(_0x15c641=_0x15c641+_0x318fe1(0x177)+_0xc5b007),_0x1647c0&&(_0x15c641=_0x15c641+_0x318fe1(0x1ef)+_0x1647c0[_0x318fe1(0x17f)](':')),_0x1c91af&&(_0x15c641=_0x15c641+_0x318fe1(0x132)+_0x1c91af),_0x5a618c===_0x318fe1(0x1e9)&&(_0x15c641=_0x15c641+_0x318fe1(0x1d4)+_0x537b8d),_0x24cdf1&&_0x24cdf1[_0x318fe1(0x1cd)]&&(_0x15c641=_0x15c641+_0x318fe1(0x1dd)+_0x5b910e),_0x5c3edf&&(_0x15c641=_0x15c641+_0x318fe1(0xfb)+_0x5c3edf),_0x445fef&&(_0x15c641=_0x15c641+_0x318fe1(0x13f)+_0x445fef),_0x2cf3a2&&Number(_0x537b8d)!==0x5&&(_0x15c641=_0x15c641+_0x318fe1(0x1e1)+_0x2cf3a2),_0x5a618c==='mj'&&(_0x15c641=_0x15c641+_0x318fe1(0x13b)+_0x537b8d,Number(_0x537b8d)===0x5&&_0x1ba99d&&(_0x15c641=_0x15c641+_0x318fe1(0x113)+_0x1ba99d)),_0x15c641=_0x15c641+'\x20',_0x15c641;}async[_0x741979(0x130)](_0x6186c9){const _0x57fc2c=_0x741979;try{const _0x43aa6e=await axios_1['default'][_0x57fc2c(0x135)](_0x6186c9,{'responseType':_0x57fc2c(0x1da)}),_0x5da342=Buffer['from'](_0x43aa6e[_0x57fc2c(0x13e)],_0x57fc2c(0xf4)),_0x4a0bbb=(0x0,image_size_1[_0x57fc2c(0x161)])(_0x5da342);return{'width':_0x4a0bbb['width'],'height':_0x4a0bbb[_0x57fc2c(0x1ad)]};}catch(_0xd54434){return console[_0x57fc2c(0x122)](_0x57fc2c(0x199),_0xd54434),{'width':0x0,'height':0x0};}}async[_0x741979(0x17c)](){const _0x261e35=_0x741979,_0x7ded75=await this['globalConfigService']['getConfigs']([_0x261e35(0x145)]);if(!_0x7ded75)return'';const _0x31457f=_0x7ded75[_0x261e35(0x1cb)]('/')?_0x7ded75[_0x261e35(0xff)](0x0,_0x7ded75[_0x261e35(0x1cd)]-0x1):_0x7ded75;return _0x31457f;}async[_0x741979(0x12c)](){const _0x4fc2b4=_0x741979,_0x386439=await this[_0x4fc2b4(0x189)]['getConfigs']([_0x4fc2b4(0x120)]);if(!_0x386439)return'';if(_0x386439){const _0x1a79da=_0x386439[_0x4fc2b4(0x1cb)]('/')?_0x386439['slice'](0x0,_0x386439[_0x4fc2b4(0x1cd)]-0x1):_0x386439;return _0x1a79da+_0x4fc2b4(0x1a2);}}async[_0x741979(0x1c3)](_0x55a733){const _0x164adb=_0x741979;try{const _0x4ed59d=[];for(let _0x194332=0x0;_0x194332<_0x55a733['length'];_0x194332++){const _0x4698b2=_0x55a733[_0x194332],_0x10fcbd='random-'+uuid['v4']()[_0x164adb(0xff)](0x0,0xa)+'.png',_0x5a5d7f=Buffer['from'](_0x4698b2,_0x164adb(0x165)),_0x4dfd34=await this[_0x164adb(0x1e0)][_0x164adb(0x1db)]({'originalname':_0x10fcbd,'filename':_0x10fcbd,'base64':_0x4698b2,'buffer':_0x5a5d7f});_0x4ed59d[_0x164adb(0xed)](_0x4dfd34);}return _0x4ed59d;}catch(_0x3d64f7){return[];}}async[_0x741979(0x106)](_0x52c067){const _0x218d16=_0x741979,_0x1e60e2=await this[_0x218d16(0x189)][_0x218d16(0x18d)]([_0x218d16(0x14d),_0x218d16(0x152),_0x218d16(0x15c),_0x218d16(0x16e),_0x218d16(0x1e4),_0x218d16(0x127),'mjPanMoney','mjZoomMoney',_0x218d16(0x114),_0x218d16(0x1e2),_0x218d16(0x1ac),'mjDescribeMoney']);if(Number(_0x1e60e2['mjFreeUse'])===0x1)return 0x0;return _0x1e60e2[_0x52c067]?Number(_0x1e60e2[_0x52c067]):0x1;}async[_0x741979(0xf6)](_0x400d1e,_0x4230e0){const _0x12dd91=_0x741979,{taskType:_0x2c7cae,version:_0x1bc43f}=_0x4230e0;let _0x7d08ea=0x1;_0x2c7cae===0x1&&(_0x7d08ea=await this[_0x12dd91(0x106)]('mjImageMoney'));_0x2c7cae===0x2&&(_0x7d08ea=await this['getDrawDecutConfig'](_0x12dd91(0x15c)));_0x2c7cae===0x3&&(_0x7d08ea=await this[_0x12dd91(0x106)]('mjSwapFaceImageMoney'));if(_0x2c7cae===0x4){const _0x2e5eb9=Number(_0x1bc43f)===0x2?_0x12dd91(0x1e2):_0x12dd91(0x1ac);_0x7d08ea=await this[_0x12dd91(0x106)](_0x2e5eb9);}await this[_0x12dd91(0x10e)][_0x12dd91(0x158)](_0x400d1e,_0x12dd91(0x1c2),_0x7d08ea);}async[_0x741979(0x10c)](_0x75a818){const _0x41ba24=_0x741979,_0x3b3f8f=await this['drawEntity'][_0x41ba24(0x134)]({'where':{'userId':_0x75a818,'status':(0x0,typeorm_2['In'])([_0x41ba24(0x173),_0x41ba24(0x1af),'SUBMITTED'])}});console[_0x41ba24(0x194)]('用户'+_0x75a818+'当前进行中任务数量:\x20'+_0x3b3f8f+'\x20');const _0x45f2f9=await this[_0x41ba24(0x189)][_0x41ba24(0x18d)]([_0x41ba24(0x18c)]),_0x5bfc94=_0x45f2f9?Number(_0x45f2f9):0x2;if(_0x3b3f8f>=_0x5bfc94)throw new common_1[(_0x41ba24(0x15d))](_0x41ba24(0x16d)+_0x5bfc94+_0x41ba24(0x16c),common_1[_0x41ba24(0x19c)][_0x41ba24(0x170)]);}async['getList'](_0x50a1b9){const _0x371c7a=_0x741979,{page:page=0x1,size:size=0x14,sysRec:_0x1074cf,userId:_0x325eca,status:_0x1ccbe3}=_0x50a1b9,_0x20affd={'isDelete':0x1};_0x1074cf&&Object[_0x371c7a(0x1c1)](_0x20affd,{'sysRec':Number(_0x1074cf)}),_0x325eca&&Object[_0x371c7a(0x1c1)](_0x20affd,{'userId':_0x325eca}),_0x1ccbe3&&Object[_0x371c7a(0x1c1)](_0x20affd,{'status':_0x1ccbe3});const [_0x8d09c4,_0x580990]=await this[_0x371c7a(0x133)]['findAndCount']({'where':_0x20affd,'order':{'id':'DESC'},'take':size,'skip':(page-0x1)*size}),_0x4ab892=await this[_0x371c7a(0x17c)]();_0x8d09c4[_0x371c7a(0x121)](_0x2529bb=>{const _0x11b415=_0x371c7a;try{_0x2529bb[_0x11b415(0x163)]&&_0x2529bb[_0x11b415(0x163)][_0x11b415(0x125)](_0x11b415(0x17a))&&_0x4ab892&&(_0x2529bb[_0x11b415(0x163)]=_0x2529bb['originalImgUrl'][_0x11b415(0x1b1)]('https://cdn.discordapp.com',_0x4ab892));}catch(_0x1e9313){}});const _0x229395={'rows':_0x8d09c4,'count':_0x580990};return _0x229395;}async[_0x741979(0xf2)](_0x34eb26){const _0x4502a2=_0x741979,{id:_0x2f19eb}=_0x34eb26,_0x42fcfe=await this[_0x4502a2(0x133)][_0x4502a2(0x1c8)]({'where':{'id':_0x2f19eb},'select':[_0x4502a2(0xf3),_0x4502a2(0x146),'id']});return _0x42fcfe;}async['getDectDetail'](){const _0xef3e63=_0x741979,_0xa4a994=await this[_0xef3e63(0x189)]['getConfigs']([_0xef3e63(0x14d),_0xef3e63(0x152),_0xef3e63(0x15c),_0xef3e63(0x16e),_0xef3e63(0x1e4),_0xef3e63(0x127),_0xef3e63(0x17e),_0xef3e63(0x1bc),_0xef3e63(0x114),_0xef3e63(0x1e2),'dalleModel3Meney',_0xef3e63(0x1be),_0xef3e63(0x13a)]);return Number(_0xa4a994['mjFreeUse'])===0x1&&Object[_0xef3e63(0x1b0)](_0xa4a994)['forEach'](_0x7d0256=>{const _0x1626c0=_0xef3e63;!['mjFreeUse',_0x1626c0(0x13a)][_0x1626c0(0x125)](_0x7d0256)&&(_0xa4a994[_0x7d0256]=0x0);}),_0xa4a994;}async[_0x741979(0x149)](){const _0xb651cf=_0x741979,_0x255d2b=await this['globalConfigService'][_0xb651cf(0x18d)](['mjNotice']);return _0x255d2b;}async['compressionImg'](_0x2666fa,_0x234285=0x1e){const _0x1aeadc=_0x741979;try{const _0x263b8e=await(0x0,axios_1[_0x1aeadc(0x161)])({'method':_0x1aeadc(0x135),'url':_0x2666fa,'responseType':_0x1aeadc(0x1da)}),_0x21c7c4=Buffer[_0x1aeadc(0x129)](_0x263b8e['data'],_0x1aeadc(0xf4)),_0x3bf45e=await sharp(_0x21c7c4)['jpeg']({'quality':_0x234285})[_0x1aeadc(0x1eb)]();return _0x3bf45e;}catch(_0x399040){return null;}}};DrawService=__decorate([(0x0,common_1[_0x741979(0x19b)])(),__param(0x1,(0x0,typeorm_1['InjectRepository'])(draw_entity_1[_0x741979(0x171)])),__param(0x2,(0x0,typeorm_1[_0x741979(0xee)])(config_entity_1['ConfigEntity'])),__param(0x3,(0x0,typeorm_1[_0x741979(0xee)])(user_entity_1[_0x741979(0x18a)])),__metadata(_0x741979(0x1d9),[upload_service_1[_0x741979(0x14f)],typeorm_2[_0x741979(0x131)],typeorm_2[_0x741979(0x131)],typeorm_2[_0x741979(0x131)],chatgpt_service_1[_0x741979(0x167)],models_service_1[_0x741979(0x16a)],globalConfig_service_1['GlobalConfigService'],userBalance_service_1[_0x741979(0x196)]])],DrawService),exports[_0x741979(0x1bb)]=DrawService;function _0x25f2(){const _0x4eebbc=['drawBlend:\x20','当前DallE绘画模型暂未上架、请联系管理员上架此模型！','response','customInstruct','提交图生文任务失败、请检查系统日志','NineErrMsg','getDrawDecutConfig','chatgptService','缺少解析图！','deductFromBalance','decorate','/mj/submit/describe','checkUserDrawLimit','thumb','userBalanceService','b64_json','/v1/images/generations','已完成对用户','定时任务\x20->\x20定时裁剪缩略图任务扫描中----->\x20待裁剪长度-------->:\x20','\x20--style\x20','mjRedrawMoney','dall-e-','DESC','removeParameters','drawShorten','.png','axios','textToImage\x20error:\x20','env','update','推荐成功','../user/user.entity','mjNotifyUrl','forEach','error','确认弹窗任务失败、缺失必要参数！','find','includes','notify\x20-------->','mjVariationMoney','result','from','drawDalleAndSave','getUseDrawModelKey','getNotifyUrl','res:\x20','取消推荐成功','mjSecretKey','getImageDimensionsFromUrl','Repository','\x20--seed\x20','drawEntity','count','get','2042565RTpMqH','./draw.entity','imgToText','res?.data:\x20','mjNotice','\x20--v\x20','uuid','NineErrMsg:\x20','data','\x20--c\x20','configEntity','username','删除成功','image-size','metadata','mjImageProxy','promptEn','userInfo','正在执行混图任务中......','notice','map','未知图片！','delete','mjFreeUse','执行换脸任务失败、请检查系统日志','UploadService','describe','获取seed失败','mjImageMoney','../upload/upload.service','modelsService','description','reroll','/mj/submit/shorten','validateBalance','FINISH','sharp','email','mjBlendImageMoney','HttpException','3457BqrHmM','未找到该项','delItem','default','MID_JOURNEY','originalImgUrl','thumb-mj-[','base64','maskBase64','ChatgptService','第一张上传图:\x20','proxyUrl','ModelsService','reverse','、请等待任务结束后继续！','当前管理员限制同时最大任务数量为','mjSwapFaceImageMoney','裁剪缩略图任务失败:\x20','BAD_REQUEST','DrawEntity','CustomZoom','NOT_START','typeorm','compressionImg','mj\x20notify\x20err:\x20','\x20--no\x20','defineProperty','提交任务失败、请检查系统配置','https://cdn.discordapp.com','formatCreateOrUpdateDate','getMjImageProxyUrl','code','mjPanMoney','join','drawFailRefund','现在请你担任Ai绘画的prompt\x20creator，主要任务是我会给您一个主题，然后请你根据主题\x20来书写提示词，提示词的格式如下：\x0a\x20\x20\x20\x20\x20\x20\x20\x20Style\x20+\x20Subject\x20+\x20Setting\x20+\x20Composition\x20+\x20Lighting\x20+\x20Additional\x20Info\x0a\x20\x20\x20\x20\x20\x20\x20\x20Style:\x20Photo\x20of\x0a\x20\x20\x20\x20\x20\x20\x20\x20Subject:An\x20astronaut\x20in\x20a\x20white\x20space\x20suit,\x20helmet\x20visor\x20reflecting\x20stars,\x0a\x20\x20\x20\x20\x20\x20\x20\x20Setting:\x20Standing\x20on\x20a\x20moon\x20with\x20Earth\x20visible\x20in\x20the\x20starry\x20sky,\x0a\x20\x20\x20\x20\x20\x20\x20\x20Composition:Astronaut\x20centered,\x20Earth\x20in\x20the\x20background,\x0a\x20\x20\x20\x20\x20\x20\x20\x20Lighting:Bright\x20sunlight\x20with\x20soft\x20moonlight\x20reflections,\x0a\x20\x20\x20\x20\x20\x20\x20\x20Additional\x20Info:\x20Moon\x20rocks\x20and\x20small\x20craters\x20nearby,\x0a\x20\x20\x20\x20\x20\x20\x20\x20参考上述的模板、将我给你的这段内容进行优化、对照上面格式、按着我的这段话发散思维、最后返回英文格式、不要返回其他任何东西、请优化这段内容\x20','saveUseLog','正在对上传图片进行咒语解析中...','mjPlusNotify','__decorate','taskCroppingThumbUrl','status','/mj/submit/blend','globalConfigService','UserEntity','dall-e-2','mjUserLimit','getConfigs','avatar','parse','Inpaint','getSeed','id不能为空','22BZICmH','log','throwError','UserBalanceService','__esModule','split','Error\x20in\x20getImageDimensionsFromUrl:','49828kmjuPe','Injectable','HttpStatus','../userBalance/userBalance.service','/mj/submit/imagine','Outpaint','---------->\x20定时裁剪缩略图任务扫描中..........','drawAction','/api/draw/mjPlusNotify','../models/models.service','180XInEfr','userId','post','notifyDalleDraw','fast','drawBlend','../globalConfig/globalConfig.service','convertUrlsToBase64','dalleModel3Meney','height','../globalConfig/config.entity','IN_PROGRESS','keys','replace','save','application/json','chatGlobaltools','图片裁剪、缩率图地址为：\x20','message','drawSwapFaceAction\x20code\x20!=\x201:\x20\x20441','dalle','error:\x20','dall-e-3','DrawService','mjZoomMoney','uploadBase64ToMj','mjDescribeMoney','Not','findAndCount','assign','mjDraw','getUrlByUploadBase','mjProxyUrl','14030000dMDGfZ','/image-seed','user','findOne','adminDrawList','提交Action任务失败、请检查系统日志','endsWith','getAxiosInstance','length','userEntity','drawSwapDace','stringify','__metadata','quota_not_enough','/mj/task/','\x20--niji\x20','现在请你担任Ai绘画的prompt\x20creator，主要任务是我会给您一个主题，然后请你根据主题\x20来书写提示词，提示词的格式如下：\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Style\x20+\x20Subject\x20+\x20Setting\x20+\x20Composition\x20+\x20Lighting\x20+\x20Additional\x20Info\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Style:\x20Photo\x20of\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Subject:An\x20astronaut\x20in\x20a\x20white\x20space\x20suit,\x20helmet\x20visor\x20reflecting\x20stars,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Setting:\x20Standing\x20on\x20a\x20moon\x20with\x20Earth\x20visible\x20in\x20the\x20starry\x20sky,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Composition:Astronaut\x20centered,\x20Earth\x20in\x20the\x20background,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Lighting:Bright\x20sunlight\x20with\x20soft\x20moonlight\x20reflections,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Additional\x20Info:\x20Moon\x20rocks\x20and\x20small\x20craters\x20nearby,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20参考上述的模板、将我给你的这段内容进行优化、对照上面格式、按着我的这段话发散思维、最后返回英文格式、不要返回其他任何东西、请优化这段内容\x20','function','执行混图任务失败、请检查系统日志','/mj/submit/action','design:paramtypes','arraybuffer','uploadFile','Executing\x20mixed\x20image\x20task...','\x20--iw\x20','Executing\x20AI\x20face\x20swap...','46245yZoADV','uploadService','\x20--s\x20','dalleModel2Meney','/mj/insight-face/swap','mjUpscaleMoney','Bearer\x20','delDrawItem','recSysList','请将下面这句话翻译为英文、并且只回复我英文、不要回复任何别的内容、翻译这句话\x20','niji','/mj/submit/upload-discord-images','toBuffer','186dzijRw','930QWeLNe','DEBUG','\x20--ar\x20','sysRec','zoomPrompt','../../common/utils','8Ayhmgh','/mj/submit/modal','管理员配置模型余额不足\x20请联系管理员！','push','InjectRepository','174120VExFlf','\x20裁剪缩略图任务完成:\x20','url','detail','prompt','binary','Analyzing\x20the\x20uploaded\x20image...','drawValidateBalance','SUCCESS','getFormatString','modelTypeId','混图任务最多支持6张图片!','\x20--q\x20','getOwnPropertyDescriptor','12704562kNHbfG','FAILURE','slice'];_0x25f2=function(){return _0x4eebbc;};return _0x25f2();}