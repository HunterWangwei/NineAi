'use strict';function _0x8022(){const _0x536ddb=['您提交的信息中包含','defineProperty','__metadata','badWords','globalConfigService','addBadWord','检测失败','update','checkBadWordsByConfig','8106687bMGtZP','baiduTextAccessToken','email','violationLogEntity','30VbvoHG','@nestjs/typeorm','敏感词检测\x20|\x20','recordUserBadWords','violationCount','includes','的内容、我们已对您的账户进行标记、请合规使用！','join','BadwordsService','__decorate','stringify','msg','HttpStatus','敏感词不存在,请检查您的提交信息','badWordsEntity','userInfo','queryBadWords','word_list','../user/user.entity','application/x-www-form-urlencoded','set','HttpException','ASC','execute','design:paramtypes','baiduCheckBadWords','username','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=','@nestjs/common','super','../../common/utils','delBadWords','log','application/json','自定义','createQueryBuilder','checkBadWords','Repository','NineAi检测','BadWordsEntity','word','baidu','save','where','loadBadWords','forEach','status','error:\x20','hideString','typeOriginCn','keyword','delete','添加敏感词成功','DESC','***','8443974RtOjmR','您提交的内容中包含','4078242AsdsWM','violationCount\x20+\x201','avatar','的信息、我们已对您账号进行标记、请合规使用！','敏感词已存在,请检查您的提交信息','affected','updateBadWords','category','10792122NpMnDa','getSensitiveConfig','UserEntity','push','default','userEntity','BAD_REQUEST','2568wXgUFe','violation','decorate','InjectRepository','nineaiCheckBadWords','./violationLog.entity','data','findAndCount','id\x20=\x20:userId','extractContent','5hxiVEU','百度文本检测出现错误、请查看配置信息:\x20','151998VrNPtM','metadata','findOne','8nHhMUY','post','__param','map','百度云检测','user','userId','397156adVfPf','function','axios','更新敏感词失败','find','formarTips','length','nineai','10SyfTRN','Like'];_0x8022=function(){return _0x536ddb;};return _0x8022();}const _0x51e930=_0x4295;(function(_0x1c8082,_0x477964){const _0x4f1ba3=_0x4295,_0x4e5316=_0x1c8082();while(!![]){try{const _0x1a5c66=-parseInt(_0x4f1ba3(0x168))/0x1*(parseInt(_0x4f1ba3(0x13b))/0x2)+-parseInt(_0x4f1ba3(0x147))/0x3+-parseInt(_0x4f1ba3(0x151))/0x4+-parseInt(_0x4f1ba3(0x145))/0x5*(parseInt(_0x4f1ba3(0x12a))/0x6)+-parseInt(_0x4f1ba3(0x12c))/0x7*(-parseInt(_0x4f1ba3(0x14a))/0x8)+-parseInt(_0x4f1ba3(0x164))/0x9*(-parseInt(_0x4f1ba3(0x159))/0xa)+parseInt(_0x4f1ba3(0x134))/0xb;if(_0x1a5c66===_0x477964)break;else _0x4e5316['push'](_0x4e5316['shift']());}catch(_0x57914a){_0x4e5316['push'](_0x4e5316['shift']());}}}(_0x8022,0xd4127));var __decorate=this&&this[_0x51e930(0x171)]||function(_0x3c2fdb,_0x29036d,_0xbe0e78,_0x5f5d7f){const _0x2ba7f8=_0x51e930;var _0x4336b5=arguments['length'],_0x726869=_0x4336b5<0x3?_0x29036d:_0x5f5d7f===null?_0x5f5d7f=Object['getOwnPropertyDescriptor'](_0x29036d,_0xbe0e78):_0x5f5d7f,_0x302272;if(typeof Reflect==='object'&&typeof Reflect[_0x2ba7f8(0x13d)]==='function')_0x726869=Reflect[_0x2ba7f8(0x13d)](_0x3c2fdb,_0x29036d,_0xbe0e78,_0x5f5d7f);else{for(var _0x40fe3e=_0x3c2fdb['length']-0x1;_0x40fe3e>=0x0;_0x40fe3e--)if(_0x302272=_0x3c2fdb[_0x40fe3e])_0x726869=(_0x4336b5<0x3?_0x302272(_0x726869):_0x4336b5>0x3?_0x302272(_0x29036d,_0xbe0e78,_0x726869):_0x302272(_0x29036d,_0xbe0e78))||_0x726869;}return _0x4336b5>0x3&&_0x726869&&Object[_0x2ba7f8(0x15c)](_0x29036d,_0xbe0e78,_0x726869),_0x726869;},__metadata=this&&this[_0x51e930(0x15d)]||function(_0x1eef03,_0x1a96af){const _0x40397c=_0x51e930;if(typeof Reflect==='object'&&typeof Reflect[_0x40397c(0x148)]===_0x40397c(0x152))return Reflect['metadata'](_0x1eef03,_0x1a96af);},__param=this&&this[_0x51e930(0x14c)]||function(_0x39a1ea,_0x5d16da){return function(_0x2524cf,_0x3b57fc){_0x5d16da(_0x2524cf,_0x3b57fc,_0x39a1ea);};};function _0x4295(_0x75d84f,_0x4b7ca2){const _0x8022fd=_0x8022();return _0x4295=function(_0x4295f4,_0x5e1cb9){_0x4295f4=_0x4295f4-0x100;let _0x3eee42=_0x8022fd[_0x4295f4];return _0x3eee42;},_0x4295(_0x75d84f,_0x4b7ca2);}Object[_0x51e930(0x15c)](exports,'__esModule',{'value':!![]}),exports[_0x51e930(0x170)]=void 0x0;const globalConfig_service_1=require('./../globalConfig/globalConfig.service'),common_1=require(_0x51e930(0x10f)),badwords_entity_1=require('./badwords.entity'),typeorm_1=require('typeorm'),typeorm_2=require(_0x51e930(0x169)),axios_1=require(_0x51e930(0x153)),violationLog_entity_1=require(_0x51e930(0x140)),user_entity_1=require(_0x51e930(0x105)),utils_1=require(_0x51e930(0x111));let BadwordsService=class BadwordsService{constructor(_0x43d97f,_0x41c17a,_0x1df4e9,_0x2cb9e2){const _0x3c264c=_0x51e930;this[_0x3c264c(0x101)]=_0x43d97f,this['violationLogEntity']=_0x41c17a,this['userEntity']=_0x1df4e9,this[_0x3c264c(0x15f)]=_0x2cb9e2,this['badWords']=[];}async['onModuleInit'](){const _0x306787=_0x51e930;this[_0x306787(0x11f)]();}async['customSensitiveWords'](_0x3734d5,_0x4f5a16){const _0x585940=_0x51e930,_0x1337c1=[];for(let _0x2681f1=0x0;_0x2681f1<this[_0x585940(0x15e)][_0x585940(0x157)];_0x2681f1++){const _0x19651d=this[_0x585940(0x15e)][_0x2681f1];_0x3734d5[_0x585940(0x16d)](_0x19651d)&&_0x1337c1[_0x585940(0x137)](_0x19651d);}if(_0x1337c1[_0x585940(0x157)]){await this[_0x585940(0x16b)](_0x4f5a16,_0x3734d5,_0x1337c1,[_0x585940(0x115)],'自定义检测');const _0x272c38='您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！';throw new common_1[(_0x585940(0x108))](_0x272c38,common_1[_0x585940(0x174)]['BAD_REQUEST']);}}async[_0x51e930(0x117)](_0x343a16,_0x40aeb1){const _0x46ae3b=_0x51e930,_0x5b7d9e=await this[_0x46ae3b(0x15f)][_0x46ae3b(0x135)]();_0x5b7d9e&&await this[_0x46ae3b(0x163)](_0x343a16,_0x5b7d9e,_0x40aeb1),await this['customSensitiveWords'](_0x343a16,_0x40aeb1);}async[_0x51e930(0x163)](_0x14e745,_0x488495,_0x3cbcba){const _0x32c123=_0x51e930,{useType:_0x5d08c6}=_0x488495;_0x5d08c6===_0x32c123(0x11c)&&await this[_0x32c123(0x10c)](_0x14e745,_0x488495[_0x32c123(0x165)],_0x3cbcba),_0x5d08c6===_0x32c123(0x158)&&await this[_0x32c123(0x13f)](_0x14e745,_0x488495,_0x3cbcba);}['extractContent'](_0x1e0ddf){const _0x3dad07=/存在(.*?)不合规/,_0x372cd0=_0x1e0ddf['match'](_0x3dad07);return _0x372cd0?_0x372cd0[0x1]:'';}async[_0x51e930(0x10c)](_0x54418b,_0x5bed1f,_0x5544ea){const _0x264e57=_0x51e930;if(!_0x5bed1f)return;const _0x537276=_0x264e57(0x10e)+_0x5bed1f+'}',_0x512e40={'Content-Type':_0x264e57(0x106),'Accept':'application/json'},_0x233b13=await axios_1[_0x264e57(0x138)][_0x264e57(0x14b)](_0x537276,{'text':_0x54418b},{'headers':_0x512e40}),{conclusion:_0xed6afb,error_code:_0x2575af,error_msg:_0x176491,conclusionType:_0x5a9d55,data:_0x4bbed1}=_0x233b13[_0x264e57(0x141)];_0x2575af&&console[_0x264e57(0x113)](_0x264e57(0x146),_0x176491);if(_0x5a9d55!==0x1){const _0x239b53=[...new Set(_0x4bbed1[_0x264e57(0x14d)](_0x33a2d8=>this[_0x264e57(0x144)](_0x33a2d8[_0x264e57(0x173)])))];await this[_0x264e57(0x16b)](_0x5544ea,_0x54418b,[_0x264e57(0x129)],_0x239b53,_0x264e57(0x14e));const _0x2d8936=_0x264e57(0x15b)+_0x239b53[_0x264e57(0x16f)](',')+_0x264e57(0x16e);throw new common_1[(_0x264e57(0x108))](_0x2d8936,common_1[_0x264e57(0x174)][_0x264e57(0x13a)]);}}async[_0x51e930(0x13f)](_0x29a30c,_0x2aa320,_0x3dbf1a){const _0x517868=_0x51e930;var _0x2f3bb5;const {nineaiBuiltInSensitiveApiBase:_0x5ddb1d,nineaiBuiltInSensitiveAuthKey:_0x1f4540}=_0x2aa320;if(!_0x5ddb1d||!_0x1f4540)return;const _0x307cda=await axios_1[_0x517868(0x138)]['post'](_0x5ddb1d,{'content':_0x29a30c},{'headers':{'Content-Type':_0x517868(0x114),'Authorization':_0x1f4540}});if(!_0x307cda['data'])return;if(_0x307cda[_0x517868(0x141)]['code']!=='0'){const {msg:msg=_0x517868(0x161)}=_0x307cda[_0x517868(0x141)];throw new common_1[(_0x517868(0x108))](_0x517868(0x16a)+msg,common_1[_0x517868(0x174)][_0x517868(0x13a)]);}if(_0x307cda[_0x517868(0x141)][_0x517868(0x104)]&&((_0x2f3bb5=_0x307cda['data'][_0x517868(0x104)])===null||_0x2f3bb5===void 0x0?void 0x0:_0x2f3bb5[_0x517868(0x157)])){const _0x2012ec=[...new Set(_0x307cda[_0x517868(0x141)][_0x517868(0x104)][_0x517868(0x14d)](_0x63b427=>_0x63b427[_0x517868(0x125)]))],_0x2d7779=[...new Set(_0x307cda['data'][_0x517868(0x104)][_0x517868(0x14d)](_0x4bab3d=>_0x4bab3d[_0x517868(0x133)]))];await this[_0x517868(0x16b)](_0x3dbf1a,_0x29a30c,_0x2012ec,_0x2d7779,_0x517868(0x119));const _0x161c78=this[_0x517868(0x156)](_0x307cda[_0x517868(0x141)]['word_list']);throw new common_1[(_0x517868(0x108))](_0x161c78,common_1[_0x517868(0x174)][_0x517868(0x13a)]);}}[_0x51e930(0x156)](_0x256aae){const _0x1228a7=_0x51e930,_0x2db531=_0x256aae[_0x1228a7(0x14d)](_0x32be4a=>_0x32be4a[_0x1228a7(0x133)]),_0x59b5a3=[...new Set(_0x2db531)];return _0x1228a7(0x12b)+_0x59b5a3['join'](',')+_0x1228a7(0x12f);}async['loadBadWords'](){const _0x4c25ac=_0x51e930,_0x3a77dc=await this[_0x4c25ac(0x101)]['find']({'where':{'status':0x1},'select':[_0x4c25ac(0x11b)]});this[_0x4c25ac(0x15e)]=_0x3a77dc['map'](_0x349923=>_0x349923[_0x4c25ac(0x11b)]);}async[_0x51e930(0x103)](_0x19353b){const _0x41ef53=_0x51e930,{page:page=0x1,size:size=0x1f4,word:_0x1d0004,status:_0x350c3b}=_0x19353b,_0x5a536a={};[0x0,0x1,'0','1'][_0x41ef53(0x16d)](_0x350c3b)&&(_0x5a536a[_0x41ef53(0x121)]=_0x350c3b),_0x1d0004&&(_0x5a536a['word']=(0x0,typeorm_1[_0x41ef53(0x15a)])('%'+_0x1d0004+'%'));const [_0x9b2348,_0x513ba7]=await this[_0x41ef53(0x101)][_0x41ef53(0x142)]({'where':_0x5a536a,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x41ef53(0x109)}});return{'rows':_0x9b2348,'count':_0x513ba7};}async[_0x51e930(0x112)](_0x390dd7){const _0x3201d9=_0x51e930,_0x47db65=await this[_0x3201d9(0x101)][_0x3201d9(0x149)]({'where':{'id':_0x390dd7['id']}});if(!_0x47db65)throw new common_1[(_0x3201d9(0x108))](_0x3201d9(0x100),common_1[_0x3201d9(0x174)]['BAD_REQUEST']);const _0x4f092c=await this[_0x3201d9(0x101)][_0x3201d9(0x126)]({'id':_0x390dd7['id']});if(_0x4f092c[_0x3201d9(0x131)]>0x0)return await this[_0x3201d9(0x11f)](),'删除敏感词成功';else throw new common_1[(_0x3201d9(0x108))]('删除敏感词失败',common_1[_0x3201d9(0x174)][_0x3201d9(0x13a)]);}async[_0x51e930(0x132)](_0x279ac9){const _0xa8db8d=_0x51e930,{id:_0x3736a9,word:_0x24d1a2,status:_0x5bfb8b}=_0x279ac9,_0x110ff1=await this[_0xa8db8d(0x101)]['findOne']({'where':{'word':_0x24d1a2}});if(_0x110ff1)throw new common_1[(_0xa8db8d(0x108))]('敏感词已经存在了、请勿重复添加',common_1[_0xa8db8d(0x174)][_0xa8db8d(0x13a)]);const _0x46b271=await this[_0xa8db8d(0x101)][_0xa8db8d(0x162)]({'id':_0x3736a9},{'word':_0x24d1a2,'status':_0x5bfb8b});if(_0x46b271[_0xa8db8d(0x131)]>0x0)return await this[_0xa8db8d(0x11f)](),'更新敏感词成功';else throw new common_1[(_0xa8db8d(0x108))](_0xa8db8d(0x154),common_1[_0xa8db8d(0x174)][_0xa8db8d(0x13a)]);}async[_0x51e930(0x160)](_0x5a54aa){const _0x2fd8d4=_0x51e930,{word:_0x35fbcb}=_0x5a54aa,_0x4e668c=await this[_0x2fd8d4(0x101)][_0x2fd8d4(0x149)]({'where':{'word':_0x35fbcb}});if(_0x4e668c)throw new common_1['HttpException'](_0x2fd8d4(0x130),common_1['HttpStatus'][_0x2fd8d4(0x13a)]);return await this[_0x2fd8d4(0x101)]['save']({'word':_0x35fbcb}),await this[_0x2fd8d4(0x11f)](),_0x2fd8d4(0x127);}async[_0x51e930(0x16b)](_0x5ae7fd,_0xc3542f,_0x328f0c,_0x149b4b,_0x400106){const _0x13dd50=_0x51e930,_0xa020e1={'userId':_0x5ae7fd,'content':_0xc3542f,'words':JSON['stringify'](_0x328f0c),'typeCn':JSON[_0x13dd50(0x172)](_0x149b4b),'typeOriginCn':_0x400106};try{await this[_0x13dd50(0x139)][_0x13dd50(0x116)]()[_0x13dd50(0x162)](user_entity_1[_0x13dd50(0x136)])[_0x13dd50(0x107)]({'violationCount':()=>_0x13dd50(0x12d)})[_0x13dd50(0x11e)](_0x13dd50(0x143),{'userId':_0x5ae7fd})[_0x13dd50(0x10a)](),await this[_0x13dd50(0x167)][_0x13dd50(0x11d)](_0xa020e1);}catch(_0x129f56){console[_0x13dd50(0x113)](_0x13dd50(0x122),_0x129f56);}}async[_0x51e930(0x13c)](_0x555388,_0x410d7d){const _0x1df2b6=_0x51e930,{role:_0x4662c8}=_0x555388[_0x1df2b6(0x14f)],{page:page=0x1,size:size=0xa,userId:_0x201200,typeOriginCn:_0x7683d4}=_0x410d7d,_0x1b07ba={};_0x201200&&(_0x1b07ba[_0x1df2b6(0x150)]=_0x201200),_0x7683d4&&(_0x1b07ba[_0x1df2b6(0x124)]=_0x7683d4);const [_0x44ddb7,_0x2fcd63]=await this['violationLogEntity'][_0x1df2b6(0x142)]({'where':_0x1b07ba,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x1df2b6(0x128)}}),_0x2ebf5e=[...new Set(_0x44ddb7['map'](_0x4826b4=>_0x4826b4[_0x1df2b6(0x150)]))],_0xe05a5c=await this[_0x1df2b6(0x139)][_0x1df2b6(0x155)]({'where':{'id':(0x0,typeorm_1['In'])(_0x2ebf5e)},'select':['id',_0x1df2b6(0x12e),_0x1df2b6(0x10d),_0x1df2b6(0x166),_0x1df2b6(0x16c),_0x1df2b6(0x121)]});return _0x44ddb7[_0x1df2b6(0x120)](_0x57a69d=>{const _0x2b71e9=_0x1df2b6,_0x41dd89=_0xe05a5c[_0x2b71e9(0x155)](_0x183137=>_0x183137['id']===_0x57a69d[_0x2b71e9(0x150)]);_0x4662c8!==_0x2b71e9(0x110)&&(_0x41dd89[_0x2b71e9(0x166)]=(0x0,utils_1[_0x2b71e9(0x123)])(_0x41dd89===null||_0x41dd89===void 0x0?void 0x0:_0x41dd89[_0x2b71e9(0x166)])),_0x57a69d[_0x2b71e9(0x102)]=_0x41dd89;}),{'rows':_0x44ddb7,'count':_0x2fcd63};}};BadwordsService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_2[_0x51e930(0x13e)])(badwords_entity_1[_0x51e930(0x11a)])),__param(0x1,(0x0,typeorm_2[_0x51e930(0x13e)])(violationLog_entity_1['ViolationLogEntity'])),__param(0x2,(0x0,typeorm_2[_0x51e930(0x13e)])(user_entity_1[_0x51e930(0x136)])),__metadata(_0x51e930(0x10b),[typeorm_1[_0x51e930(0x118)],typeorm_1[_0x51e930(0x118)],typeorm_1[_0x51e930(0x118)],globalConfig_service_1['GlobalConfigService']])],BadwordsService),exports['BadwordsService']=BadwordsService;