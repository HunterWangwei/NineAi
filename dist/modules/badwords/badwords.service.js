'use strict';const _0x48eb69=_0x1694;(function(_0x2462cb,_0x367587){const _0x514f41=_0x1694,_0x349e9a=_0x2462cb();while(!![]){try{const _0x5772b9=-parseInt(_0x514f41(0x1b1))/0x1+parseInt(_0x514f41(0x190))/0x2+parseInt(_0x514f41(0x1cc))/0x3+-parseInt(_0x514f41(0x1a7))/0x4+-parseInt(_0x514f41(0x1d3))/0x5*(-parseInt(_0x514f41(0x1a6))/0x6)+parseInt(_0x514f41(0x17c))/0x7+parseInt(_0x514f41(0x173))/0x8*(-parseInt(_0x514f41(0x16d))/0x9);if(_0x5772b9===_0x367587)break;else _0x349e9a['push'](_0x349e9a['shift']());}catch(_0x1e25ea){_0x349e9a['push'](_0x349e9a['shift']());}}}(_0x20eb,0x8b4e9));var __decorate=this&&this[_0x48eb69(0x1c1)]||function(_0x4d2057,_0x45b2f1,_0x5981fc,_0x4e8fad){const _0x252df0=_0x48eb69;var _0x523d4b=arguments[_0x252df0(0x180)],_0xdb6e29=_0x523d4b<0x3?_0x45b2f1:_0x4e8fad===null?_0x4e8fad=Object[_0x252df0(0x1d5)](_0x45b2f1,_0x5981fc):_0x4e8fad,_0x1b8bea;if(typeof Reflect===_0x252df0(0x1cd)&&typeof Reflect[_0x252df0(0x1bd)]===_0x252df0(0x19a))_0xdb6e29=Reflect[_0x252df0(0x1bd)](_0x4d2057,_0x45b2f1,_0x5981fc,_0x4e8fad);else{for(var _0x369e79=_0x4d2057[_0x252df0(0x180)]-0x1;_0x369e79>=0x0;_0x369e79--)if(_0x1b8bea=_0x4d2057[_0x369e79])_0xdb6e29=(_0x523d4b<0x3?_0x1b8bea(_0xdb6e29):_0x523d4b>0x3?_0x1b8bea(_0x45b2f1,_0x5981fc,_0xdb6e29):_0x1b8bea(_0x45b2f1,_0x5981fc))||_0xdb6e29;}return _0x523d4b>0x3&&_0xdb6e29&&Object[_0x252df0(0x16f)](_0x45b2f1,_0x5981fc,_0xdb6e29),_0xdb6e29;},__metadata=this&&this[_0x48eb69(0x1d0)]||function(_0x4424fa,_0x526e6c){const _0x458e7c=_0x48eb69;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x458e7c(0x19a))return Reflect[_0x458e7c(0x170)](_0x4424fa,_0x526e6c);},__param=this&&this[_0x48eb69(0x196)]||function(_0x250f13,_0x1ed6c6){return function(_0x2a3467,_0x3fd765){_0x1ed6c6(_0x2a3467,_0x3fd765,_0x250f13);};};Object[_0x48eb69(0x16f)](exports,'__esModule',{'value':!![]}),exports[_0x48eb69(0x16e)]=void 0x0;function _0x1694(_0x3d479e,_0x143a49){const _0x20ebdc=_0x20eb();return _0x1694=function(_0x16942d,_0x467ec9){_0x16942d=_0x16942d-0x168;let _0x267038=_0x20ebdc[_0x16942d];return _0x267038;},_0x1694(_0x3d479e,_0x143a49);}function _0x20eb(){const _0x52ba17=['object','GlobalConfigService','log','__metadata','badWordsEntity','word_list','20405XoynCs','敏感词不存在,请检查您的提交信息','getOwnPropertyDescriptor','敏感词已存在,请检查您的提交信息','badWords','default','的内容、我们已对您的账户进行标记、请合规使用！','formarTips','application/json','design:paramtypes','10710099AYELMF','BadwordsService','defineProperty','metadata','violationCount','word','8PfOVaj','id\x20=\x20:userId','customSensitiveWords','username','./violationLog.entity','delBadWords','findOne','../../common/utils','user','297101Ecnmbr','data','checkBadWordsByConfig','update','length','typeorm','status','updateBadWords','push','ASC','email','ViolationLogEntity','@nestjs/common','category','删除敏感词成功','HttpStatus','更新敏感词成功','userInfo','extractContent','find','1416482hNqLPP','stringify','keyword','msg','application/x-www-form-urlencoded','queryBadWords','__param','../user/user.entity','match','includes','function','post','recordUserBadWords','globalConfigService','super','loadBadWords','***','InjectRepository','join','HttpException','BAD_REQUEST','百度云检测','1452GMObPc','2348208vNWrUs','violationCount\x20+\x201','Repository','save','baiduTextAccessToken','baiduCheckBadWords','Like','checkBadWords','@nestjs/typeorm','nineai','438368GeYWsY','您提交的内容中包含','userId','Injectable','onModuleInit','findAndCount','error:\x20','hideString','敏感词已经存在了、请勿重复添加','violationLogEntity','nineaiCheckBadWords','typeOriginCn','decorate','您提交的信息中包含','addBadWord','userEntity','__decorate','createQueryBuilder','affected','map','百度文本检测出现错误、请查看配置信息:\x20','的信息、我们已对您账号进行标记、请合规使用！','delete','violation','baidu','./../globalConfig/globalConfig.service','UserEntity','3143238ndYGko'];_0x20eb=function(){return _0x52ba17;};return _0x20eb();}const globalConfig_service_1=require(_0x48eb69(0x1ca)),common_1=require(_0x48eb69(0x188)),badwords_entity_1=require('./badwords.entity'),typeorm_1=require(_0x48eb69(0x181)),typeorm_2=require(_0x48eb69(0x1af)),axios_1=require('axios'),violationLog_entity_1=require(_0x48eb69(0x177)),user_entity_1=require(_0x48eb69(0x197)),utils_1=require(_0x48eb69(0x17a));let BadwordsService=class BadwordsService{constructor(_0xa93022,_0x12ddea,_0x481102,_0x52d46b){const _0x5860cb=_0x48eb69;this['badWordsEntity']=_0xa93022,this[_0x5860cb(0x1ba)]=_0x12ddea,this['userEntity']=_0x481102,this[_0x5860cb(0x19d)]=_0x52d46b,this['badWords']=[];}async[_0x48eb69(0x1b5)](){const _0x361334=_0x48eb69;this[_0x361334(0x19f)]();}async[_0x48eb69(0x175)](_0x3a2bc9,_0x837ed9){const _0xafd22b=_0x48eb69,_0x2ed22e=[];for(let _0x17cf59=0x0;_0x17cf59<this[_0xafd22b(0x1d7)][_0xafd22b(0x180)];_0x17cf59++){const _0x2e0930=this['badWords'][_0x17cf59];_0x3a2bc9[_0xafd22b(0x199)](_0x2e0930)&&_0x2ed22e[_0xafd22b(0x184)](_0x2e0930);}if(_0x2ed22e[_0xafd22b(0x180)]){await this[_0xafd22b(0x19c)](_0x837ed9,_0x3a2bc9,_0x2ed22e,['自定义'],'自定义检测');const _0x2ffeca='您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！';throw new common_1['HttpException'](_0x2ffeca,common_1[_0xafd22b(0x18b)][_0xafd22b(0x1a4)]);}}async[_0x48eb69(0x1ae)](_0x5c8ccb,_0x23e180){const _0x448a74=_0x48eb69,_0x5c42d5=await this['globalConfigService']['getSensitiveConfig']();_0x5c42d5&&await this[_0x448a74(0x17e)](_0x5c8ccb,_0x5c42d5,_0x23e180),await this[_0x448a74(0x175)](_0x5c8ccb,_0x23e180);}async[_0x48eb69(0x17e)](_0x225992,_0x3dc010,_0x22191e){const _0x559a1d=_0x48eb69,{useType:_0x1761a9}=_0x3dc010;_0x1761a9===_0x559a1d(0x1c9)&&await this[_0x559a1d(0x1ac)](_0x225992,_0x3dc010[_0x559a1d(0x1ab)],_0x22191e),_0x1761a9===_0x559a1d(0x1b0)&&await this[_0x559a1d(0x1bb)](_0x225992,_0x3dc010,_0x22191e);}[_0x48eb69(0x18e)](_0x1f71ea){const _0x390008=_0x48eb69,_0x52a96f=/存在(.*?)不合规/,_0x1d5241=_0x1f71ea[_0x390008(0x198)](_0x52a96f);return _0x1d5241?_0x1d5241[0x1]:'';}async['baiduCheckBadWords'](_0x17e316,_0x4b20ee,_0x48a009){const _0x5240ab=_0x48eb69;if(!_0x4b20ee)return;const _0x4874cb='https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token='+_0x4b20ee+'}',_0x509ef3={'Content-Type':_0x5240ab(0x194),'Accept':'application/json'},_0x11615d=await axios_1['default'][_0x5240ab(0x19b)](_0x4874cb,{'text':_0x17e316},{'headers':_0x509ef3}),{conclusion:_0xaa7e62,error_code:_0xf756b8,error_msg:_0x44853d,conclusionType:_0x553efc,data:_0xeac68a}=_0x11615d[_0x5240ab(0x17d)];_0xf756b8&&console[_0x5240ab(0x1cf)](_0x5240ab(0x1c5),_0x44853d);if(_0x553efc!==0x1){const _0x4e8b1c=[...new Set(_0xeac68a[_0x5240ab(0x1c4)](_0xae94=>this['extractContent'](_0xae94[_0x5240ab(0x193)])))];await this[_0x5240ab(0x19c)](_0x48a009,_0x17e316,[_0x5240ab(0x1a0)],_0x4e8b1c,_0x5240ab(0x1a5));const _0x230bdc=_0x5240ab(0x1be)+_0x4e8b1c[_0x5240ab(0x1a2)](',')+_0x5240ab(0x169);throw new common_1[(_0x5240ab(0x1a3))](_0x230bdc,common_1[_0x5240ab(0x18b)][_0x5240ab(0x1a4)]);}}async[_0x48eb69(0x1bb)](_0x3d51c8,_0x1eda10,_0x4417d4){const _0x219172=_0x48eb69;var _0x232aa5;const {nineaiBuiltInSensitiveApiBase:_0x4169d7,nineaiBuiltInSensitiveAuthKey:_0x3c7809}=_0x1eda10;if(!_0x4169d7||!_0x3c7809)return;const _0x2f14df=await axios_1[_0x219172(0x168)][_0x219172(0x19b)](_0x4169d7,{'content':_0x3d51c8},{'headers':{'Content-Type':_0x219172(0x16b),'Authorization':_0x3c7809}});if(!_0x2f14df[_0x219172(0x17d)])return;if(_0x2f14df[_0x219172(0x17d)]['code']!=='0'){const {msg:msg='检测失败'}=_0x2f14df['data'];throw new common_1[(_0x219172(0x1a3))]('敏感词检测\x20|\x20'+msg,common_1['HttpStatus']['BAD_REQUEST']);}if(_0x2f14df[_0x219172(0x17d)]['word_list']&&((_0x232aa5=_0x2f14df[_0x219172(0x17d)][_0x219172(0x1d2)])===null||_0x232aa5===void 0x0?void 0x0:_0x232aa5[_0x219172(0x180)])){const _0x4f2663=[...new Set(_0x2f14df['data']['word_list'][_0x219172(0x1c4)](_0x2f5ed8=>_0x2f5ed8[_0x219172(0x192)]))],_0x14229d=[...new Set(_0x2f14df['data'][_0x219172(0x1d2)][_0x219172(0x1c4)](_0x551f21=>_0x551f21[_0x219172(0x189)]))];await this[_0x219172(0x19c)](_0x4417d4,_0x3d51c8,_0x4f2663,_0x14229d,'NineAi检测');const _0x5144db=this[_0x219172(0x16a)](_0x2f14df[_0x219172(0x17d)][_0x219172(0x1d2)]);throw new common_1[(_0x219172(0x1a3))](_0x5144db,common_1[_0x219172(0x18b)][_0x219172(0x1a4)]);}}[_0x48eb69(0x16a)](_0x48f56b){const _0x365561=_0x48eb69,_0x37cc7c=_0x48f56b[_0x365561(0x1c4)](_0x5cd2c9=>_0x5cd2c9[_0x365561(0x189)]),_0x17ecb7=[...new Set(_0x37cc7c)];return _0x365561(0x1b2)+_0x17ecb7[_0x365561(0x1a2)](',')+_0x365561(0x1c6);}async[_0x48eb69(0x19f)](){const _0x535e6b=_0x48eb69,_0x448151=await this[_0x535e6b(0x1d1)][_0x535e6b(0x18f)]({'where':{'status':0x1},'select':[_0x535e6b(0x172)]});this['badWords']=_0x448151[_0x535e6b(0x1c4)](_0x56dfe4=>_0x56dfe4[_0x535e6b(0x172)]);}async[_0x48eb69(0x195)](_0x31a20a){const _0x22ee71=_0x48eb69,{page:page=0x1,size:size=0x1f4,word:_0x2a4018,status:_0x1eeea6}=_0x31a20a,_0xccdf83={};[0x0,0x1,'0','1'][_0x22ee71(0x199)](_0x1eeea6)&&(_0xccdf83[_0x22ee71(0x182)]=_0x1eeea6),_0x2a4018&&(_0xccdf83[_0x22ee71(0x172)]=(0x0,typeorm_1[_0x22ee71(0x1ad)])('%'+_0x2a4018+'%'));const [_0x5c8062,_0x35eb9c]=await this[_0x22ee71(0x1d1)][_0x22ee71(0x1b6)]({'where':_0xccdf83,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x22ee71(0x185)}});return{'rows':_0x5c8062,'count':_0x35eb9c};}async[_0x48eb69(0x178)](_0x545193){const _0x82f943=_0x48eb69,_0x176cee=await this[_0x82f943(0x1d1)][_0x82f943(0x179)]({'where':{'id':_0x545193['id']}});if(!_0x176cee)throw new common_1[(_0x82f943(0x1a3))](_0x82f943(0x1d4),common_1['HttpStatus'][_0x82f943(0x1a4)]);const _0x5b18a7=await this[_0x82f943(0x1d1)][_0x82f943(0x1c7)]({'id':_0x545193['id']});if(_0x5b18a7[_0x82f943(0x1c3)]>0x0)return await this['loadBadWords'](),_0x82f943(0x18a);else throw new common_1[(_0x82f943(0x1a3))]('删除敏感词失败',common_1[_0x82f943(0x18b)][_0x82f943(0x1a4)]);}async[_0x48eb69(0x183)](_0x551561){const _0x5f0d24=_0x48eb69,{id:_0x5b1bb0,word:_0x32e308,status:_0x17fdf7}=_0x551561,_0x32c3f4=await this[_0x5f0d24(0x1d1)][_0x5f0d24(0x179)]({'where':{'word':_0x32e308}});if(_0x32c3f4)throw new common_1[(_0x5f0d24(0x1a3))](_0x5f0d24(0x1b9),common_1[_0x5f0d24(0x18b)][_0x5f0d24(0x1a4)]);const _0x2ce3c3=await this[_0x5f0d24(0x1d1)][_0x5f0d24(0x17f)]({'id':_0x5b1bb0},{'word':_0x32e308,'status':_0x17fdf7});if(_0x2ce3c3[_0x5f0d24(0x1c3)]>0x0)return await this[_0x5f0d24(0x19f)](),_0x5f0d24(0x18c);else throw new common_1[(_0x5f0d24(0x1a3))]('更新敏感词失败',common_1[_0x5f0d24(0x18b)][_0x5f0d24(0x1a4)]);}async[_0x48eb69(0x1bf)](_0x3d36ca){const _0x1210e5=_0x48eb69,{word:_0x5eaddd}=_0x3d36ca,_0x289239=await this[_0x1210e5(0x1d1)][_0x1210e5(0x179)]({'where':{'word':_0x5eaddd}});if(_0x289239)throw new common_1[(_0x1210e5(0x1a3))](_0x1210e5(0x1d6),common_1['HttpStatus'][_0x1210e5(0x1a4)]);return await this[_0x1210e5(0x1d1)][_0x1210e5(0x1aa)]({'word':_0x5eaddd}),await this[_0x1210e5(0x19f)](),'添加敏感词成功';}async['recordUserBadWords'](_0x1d7368,_0x32283f,_0x3e3735,_0x1f922d,_0x199667){const _0x587f55=_0x48eb69,_0x5b51f9={'userId':_0x1d7368,'content':_0x32283f,'words':JSON[_0x587f55(0x191)](_0x3e3735),'typeCn':JSON[_0x587f55(0x191)](_0x1f922d),'typeOriginCn':_0x199667};try{await this[_0x587f55(0x1c0)][_0x587f55(0x1c2)]()['update'](user_entity_1[_0x587f55(0x1cb)])['set']({'violationCount':()=>_0x587f55(0x1a8)})['where'](_0x587f55(0x174),{'userId':_0x1d7368})['execute'](),await this[_0x587f55(0x1ba)]['save'](_0x5b51f9);}catch(_0x4764b9){console[_0x587f55(0x1cf)](_0x587f55(0x1b7),_0x4764b9);}}async[_0x48eb69(0x1c8)](_0x3ba75b,_0x2883b8){const _0x41bf70=_0x48eb69,{role:_0x188284}=_0x3ba75b[_0x41bf70(0x17b)],{page:page=0x1,size:size=0xa,userId:_0x5da68c,typeOriginCn:_0x38817c}=_0x2883b8,_0xdc2e30={};_0x5da68c&&(_0xdc2e30[_0x41bf70(0x1b3)]=_0x5da68c),_0x38817c&&(_0xdc2e30[_0x41bf70(0x1bc)]=_0x38817c);const [_0x1df6df,_0x425dba]=await this['violationLogEntity'][_0x41bf70(0x1b6)]({'where':_0xdc2e30,'skip':(page-0x1)*size,'take':size,'order':{'id':'DESC'}}),_0x1cc74f=[...new Set(_0x1df6df['map'](_0x5967ae=>_0x5967ae[_0x41bf70(0x1b3)]))],_0x4850b7=await this['userEntity'][_0x41bf70(0x18f)]({'where':{'id':(0x0,typeorm_1['In'])(_0x1cc74f)},'select':['id','avatar',_0x41bf70(0x176),'email',_0x41bf70(0x171),'status']});return _0x1df6df['forEach'](_0x23317f=>{const _0x30ac18=_0x41bf70,_0x59c8cd=_0x4850b7[_0x30ac18(0x18f)](_0x5203d8=>_0x5203d8['id']===_0x23317f[_0x30ac18(0x1b3)]);_0x188284!==_0x30ac18(0x19e)&&(_0x59c8cd['email']=(0x0,utils_1[_0x30ac18(0x1b8)])(_0x59c8cd[_0x30ac18(0x186)])),_0x23317f[_0x30ac18(0x18d)]=_0x59c8cd;}),{'rows':_0x1df6df,'count':_0x425dba};}};BadwordsService=__decorate([(0x0,common_1[_0x48eb69(0x1b4)])(),__param(0x0,(0x0,typeorm_2['InjectRepository'])(badwords_entity_1['BadWordsEntity'])),__param(0x1,(0x0,typeorm_2['InjectRepository'])(violationLog_entity_1[_0x48eb69(0x187)])),__param(0x2,(0x0,typeorm_2[_0x48eb69(0x1a1)])(user_entity_1[_0x48eb69(0x1cb)])),__metadata(_0x48eb69(0x16c),[typeorm_1[_0x48eb69(0x1a9)],typeorm_1[_0x48eb69(0x1a9)],typeorm_1[_0x48eb69(0x1a9)],globalConfig_service_1[_0x48eb69(0x1ce)]])],BadwordsService),exports[_0x48eb69(0x16e)]=BadwordsService;