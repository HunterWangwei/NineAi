'use strict';const _0xbb7e8a=_0xdb46;(function(_0x16dd89,_0x45fcd8){const _0xb43fe=_0xdb46,_0x3218a0=_0x16dd89();while(!![]){try{const _0x185f81=-parseInt(_0xb43fe(0xaa))/0x1+parseInt(_0xb43fe(0xe5))/0x2+-parseInt(_0xb43fe(0x9a))/0x3*(-parseInt(_0xb43fe(0x85))/0x4)+parseInt(_0xb43fe(0xbd))/0x5+-parseInt(_0xb43fe(0x7b))/0x6*(-parseInt(_0xb43fe(0x81))/0x7)+-parseInt(_0xb43fe(0xcc))/0x8*(-parseInt(_0xb43fe(0xc7))/0x9)+-parseInt(_0xb43fe(0x97))/0xa;if(_0x185f81===_0x45fcd8)break;else _0x3218a0['push'](_0x3218a0['shift']());}catch(_0x14b470){_0x3218a0['push'](_0x3218a0['shift']());}}}(_0x4d54,0xc799a));function _0x4d54(){const _0x41dc8c=['../../common/utils','的信息、我们已对您账号进行标记、请合规使用！','141244ciMinM','敏感词检测\x20|\x20','find','set','userEntity','where','userInfo','word_list','__decorate','badWords','defineProperty','function','axios','log','forEach','join','findAndCount','user','38698520GSSbix','loadBadWords','BadWordsEntity','123YECcYn','@nestjs/typeorm','敏感词已存在,请检查您的提交信息','super','delBadWords','post','delete','includes','length','recordUserBadWords','msg','自定义检测','stringify','globalConfigService','violationLogEntity','Repository','883020FZbuaO','您提交的信息中包含','id\x20=\x20:userId','GlobalConfigService','__param','./../globalConfig/globalConfig.service','UserEntity','InjectRepository','BAD_REQUEST','push','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=','getOwnPropertyDescriptor','checkBadWords','username','findOne','__esModule','decorate','queryBadWords','map','5477465uVnECn','Injectable','save','HttpStatus','__metadata','typeOriginCn','formarTips','HttpException','DESC','Like','601569uRlUHl','ViolationLogEntity','affected','ASC','删除敏感词失败','136DFCJue','category','extractContent','status','violationCount','百度文本检测出现错误、请查看配置信息:\x20','您提交的内容中包含','typeorm','./violationLog.entity','敏感词已经存在了、请勿重复添加','application/x-www-form-urlencoded','customSensitiveWords','敏感词不存在,请检查您的提交信息','添加敏感词成功','BadwordsService','data','userId','删除敏感词成功','metadata','keyword','的内容、我们已对您的账户进行标记、请合规使用！','badWordsEntity','avatar','default','baiduTextAccessToken','1124680XLAHHl','nineai','createQueryBuilder','./badwords.entity','word','nineaiCheckBadWords','checkBadWordsByConfig','baiduCheckBadWords','error:\x20','54itYmnU','email','@nestjs/common','application/json','更新敏感词失败','violationCount\x20+\x201','1033319PmibFp','object'];_0x4d54=function(){return _0x41dc8c;};return _0x4d54();}function _0xdb46(_0x2f6e89,_0x41b486){const _0x4d5490=_0x4d54();return _0xdb46=function(_0xdb4604,_0x385f37){_0xdb4604=_0xdb4604-0x79;let _0x2f704d=_0x4d5490[_0xdb4604];return _0x2f704d;},_0xdb46(_0x2f6e89,_0x41b486);}var __decorate=this&&this[_0xbb7e8a(0x8d)]||function(_0x53f42c,_0x1b8a16,_0x3cf516,_0x293591){const _0x3775df=_0xbb7e8a;var _0x1db62c=arguments[_0x3775df(0xa2)],_0x49f23c=_0x1db62c<0x3?_0x1b8a16:_0x293591===null?_0x293591=Object[_0x3775df(0xb5)](_0x1b8a16,_0x3cf516):_0x293591,_0x31d716;if(typeof Reflect==='object'&&typeof Reflect[_0x3775df(0xba)]===_0x3775df(0x90))_0x49f23c=Reflect[_0x3775df(0xba)](_0x53f42c,_0x1b8a16,_0x3cf516,_0x293591);else{for(var _0x1ab3a7=_0x53f42c[_0x3775df(0xa2)]-0x1;_0x1ab3a7>=0x0;_0x1ab3a7--)if(_0x31d716=_0x53f42c[_0x1ab3a7])_0x49f23c=(_0x1db62c<0x3?_0x31d716(_0x49f23c):_0x1db62c>0x3?_0x31d716(_0x1b8a16,_0x3cf516,_0x49f23c):_0x31d716(_0x1b8a16,_0x3cf516))||_0x49f23c;}return _0x1db62c>0x3&&_0x49f23c&&Object['defineProperty'](_0x1b8a16,_0x3cf516,_0x49f23c),_0x49f23c;},__metadata=this&&this[_0xbb7e8a(0xc1)]||function(_0x1003ec,_0x3df590){const _0x5307b6=_0xbb7e8a;if(typeof Reflect===_0x5307b6(0x82)&&typeof Reflect[_0x5307b6(0xde)]===_0x5307b6(0x90))return Reflect[_0x5307b6(0xde)](_0x1003ec,_0x3df590);},__param=this&&this[_0xbb7e8a(0xae)]||function(_0x470a02,_0x167767){return function(_0x436932,_0x118554){_0x167767(_0x436932,_0x118554,_0x470a02);};};Object[_0xbb7e8a(0x8f)](exports,_0xbb7e8a(0xb9),{'value':!![]}),exports['BadwordsService']=void 0x0;const globalConfig_service_1=require(_0xbb7e8a(0xaf)),common_1=require(_0xbb7e8a(0x7d)),badwords_entity_1=require(_0xbb7e8a(0xe8)),typeorm_1=require(_0xbb7e8a(0xd3)),typeorm_2=require(_0xbb7e8a(0x9b)),axios_1=require(_0xbb7e8a(0x91)),violationLog_entity_1=require(_0xbb7e8a(0xd4)),user_entity_1=require('../user/user.entity'),utils_1=require(_0xbb7e8a(0x83));let BadwordsService=class BadwordsService{constructor(_0x2d4774,_0x35cc73,_0x412254,_0x4493cd){const _0x293f04=_0xbb7e8a;this['badWordsEntity']=_0x2d4774,this[_0x293f04(0xa8)]=_0x35cc73,this[_0x293f04(0x89)]=_0x412254,this[_0x293f04(0xa7)]=_0x4493cd,this[_0x293f04(0x8e)]=[];}async['onModuleInit'](){const _0x2e56ec=_0xbb7e8a;this[_0x2e56ec(0x98)]();}async['customSensitiveWords'](_0x28748f,_0xd0dd95){const _0x17db1c=_0xbb7e8a,_0x4fa23a=[];for(let _0x4c260d=0x0;_0x4c260d<this[_0x17db1c(0x8e)]['length'];_0x4c260d++){const _0x5054c5=this[_0x17db1c(0x8e)][_0x4c260d];_0x28748f[_0x17db1c(0xa1)](_0x5054c5)&&_0x4fa23a[_0x17db1c(0xb3)](_0x5054c5);}if(_0x4fa23a[_0x17db1c(0xa2)]){await this[_0x17db1c(0xa3)](_0xd0dd95,_0x28748f,_0x4fa23a,['自定义'],_0x17db1c(0xa5));const _0x108213='您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！';throw new common_1[(_0x17db1c(0xc4))](_0x108213,common_1[_0x17db1c(0xc0)][_0x17db1c(0xb2)]);}}async[_0xbb7e8a(0xb6)](_0x1bf237,_0x4a1b13){const _0x562bad=_0xbb7e8a,_0x230e0a=await this[_0x562bad(0xa7)]['getSensitiveConfig']();_0x230e0a&&await this[_0x562bad(0xeb)](_0x1bf237,_0x230e0a,_0x4a1b13),await this[_0x562bad(0xd7)](_0x1bf237,_0x4a1b13);}async[_0xbb7e8a(0xeb)](_0x220b4b,_0x1c0b99,_0x105413){const _0x340884=_0xbb7e8a,{useType:_0x449983}=_0x1c0b99;_0x449983==='baidu'&&await this[_0x340884(0x79)](_0x220b4b,_0x1c0b99[_0x340884(0xe4)],_0x105413),_0x449983===_0x340884(0xe6)&&await this[_0x340884(0xea)](_0x220b4b,_0x1c0b99,_0x105413);}[_0xbb7e8a(0xce)](_0x4aa61a){const _0xe73348=/存在(.*?)不合规/,_0x179a81=_0x4aa61a['match'](_0xe73348);return _0x179a81?_0x179a81[0x1]:'';}async['baiduCheckBadWords'](_0x3253af,_0x4ee8b0,_0x441825){const _0xf8633c=_0xbb7e8a;if(!_0x4ee8b0)return;const _0xde1465=_0xf8633c(0xb4)+_0x4ee8b0+'}',_0x980260={'Content-Type':_0xf8633c(0xd6),'Accept':_0xf8633c(0x7e)},_0x4cc414=await axios_1['default'][_0xf8633c(0x9f)](_0xde1465,{'text':_0x3253af},{'headers':_0x980260}),{conclusion:_0x535a7e,error_code:_0x1f424d,error_msg:_0x2a6e03,conclusionType:_0x326c2b,data:_0x3e8005}=_0x4cc414[_0xf8633c(0xdb)];_0x1f424d&&console[_0xf8633c(0x92)](_0xf8633c(0xd1),_0x2a6e03);if(_0x326c2b!==0x1){const _0xadaf8a=[...new Set(_0x3e8005[_0xf8633c(0xbc)](_0x2175f5=>this[_0xf8633c(0xce)](_0x2175f5[_0xf8633c(0xa4)])))];await this[_0xf8633c(0xa3)](_0x441825,_0x3253af,['***'],_0xadaf8a,'百度云检测');const _0x5441dc=_0xf8633c(0xab)+_0xadaf8a[_0xf8633c(0x94)](',')+_0xf8633c(0xe0);throw new common_1[(_0xf8633c(0xc4))](_0x5441dc,common_1[_0xf8633c(0xc0)][_0xf8633c(0xb2)]);}}async['nineaiCheckBadWords'](_0x885b6e,_0xf925a7,_0x3d616e){const _0x3b89ac=_0xbb7e8a;var _0x2afac0;const {nineaiBuiltInSensitiveApiBase:_0x1034bd,nineaiBuiltInSensitiveAuthKey:_0x4a3668}=_0xf925a7;if(!_0x1034bd||!_0x4a3668)return;const _0x13ff12=await axios_1[_0x3b89ac(0xe3)][_0x3b89ac(0x9f)](_0x1034bd,{'content':_0x885b6e},{'headers':{'Content-Type':_0x3b89ac(0x7e),'Authorization':_0x4a3668}});if(!_0x13ff12[_0x3b89ac(0xdb)])return;if(_0x13ff12[_0x3b89ac(0xdb)]['code']!=='0'){const {msg:msg='检测失败'}=_0x13ff12[_0x3b89ac(0xdb)];throw new common_1[(_0x3b89ac(0xc4))](_0x3b89ac(0x86)+msg,common_1['HttpStatus'][_0x3b89ac(0xb2)]);}if(_0x13ff12['data'][_0x3b89ac(0x8c)]&&((_0x2afac0=_0x13ff12[_0x3b89ac(0xdb)][_0x3b89ac(0x8c)])===null||_0x2afac0===void 0x0?void 0x0:_0x2afac0['length'])){const _0x4c6875=[...new Set(_0x13ff12[_0x3b89ac(0xdb)]['word_list']['map'](_0x26ed4e=>_0x26ed4e[_0x3b89ac(0xdf)]))],_0x45407c=[...new Set(_0x13ff12[_0x3b89ac(0xdb)][_0x3b89ac(0x8c)][_0x3b89ac(0xbc)](_0x2493b8=>_0x2493b8[_0x3b89ac(0xcd)]))];await this[_0x3b89ac(0xa3)](_0x3d616e,_0x885b6e,_0x4c6875,_0x45407c,'NineAi检测');const _0x21d08d=this[_0x3b89ac(0xc3)](_0x13ff12['data']['word_list']);throw new common_1['HttpException'](_0x21d08d,common_1[_0x3b89ac(0xc0)][_0x3b89ac(0xb2)]);}}[_0xbb7e8a(0xc3)](_0x1bd7f8){const _0x39c4d6=_0xbb7e8a,_0x4caaac=_0x1bd7f8[_0x39c4d6(0xbc)](_0x1b2e58=>_0x1b2e58[_0x39c4d6(0xcd)]),_0x54d493=[...new Set(_0x4caaac)];return _0x39c4d6(0xd2)+_0x54d493['join'](',')+_0x39c4d6(0x84);}async[_0xbb7e8a(0x98)](){const _0x31bea5=_0xbb7e8a,_0x453e6e=await this[_0x31bea5(0xe1)]['find']({'where':{'status':0x1},'select':[_0x31bea5(0xe9)]});this[_0x31bea5(0x8e)]=_0x453e6e['map'](_0x14117e=>_0x14117e[_0x31bea5(0xe9)]);}async[_0xbb7e8a(0xbb)](_0x4cdfad){const _0x3b84f6=_0xbb7e8a,{page:page=0x1,size:size=0x1f4,word:_0x3cbf0d,status:_0x3a3463}=_0x4cdfad,_0x541921={};[0x0,0x1,'0','1'][_0x3b84f6(0xa1)](_0x3a3463)&&(_0x541921[_0x3b84f6(0xcf)]=_0x3a3463),_0x3cbf0d&&(_0x541921[_0x3b84f6(0xe9)]=(0x0,typeorm_1[_0x3b84f6(0xc6)])('%'+_0x3cbf0d+'%'));const [_0x3762de,_0x27bf82]=await this['badWordsEntity']['findAndCount']({'where':_0x541921,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x3b84f6(0xca)}});return{'rows':_0x3762de,'count':_0x27bf82};}async[_0xbb7e8a(0x9e)](_0x42040a){const _0x5bd930=_0xbb7e8a,_0x45c83f=await this['badWordsEntity'][_0x5bd930(0xb8)]({'where':{'id':_0x42040a['id']}});if(!_0x45c83f)throw new common_1[(_0x5bd930(0xc4))](_0x5bd930(0xd8),common_1['HttpStatus'][_0x5bd930(0xb2)]);const _0x1f438e=await this['badWordsEntity'][_0x5bd930(0xa0)]({'id':_0x42040a['id']});if(_0x1f438e[_0x5bd930(0xc9)]>0x0)return await this[_0x5bd930(0x98)](),_0x5bd930(0xdd);else throw new common_1['HttpException'](_0x5bd930(0xcb),common_1[_0x5bd930(0xc0)][_0x5bd930(0xb2)]);}async['updateBadWords'](_0x4d472e){const _0x3fc7f3=_0xbb7e8a,{id:_0x2c50a4,word:_0x2a85ba,status:_0x3527c0}=_0x4d472e,_0x3cebf1=await this['badWordsEntity'][_0x3fc7f3(0xb8)]({'where':{'word':_0x2a85ba}});if(_0x3cebf1)throw new common_1[(_0x3fc7f3(0xc4))](_0x3fc7f3(0xd5),common_1[_0x3fc7f3(0xc0)][_0x3fc7f3(0xb2)]);const _0x738522=await this[_0x3fc7f3(0xe1)]['update']({'id':_0x2c50a4},{'word':_0x2a85ba,'status':_0x3527c0});if(_0x738522[_0x3fc7f3(0xc9)]>0x0)return await this[_0x3fc7f3(0x98)](),'更新敏感词成功';else throw new common_1['HttpException'](_0x3fc7f3(0x7f),common_1['HttpStatus'][_0x3fc7f3(0xb2)]);}async['addBadWord'](_0x40205f){const _0x328f23=_0xbb7e8a,{word:_0x55f17a}=_0x40205f,_0x5de544=await this[_0x328f23(0xe1)]['findOne']({'where':{'word':_0x55f17a}});if(_0x5de544)throw new common_1['HttpException'](_0x328f23(0x9c),common_1[_0x328f23(0xc0)][_0x328f23(0xb2)]);return await this[_0x328f23(0xe1)][_0x328f23(0xbf)]({'word':_0x55f17a}),await this['loadBadWords'](),_0x328f23(0xd9);}async[_0xbb7e8a(0xa3)](_0x44ce72,_0x114cfb,_0x5d75a1,_0x5cb598,_0x1b2490){const _0x4ae15c=_0xbb7e8a,_0x405b19={'userId':_0x44ce72,'content':_0x114cfb,'words':JSON[_0x4ae15c(0xa6)](_0x5d75a1),'typeCn':JSON[_0x4ae15c(0xa6)](_0x5cb598),'typeOriginCn':_0x1b2490};try{await this[_0x4ae15c(0x89)][_0x4ae15c(0xe7)]()['update'](user_entity_1[_0x4ae15c(0xb0)])[_0x4ae15c(0x88)]({'violationCount':()=>_0x4ae15c(0x80)})[_0x4ae15c(0x8a)](_0x4ae15c(0xac),{'userId':_0x44ce72})['execute'](),await this[_0x4ae15c(0xa8)][_0x4ae15c(0xbf)](_0x405b19);}catch(_0x364f74){console[_0x4ae15c(0x92)](_0x4ae15c(0x7a),_0x364f74);}}async['violation'](_0x1abcde,_0x4b99c7){const _0x5cbd1a=_0xbb7e8a,{role:_0xbc2716}=_0x1abcde[_0x5cbd1a(0x96)],{page:page=0x1,size:size=0xa,userId:_0x705f95,typeOriginCn:_0x51784d}=_0x4b99c7,_0x3bcb7d={};_0x705f95&&(_0x3bcb7d['userId']=_0x705f95),_0x51784d&&(_0x3bcb7d[_0x5cbd1a(0xc2)]=_0x51784d);const [_0xdb51be,_0xfcc245]=await this[_0x5cbd1a(0xa8)][_0x5cbd1a(0x95)]({'where':_0x3bcb7d,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x5cbd1a(0xc5)}}),_0xd415d8=[...new Set(_0xdb51be[_0x5cbd1a(0xbc)](_0x2b2b20=>_0x2b2b20[_0x5cbd1a(0xdc)]))],_0x260d04=await this['userEntity']['find']({'where':{'id':(0x0,typeorm_1['In'])(_0xd415d8)},'select':['id',_0x5cbd1a(0xe2),_0x5cbd1a(0xb7),_0x5cbd1a(0x7c),_0x5cbd1a(0xd0),_0x5cbd1a(0xcf)]});return _0xdb51be[_0x5cbd1a(0x93)](_0xe1ad17=>{const _0x29476b=_0x5cbd1a,_0x34b182=_0x260d04[_0x29476b(0x87)](_0x3a18f1=>_0x3a18f1['id']===_0xe1ad17['userId']);_0xbc2716!==_0x29476b(0x9d)&&(_0x34b182[_0x29476b(0x7c)]=(0x0,utils_1['hideString'])(_0x34b182[_0x29476b(0x7c)])),_0xe1ad17[_0x29476b(0x8b)]=_0x34b182;}),{'rows':_0xdb51be,'count':_0xfcc245};}};BadwordsService=__decorate([(0x0,common_1[_0xbb7e8a(0xbe)])(),__param(0x0,(0x0,typeorm_2['InjectRepository'])(badwords_entity_1[_0xbb7e8a(0x99)])),__param(0x1,(0x0,typeorm_2[_0xbb7e8a(0xb1)])(violationLog_entity_1[_0xbb7e8a(0xc8)])),__param(0x2,(0x0,typeorm_2[_0xbb7e8a(0xb1)])(user_entity_1[_0xbb7e8a(0xb0)])),__metadata('design:paramtypes',[typeorm_1[_0xbb7e8a(0xa9)],typeorm_1[_0xbb7e8a(0xa9)],typeorm_1[_0xbb7e8a(0xa9)],globalConfig_service_1[_0xbb7e8a(0xad)]])],BadwordsService),exports[_0xbb7e8a(0xda)]=BadwordsService;