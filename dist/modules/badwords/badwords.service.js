'use strict';const _0x38b809=_0x27a4;(function(_0x4c1c62,_0x1a2715){const _0x24361e=_0x27a4,_0x126882=_0x4c1c62();while(!![]){try{const _0x2d6c42=parseInt(_0x24361e(0x15b))/0x1*(parseInt(_0x24361e(0x164))/0x2)+-parseInt(_0x24361e(0x135))/0x3+parseInt(_0x24361e(0x173))/0x4+parseInt(_0x24361e(0x139))/0x5*(-parseInt(_0x24361e(0x14c))/0x6)+parseInt(_0x24361e(0x150))/0x7+parseInt(_0x24361e(0x122))/0x8*(-parseInt(_0x24361e(0x17c))/0x9)+parseInt(_0x24361e(0x17e))/0xa;if(_0x2d6c42===_0x1a2715)break;else _0x126882['push'](_0x126882['shift']());}catch(_0xfa34a3){_0x126882['push'](_0x126882['shift']());}}}(_0x1ec9,0x3dfb1));var __decorate=this&&this[_0x38b809(0x129)]||function(_0x2560fc,_0x333baf,_0x480fc5,_0x292e5c){const _0x286943=_0x38b809;var _0x273b91=arguments[_0x286943(0x158)],_0x2ca0f7=_0x273b91<0x3?_0x333baf:_0x292e5c===null?_0x292e5c=Object[_0x286943(0x11d)](_0x333baf,_0x480fc5):_0x292e5c,_0x1ee6f4;if(typeof Reflect===_0x286943(0x11a)&&typeof Reflect[_0x286943(0x16b)]==='function')_0x2ca0f7=Reflect[_0x286943(0x16b)](_0x2560fc,_0x333baf,_0x480fc5,_0x292e5c);else{for(var _0xd737ac=_0x2560fc['length']-0x1;_0xd737ac>=0x0;_0xd737ac--)if(_0x1ee6f4=_0x2560fc[_0xd737ac])_0x2ca0f7=(_0x273b91<0x3?_0x1ee6f4(_0x2ca0f7):_0x273b91>0x3?_0x1ee6f4(_0x333baf,_0x480fc5,_0x2ca0f7):_0x1ee6f4(_0x333baf,_0x480fc5))||_0x2ca0f7;}return _0x273b91>0x3&&_0x2ca0f7&&Object[_0x286943(0x15d)](_0x333baf,_0x480fc5,_0x2ca0f7),_0x2ca0f7;},__metadata=this&&this[_0x38b809(0x146)]||function(_0x43c3c2,_0x3c0caa){const _0x4793a1=_0x38b809;if(typeof Reflect===_0x4793a1(0x11a)&&typeof Reflect[_0x4793a1(0x114)]===_0x4793a1(0x153))return Reflect[_0x4793a1(0x114)](_0x43c3c2,_0x3c0caa);},__param=this&&this[_0x38b809(0x15a)]||function(_0x27c504,_0x179249){return function(_0x24254c,_0x31e857){_0x179249(_0x24254c,_0x31e857,_0x27c504);};};Object['defineProperty'](exports,_0x38b809(0x167),{'value':!![]}),exports[_0x38b809(0x14e)]=void 0x0;function _0x27a4(_0x3a7c95,_0x451dd2){const _0x1ec96c=_0x1ec9();return _0x27a4=function(_0x27a432,_0x492c48){_0x27a432=_0x27a432-0x110;let _0x52c8af=_0x1ec96c[_0x27a432];return _0x52c8af;},_0x27a4(_0x3a7c95,_0x451dd2);}const globalConfig_service_1=require(_0x38b809(0x137)),common_1=require('@nestjs/common'),badwords_entity_1=require(_0x38b809(0x134)),typeorm_1=require('typeorm'),typeorm_2=require(_0x38b809(0x172)),axios_1=require(_0x38b809(0x174)),violationLog_entity_1=require(_0x38b809(0x131)),user_entity_1=require(_0x38b809(0x16f)),utils_1=require(_0x38b809(0x120));function _0x1ec9(){const _0x2cccba=['__param','58313vfGHOX','badWords','defineProperty','push','application/x-www-form-urlencoded','userEntity','NineAi检测','您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！','map','16AKsdnU','您提交的内容中包含','customSensitiveWords','__esModule','BAD_REQUEST','更新敏感词失败','default','decorate','userId','code','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=','../user/user.entity','nineaiCheckBadWords','HttpException','@nestjs/typeorm','887288WlgmqJ','axios','recordUserBadWords','Repository','findOne','save','addBadWord','update','baiduCheckBadWords','3388293uoyGdt','badWordsEntity','390660vapcsJ','email','extractContent','includes','checkBadWordsByConfig','添加敏感词成功','word','metadata','baiduTextAccessToken','敏感词已经存在了、请勿重复添加','您提交的信息中包含','UserEntity','userInfo','object','stringify','id\x20=\x20:userId','getOwnPropertyDescriptor','***','delBadWords','../../common/utils','data','8ueafgr','super','where','百度云检测','queryBadWords','onModuleInit','BadWordsEntity','__decorate','自定义检测','set','Injectable','msg','findAndCount','更新敏感词成功','loadBadWords','./violationLog.entity','match','execute','./badwords.entity','364359UNYxba','violationCount','./../globalConfig/globalConfig.service','检测失败','116650pHguUb','敏感词已存在,请检查您的提交信息','GlobalConfigService','find','join','violationCount\x20+\x201','status','的内容、我们已对您的账户进行标记、请合规使用！','删除敏感词失败','敏感词不存在,请检查您的提交信息','formarTips','InjectRepository','post','__metadata','globalConfigService','百度文本检测出现错误、请查看配置信息:\x20','createQueryBuilder','删除敏感词成功','username','18ClOmFc','keyword','BadwordsService','getSensitiveConfig','660807Tjzjuo','violationLogEntity','affected','function','category','application/json','HttpStatus','word_list','length','log'];_0x1ec9=function(){return _0x2cccba;};return _0x1ec9();}let BadwordsService=class BadwordsService{constructor(_0x295567,_0x56d9ad,_0x116b3e,_0x5c89de){const _0x1cacf9=_0x38b809;this[_0x1cacf9(0x17d)]=_0x295567,this[_0x1cacf9(0x151)]=_0x56d9ad,this['userEntity']=_0x116b3e,this[_0x1cacf9(0x147)]=_0x5c89de,this[_0x1cacf9(0x15c)]=[];}async[_0x38b809(0x127)](){const _0x533885=_0x38b809;this[_0x533885(0x130)]();}async[_0x38b809(0x166)](_0x2a8fcf,_0xa0be2d){const _0x202813=_0x38b809,_0x5d8901=[];for(let _0x1c4d75=0x0;_0x1c4d75<this['badWords'][_0x202813(0x158)];_0x1c4d75++){const _0x469c5f=this[_0x202813(0x15c)][_0x1c4d75];_0x2a8fcf[_0x202813(0x110)](_0x469c5f)&&_0x5d8901[_0x202813(0x15e)](_0x469c5f);}if(_0x5d8901['length']){await this[_0x202813(0x175)](_0xa0be2d,_0x2a8fcf,_0x5d8901,['自定义'],_0x202813(0x12a));const _0x4c4e65=_0x202813(0x162);throw new common_1[(_0x202813(0x171))](_0x4c4e65,common_1['HttpStatus'][_0x202813(0x168)]);}}async['checkBadWords'](_0x12cc30,_0x55fb1e){const _0x2662a0=_0x38b809,_0x6dcf05=await this[_0x2662a0(0x147)][_0x2662a0(0x14f)]();_0x6dcf05&&await this[_0x2662a0(0x111)](_0x12cc30,_0x6dcf05,_0x55fb1e),await this[_0x2662a0(0x166)](_0x12cc30,_0x55fb1e);}async[_0x38b809(0x111)](_0x45ad6e,_0x2eb8e2,_0x3f368d){const _0x4308d8=_0x38b809,{useType:_0x300888}=_0x2eb8e2;_0x300888==='baidu'&&await this[_0x4308d8(0x17b)](_0x45ad6e,_0x2eb8e2[_0x4308d8(0x115)],_0x3f368d),_0x300888==='nineai'&&await this[_0x4308d8(0x170)](_0x45ad6e,_0x2eb8e2,_0x3f368d);}['extractContent'](_0x18e44d){const _0x180268=_0x38b809,_0x475090=/存在(.*?)不合规/,_0x42aaf6=_0x18e44d[_0x180268(0x132)](_0x475090);return _0x42aaf6?_0x42aaf6[0x1]:'';}async['baiduCheckBadWords'](_0x35f0fc,_0x340971,_0x3f513e){const _0x572a9=_0x38b809;if(!_0x340971)return;const _0x115fef=_0x572a9(0x16e)+_0x340971+'}',_0x4c1bd9={'Content-Type':_0x572a9(0x15f),'Accept':_0x572a9(0x155)},_0x3f081a=await axios_1[_0x572a9(0x16a)][_0x572a9(0x145)](_0x115fef,{'text':_0x35f0fc},{'headers':_0x4c1bd9}),{conclusion:_0x47e6cb,error_code:_0x469a05,error_msg:_0x1cf4c2,conclusionType:_0x383987,data:_0xd2ce30}=_0x3f081a[_0x572a9(0x121)];_0x469a05&&console[_0x572a9(0x159)](_0x572a9(0x148),_0x1cf4c2);if(_0x383987!==0x1){const _0x5e916b=[...new Set(_0xd2ce30['map'](_0x3e041d=>this[_0x572a9(0x180)](_0x3e041d[_0x572a9(0x12d)])))];await this[_0x572a9(0x175)](_0x3f513e,_0x35f0fc,[_0x572a9(0x11e)],_0x5e916b,_0x572a9(0x125));const _0x8f4121=_0x572a9(0x117)+_0x5e916b[_0x572a9(0x13d)](',')+_0x572a9(0x140);throw new common_1[(_0x572a9(0x171))](_0x8f4121,common_1[_0x572a9(0x156)][_0x572a9(0x168)]);}}async[_0x38b809(0x170)](_0x19e076,_0x417244,_0x5e903b){const _0x6401f0=_0x38b809;var _0x4de246;const {nineaiBuiltInSensitiveApiBase:_0x4e75d7,nineaiBuiltInSensitiveAuthKey:_0x15f16a}=_0x417244;if(!_0x4e75d7||!_0x15f16a)return;const _0x3b12aa=await axios_1[_0x6401f0(0x16a)]['post'](_0x4e75d7,{'content':_0x19e076},{'headers':{'Content-Type':_0x6401f0(0x155),'Authorization':_0x15f16a}});if(!_0x3b12aa['data'])return;if(_0x3b12aa[_0x6401f0(0x121)][_0x6401f0(0x16d)]!=='0'){const {msg:msg=_0x6401f0(0x138)}=_0x3b12aa[_0x6401f0(0x121)];throw new common_1[(_0x6401f0(0x171))]('敏感词检测\x20|\x20'+msg,common_1[_0x6401f0(0x156)][_0x6401f0(0x168)]);}if(_0x3b12aa[_0x6401f0(0x121)][_0x6401f0(0x157)]&&((_0x4de246=_0x3b12aa[_0x6401f0(0x121)][_0x6401f0(0x157)])===null||_0x4de246===void 0x0?void 0x0:_0x4de246['length'])){const _0x54a00e=[...new Set(_0x3b12aa[_0x6401f0(0x121)][_0x6401f0(0x157)][_0x6401f0(0x163)](_0x58e6b8=>_0x58e6b8[_0x6401f0(0x14d)]))],_0x1bde4a=[...new Set(_0x3b12aa[_0x6401f0(0x121)][_0x6401f0(0x157)][_0x6401f0(0x163)](_0x4e22e3=>_0x4e22e3[_0x6401f0(0x154)]))];await this['recordUserBadWords'](_0x5e903b,_0x19e076,_0x54a00e,_0x1bde4a,_0x6401f0(0x161));const _0x240d4a=this[_0x6401f0(0x143)](_0x3b12aa[_0x6401f0(0x121)][_0x6401f0(0x157)]);throw new common_1['HttpException'](_0x240d4a,common_1[_0x6401f0(0x156)]['BAD_REQUEST']);}}['formarTips'](_0x26aa16){const _0xaf5ca9=_0x38b809,_0x351584=_0x26aa16[_0xaf5ca9(0x163)](_0x3b7ebf=>_0x3b7ebf[_0xaf5ca9(0x154)]),_0x20a47a=[...new Set(_0x351584)];return _0xaf5ca9(0x165)+_0x20a47a['join'](',')+'的信息、我们已对您账号进行标记、请合规使用！';}async['loadBadWords'](){const _0x346879=_0x38b809,_0x365154=await this[_0x346879(0x17d)][_0x346879(0x13c)]({'where':{'status':0x1},'select':[_0x346879(0x113)]});this[_0x346879(0x15c)]=_0x365154['map'](_0x4a2515=>_0x4a2515[_0x346879(0x113)]);}async[_0x38b809(0x126)](_0x409ac9){const _0x1a6568=_0x38b809,{page:page=0x1,size:size=0x1f4,word:_0x3336f2,status:_0x273cce}=_0x409ac9,_0x496e00={};[0x0,0x1,'0','1'][_0x1a6568(0x110)](_0x273cce)&&(_0x496e00[_0x1a6568(0x13f)]=_0x273cce),_0x3336f2&&(_0x496e00[_0x1a6568(0x113)]=(0x0,typeorm_1['Like'])('%'+_0x3336f2+'%'));const [_0x40f7c1,_0x217319]=await this[_0x1a6568(0x17d)][_0x1a6568(0x12e)]({'where':_0x496e00,'skip':(page-0x1)*size,'take':size,'order':{'id':'ASC'}});return{'rows':_0x40f7c1,'count':_0x217319};}async[_0x38b809(0x11f)](_0x3c1b25){const _0x2663d3=_0x38b809,_0x2c4c12=await this[_0x2663d3(0x17d)][_0x2663d3(0x177)]({'where':{'id':_0x3c1b25['id']}});if(!_0x2c4c12)throw new common_1[(_0x2663d3(0x171))](_0x2663d3(0x142),common_1[_0x2663d3(0x156)][_0x2663d3(0x168)]);const _0x2d5dcd=await this['badWordsEntity']['delete']({'id':_0x3c1b25['id']});if(_0x2d5dcd[_0x2663d3(0x152)]>0x0)return await this[_0x2663d3(0x130)](),_0x2663d3(0x14a);else throw new common_1[(_0x2663d3(0x171))](_0x2663d3(0x141),common_1[_0x2663d3(0x156)][_0x2663d3(0x168)]);}async['updateBadWords'](_0x9ba161){const _0x1f4c2e=_0x38b809,{id:_0x3850b9,word:_0x1008f5,status:_0x56e817}=_0x9ba161,_0x231f69=await this['badWordsEntity'][_0x1f4c2e(0x177)]({'where':{'word':_0x1008f5}});if(_0x231f69)throw new common_1[(_0x1f4c2e(0x171))](_0x1f4c2e(0x116),common_1[_0x1f4c2e(0x156)][_0x1f4c2e(0x168)]);const _0x9e87a5=await this[_0x1f4c2e(0x17d)][_0x1f4c2e(0x17a)]({'id':_0x3850b9},{'word':_0x1008f5,'status':_0x56e817});if(_0x9e87a5['affected']>0x0)return await this[_0x1f4c2e(0x130)](),_0x1f4c2e(0x12f);else throw new common_1[(_0x1f4c2e(0x171))](_0x1f4c2e(0x169),common_1['HttpStatus']['BAD_REQUEST']);}async[_0x38b809(0x179)](_0x1faa8c){const _0x3a6c34=_0x38b809,{word:_0x179b8c}=_0x1faa8c,_0x2331d1=await this[_0x3a6c34(0x17d)][_0x3a6c34(0x177)]({'where':{'word':_0x179b8c}});if(_0x2331d1)throw new common_1[(_0x3a6c34(0x171))](_0x3a6c34(0x13a),common_1[_0x3a6c34(0x156)][_0x3a6c34(0x168)]);return await this['badWordsEntity']['save']({'word':_0x179b8c}),await this['loadBadWords'](),_0x3a6c34(0x112);}async[_0x38b809(0x175)](_0x411fe3,_0x3ed33d,_0x4fe454,_0x18e65f,_0x399083){const _0x2a9254=_0x38b809,_0x45f80f={'userId':_0x411fe3,'content':_0x3ed33d,'words':JSON[_0x2a9254(0x11b)](_0x4fe454),'typeCn':JSON[_0x2a9254(0x11b)](_0x18e65f),'typeOriginCn':_0x399083};try{await this[_0x2a9254(0x160)][_0x2a9254(0x149)]()[_0x2a9254(0x17a)](user_entity_1[_0x2a9254(0x118)])[_0x2a9254(0x12b)]({'violationCount':()=>_0x2a9254(0x13e)})[_0x2a9254(0x124)](_0x2a9254(0x11c),{'userId':_0x411fe3})[_0x2a9254(0x133)](),await this[_0x2a9254(0x151)][_0x2a9254(0x178)](_0x45f80f);}catch(_0x1c76b9){console['log']('error:\x20',_0x1c76b9);}}async['violation'](_0x2e73f4,_0x2cd25f){const _0x60fca1=_0x38b809,{role:_0x1e7b0c}=_0x2e73f4['user'],{page:page=0x1,size:size=0xa,userId:_0x3167e3,typeOriginCn:_0x2cb493}=_0x2cd25f,_0x3bbf67={};_0x3167e3&&(_0x3bbf67[_0x60fca1(0x16c)]=_0x3167e3),_0x2cb493&&(_0x3bbf67['typeOriginCn']=_0x2cb493);const [_0x144772,_0xababb1]=await this['violationLogEntity']['findAndCount']({'where':_0x3bbf67,'skip':(page-0x1)*size,'take':size,'order':{'id':'DESC'}}),_0x5c3cf7=[...new Set(_0x144772[_0x60fca1(0x163)](_0x499898=>_0x499898['userId']))],_0x4a1780=await this[_0x60fca1(0x160)][_0x60fca1(0x13c)]({'where':{'id':(0x0,typeorm_1['In'])(_0x5c3cf7)},'select':['id','avatar',_0x60fca1(0x14b),'email',_0x60fca1(0x136),'status']});return _0x144772['forEach'](_0x5b71fc=>{const _0x5edcec=_0x60fca1,_0x467abc=_0x4a1780['find'](_0x3365c8=>_0x3365c8['id']===_0x5b71fc['userId']);_0x1e7b0c!==_0x5edcec(0x123)&&(_0x467abc['email']=(0x0,utils_1['hideString'])(_0x467abc===null||_0x467abc===void 0x0?void 0x0:_0x467abc[_0x5edcec(0x17f)])),_0x5b71fc[_0x5edcec(0x119)]=_0x467abc;}),{'rows':_0x144772,'count':_0xababb1};}};BadwordsService=__decorate([(0x0,common_1[_0x38b809(0x12c)])(),__param(0x0,(0x0,typeorm_2[_0x38b809(0x144)])(badwords_entity_1[_0x38b809(0x128)])),__param(0x1,(0x0,typeorm_2[_0x38b809(0x144)])(violationLog_entity_1['ViolationLogEntity'])),__param(0x2,(0x0,typeorm_2[_0x38b809(0x144)])(user_entity_1[_0x38b809(0x118)])),__metadata('design:paramtypes',[typeorm_1[_0x38b809(0x176)],typeorm_1[_0x38b809(0x176)],typeorm_1[_0x38b809(0x176)],globalConfig_service_1[_0x38b809(0x13b)]])],BadwordsService),exports[_0x38b809(0x14e)]=BadwordsService;