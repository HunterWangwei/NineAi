'use strict';const _0x4cab84=_0x267e;(function(_0x4f71be,_0x1afbc5){const _0x45b15c=_0x267e,_0x3f2874=_0x4f71be();while(!![]){try{const _0x39c912=parseInt(_0x45b15c(0xd3))/0x1+parseInt(_0x45b15c(0x10a))/0x2+parseInt(_0x45b15c(0xf4))/0x3+-parseInt(_0x45b15c(0xf9))/0x4+-parseInt(_0x45b15c(0x12f))/0x5*(parseInt(_0x45b15c(0x124))/0x6)+-parseInt(_0x45b15c(0x12a))/0x7+parseInt(_0x45b15c(0x115))/0x8*(parseInt(_0x45b15c(0x128))/0x9);if(_0x39c912===_0x1afbc5)break;else _0x3f2874['push'](_0x3f2874['shift']());}catch(_0x530c0b){_0x3f2874['push'](_0x3f2874['shift']());}}}(_0x5e7d,0x42052));function _0x5e7d(){const _0x5b3953=['axios','DESC','join','InjectRepository','getSensitiveConfig','../../common/utils','百度文本检测出现错误、请查看配置信息:\x20','update','violation','baidu','msg','find','8940NSwVsB','userEntity','Repository','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=','549YoThJG','post','1662969JYKgei','./../globalConfig/globalConfig.service','badWordsEntity','customSensitiveWords','function','415gmEQsI','user','BadWordsEntity','addBadWord','globalConfigService','您提交的内容中包含','nineai','username','onModuleInit','NineAi检测','baiduTextAccessToken','default','userInfo','typeorm','application/x-www-form-urlencoded','添加敏感词成功','word_list','Injectable','ASC','HttpException','metadata','354849dSEaxW','object','formarTips','status','Like','loadBadWords','../user/user.entity','violationLogEntity','敏感词检测\x20|\x20','findOne','nineaiCheckBadWords','decorate','***','UserEntity','recordUserBadWords','keyword','log','@nestjs/common','更新敏感词失败','word','百度云检测','./badwords.entity','hideString','updateBadWords','violationCount','BAD_REQUEST','checkBadWordsByConfig','design:paramtypes','的信息、我们已对您账号进行标记、请合规使用！','where','email','map','avatar','861342LjuTNE','category','length','baiduCheckBadWords','stringify','1902372ZDuMhE','badWords','extractContent','删除敏感词成功','typeOriginCn','userId','id\x20=\x20:userId','defineProperty','您提交的信息中包含','自定义检测','您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！','findAndCount','data','push','HttpStatus','__metadata','affected','604464dVbllk','includes','execute','getOwnPropertyDescriptor','save','forEach','queryBadWords','set','__param','删除敏感词失败','code','21384oprFlg','ViolationLogEntity','敏感词不存在,请检查您的提交信息'];_0x5e7d=function(){return _0x5b3953;};return _0x5e7d();}var __decorate=this&&this['__decorate']||function(_0x2250d8,_0x1fd731,_0x40d2d6,_0x1aaa77){const _0x340638=_0x267e;var _0x2acbd6=arguments[_0x340638(0xf6)],_0x34293e=_0x2acbd6<0x3?_0x1fd731:_0x1aaa77===null?_0x1aaa77=Object[_0x340638(0x10d)](_0x1fd731,_0x40d2d6):_0x1aaa77,_0x3cd3af;if(typeof Reflect===_0x340638(0xd4)&&typeof Reflect[_0x340638(0xde)]===_0x340638(0x12e))_0x34293e=Reflect[_0x340638(0xde)](_0x2250d8,_0x1fd731,_0x40d2d6,_0x1aaa77);else{for(var _0x3847be=_0x2250d8[_0x340638(0xf6)]-0x1;_0x3847be>=0x0;_0x3847be--)if(_0x3cd3af=_0x2250d8[_0x3847be])_0x34293e=(_0x2acbd6<0x3?_0x3cd3af(_0x34293e):_0x2acbd6>0x3?_0x3cd3af(_0x1fd731,_0x40d2d6,_0x34293e):_0x3cd3af(_0x1fd731,_0x40d2d6))||_0x34293e;}return _0x2acbd6>0x3&&_0x34293e&&Object[_0x340638(0x100)](_0x1fd731,_0x40d2d6,_0x34293e),_0x34293e;},__metadata=this&&this[_0x4cab84(0x108)]||function(_0x3b1cb6,_0x2a646f){const _0x4c3481=_0x4cab84;if(typeof Reflect===_0x4c3481(0xd4)&&typeof Reflect[_0x4c3481(0xd2)]===_0x4c3481(0x12e))return Reflect[_0x4c3481(0xd2)](_0x3b1cb6,_0x2a646f);},__param=this&&this[_0x4cab84(0x112)]||function(_0x35d0dd,_0x3150c2){return function(_0x59e820,_0x396544){_0x3150c2(_0x59e820,_0x396544,_0x35d0dd);};};Object[_0x4cab84(0x100)](exports,'__esModule',{'value':!![]}),exports['BadwordsService']=void 0x0;const globalConfig_service_1=require(_0x4cab84(0x12b)),common_1=require(_0x4cab84(0xe4)),badwords_entity_1=require(_0x4cab84(0xe8)),typeorm_1=require(_0x4cab84(0xcb)),typeorm_2=require('@nestjs/typeorm'),axios_1=require(_0x4cab84(0x118)),violationLog_entity_1=require('./violationLog.entity'),user_entity_1=require(_0x4cab84(0xd9)),utils_1=require(_0x4cab84(0x11d));let BadwordsService=class BadwordsService{constructor(_0x461713,_0x10dba3,_0x15acab,_0x3b008a){const _0x2a3315=_0x4cab84;this[_0x2a3315(0x12c)]=_0x461713,this[_0x2a3315(0xda)]=_0x10dba3,this[_0x2a3315(0x125)]=_0x15acab,this[_0x2a3315(0x133)]=_0x3b008a,this[_0x2a3315(0xfa)]=[];}async[_0x4cab84(0x137)](){this['loadBadWords']();}async[_0x4cab84(0x12d)](_0x5aadb0,_0x1badb6){const _0x5924f4=_0x4cab84,_0xd1cc23=[];for(let _0x163009=0x0;_0x163009<this[_0x5924f4(0xfa)][_0x5924f4(0xf6)];_0x163009++){const _0x36f6c2=this[_0x5924f4(0xfa)][_0x163009];_0x5aadb0['includes'](_0x36f6c2)&&_0xd1cc23[_0x5924f4(0x106)](_0x36f6c2);}if(_0xd1cc23['length']){await this['recordUserBadWords'](_0x1badb6,_0x5aadb0,_0xd1cc23,['自定义'],_0x5924f4(0x102));const _0x117962=_0x5924f4(0x103);throw new common_1['HttpException'](_0x117962,common_1[_0x5924f4(0x107)][_0x5924f4(0xec)]);}}async['checkBadWords'](_0x17e9e4,_0x2e09a1){const _0x1982bb=_0x4cab84,_0x61617c=await this[_0x1982bb(0x133)][_0x1982bb(0x11c)]();_0x61617c&&await this[_0x1982bb(0xed)](_0x17e9e4,_0x61617c,_0x2e09a1),await this[_0x1982bb(0x12d)](_0x17e9e4,_0x2e09a1);}async[_0x4cab84(0xed)](_0x5f3186,_0xf5e94e,_0x85f9ae){const _0x1d14b3=_0x4cab84,{useType:_0x30e758}=_0xf5e94e;_0x30e758===_0x1d14b3(0x121)&&await this[_0x1d14b3(0xf7)](_0x5f3186,_0xf5e94e[_0x1d14b3(0xc8)],_0x85f9ae),_0x30e758===_0x1d14b3(0x135)&&await this[_0x1d14b3(0xdd)](_0x5f3186,_0xf5e94e,_0x85f9ae);}['extractContent'](_0x28353e){const _0x59816a=/存在(.*?)不合规/,_0x4dbee7=_0x28353e['match'](_0x59816a);return _0x4dbee7?_0x4dbee7[0x1]:'';}async['baiduCheckBadWords'](_0x48e91f,_0x168623,_0x4b3adc){const _0x37f55b=_0x4cab84;if(!_0x168623)return;const _0x40ef9d=_0x37f55b(0x127)+_0x168623+'}',_0x57bacd={'Content-Type':_0x37f55b(0xcc),'Accept':'application/json'},_0x4bc559=await axios_1[_0x37f55b(0xc9)][_0x37f55b(0x129)](_0x40ef9d,{'text':_0x48e91f},{'headers':_0x57bacd}),{conclusion:_0x3aa2f6,error_code:_0x412923,error_msg:_0x474430,conclusionType:_0x1ab096,data:_0x2a3dcf}=_0x4bc559[_0x37f55b(0x105)];_0x412923&&console[_0x37f55b(0xe3)](_0x37f55b(0x11e),_0x474430);if(_0x1ab096!==0x1){const _0x6bea39=[...new Set(_0x2a3dcf[_0x37f55b(0xf2)](_0x467c4d=>this[_0x37f55b(0xfb)](_0x467c4d[_0x37f55b(0x122)])))];await this[_0x37f55b(0xe1)](_0x4b3adc,_0x48e91f,[_0x37f55b(0xdf)],_0x6bea39,_0x37f55b(0xe7));const _0x21ea58=_0x37f55b(0x101)+_0x6bea39['join'](',')+'的内容、我们已对您的账户进行标记、请合规使用！';throw new common_1[(_0x37f55b(0xd1))](_0x21ea58,common_1[_0x37f55b(0x107)][_0x37f55b(0xec)]);}}async[_0x4cab84(0xdd)](_0x1bbb9a,_0x4eb588,_0x537558){const _0x59594e=_0x4cab84;var _0x254999;const {nineaiBuiltInSensitiveApiBase:_0x33c6bf,nineaiBuiltInSensitiveAuthKey:_0x177dbb}=_0x4eb588;if(!_0x33c6bf||!_0x177dbb)return;const _0xdd6752=await axios_1['default']['post'](_0x33c6bf,{'content':_0x1bbb9a},{'headers':{'Content-Type':'application/json','Authorization':_0x177dbb}});if(!_0xdd6752['data'])return;if(_0xdd6752[_0x59594e(0x105)][_0x59594e(0x114)]!=='0'){const {msg:msg='检测失败'}=_0xdd6752[_0x59594e(0x105)];throw new common_1[(_0x59594e(0xd1))](_0x59594e(0xdb)+msg,common_1[_0x59594e(0x107)]['BAD_REQUEST']);}if(_0xdd6752[_0x59594e(0x105)][_0x59594e(0xce)]&&((_0x254999=_0xdd6752[_0x59594e(0x105)][_0x59594e(0xce)])===null||_0x254999===void 0x0?void 0x0:_0x254999['length'])){const _0x221876=[...new Set(_0xdd6752[_0x59594e(0x105)][_0x59594e(0xce)]['map'](_0x589249=>_0x589249[_0x59594e(0xe2)]))],_0x207eda=[...new Set(_0xdd6752[_0x59594e(0x105)][_0x59594e(0xce)][_0x59594e(0xf2)](_0x156d85=>_0x156d85[_0x59594e(0xf5)]))];await this['recordUserBadWords'](_0x537558,_0x1bbb9a,_0x221876,_0x207eda,_0x59594e(0xc7));const _0x4911ad=this['formarTips'](_0xdd6752['data']['word_list']);throw new common_1[(_0x59594e(0xd1))](_0x4911ad,common_1[_0x59594e(0x107)][_0x59594e(0xec)]);}}[_0x4cab84(0xd5)](_0x4a59e5){const _0x49c63b=_0x4cab84,_0x54a150=_0x4a59e5[_0x49c63b(0xf2)](_0x1c3521=>_0x1c3521['category']),_0x1bf635=[...new Set(_0x54a150)];return _0x49c63b(0x134)+_0x1bf635[_0x49c63b(0x11a)](',')+_0x49c63b(0xef);}async[_0x4cab84(0xd8)](){const _0x56bccb=_0x4cab84,_0x21f005=await this[_0x56bccb(0x12c)]['find']({'where':{'status':0x1},'select':['word']});this[_0x56bccb(0xfa)]=_0x21f005[_0x56bccb(0xf2)](_0x12b534=>_0x12b534[_0x56bccb(0xe6)]);}async[_0x4cab84(0x110)](_0x448430){const _0x4249f8=_0x4cab84,{page:page=0x1,size:size=0x1f4,word:_0x29199f,status:_0x326847}=_0x448430,_0x322dec={};[0x0,0x1,'0','1'][_0x4249f8(0x10b)](_0x326847)&&(_0x322dec[_0x4249f8(0xd6)]=_0x326847),_0x29199f&&(_0x322dec[_0x4249f8(0xe6)]=(0x0,typeorm_1[_0x4249f8(0xd7)])('%'+_0x29199f+'%'));const [_0x42fc66,_0x16bbf9]=await this[_0x4249f8(0x12c)][_0x4249f8(0x104)]({'where':_0x322dec,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x4249f8(0xd0)}});return{'rows':_0x42fc66,'count':_0x16bbf9};}async['delBadWords'](_0x415ec9){const _0xfa8612=_0x4cab84,_0x16596e=await this[_0xfa8612(0x12c)][_0xfa8612(0xdc)]({'where':{'id':_0x415ec9['id']}});if(!_0x16596e)throw new common_1['HttpException'](_0xfa8612(0x117),common_1[_0xfa8612(0x107)][_0xfa8612(0xec)]);const _0x394a24=await this[_0xfa8612(0x12c)]['delete']({'id':_0x415ec9['id']});if(_0x394a24[_0xfa8612(0x109)]>0x0)return await this['loadBadWords'](),_0xfa8612(0xfc);else throw new common_1[(_0xfa8612(0xd1))](_0xfa8612(0x113),common_1[_0xfa8612(0x107)]['BAD_REQUEST']);}async[_0x4cab84(0xea)](_0x1dce28){const _0x27fb69=_0x4cab84,{id:_0x40891b,word:_0x563b0b,status:_0x1e202f}=_0x1dce28,_0x122d4d=await this['badWordsEntity']['findOne']({'where':{'word':_0x563b0b}});if(_0x122d4d)throw new common_1['HttpException']('敏感词已经存在了、请勿重复添加',common_1[_0x27fb69(0x107)][_0x27fb69(0xec)]);const _0x380200=await this['badWordsEntity'][_0x27fb69(0x11f)]({'id':_0x40891b},{'word':_0x563b0b,'status':_0x1e202f});if(_0x380200[_0x27fb69(0x109)]>0x0)return await this[_0x27fb69(0xd8)](),'更新敏感词成功';else throw new common_1[(_0x27fb69(0xd1))](_0x27fb69(0xe5),common_1['HttpStatus']['BAD_REQUEST']);}async[_0x4cab84(0x132)](_0x248226){const _0xa60daa=_0x4cab84,{word:_0x359366}=_0x248226,_0x1cd117=await this['badWordsEntity'][_0xa60daa(0xdc)]({'where':{'word':_0x359366}});if(_0x1cd117)throw new common_1['HttpException']('敏感词已存在,请检查您的提交信息',common_1[_0xa60daa(0x107)][_0xa60daa(0xec)]);return await this[_0xa60daa(0x12c)]['save']({'word':_0x359366}),await this[_0xa60daa(0xd8)](),_0xa60daa(0xcd);}async['recordUserBadWords'](_0x3529fa,_0x182935,_0x470688,_0x7f1499,_0x3aed76){const _0x379036=_0x4cab84,_0x5cafec={'userId':_0x3529fa,'content':_0x182935,'words':JSON[_0x379036(0xf8)](_0x470688),'typeCn':JSON[_0x379036(0xf8)](_0x7f1499),'typeOriginCn':_0x3aed76};try{await this[_0x379036(0x125)]['createQueryBuilder']()[_0x379036(0x11f)](user_entity_1[_0x379036(0xe0)])[_0x379036(0x111)]({'violationCount':()=>'violationCount\x20+\x201'})[_0x379036(0xf0)](_0x379036(0xff),{'userId':_0x3529fa})[_0x379036(0x10c)](),await this[_0x379036(0xda)][_0x379036(0x10e)](_0x5cafec);}catch(_0x753d9f){console[_0x379036(0xe3)]('error:\x20',_0x753d9f);}}async[_0x4cab84(0x120)](_0x128af0,_0x5d2ef0){const _0xd3c2c7=_0x4cab84,{role:_0x93742}=_0x128af0[_0xd3c2c7(0x130)],{page:page=0x1,size:size=0xa,userId:_0x32ce25,typeOriginCn:_0xb81486}=_0x5d2ef0,_0x594bbf={};_0x32ce25&&(_0x594bbf[_0xd3c2c7(0xfe)]=_0x32ce25),_0xb81486&&(_0x594bbf[_0xd3c2c7(0xfd)]=_0xb81486);const [_0x273198,_0x33387c]=await this['violationLogEntity']['findAndCount']({'where':_0x594bbf,'skip':(page-0x1)*size,'take':size,'order':{'id':_0xd3c2c7(0x119)}}),_0x32da65=[...new Set(_0x273198['map'](_0x44381f=>_0x44381f['userId']))],_0x10628b=await this[_0xd3c2c7(0x125)]['find']({'where':{'id':(0x0,typeorm_1['In'])(_0x32da65)},'select':['id',_0xd3c2c7(0xf3),_0xd3c2c7(0x136),_0xd3c2c7(0xf1),_0xd3c2c7(0xeb),_0xd3c2c7(0xd6)]});return _0x273198[_0xd3c2c7(0x10f)](_0x31cc00=>{const _0x2c4f48=_0xd3c2c7,_0x56a9cb=_0x10628b[_0x2c4f48(0x123)](_0x5a131f=>_0x5a131f['id']===_0x31cc00['userId']);_0x93742!=='super'&&(_0x56a9cb['email']=(0x0,utils_1[_0x2c4f48(0xe9)])(_0x56a9cb===null||_0x56a9cb===void 0x0?void 0x0:_0x56a9cb['email'])),_0x31cc00[_0x2c4f48(0xca)]=_0x56a9cb;}),{'rows':_0x273198,'count':_0x33387c};}};function _0x267e(_0x27c3e9,_0x321ab8){const _0x5e7d95=_0x5e7d();return _0x267e=function(_0x267e57,_0x8b7e79){_0x267e57=_0x267e57-0xc7;let _0x157eb3=_0x5e7d95[_0x267e57];return _0x157eb3;},_0x267e(_0x27c3e9,_0x321ab8);}BadwordsService=__decorate([(0x0,common_1[_0x4cab84(0xcf)])(),__param(0x0,(0x0,typeorm_2[_0x4cab84(0x11b)])(badwords_entity_1[_0x4cab84(0x131)])),__param(0x1,(0x0,typeorm_2[_0x4cab84(0x11b)])(violationLog_entity_1[_0x4cab84(0x116)])),__param(0x2,(0x0,typeorm_2[_0x4cab84(0x11b)])(user_entity_1['UserEntity'])),__metadata(_0x4cab84(0xee),[typeorm_1[_0x4cab84(0x126)],typeorm_1[_0x4cab84(0x126)],typeorm_1[_0x4cab84(0x126)],globalConfig_service_1['GlobalConfigService']])],BadwordsService),exports['BadwordsService']=BadwordsService;