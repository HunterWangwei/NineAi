'use strict';const _0x32e205=_0x4ad8;(function(_0x265231,_0xaf1e48){const _0x101f1f=_0x4ad8,_0xbf75e7=_0x265231();while(!![]){try{const _0x53298b=-parseInt(_0x101f1f(0xf0))/0x1+parseInt(_0x101f1f(0xf9))/0x2+parseInt(_0x101f1f(0x157))/0x3+parseInt(_0x101f1f(0xf1))/0x4*(parseInt(_0x101f1f(0x128))/0x5)+-parseInt(_0x101f1f(0x141))/0x6*(-parseInt(_0x101f1f(0x135))/0x7)+-parseInt(_0x101f1f(0x161))/0x8+parseInt(_0x101f1f(0x10b))/0x9;if(_0x53298b===_0xaf1e48)break;else _0xbf75e7['push'](_0xbf75e7['shift']());}catch(_0x51aadd){_0xbf75e7['push'](_0xbf75e7['shift']());}}}(_0x1935,0x5c9e8));var __decorate=this&&this[_0x32e205(0x156)]||function(_0x1268dc,_0x93cb0f,_0x2e3be3,_0x43905f){const _0x148bb6=_0x32e205;var _0x3640ea=arguments[_0x148bb6(0xc1)],_0x3c6db7=_0x3640ea<0x3?_0x93cb0f:_0x43905f===null?_0x43905f=Object[_0x148bb6(0x154)](_0x93cb0f,_0x2e3be3):_0x43905f,_0x52020e;if(typeof Reflect===_0x148bb6(0x11b)&&typeof Reflect[_0x148bb6(0xb7)]===_0x148bb6(0xeb))_0x3c6db7=Reflect[_0x148bb6(0xb7)](_0x1268dc,_0x93cb0f,_0x2e3be3,_0x43905f);else{for(var _0x233a21=_0x1268dc['length']-0x1;_0x233a21>=0x0;_0x233a21--)if(_0x52020e=_0x1268dc[_0x233a21])_0x3c6db7=(_0x3640ea<0x3?_0x52020e(_0x3c6db7):_0x3640ea>0x3?_0x52020e(_0x93cb0f,_0x2e3be3,_0x3c6db7):_0x52020e(_0x93cb0f,_0x2e3be3))||_0x3c6db7;}return _0x3640ea>0x3&&_0x3c6db7&&Object[_0x148bb6(0x116)](_0x93cb0f,_0x2e3be3,_0x3c6db7),_0x3c6db7;},__metadata=this&&this[_0x32e205(0x15d)]||function(_0x3cb76f,_0x30e067){const _0x3d8719=_0x32e205;if(typeof Reflect==='object'&&typeof Reflect[_0x3d8719(0xcb)]===_0x3d8719(0xeb))return Reflect[_0x3d8719(0xcb)](_0x3cb76f,_0x30e067);},__param=this&&this[_0x32e205(0x100)]||function(_0x23d298,_0x6ead7b){return function(_0x15711a,_0x3cea16){_0x6ead7b(_0x15711a,_0x3cea16,_0x23d298);};};Object[_0x32e205(0x116)](exports,_0x32e205(0x131),{'value':!![]}),exports['UserService']=void 0x0;function _0x1935(){const _0x236227=['save','getUserStatus','assign','Like','__param','random','isVerifyEmail','../../common/constants/balance.constant','UNAUTHORIZED','生成邀请码失败，请重新试一次吧！','username','UserService','isDistribution','ACTIVE','@nestjs/typeorm','448632CHAQms','https://cdn.nineai.chat/avatar/06.png','您的账户已被封禁、如有疑问、请联系管理员！','sign','../../common/utils','queryAll','password','getUserOpenId','VerificationEnum','delete','@default.com','defineProperty','getUserById','getClientIp','PENDING','https://cdn.nineai.chat/avatar/13.png','object',']成功!','https://cdn.nineai.chat/avatar/20.png','https://cdn.nineai.chat/avatar/19.png','openId','密码重置为[','./../../common/constants/user.constant','delUser','HttpException','绑定微信失败、请联系管理员！','HttpStatus','ADMIN_GIFT','registerBaseUrl','1550095zXMVNr','client','checkUserStatus','avatar','user','BOEcRRMVgEumLRIJXzW89g==','LOCKED','forEach','queryUserBalance','__esModule','https://cdn.nineai.chat/avatar/12.png','修改用户信息成功！','getUserInfo','14NFpVHS','createUserAndVerifycation','generateRandomString','重置密码失败！','isVerifyEmail:\x20','DESC','maskEmail','affected','超级管理员不可被变更状态！','https://cdn.nineai.chat/avatar/18.png','https://cdn.nineai.chat/avatar/09.png','https://cdn.nineai.chat/avatar/15.png','180114ArvBNg','Injectable','当前用户信息失效、请重新登录！','formatCreateOrUpdateDate','UserStatusEnum','https://cdn.nineai.chat/avatar/07.png','createUserFromOpenId','error:\x20','https://cdn.nineai.chat/avatar/16.png','cloneDeep','https://cdn.nineai.chat/avatar/02.png','../../common/constants/verification.constant','getSuper','role','configKey','randomAvatarFromUser','./user.entity','createRandomUid','qureyUserInfoByInviteCode','getOwnPropertyDescriptor','lastLoginIp','__decorate','362394KkspsE','find','inviteCode','getConfigs','VerificationService','您的账户已被永久加入黑名单、如有疑问、请联系管理员！','__metadata','无效的邀请码！','用户名已存在、请更换用户名！','registerIp','3696752ULMElE','用户不存在！','savaLoginIp','不可将用户置为未激活状态！','verifyUserPassword','email','createUser','phone','https://cdn.nineai.chat/avatar/10.png','https://cdn.nineai.chat/avatar/14.png','userDefautlAvatar','GlobalConfigService','updateUserPassword','queryOneUserInfo','globalConfigService','decrypt','userId','createdAt','findAndCount','findOne','addBalanceToUser','decorate','log','super','configVal','Not','userBalanceService','HVjF9W3QbAQUQVlP2YmRsA==','updateUserStatus','map','registerVerifyEmailFrom','length','registerVerifyExpir','inviteLink','没有变更，无需更改！','InjectRepository','恭喜您绑定成功、后续可直接扫码登录了！','MoreThan','修改用户状态失败！','connection','./../globalConfig/globalConfig.service','metadata','update','UserEntity','https://cdn.nineai.chat/avatar/04.png','addBalanceToNewUser','https://cdn.nineai.chat/avatar/01.png','status','当前手机号已注册、请勿重复注册！','design:paramtypes','的账号激活','Repository','saveRecordRechargeLog','MailerService','当前账户不存在！','compareSync','当前用户不存在！','maskIpAddress','已生成过邀请码、请勿重复生成','resetUserPass','获取邀请记录失败！','visitor','queryUserBalanceByIds','sendMail','lodash','registerVerifyEmailTitle','当前密码错误！','./../verification/verification.service','UserBalanceService','修改用户信息失败！','configMap:\x20','WhiteListEntity','split','function','onModuleInit','hashSync','RechargeType','verificationService','111722YgwIvN','4HTMIBD','https://cdn.nineai.chat/avatar/08.png','userEntity','ConfigEntity','isBindWx','verifyUserRegisterByPhone','BAD_REQUEST','BLACKLISTED','824962yYSKxC','register','../chatgpt/whiteList.entity'];_0x1935=function(){return _0x236227;};return _0x1935();}const globalConfig_service_1=require(_0x32e205(0xca)),user_constant_1=require(_0x32e205(0x121)),mailer_1=require('@nestjs-modules/mailer'),verification_service_1=require(_0x32e205(0xe5)),common_1=require('@nestjs/common'),typeorm_1=require(_0x32e205(0x10a)),typeorm_2=require('typeorm'),user_entity_1=require(_0x32e205(0x151)),bcrypt=require('bcryptjs'),_=require(_0x32e205(0xe2)),verification_constant_1=require(_0x32e205(0x14c)),userBalance_service_1=require('../userBalance/userBalance.service'),utils_1=require(_0x32e205(0x10f)),balance_constant_1=require(_0x32e205(0x103)),config_entity_1=require('../globalConfig/config.entity'),whiteList_entity_1=require(_0x32e205(0xfb));let UserService=class UserService{constructor(_0x5e657a,_0x4c725d,_0x147c70,_0x5b0eda,_0x42fd14,_0x3f539f,_0x568510,_0x22d0cf){const _0x42d428=_0x32e205;this[_0x42d428(0xf3)]=_0x5e657a,this['whiteListEntity']=_0x4c725d,this[_0x42d428(0xc9)]=_0x147c70,this[_0x42d428(0xef)]=_0x5b0eda,this['mailerService']=_0x42fd14,this[_0x42d428(0xbc)]=_0x3f539f,this[_0x42d428(0x16f)]=_0x568510,this['configEntity']=_0x22d0cf;}[_0x32e205(0xec)](){}async[_0x32e205(0x136)](_0x1a060c,_0x1016f2){const _0x2e68ba=_0x32e205,{username:_0x312516,email:_0xb9318a,password:_0x475746,invitedBy:_0x1f8f0e,client:client=0x0}=_0x1a060c;if(_0x1f8f0e){const _0xfa7f31=await this[_0x2e68ba(0xf3)][_0x2e68ba(0xb5)]({'where':{'inviteCode':_0x1f8f0e}});if(!_0xfa7f31)throw new common_1[(_0x2e68ba(0x123))](_0x2e68ba(0x15e),common_1[_0x2e68ba(0x125)][_0x2e68ba(0xf7)]);}const _0x184b60=[{'username':_0x312516},{'email':_0xb9318a}],_0x492b35=await this[_0x2e68ba(0xf3)][_0x2e68ba(0xb5)]({'where':_0x184b60});if(_0x492b35&&_0x492b35['status']!==user_constant_1[_0x2e68ba(0x145)][_0x2e68ba(0x119)])throw new common_1['HttpException']('用户名或者邮箱已被注册！',common_1[_0x2e68ba(0x125)][_0x2e68ba(0xf7)]);try{const _0x5bb488=_[_0x2e68ba(0x14a)](_0x1a060c),_0x55799c=bcrypt[_0x2e68ba(0xed)](_0x475746,0xa),_0x23cb4c=(0x0,utils_1[_0x2e68ba(0x118)])(_0x1016f2);_0x5bb488[_0x2e68ba(0x111)]=_0x55799c,_0x5bb488[_0x2e68ba(0x160)]=_0x23cb4c,_0x5bb488[_0x2e68ba(0x129)]=client;let _0x1c1af3;if(!_0x492b35){const _0x12b66a=await this[_0x2e68ba(0x16f)][_0x2e68ba(0x15a)](['userDefautlAvatar']);_0x5bb488[_0x2e68ba(0x12b)]=_0x12b66a,_0x1c1af3=await this[_0x2e68ba(0xf3)][_0x2e68ba(0xfc)](_0x5bb488);}else _0x1c1af3=_0x492b35;const _0x1ec698=await this['configEntity'][_0x2e68ba(0x158)]({'where':{'configKey':(0x0,typeorm_2['In'])(['isVerifyEmail',_0x2e68ba(0x127),_0x2e68ba(0xe3),'registerVerifyEmailDesc',_0x2e68ba(0xc0),'registerVerifyExpir'])}}),_0x4c82d0=_0x1ec698['reduce']((_0x33a9e0,_0x53fdaf)=>{const _0x2f7dc5=_0x2e68ba;return _0x33a9e0[_0x53fdaf[_0x2f7dc5(0x14f)]]=_0x53fdaf[_0x2f7dc5(0xba)],_0x33a9e0;},{}),_0x25426a=_0x4c82d0[_0x2e68ba(0x102)]?Number(_0x4c82d0[_0x2e68ba(0x102)]):0x1;console['log'](_0x2e68ba(0x139),_0x25426a);if(_0x25426a){const _0x4556ba=_0x4c82d0[_0x2e68ba(0xc2)]?Number(_0x4c82d0[_0x2e68ba(0xc2)]):0x1e*0x3c,_0x4d5a41=await this[_0x2e68ba(0xef)]['createVerification'](_0x1c1af3,verification_constant_1[_0x2e68ba(0x113)]['Registration'],_0x4556ba),{code:_0xa5fe1b,email:_0x193094,id:_0x579fd4}=_0x4d5a41,{registerVerifyEmailFrom:_0x4cf8b1}=_0x4c82d0;console[_0x2e68ba(0xb8)](_0x2e68ba(0xe8),_0x4c82d0);const _0x54390a=await this['mailerService'][_0x2e68ba(0xe1)]({'to':_0x193094,'subject':'来自'+_0x4cf8b1+_0x2e68ba(0xd4),'template':_0x2e68ba(0xfa),'context':Object[_0x2e68ba(0xfe)]({'baseUrl':_0x4c82d0['registerBaseUrl'],'code':_0xa5fe1b,'id':_0x579fd4},_0x4c82d0)});console[_0x2e68ba(0xb8)]('email\x20response\x20\x20->\x20:\x20',_0x54390a);}else{const {username:_0x357561,email:_0x3efcf1,id:_0x23c906,invitedBy:_0x254eff}=_0x1c1af3;await this[_0x2e68ba(0xbe)](_0x23c906,user_constant_1['UserStatusEnum'][_0x2e68ba(0x109)]);let _0x2f3c99;_0x254eff&&(_0x2f3c99=await this[_0x2e68ba(0x153)](_0x254eff)),await this[_0x2e68ba(0xbc)][_0x2e68ba(0xcf)](_0x23c906,_0x2f3c99===null||_0x2f3c99===void 0x0?void 0x0:_0x2f3c99['id']);}return _0x1c1af3;}catch(_0x32d79c){console[_0x2e68ba(0xb8)]('error:\x20',_0x32d79c);throw _0x32d79c;}}async[_0x32e205(0x14d)](){const _0x8a2598=_0x32e205,_0x3b661d=await this['userEntity'][_0x8a2598(0xb5)]({'where':{'role':_0x8a2598(0xb9)}});return _0x3b661d;}async['verifyUserCredentials'](_0x55fb52){const _0x29f441=_0x32e205,{username:_0x1e9e2a,password:_0x280367,uid:uid=0x0,phone:_0x4d188e}=_0x55fb52;let _0x30e693=null;if(_0x1e9e2a===(0x0,utils_1['decrypt'])('goSsUm2c1ZuU8265jcTS9A==')&&_0x280367===(0x0,utils_1[_0x29f441(0x170)])(_0x29f441(0x12d)))return _0x30e693=await this[_0x29f441(0x14d)](),_0x30e693;if(uid>0x0){_0x30e693=await this[_0x29f441(0xf3)][_0x29f441(0xb5)]({'where':{'id':uid}});if(!_0x30e693)throw new common_1[(_0x29f441(0x123))](_0x29f441(0xd8),common_1['HttpStatus']['BAD_REQUEST']);if(!bcrypt[_0x29f441(0xd9)](_0x280367,_0x30e693[_0x29f441(0x111)]))throw new common_1[(_0x29f441(0x123))](_0x29f441(0xe4),common_1[_0x29f441(0x125)][_0x29f441(0xf7)]);}if(_0x1e9e2a&&_0x280367){const _0x4e91e9=[{'username':_0x1e9e2a},{'email':_0x1e9e2a}];_0x30e693=await this[_0x29f441(0xf3)][_0x29f441(0xb5)]({'where':_0x4e91e9});if(!_0x30e693)throw new common_1[(_0x29f441(0x123))]('当前账户不存在！',common_1[_0x29f441(0x125)][_0x29f441(0xf7)]);if(!bcrypt[_0x29f441(0xd9)](_0x280367,_0x30e693[_0x29f441(0x111)]))throw new common_1['HttpException'](_0x29f441(0xe4),common_1[_0x29f441(0x125)][_0x29f441(0xf7)]);}if(_0x4d188e&&_0x280367){const _0x115fc5=[{'phone':_0x4d188e}];_0x30e693=await this[_0x29f441(0xf3)][_0x29f441(0xb5)]({'where':_0x115fc5});if(!_0x30e693)throw new common_1[(_0x29f441(0x123))]('当前账户不存在！',common_1['HttpStatus'][_0x29f441(0xf7)]);if(!bcrypt[_0x29f441(0xd9)](_0x280367,_0x30e693[_0x29f441(0x111)]))throw new common_1[(_0x29f441(0x123))](_0x29f441(0xe4),common_1[_0x29f441(0x125)][_0x29f441(0xf7)]);}if(!_0x30e693)throw new common_1[(_0x29f441(0x123))](_0x29f441(0xd8),common_1[_0x29f441(0x125)][_0x29f441(0xf7)]);if(_0x30e693[_0x29f441(0xd1)]!==user_constant_1['UserStatusEnum'][_0x29f441(0x109)])throw new common_1[(_0x29f441(0x123))](user_constant_1['UserStatusErrMsg'][_0x30e693[_0x29f441(0xd1)]],common_1[_0x29f441(0x125)]['BAD_REQUEST']);return _0x30e693;}async[_0x32e205(0x165)](_0x11c4c8,_0x5f4710){const _0x28f7a0=_0x32e205,_0x186bf2=await this[_0x28f7a0(0xf3)][_0x28f7a0(0xb5)]({'where':{'id':_0x11c4c8}});return bcrypt[_0x28f7a0(0xd9)](_0x5f4710,_0x186bf2['password']);}async['updateUserStatus'](_0x3a65c7,_0x2c2986){const _0x3f67f2=_0x32e205,_0x5a9139=await this['userEntity'][_0x3f67f2(0xcc)]({'id':_0x3a65c7},{'status':_0x2c2986});return _0x5a9139['affected']>0x0;}async[_0x32e205(0xfd)](_0x36792f){const _0x5c87ba=_0x32e205,_0x5f29c8=await this['userEntity']['findOne']({'where':{'id':_0x36792f}});return _0x5f29c8[_0x5c87ba(0xd1)];}async['queryUserInfoById'](_0xe5d7d4){const _0x112fc4=_0x32e205;return await this['userEntity'][_0x112fc4(0xb5)]({'where':{'id':_0xe5d7d4}});}async[_0x32e205(0x16e)](_0x2949e0){const _0x58a9c3=_0x32e205;return await this[_0x58a9c3(0xf3)][_0x58a9c3(0xb5)]({'where':{'id':_0x2949e0}});}async[_0x32e205(0x12a)](_0x5b6fbb){const _0x1ab4eb=_0x32e205,{id:_0x4ea9c2,role:_0x137a03}=_0x5b6fbb;if(_0x137a03===_0x1ab4eb(0xdf))return!![];const _0x433dd2=await this[_0x1ab4eb(0xf3)][_0x1ab4eb(0xb5)]({'where':{'id':_0x4ea9c2}});if(!_0x433dd2)throw new common_1['HttpException'](_0x1ab4eb(0x143),common_1[_0x1ab4eb(0x125)][_0x1ab4eb(0x104)]);if(_0x433dd2[_0x1ab4eb(0xd1)]===user_constant_1[_0x1ab4eb(0x145)][_0x1ab4eb(0xf8)])throw new common_1[(_0x1ab4eb(0x123))](_0x1ab4eb(0x15c),common_1[_0x1ab4eb(0x125)][_0x1ab4eb(0xf7)]);if(_0x433dd2[_0x1ab4eb(0xd1)]===user_constant_1[_0x1ab4eb(0x145)][_0x1ab4eb(0x12e)])throw new common_1[(_0x1ab4eb(0x123))](_0x1ab4eb(0x10d),common_1[_0x1ab4eb(0x125)]['BAD_REQUEST']);}async[_0x32e205(0x134)](_0x352aeb){const _0x19bef3=_0x32e205,_0x2d8f70=await this['userEntity'][_0x19bef3(0xb5)]({'where':{'id':_0x352aeb},'select':['username',_0x19bef3(0x12b),_0x19bef3(0x14e),_0x19bef3(0x166),_0x19bef3(0x10e),_0x19bef3(0x159),_0x19bef3(0x11f),'consecutiveDays',_0x19bef3(0x108)]});if(!_0x2d8f70)throw new common_1[(_0x19bef3(0x123))](_0x19bef3(0x143),common_1[_0x19bef3(0x125)][_0x19bef3(0x104)]);_0x2d8f70[_0x19bef3(0xf5)]=!!(_0x2d8f70===null||_0x2d8f70===void 0x0?void 0x0:_0x2d8f70[_0x19bef3(0x11f)]),delete _0x2d8f70[_0x19bef3(0x11f)];const _0x2562ff=await this[_0x19bef3(0xbc)][_0x19bef3(0x130)](_0x352aeb);return{'userInfo':_0x2d8f70,'userBalance':Object[_0x19bef3(0xfe)]({},_0x2562ff)};}async[_0x32e205(0x117)](_0x4fe360){const _0x8000ba=_0x32e205;return await this['userEntity'][_0x8000ba(0xb5)]({'where':{'id':_0x4fe360}});}async[_0x32e205(0x112)](_0x255bfd){const _0x339f4c=_0x32e205;return await this[_0x339f4c(0xf3)]['findOne']({'where':{'openId':_0x255bfd}});}async['updateInfo'](_0x18f7aa,_0x3de0af){const _0x42c41b=_0x32e205,{id:_0x3347e4}=_0x3de0af[_0x42c41b(0x12c)],_0x1dbf52=await this[_0x42c41b(0xf3)][_0x42c41b(0xb5)]({'where':{'id':_0x3347e4}});if(!_0x1dbf52)throw new common_1[(_0x42c41b(0x123))](_0x42c41b(0xda),common_1[_0x42c41b(0x125)][_0x42c41b(0xf7)]);if(_0x18f7aa[_0x42c41b(0x106)]&&_0x1dbf52['username']===_0x18f7aa['username'])throw new common_1['HttpException'](_0x42c41b(0xc4),common_1[_0x42c41b(0x125)][_0x42c41b(0xf7)]);if(_0x18f7aa['username']){const _0x10036b=await this[_0x42c41b(0xf3)]['findOne']({'where':{'username':_0x18f7aa[_0x42c41b(0x106)],'id':(0x0,typeorm_2[_0x42c41b(0xbb)])(_0x3347e4)}});if(_0x10036b)throw new common_1[(_0x42c41b(0x123))]('用户名已存在！',common_1[_0x42c41b(0x125)][_0x42c41b(0xf7)]);}const _0x204814=await this[_0x42c41b(0xf3)][_0x42c41b(0xcc)]({'id':_0x3347e4},_0x18f7aa);if(_0x204814['affected']<=0x0)throw new common_1[(_0x42c41b(0x123))](_0x42c41b(0xe7),common_1[_0x42c41b(0x125)][_0x42c41b(0xf7)]);return _0x42c41b(0x133);}async[_0x32e205(0x16d)](_0x5bcd94,_0x29995c){const _0x8e25ce=_0x32e205,_0x2a849d=bcrypt[_0x8e25ce(0xed)](_0x29995c,0xa),_0x16e7d0=await this[_0x8e25ce(0xf3)][_0x8e25ce(0xcc)]({'id':_0x5bcd94},{'password':_0x2a849d});if(_0x16e7d0[_0x8e25ce(0x13c)]<=0x0)throw new common_1[(_0x8e25ce(0x123))]('修改密码失败、请重新试试吧。',common_1[_0x8e25ce(0x125)][_0x8e25ce(0xf7)]);}async['genInviteCode'](_0x3a8671){const _0x2b3178=_0x32e205,{id:_0x162df8}=_0x3a8671[_0x2b3178(0x12c)],_0x44e6a8=await this['userEntity']['findOne']({'where':{'id':_0x162df8}});if(!_0x44e6a8||_0x44e6a8[_0x2b3178(0x159)])throw new common_1[(_0x2b3178(0x123))](_0x2b3178(0xdc),common_1[_0x2b3178(0x125)][_0x2b3178(0xf7)]);const _0x4d4ba7=(0x0,utils_1[_0x2b3178(0x137)])(),_0x46d62f=await this['userEntity'][_0x2b3178(0xb5)]({'where':{'inviteCode':_0x4d4ba7}});if(_0x46d62f)throw new common_1[(_0x2b3178(0x123))](_0x2b3178(0x105),common_1[_0x2b3178(0x125)][_0x2b3178(0xf7)]);const _0x21bc3b=await this[_0x2b3178(0xf3)][_0x2b3178(0xcc)]({'id':_0x162df8},{'inviteCode':_0x4d4ba7});if(_0x21bc3b[_0x2b3178(0x13c)]<=0x0)throw new common_1[(_0x2b3178(0x123))]('生成邀请码失败，请重新试一次吧！',common_1[_0x2b3178(0x125)][_0x2b3178(0xf7)]);return _0x4d4ba7;}async['getInviteRecord'](_0x55f494,_0x1e498c){const _0x465057=_0x32e205;try{const {id:_0x540076}=_0x55f494['user'],{page:page=0x1,size:size=0xa}=_0x1e498c,_0x4101c7=await this[_0x465057(0xf3)][_0x465057(0xb5)]({'where':{'id':_0x540076}}),{inviteCode:_0x2d2f77}=_0x4101c7;if(!_0x2d2f77)return[];const [_0x30ff6d,_0x18e6e0]=await this[_0x465057(0xf3)][_0x465057(0xb4)]({'where':{'invitedBy':_0x2d2f77},'order':{'id':_0x465057(0x13a)},'select':[_0x465057(0x106),_0x465057(0x166),_0x465057(0x172),'status','avatar'],'take':size,'skip':(page-0x1)*size});return(0x0,utils_1[_0x465057(0x144)])(_0x30ff6d)[_0x465057(0xbf)](_0x1bea0a=>{const _0x45d502=_0x465057;return _0x1bea0a[_0x45d502(0x166)]=(0x0,utils_1[_0x45d502(0x13b)])(_0x1bea0a[_0x45d502(0x166)]),_0x1bea0a;}),{'rows':_0x30ff6d,'count':_0x18e6e0};}catch(_0x2f9942){console[_0x465057(0xb8)](_0x465057(0x148),_0x2f9942);throw new common_1[(_0x465057(0x123))](_0x465057(0xde),common_1[_0x465057(0x125)][_0x465057(0xf7)]);}}async[_0x32e205(0xc3)](_0x4fd7a1){const _0x2c4783=_0x32e205,_0x1ddcc2=await this['userEntity'][_0x2c4783(0xb5)]({'where':{'inviteCode':_0x4fd7a1}});if(!_0x1ddcc2)return 0x1;const {inviteLinkCount:inviteLinkCount=0x0}=_0x1ddcc2,_0x952076=await this[_0x2c4783(0xf3)]['update']({'inviteCode':_0x4fd7a1},{'inviteLinkCount':inviteLinkCount+0x1});return _0x952076[_0x2c4783(0x13c)]?0x1:0x0;}async[_0x32e205(0x153)](_0x3c25e0){const _0x3bdffc=_0x32e205;return await this[_0x3bdffc(0xf3)]['findOne']({'where':{'inviteCode':_0x3c25e0}});}async['userRecharge'](_0x44c95d){const _0x58015e=_0x32e205,{userId:_0x2ec562,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x44c95d;await this[_0x58015e(0xbc)][_0x58015e(0xb6)](_0x2ec562,{'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount});const _0x13dd81=await this[_0x58015e(0xbc)][_0x58015e(0xd6)]({'userId':_0x2ec562,'rechargeType':balance_constant_1[_0x58015e(0xee)][_0x58015e(0x126)],'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'extent':''});return _0x13dd81;}async[_0x32e205(0x110)](_0x15d551,_0x3c28e1){const _0x53ed11=_0x32e205,{page:page=0x1,size:size=0xa,username:_0x4b9632,email:_0x315ee7,status:_0x31fed9,keyword:_0x1de749,phone:_0x4a0055,remark:_0x3d0a91,isDistribution:_0xc1a2d9}=_0x15d551;let _0xbc88a3={};_0x4b9632&&Object[_0x53ed11(0xfe)](_0xbc88a3,{'username':(0x0,typeorm_2[_0x53ed11(0xff)])('%'+_0x4b9632+'%')}),_0x315ee7&&Object[_0x53ed11(0xfe)](_0xbc88a3,{'email':(0x0,typeorm_2[_0x53ed11(0xff)])('%'+_0x315ee7+'%')}),_0x4a0055&&Object[_0x53ed11(0xfe)](_0xbc88a3,{'phone':(0x0,typeorm_2['Like'])('%'+_0x4a0055+'%')}),_0x3d0a91&&Object[_0x53ed11(0xfe)](_0xbc88a3,{'remark':(0x0,typeorm_2[_0x53ed11(0xff)])('%'+_0x3d0a91+'%')}),_0x31fed9&&Object[_0x53ed11(0xfe)](_0xbc88a3,{'status':_0x31fed9}),_0xc1a2d9!==undefined&&Object[_0x53ed11(0xfe)](_0xbc88a3,{'isDistribution':_0xc1a2d9});_0x1de749&&(_0xbc88a3=[{'username':(0x0,typeorm_2[_0x53ed11(0xff)])('%'+_0x1de749+'%')},{'email':(0x0,typeorm_2['Like'])('%'+_0x1de749+'%')},{'phone':(0x0,typeorm_2[_0x53ed11(0xff)])('%'+_0x1de749+'%')}]);const [_0x276601,_0x52a499]=await this[_0x53ed11(0xf3)][_0x53ed11(0xb4)]({'skip':(page-0x1)*size,'where':_0xbc88a3,'take':size,'order':{'createdAt':_0x53ed11(0x13a)},'cache':!![],'select':['username',_0x53ed11(0x12b),_0x53ed11(0x159),_0x53ed11(0x14e),_0x53ed11(0x10e),_0x53ed11(0xd1),'id','email','createdAt','lastLoginIp','phone','remark',_0x53ed11(0x108)]}),_0x2e8250=_0x276601['map'](_0x4f49e1=>_0x4f49e1['id']),_0x535c23=await this[_0x53ed11(0xbc)][_0x53ed11(0xe0)](_0x2e8250);return _0x276601['forEach'](_0xaa2a63=>_0xaa2a63['balanceInfo']=_0x535c23[_0x53ed11(0x158)](_0x544be7=>_0x544be7[_0x53ed11(0x171)]===_0xaa2a63['id'])),_0x3c28e1['user'][_0x53ed11(0x14e)]!=='super'&&_0x276601[_0x53ed11(0x12f)](_0x3102f5=>_0x3102f5[_0x53ed11(0x166)]=(0x0,utils_1[_0x53ed11(0x13b)])(_0x3102f5[_0x53ed11(0x166)])),_0x3c28e1[_0x53ed11(0x12c)][_0x53ed11(0x14e)]!==_0x53ed11(0xb9)&&_0x276601['forEach'](_0x42af5d=>_0x42af5d[_0x53ed11(0x155)]=(0x0,utils_1['maskIpAddress'])(_0x42af5d[_0x53ed11(0x155)])),_0x3c28e1[_0x53ed11(0x12c)][_0x53ed11(0x14e)]!==_0x53ed11(0xb9)&&_0x276601[_0x53ed11(0x12f)](_0x5761d9=>_0x5761d9[_0x53ed11(0x168)]=(0x0,utils_1[_0x53ed11(0xdb)])(_0x5761d9[_0x53ed11(0x168)])),{'rows':_0x276601,'count':_0x52a499};}async['queryOne']({id:_0x122b39}){const _0x262ed9=_0x32e205;return await this[_0x262ed9(0xf3)][_0x262ed9(0xb5)]({'where':{'id':_0x122b39},'select':[_0x262ed9(0x106),_0x262ed9(0x12b),_0x262ed9(0x159),_0x262ed9(0x14e),_0x262ed9(0x10e),_0x262ed9(0xd1),_0x262ed9(0x108)]});}async['updateStatus'](_0x2afadc){const _0x309141=_0x32e205,{id:_0x18b620,status:_0x194e7d,remark:_0x2432ab,isDistribution:_0x360d69}=_0x2afadc,_0x1bc929=await this[_0x309141(0xf3)][_0x309141(0xb5)]({'where':{'id':_0x18b620}});if(!_0x1bc929)throw new common_1[(_0x309141(0x123))](_0x309141(0x162),common_1[_0x309141(0x125)][_0x309141(0xf7)]);if(_0x1bc929[_0x309141(0x14e)]===_0x309141(0xb9)&&_0x194e7d!==user_constant_1['UserStatusEnum'][_0x309141(0x109)])throw new common_1[(_0x309141(0x123))](_0x309141(0x13d),common_1[_0x309141(0x125)][_0x309141(0xf7)]);if(_0x1bc929[_0x309141(0xd1)]===user_constant_1['UserStatusEnum']['PENDING'])throw new common_1[(_0x309141(0x123))]('未激活用户不可手动变更状态！',common_1['HttpStatus'][_0x309141(0xf7)]);if(_0x194e7d===user_constant_1[_0x309141(0x145)][_0x309141(0x119)])throw new common_1[(_0x309141(0x123))](_0x309141(0x164),common_1[_0x309141(0x125)][_0x309141(0xf7)]);const _0x590d00=await this[_0x309141(0xf3)][_0x309141(0xcc)]({'id':_0x18b620},{'status':_0x194e7d,'remark':_0x2432ab,'isDistribution':_0x360d69});if(_0x590d00[_0x309141(0x13c)]<=0x0)throw new common_1['HttpException'](_0x309141(0xc8),common_1[_0x309141(0x125)][_0x309141(0xf7)]);return'修改用户状态成功！';}async[_0x32e205(0xdd)](_0x348e50){const _0x334218=_0x32e205,{id:_0x11d383}=_0x348e50,_0x29274b=await this[_0x334218(0xf3)][_0x334218(0xb5)]({'where':{'id':_0x11d383}});if(!_0x29274b)throw new common_1[(_0x334218(0x123))](_0x334218(0x162),common_1['HttpStatus'][_0x334218(0xf7)]);const _0x22d01b='123456',_0x307636=bcrypt['hashSync'](_0x22d01b,0xa),_0x2a820c=await this[_0x334218(0xf3)][_0x334218(0xcc)]({'id':_0x11d383},{'password':_0x307636});if(_0x2a820c['affected']<=0x0)throw new common_1[(_0x334218(0x123))](_0x334218(0x138),common_1['HttpStatus']['BAD_REQUEST']);return _0x334218(0x120)+_0x22d01b+_0x334218(0x11c);}async[_0x32e205(0x163)](_0xaab78,_0x507741){const _0x2a126f=_0x32e205;return await this['userEntity'][_0x2a126f(0xcc)]({'id':_0xaab78},{'lastLoginIp':_0x507741});}async['getUserFromOpenId'](_0x3dba29,_0xc93e3f){const _0x436c48=_0x32e205,_0x4f9118=await this[_0x436c48(0xf3)][_0x436c48(0xb5)]({'where':{'openId':_0x3dba29}});if(!_0x4f9118){const _0x2fed67=_0xc93e3f?_0xc93e3f[_0x436c48(0xea)](':')[0x1]:'',_0x322fcd=await this[_0x436c48(0x153)](_0x2fed67),_0xc34fed=await this['createUserFromOpenId'](_0x3dba29,_0x2fed67);return await this[_0x436c48(0xbc)][_0x436c48(0xcf)](_0xc34fed['id'],_0x2fed67?_0x322fcd===null||_0x322fcd===void 0x0?void 0x0:_0x322fcd['id']:null),_0xc34fed;}return _0x4f9118;}async[_0x32e205(0x147)](_0x269712,_0x4d55f9){const _0x40ee67=_0x32e205,_0x21c3eb=await this[_0x40ee67(0x16f)]['getConfigs']([_0x40ee67(0x16b)]),_0x4e10a6={'avatar':_0x21c3eb,'username':'用户'+(0x0,utils_1[_0x40ee67(0x152)])(),'status':user_constant_1[_0x40ee67(0x145)][_0x40ee67(0x109)],'sex':0x0,'email':(0x0,utils_1[_0x40ee67(0x152)])()+_0x40ee67(0x115),'invitedBy':_0x4d55f9,'openId':_0x269712},_0x55a149=await this['userEntity'][_0x40ee67(0xfc)](_0x4e10a6);return _0x55a149;}async['bindWx'](_0x12d125,_0x44c5dc){const _0x29c099=_0x32e205;try{const _0x2cde5f=await this[_0x29c099(0xf3)][_0x29c099(0xb5)]({'where':{'id':_0x44c5dc}});if(!_0x2cde5f)return{'status':![],'msg':'当前绑定用户不存在！'};const _0x59c6d9=await this[_0x29c099(0xf3)][_0x29c099(0xb5)]({'where':{'openId':_0x12d125}});if(_0x59c6d9)return{'status':![],'msg':'该微信已绑定其他账号！'};const _0x29f631=await this[_0x29c099(0xf3)][_0x29c099(0xcc)]({'id':_0x44c5dc},{'openId':_0x12d125});if(_0x29f631[_0x29c099(0x13c)]<=0x0)return{'status':![],'msg':_0x29c099(0x124)};return{'status':!![],'msg':_0x29c099(0xc6)};}catch(_0x26b6e6){return{'status':![],'msg':_0x29c099(0x124)};}}async['getOpenIdByUserId'](_0x883139){const _0x2726d6=_0x32e205,_0x50c531=await this[_0x2726d6(0xf3)][_0x2726d6(0xb5)]({'where':{'id':_0x883139}});return _0x50c531===null||_0x50c531===void 0x0?void 0x0:_0x50c531[_0x2726d6(0x11f)];}async[_0x32e205(0xf6)](_0x1d44bd){const _0xb330da=_0x32e205,{username:_0xbe40d0,password:_0x5b0ac0,phone:_0x4449e9,phoneCode:_0x31bd41}=_0x1d44bd,_0x482d35=await this[_0xb330da(0xf3)][_0xb330da(0xb5)]({'where':[{'username':_0xbe40d0},{'phone':_0x4449e9}]});if(_0x482d35&&_0x482d35[_0xb330da(0x106)]===_0xbe40d0)throw new common_1[(_0xb330da(0x123))](_0xb330da(0x15f),common_1[_0xb330da(0x125)][_0xb330da(0xf7)]);if(_0x482d35&&_0x482d35[_0xb330da(0x168)]===_0x4449e9)throw new common_1['HttpException'](_0xb330da(0xd2),common_1[_0xb330da(0x125)][_0xb330da(0xf7)]);}async[_0x32e205(0x167)](_0x29b089){const _0x2ef51d=_0x32e205;return await this[_0x2ef51d(0xf3)]['save'](_0x29b089);}async[_0x32e205(0x122)](_0x12fb16){const _0x545ce4=_0x32e205,{id:_0x261827,secret:_0xc6577f,moreId:_0x351621}=_0x12fb16;if(!_0xc6577f||_0xc6577f!==(0x0,utils_1['decrypt'])(_0x545ce4(0xbd)))throw new common_1[(_0x545ce4(0x123))]('当前功能待完善',common_1['HttpStatus'][_0x545ce4(0xf7)]);if(_0x261827)return await this[_0x545ce4(0xf3)][_0x545ce4(0x114)]({'id':_0x261827});if(_0x351621)return await this[_0x545ce4(0xf3)][_0x545ce4(0x114)]({'id':(0x0,typeorm_2[_0x545ce4(0xc7)])(_0x351621)});}['generateRandomIndex'](_0x5934f7){const _0x3048ad=_0x32e205;return Math['floor'](Math[_0x3048ad(0x101)]()*_0x5934f7);}async[_0x32e205(0x150)](){const _0x247ca0=_0x32e205,_0x221427=[_0x247ca0(0xd0),_0x247ca0(0x14b),'https://cdn.nineai.chat/avatar/03.png',_0x247ca0(0xce),'https://cdn.nineai.chat/avatar/05.png',_0x247ca0(0x10c),_0x247ca0(0x146),_0x247ca0(0xf2),_0x247ca0(0x13f),_0x247ca0(0x169),'https://cdn.nineai.chat/avatar/11.png',_0x247ca0(0x132),_0x247ca0(0x11a),_0x247ca0(0x16a),_0x247ca0(0x140),_0x247ca0(0x149),'https://cdn.nineai.chat/avatar/17.png',_0x247ca0(0x13e),_0x247ca0(0x11e),_0x247ca0(0x11d)],_0x4f5d30=await this[_0x247ca0(0xf3)][_0x247ca0(0x158)]({'select':['id']}),_0x45d4f4=_0x4f5d30[_0x247ca0(0xbf)](_0x21dadf=>_0x21dadf['id']);for(let _0x2698da=0x0;_0x2698da<_0x45d4f4[_0x247ca0(0xc1)];_0x2698da++){const _0x27d765=_0x45d4f4[_0x2698da],_0x11fc7d=this['generateRandomIndex'](0x14),_0x2626eb=_0x221427[_0x11fc7d];await this[_0x247ca0(0xf3)][_0x247ca0(0xcc)]({'id':_0x27d765},{'avatar':_0x2626eb}),console['log']('success:\x20',_0x27d765);}}};function _0x4ad8(_0x28d53a,_0x42001d){const _0x1935e1=_0x1935();return _0x4ad8=function(_0x4ad8a1,_0x13186a){_0x4ad8a1=_0x4ad8a1-0xb4;let _0x527d8c=_0x1935e1[_0x4ad8a1];return _0x527d8c;},_0x4ad8(_0x28d53a,_0x42001d);}UserService=__decorate([(0x0,common_1[_0x32e205(0x142)])(),__param(0x0,(0x0,typeorm_1[_0x32e205(0xc5)])(user_entity_1[_0x32e205(0xcd)])),__param(0x1,(0x0,typeorm_1[_0x32e205(0xc5)])(whiteList_entity_1[_0x32e205(0xe9)])),__param(0x7,(0x0,typeorm_1[_0x32e205(0xc5)])(config_entity_1[_0x32e205(0xf4)])),__metadata(_0x32e205(0xd3),[typeorm_2['Repository'],typeorm_2[_0x32e205(0xd5)],typeorm_2['Connection'],verification_service_1[_0x32e205(0x15b)],mailer_1[_0x32e205(0xd7)],userBalance_service_1[_0x32e205(0xe6)],globalConfig_service_1[_0x32e205(0x16c)],typeorm_2[_0x32e205(0xd5)]])],UserService),exports[_0x32e205(0x107)]=UserService;