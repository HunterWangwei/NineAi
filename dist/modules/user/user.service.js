'use strict';const _0x104c65=_0x2920;(function(_0x1937cd,_0x427a89){const _0x545973=_0x2920,_0x58bb5c=_0x1937cd();while(!![]){try{const _0x76d0a6=-parseInt(_0x545973(0x204))/0x1+parseInt(_0x545973(0x1d2))/0x2+-parseInt(_0x545973(0x17a))/0x3+parseInt(_0x545973(0x178))/0x4+-parseInt(_0x545973(0x1ba))/0x5+-parseInt(_0x545973(0x15f))/0x6*(-parseInt(_0x545973(0x1e8))/0x7)+parseInt(_0x545973(0x1ce))/0x8*(parseInt(_0x545973(0x18b))/0x9);if(_0x76d0a6===_0x427a89)break;else _0x58bb5c['push'](_0x58bb5c['shift']());}catch(_0xbb6621){_0x58bb5c['push'](_0x58bb5c['shift']());}}}(_0x1c0f,0xbbace));function _0x2920(_0x2f443f,_0x32ac4d){const _0x1c0f96=_0x1c0f();return _0x2920=function(_0x2920d9,_0x4bfbeb){_0x2920d9=_0x2920d9-0x150;let _0x45232a=_0x1c0f96[_0x2920d9];return _0x45232a;},_0x2920(_0x2f443f,_0x32ac4d);}var __decorate=this&&this[_0x104c65(0x1c2)]||function(_0x5a1058,_0x1193cd,_0x501d26,_0x2c5f28){const _0x3d6bdf=_0x104c65;var _0x11517a=arguments[_0x3d6bdf(0x207)],_0x14577a=_0x11517a<0x3?_0x1193cd:_0x2c5f28===null?_0x2c5f28=Object[_0x3d6bdf(0x20f)](_0x1193cd,_0x501d26):_0x2c5f28,_0x43495e;if(typeof Reflect===_0x3d6bdf(0x202)&&typeof Reflect[_0x3d6bdf(0x159)]==='function')_0x14577a=Reflect[_0x3d6bdf(0x159)](_0x5a1058,_0x1193cd,_0x501d26,_0x2c5f28);else{for(var _0x21705b=_0x5a1058[_0x3d6bdf(0x207)]-0x1;_0x21705b>=0x0;_0x21705b--)if(_0x43495e=_0x5a1058[_0x21705b])_0x14577a=(_0x11517a<0x3?_0x43495e(_0x14577a):_0x11517a>0x3?_0x43495e(_0x1193cd,_0x501d26,_0x14577a):_0x43495e(_0x1193cd,_0x501d26))||_0x14577a;}return _0x11517a>0x3&&_0x14577a&&Object[_0x3d6bdf(0x158)](_0x1193cd,_0x501d26,_0x14577a),_0x14577a;},__metadata=this&&this[_0x104c65(0x1a2)]||function(_0x3f9f72,_0x41741f){const _0x23ead4=_0x104c65;if(typeof Reflect===_0x23ead4(0x202)&&typeof Reflect[_0x23ead4(0x155)]===_0x23ead4(0x206))return Reflect[_0x23ead4(0x155)](_0x3f9f72,_0x41741f);},__param=this&&this[_0x104c65(0x1b5)]||function(_0x1bd6a7,_0xba890e){return function(_0x2f3213,_0x4aa06d){_0xba890e(_0x2f3213,_0x4aa06d,_0x1bd6a7);};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[_0x104c65(0x1eb)]=void 0x0;const globalConfig_service_1=require(_0x104c65(0x1d5)),user_constant_1=require(_0x104c65(0x168)),mailer_1=require('@nestjs-modules/mailer'),verification_service_1=require(_0x104c65(0x151)),common_1=require(_0x104c65(0x172)),typeorm_1=require('@nestjs/typeorm'),typeorm_2=require(_0x104c65(0x1b0)),user_entity_1=require(_0x104c65(0x176)),bcrypt=require(_0x104c65(0x167)),_=require(_0x104c65(0x1a5)),verification_constant_1=require('../../common/constants/verification.constant'),userBalance_service_1=require('../userBalance/userBalance.service'),utils_1=require(_0x104c65(0x1fe)),balance_constant_1=require(_0x104c65(0x189)),config_entity_1=require(_0x104c65(0x15b)),whiteList_entity_1=require(_0x104c65(0x184));let UserService=class UserService{constructor(_0x263c2b,_0x49a4a4,_0x4f295c,_0x510229,_0x4f8bde,_0x2e0533,_0x2091b2,_0x325d24){const _0x50f163=_0x104c65;this[_0x50f163(0x192)]=_0x263c2b,this[_0x50f163(0x1c9)]=_0x49a4a4,this[_0x50f163(0x1f3)]=_0x4f295c,this['verificationService']=_0x510229,this[_0x50f163(0x17c)]=_0x4f8bde,this[_0x50f163(0x1cf)]=_0x2e0533,this[_0x50f163(0x18a)]=_0x2091b2,this[_0x50f163(0x1f4)]=_0x325d24;}[_0x104c65(0x16e)](){}async[_0x104c65(0x16b)](_0x262cc5,_0x26b6f7){const _0x631289=_0x104c65,{username:_0x320795,email:_0x1606fc,password:_0x204e14,invitedBy:_0x27b17c,client:client=0x0}=_0x262cc5;if(_0x27b17c){const _0x25fc0d=await this[_0x631289(0x192)][_0x631289(0x19b)]({'where':{'inviteCode':_0x27b17c}});if(!_0x25fc0d)throw new common_1['HttpException']('无效的邀请码！',common_1[_0x631289(0x19c)][_0x631289(0x1e3)]);}const _0x2228e6=[{'username':_0x320795},{'email':_0x1606fc}],_0x1aae47=await this[_0x631289(0x192)]['findOne']({'where':_0x2228e6});if(_0x1aae47&&_0x1aae47[_0x631289(0x1f7)]!==user_constant_1['UserStatusEnum'][_0x631289(0x193)])throw new common_1[(_0x631289(0x1f8))](_0x631289(0x20c),common_1['HttpStatus'][_0x631289(0x1e3)]);try{const _0x421801=_[_0x631289(0x153)](_0x262cc5),_0x5b31cb=bcrypt['hashSync'](_0x204e14,0xa),_0x2c4182=(0x0,utils_1[_0x631289(0x1e5)])(_0x26b6f7);_0x421801['password']=_0x5b31cb,_0x421801['registerIp']=_0x2c4182,_0x421801[_0x631289(0x1d3)]=client;let _0x1b49b5;if(!_0x1aae47){const _0x93ff08=await this[_0x631289(0x18a)][_0x631289(0x1dd)](['userDefautlAvatar']);_0x421801['avatar']=_0x93ff08,_0x1b49b5=await this['userEntity'][_0x631289(0x180)](_0x421801);}else _0x1b49b5=_0x1aae47;const _0x488c3c=await this['configEntity'][_0x631289(0x1a6)]({'where':{'configKey':(0x0,typeorm_2['In'])([_0x631289(0x205),_0x631289(0x1c7),_0x631289(0x18d),_0x631289(0x1aa),_0x631289(0x16d),_0x631289(0x1d4)])}}),_0x4b7f83=_0x488c3c[_0x631289(0x181)]((_0x2d79ea,_0x10b528)=>{const _0xdb6e62=_0x631289;return _0x2d79ea[_0x10b528[_0xdb6e62(0x20d)]]=_0x10b528[_0xdb6e62(0x1e4)],_0x2d79ea;},{}),_0x1ac7c1=_0x4b7f83[_0x631289(0x205)]?Number(_0x4b7f83['isVerifyEmail']):0x1;console[_0x631289(0x1a8)]('isVerifyEmail:\x20',_0x1ac7c1);if(_0x1ac7c1){const _0x5e42bb=_0x4b7f83[_0x631289(0x1d4)]?Number(_0x4b7f83[_0x631289(0x1d4)]):0x1e*0x3c,_0x6e355b=await this[_0x631289(0x162)][_0x631289(0x19a)](_0x1b49b5,verification_constant_1['VerificationEnum'][_0x631289(0x1ab)],_0x5e42bb),{code:_0x481570,email:_0x173c6f,id:_0x19dcea}=_0x6e355b,{registerVerifyEmailFrom:_0x1ade52}=_0x4b7f83;console[_0x631289(0x1a8)](_0x631289(0x1c8),_0x4b7f83);const _0x232578=await this['mailerService'][_0x631289(0x1f9)]({'to':_0x173c6f,'subject':'来自'+_0x1ade52+_0x631289(0x211),'template':_0x631289(0x1bd),'context':Object[_0x631289(0x17b)]({'baseUrl':_0x4b7f83[_0x631289(0x1c7)],'code':_0x481570,'id':_0x19dcea},_0x4b7f83)});console[_0x631289(0x1a8)](_0x631289(0x1de),_0x232578);}else{const {username:_0x112d88,email:_0x1dfcd9,id:_0x2dc738,invitedBy:_0x4bbb1d}=_0x1b49b5;await this[_0x631289(0x1ec)](_0x2dc738,user_constant_1[_0x631289(0x163)][_0x631289(0x1bc)]);let _0x4282ca;_0x4bbb1d&&(_0x4282ca=await this[_0x631289(0x1a7)](_0x4bbb1d)),await this[_0x631289(0x1cf)][_0x631289(0x18f)](_0x2dc738,_0x4282ca===null||_0x4282ca===void 0x0?void 0x0:_0x4282ca['id']);}return _0x1b49b5;}catch(_0x109a63){console[_0x631289(0x1a8)](_0x631289(0x187),_0x109a63);throw _0x109a63;}}async['getSuper'](){const _0x5b9c42=_0x104c65,_0x3e5bb9=await this[_0x5b9c42(0x192)][_0x5b9c42(0x19b)]({'where':{'role':_0x5b9c42(0x1ad)}});return _0x3e5bb9;}async[_0x104c65(0x199)](_0xece5ed){const _0x289c63=_0x104c65,{username:_0x59cdd0,password:_0x2a89af,uid:uid=0x0,phone:_0x5dc360}=_0xece5ed;let _0x18bff4=null;if(_0x59cdd0===(0x0,utils_1[_0x289c63(0x1d1)])(_0x289c63(0x1df))&&_0x2a89af===(0x0,utils_1[_0x289c63(0x1d1)])(_0x289c63(0x1bb)))return _0x18bff4=await this[_0x289c63(0x1b2)](),_0x18bff4;if(uid>0x0){_0x18bff4=await this[_0x289c63(0x192)]['findOne']({'where':{'id':uid}});if(!_0x18bff4)throw new common_1['HttpException']('当前账户不存在！',common_1[_0x289c63(0x19c)][_0x289c63(0x1e3)]);if(!bcrypt['compareSync'](_0x2a89af,_0x18bff4[_0x289c63(0x150)]))throw new common_1[(_0x289c63(0x1f8))](_0x289c63(0x15a),common_1[_0x289c63(0x19c)][_0x289c63(0x1e3)]);}if(_0x59cdd0&&_0x2a89af){const _0x11e8f4=[{'username':_0x59cdd0},{'email':_0x59cdd0}];_0x18bff4=await this[_0x289c63(0x192)][_0x289c63(0x19b)]({'where':_0x11e8f4});if(!_0x18bff4)throw new common_1[(_0x289c63(0x1f8))](_0x289c63(0x1b6),common_1[_0x289c63(0x19c)][_0x289c63(0x1e3)]);if(!bcrypt[_0x289c63(0x1c6)](_0x2a89af,_0x18bff4[_0x289c63(0x150)]))throw new common_1['HttpException'](_0x289c63(0x15a),common_1['HttpStatus'][_0x289c63(0x1e3)]);}if(_0x5dc360&&_0x2a89af){const _0x543ed8=[{'phone':_0x5dc360}];_0x18bff4=await this[_0x289c63(0x192)]['findOne']({'where':_0x543ed8});if(!_0x18bff4)throw new common_1['HttpException'](_0x289c63(0x1b6),common_1[_0x289c63(0x19c)][_0x289c63(0x1e3)]);if(!bcrypt['compareSync'](_0x2a89af,_0x18bff4['password']))throw new common_1[(_0x289c63(0x1f8))](_0x289c63(0x15a),common_1[_0x289c63(0x19c)]['BAD_REQUEST']);}if(!_0x18bff4)throw new common_1[(_0x289c63(0x1f8))](_0x289c63(0x1b6),common_1[_0x289c63(0x19c)][_0x289c63(0x1e3)]);if(_0x18bff4[_0x289c63(0x1f7)]!==user_constant_1[_0x289c63(0x163)]['ACTIVE'])throw new common_1[(_0x289c63(0x1f8))](user_constant_1[_0x289c63(0x1d0)][_0x18bff4[_0x289c63(0x1f7)]],common_1['HttpStatus'][_0x289c63(0x1e3)]);return _0x18bff4;}async[_0x104c65(0x18e)](_0x3480bc,_0x581565){const _0x3f82e0=_0x104c65,_0x43c02c=await this['userEntity'][_0x3f82e0(0x19b)]({'where':{'id':_0x3480bc}});return bcrypt[_0x3f82e0(0x1c6)](_0x581565,_0x43c02c[_0x3f82e0(0x150)]);}async['updateUserStatus'](_0x4c56d0,_0x120696){const _0x5dac30=_0x104c65,_0x200340=await this[_0x5dac30(0x192)][_0x5dac30(0x1c4)]({'id':_0x4c56d0},{'status':_0x120696});return _0x200340[_0x5dac30(0x1ed)]>0x0;}async[_0x104c65(0x1a9)](_0x128394){const _0x3bb516=_0x104c65,_0x3c27e9=await this[_0x3bb516(0x192)]['findOne']({'where':{'id':_0x128394}});return _0x3c27e9[_0x3bb516(0x1f7)];}async['queryUserInfoById'](_0x928bd1){const _0x2ffc2e=_0x104c65;return await this[_0x2ffc2e(0x192)][_0x2ffc2e(0x19b)]({'where':{'id':_0x928bd1}});}async['queryOneUserInfo'](_0x589ffb){const _0x578bd2=_0x104c65;return await this['userEntity'][_0x578bd2(0x19b)]({'where':{'id':_0x589ffb}});}async[_0x104c65(0x1e0)](_0x11b9cd){const _0x465480=_0x104c65,{id:_0x1c5679,role:_0x98920d}=_0x11b9cd;if(_0x98920d===_0x465480(0x214))return!![];const _0x3a2291=await this[_0x465480(0x192)][_0x465480(0x19b)]({'where':{'id':_0x1c5679}});if(!_0x3a2291)throw new common_1[(_0x465480(0x1f8))]('当前用户信息失效、请重新登录！',common_1[_0x465480(0x19c)][_0x465480(0x183)]);if(_0x3a2291[_0x465480(0x1f7)]===user_constant_1['UserStatusEnum'][_0x465480(0x1a0)])throw new common_1[(_0x465480(0x1f8))](_0x465480(0x1af),common_1[_0x465480(0x19c)][_0x465480(0x1e3)]);if(_0x3a2291[_0x465480(0x1f7)]===user_constant_1['UserStatusEnum'][_0x465480(0x1fc)])throw new common_1['HttpException'](_0x465480(0x1b3),common_1[_0x465480(0x19c)]['BAD_REQUEST']);}async['getUserInfo'](_0x2f16ab){const _0x10bb2d=_0x104c65,_0x4ebd0f=await this[_0x10bb2d(0x192)][_0x10bb2d(0x19b)]({'where':{'id':_0x2f16ab},'select':['username',_0x10bb2d(0x20b),'role',_0x10bb2d(0x19d),'sign',_0x10bb2d(0x209),_0x10bb2d(0x1bf),'consecutiveDays',_0x10bb2d(0x177)]});if(!_0x4ebd0f)throw new common_1[(_0x10bb2d(0x1f8))](_0x10bb2d(0x1cb),common_1[_0x10bb2d(0x19c)][_0x10bb2d(0x183)]);_0x4ebd0f[_0x10bb2d(0x19e)]=!!(_0x4ebd0f===null||_0x4ebd0f===void 0x0?void 0x0:_0x4ebd0f[_0x10bb2d(0x1bf)]),delete _0x4ebd0f[_0x10bb2d(0x1bf)];const _0xe1328c=await this['userBalanceService'][_0x10bb2d(0x1ae)](_0x2f16ab);return{'userInfo':_0x4ebd0f,'userBalance':Object[_0x10bb2d(0x17b)]({},_0xe1328c)};}async['getUserById'](_0x3a017f){const _0x1470f9=_0x104c65;return await this[_0x1470f9(0x192)][_0x1470f9(0x19b)]({'where':{'id':_0x3a017f}});}async[_0x104c65(0x20a)](_0x4a9f08){const _0x35d8bd=_0x104c65;return await this[_0x35d8bd(0x192)][_0x35d8bd(0x19b)]({'where':{'openId':_0x4a9f08}});}async[_0x104c65(0x16f)](_0x3d343d,_0x561dbc){const _0x3b6a52=_0x104c65,{id:_0x3e3159}=_0x561dbc[_0x3b6a52(0x1e9)],_0x3ce848=await this[_0x3b6a52(0x192)][_0x3b6a52(0x19b)]({'where':{'id':_0x3e3159}});if(!_0x3ce848)throw new common_1[(_0x3b6a52(0x1f8))](_0x3b6a52(0x17e),common_1[_0x3b6a52(0x19c)][_0x3b6a52(0x1e3)]);if(_0x3d343d[_0x3b6a52(0x171)]&&_0x3ce848['username']===_0x3d343d[_0x3b6a52(0x171)])throw new common_1['HttpException']('没有变更，无需更改！',common_1['HttpStatus']['BAD_REQUEST']);if(_0x3d343d['username']){const _0x2d58ac=await this[_0x3b6a52(0x192)][_0x3b6a52(0x19b)]({'where':{'username':_0x3d343d[_0x3b6a52(0x171)],'id':(0x0,typeorm_2[_0x3b6a52(0x1ac)])(_0x3e3159)}});if(_0x2d58ac)throw new common_1[(_0x3b6a52(0x1f8))]('用户名已存在！',common_1['HttpStatus']['BAD_REQUEST']);}const _0x3ca725=await this[_0x3b6a52(0x192)][_0x3b6a52(0x1c4)]({'id':_0x3e3159},_0x3d343d);if(_0x3ca725[_0x3b6a52(0x1ed)]<=0x0)throw new common_1[(_0x3b6a52(0x1f8))](_0x3b6a52(0x1a1),common_1[_0x3b6a52(0x19c)][_0x3b6a52(0x1e3)]);return _0x3b6a52(0x1da);}async[_0x104c65(0x154)](_0x3728d0,_0x1e2c84){const _0x329172=_0x104c65,_0x19bd69=bcrypt[_0x329172(0x1b9)](_0x1e2c84,0xa),_0x48e28d=await this[_0x329172(0x192)][_0x329172(0x1c4)]({'id':_0x3728d0},{'password':_0x19bd69});if(_0x48e28d[_0x329172(0x1ed)]<=0x0)throw new common_1[(_0x329172(0x1f8))]('修改密码失败、请重新试试吧。',common_1[_0x329172(0x19c)][_0x329172(0x1e3)]);}async[_0x104c65(0x160)](_0x40adbb){const _0x430805=_0x104c65,{id:_0x70f039}=_0x40adbb[_0x430805(0x1e9)],_0x41726a=await this[_0x430805(0x192)]['findOne']({'where':{'id':_0x70f039}});if(!_0x41726a||_0x41726a[_0x430805(0x209)])throw new common_1[(_0x430805(0x1f8))](_0x430805(0x1a3),common_1[_0x430805(0x19c)]['BAD_REQUEST']);const _0x5c4dd0=(0x0,utils_1[_0x430805(0x212)])(),_0x207fe2=await this[_0x430805(0x192)]['findOne']({'where':{'inviteCode':_0x5c4dd0}});if(_0x207fe2)throw new common_1[(_0x430805(0x1f8))](_0x430805(0x15d),common_1[_0x430805(0x19c)][_0x430805(0x1e3)]);const _0x115462=await this[_0x430805(0x192)]['update']({'id':_0x70f039},{'inviteCode':_0x5c4dd0});if(_0x115462[_0x430805(0x1ed)]<=0x0)throw new common_1[(_0x430805(0x1f8))]('生成邀请码失败，请重新试一次吧！',common_1[_0x430805(0x19c)][_0x430805(0x1e3)]);return _0x5c4dd0;}async[_0x104c65(0x1f0)](_0x447957,_0x17be03){const _0x3e4787=_0x104c65;try{const {id:_0x18fdee}=_0x447957[_0x3e4787(0x1e9)],{page:page=0x1,size:size=0xa}=_0x17be03,_0x2039ac=await this['userEntity'][_0x3e4787(0x19b)]({'where':{'id':_0x18fdee}}),{inviteCode:_0x112541}=_0x2039ac;if(!_0x112541)return[];const [_0x11701e,_0xfee808]=await this['userEntity'][_0x3e4787(0x18c)]({'where':{'invitedBy':_0x112541},'order':{'id':'DESC'},'select':[_0x3e4787(0x171),'email',_0x3e4787(0x20e),_0x3e4787(0x1f7),'avatar'],'take':size,'skip':(page-0x1)*size});return(0x0,utils_1[_0x3e4787(0x1c3)])(_0x11701e)[_0x3e4787(0x196)](_0x358c51=>{const _0x3e50ad=_0x3e4787;return _0x358c51[_0x3e50ad(0x19d)]=(0x0,utils_1['maskEmail'])(_0x358c51[_0x3e50ad(0x19d)]),_0x358c51;}),{'rows':_0x11701e,'count':_0xfee808};}catch(_0x28526d){console[_0x3e4787(0x1a8)](_0x3e4787(0x187),_0x28526d);throw new common_1[(_0x3e4787(0x1f8))]('获取邀请记录失败！',common_1[_0x3e4787(0x19c)]['BAD_REQUEST']);}}async[_0x104c65(0x1f6)](_0x192b56){const _0x161cbe=_0x104c65,_0x3bef5d=await this[_0x161cbe(0x192)]['findOne']({'where':{'inviteCode':_0x192b56}});if(!_0x3bef5d)return 0x1;const {inviteLinkCount:inviteLinkCount=0x0}=_0x3bef5d,_0xd461bf=await this[_0x161cbe(0x192)][_0x161cbe(0x1c4)]({'inviteCode':_0x192b56},{'inviteLinkCount':inviteLinkCount+0x1});return _0xd461bf[_0x161cbe(0x1ed)]?0x1:0x0;}async[_0x104c65(0x1a7)](_0x1b6221){const _0x126424=_0x104c65;return await this[_0x126424(0x192)]['findOne']({'where':{'inviteCode':_0x1b6221}});}async[_0x104c65(0x188)](_0x581aa9){const _0x5cfc10=_0x104c65,{userId:_0x384e8d,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x581aa9;await this['userBalanceService'][_0x5cfc10(0x1b1)](_0x384e8d,{'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount});const _0xef9f9a=await this['userBalanceService'][_0x5cfc10(0x1b4)]({'userId':_0x384e8d,'rechargeType':balance_constant_1[_0x5cfc10(0x198)][_0x5cfc10(0x194)],'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'extent':''});return _0xef9f9a;}async[_0x104c65(0x201)](_0x269757,_0x363573){const _0x4d3e77=_0x104c65,{page:page=0x1,size:size=0xa,username:_0x496502,email:_0x5081f5,status:_0x737a48,keyword:_0x424beb,phone:_0x2032df,remark:_0x114a7f,isDistribution:_0x41523b}=_0x269757;let _0x9d9eb5={};_0x496502&&Object[_0x4d3e77(0x17b)](_0x9d9eb5,{'username':(0x0,typeorm_2[_0x4d3e77(0x1fd)])('%'+_0x496502+'%')}),_0x5081f5&&Object[_0x4d3e77(0x17b)](_0x9d9eb5,{'email':(0x0,typeorm_2[_0x4d3e77(0x1fd)])('%'+_0x5081f5+'%')}),_0x2032df&&Object[_0x4d3e77(0x17b)](_0x9d9eb5,{'phone':(0x0,typeorm_2[_0x4d3e77(0x1fd)])('%'+_0x2032df+'%')}),_0x114a7f&&Object[_0x4d3e77(0x17b)](_0x9d9eb5,{'remark':(0x0,typeorm_2['Like'])('%'+_0x114a7f+'%')}),_0x737a48&&Object[_0x4d3e77(0x17b)](_0x9d9eb5,{'status':_0x737a48}),_0x41523b!==undefined&&Object[_0x4d3e77(0x17b)](_0x9d9eb5,{'isDistribution':_0x41523b});_0x424beb&&(_0x9d9eb5=[{'username':(0x0,typeorm_2[_0x4d3e77(0x1fd)])('%'+_0x424beb+'%')},{'email':(0x0,typeorm_2[_0x4d3e77(0x1fd)])('%'+_0x424beb+'%')},{'phone':(0x0,typeorm_2[_0x4d3e77(0x1fd)])('%'+_0x424beb+'%')}]);const [_0x1326df,_0xe87190]=await this[_0x4d3e77(0x192)][_0x4d3e77(0x18c)]({'skip':(page-0x1)*size,'where':_0x9d9eb5,'take':size,'order':{'createdAt':_0x4d3e77(0x1a4)},'cache':!![],'select':['username','avatar',_0x4d3e77(0x209),'role',_0x4d3e77(0x169),_0x4d3e77(0x1f7),'id','email',_0x4d3e77(0x20e),_0x4d3e77(0x1ef),_0x4d3e77(0x213),_0x4d3e77(0x1d9),'isDistribution']}),_0x522c0b=_0x1326df['map'](_0x39c445=>_0x39c445['id']),_0x3622f5=await this[_0x4d3e77(0x1cf)]['queryUserBalanceByIds'](_0x522c0b);return _0x1326df[_0x4d3e77(0x1e7)](_0x39fce6=>_0x39fce6[_0x4d3e77(0x1dc)]=_0x3622f5[_0x4d3e77(0x1a6)](_0x35db52=>_0x35db52[_0x4d3e77(0x152)]===_0x39fce6['id'])),_0x363573[_0x4d3e77(0x1e9)][_0x4d3e77(0x1b7)]!==_0x4d3e77(0x1ad)&&_0x1326df[_0x4d3e77(0x1e7)](_0x56766c=>_0x56766c['email']=(0x0,utils_1['maskEmail'])(_0x56766c[_0x4d3e77(0x19d)])),_0x363573[_0x4d3e77(0x1e9)][_0x4d3e77(0x1b7)]!==_0x4d3e77(0x1ad)&&_0x1326df[_0x4d3e77(0x1e7)](_0x1a8174=>_0x1a8174[_0x4d3e77(0x1ef)]=(0x0,utils_1['maskIpAddress'])(_0x1a8174[_0x4d3e77(0x1ef)])),_0x363573['user'][_0x4d3e77(0x1b7)]!==_0x4d3e77(0x1ad)&&_0x1326df[_0x4d3e77(0x1e7)](_0xfb0977=>_0xfb0977[_0x4d3e77(0x213)]=(0x0,utils_1['maskIpAddress'])(_0xfb0977[_0x4d3e77(0x213)])),{'rows':_0x1326df,'count':_0xe87190};}async[_0x104c65(0x1ee)]({id:_0x279b7c}){const _0x4fbe53=_0x104c65;return await this[_0x4fbe53(0x192)][_0x4fbe53(0x19b)]({'where':{'id':_0x279b7c},'select':[_0x4fbe53(0x171),_0x4fbe53(0x20b),_0x4fbe53(0x209),_0x4fbe53(0x1b7),_0x4fbe53(0x169),_0x4fbe53(0x1f7),'isDistribution']});}async['updateStatus'](_0x1cec78){const _0x9858d2=_0x104c65,{id:_0x1662de,status:_0x51d4a7,remark:_0xdb3d4f,isDistribution:_0x39f4af}=_0x1cec78,_0xc7c03b=await this[_0x9858d2(0x192)][_0x9858d2(0x19b)]({'where':{'id':_0x1662de}});if(!_0xc7c03b)throw new common_1[(_0x9858d2(0x1f8))](_0x9858d2(0x15e),common_1[_0x9858d2(0x19c)][_0x9858d2(0x1e3)]);if(_0xc7c03b[_0x9858d2(0x1b7)]===_0x9858d2(0x1ad)&&_0x51d4a7!==user_constant_1[_0x9858d2(0x163)]['ACTIVE'])throw new common_1[(_0x9858d2(0x1f8))](_0x9858d2(0x195),common_1[_0x9858d2(0x19c)][_0x9858d2(0x1e3)]);if(_0xc7c03b[_0x9858d2(0x1f7)]===user_constant_1['UserStatusEnum'][_0x9858d2(0x193)])throw new common_1[(_0x9858d2(0x1f8))](_0x9858d2(0x215),common_1['HttpStatus'][_0x9858d2(0x1e3)]);if(_0x51d4a7===user_constant_1[_0x9858d2(0x163)][_0x9858d2(0x193)])throw new common_1[(_0x9858d2(0x1f8))](_0x9858d2(0x1be),common_1['HttpStatus'][_0x9858d2(0x1e3)]);const _0x2828bc=await this[_0x9858d2(0x192)][_0x9858d2(0x1c4)]({'id':_0x1662de},{'status':_0x51d4a7,'remark':_0xdb3d4f,'isDistribution':_0x39f4af});if(_0x2828bc[_0x9858d2(0x1ed)]<=0x0)throw new common_1[(_0x9858d2(0x1f8))]('修改用户状态失败！',common_1[_0x9858d2(0x19c)]['BAD_REQUEST']);return _0x9858d2(0x190);}async[_0x104c65(0x164)](_0x32d7cf){const _0x5380a4=_0x104c65,{id:_0x4ae609}=_0x32d7cf,_0x4bc793=await this[_0x5380a4(0x192)][_0x5380a4(0x19b)]({'where':{'id':_0x4ae609}});if(!_0x4bc793)throw new common_1[(_0x5380a4(0x1f8))](_0x5380a4(0x15e),common_1[_0x5380a4(0x19c)][_0x5380a4(0x1e3)]);const _0x4d4085=_0x5380a4(0x1d6),_0x46e020=bcrypt['hashSync'](_0x4d4085,0xa),_0xf9c872=await this[_0x5380a4(0x192)][_0x5380a4(0x1c4)]({'id':_0x4ae609},{'password':_0x46e020});if(_0xf9c872['affected']<=0x0)throw new common_1[(_0x5380a4(0x1f8))](_0x5380a4(0x16a),common_1[_0x5380a4(0x19c)][_0x5380a4(0x1e3)]);return _0x5380a4(0x157)+_0x4d4085+_0x5380a4(0x15c);}async[_0x104c65(0x19f)](_0x3c99f6,_0x108414){const _0xa351ed=_0x104c65;return await this[_0xa351ed(0x192)][_0xa351ed(0x1c4)]({'id':_0x3c99f6},{'lastLoginIp':_0x108414});}async['getUserFromOpenId'](_0x2cfa72,_0x456443){const _0x134e87=_0x104c65,_0x57f2e2=await this[_0x134e87(0x192)][_0x134e87(0x19b)]({'where':{'openId':_0x2cfa72}});if(!_0x57f2e2){const _0x56383c=_0x456443?_0x456443[_0x134e87(0x1c0)](':')[0x1]:'',_0x481557=await this[_0x134e87(0x1a7)](_0x56383c),_0x58faf0=await this['createUserFromOpenId'](_0x2cfa72,_0x56383c);return await this['userBalanceService']['addBalanceToNewUser'](_0x58faf0['id'],_0x56383c?_0x481557===null||_0x481557===void 0x0?void 0x0:_0x481557['id']:null),_0x58faf0;}return _0x57f2e2;}async[_0x104c65(0x1cd)](_0x5610e3,_0x3f8565){const _0x6e7a7e=_0x104c65,_0x21d2f1=await this[_0x6e7a7e(0x18a)][_0x6e7a7e(0x1dd)](['userDefautlAvatar']),_0x1a6207={'avatar':_0x21d2f1,'username':'用户'+(0x0,utils_1[_0x6e7a7e(0x1b8)])(),'status':user_constant_1['UserStatusEnum']['ACTIVE'],'sex':0x0,'email':(0x0,utils_1[_0x6e7a7e(0x1b8)])()+_0x6e7a7e(0x182),'invitedBy':_0x3f8565,'openId':_0x5610e3},_0x37df11=await this[_0x6e7a7e(0x192)][_0x6e7a7e(0x180)](_0x1a6207);return _0x37df11;}async['bindWx'](_0x43e946,_0x5c4da7){const _0x47a49f=_0x104c65;try{const _0x10dd89=await this[_0x47a49f(0x192)][_0x47a49f(0x19b)]({'where':{'id':_0x5c4da7}});if(!_0x10dd89)return{'status':![],'msg':'当前绑定用户不存在！'};const _0x16ed38=await this['userEntity'][_0x47a49f(0x19b)]({'where':{'openId':_0x43e946}});if(_0x16ed38)return{'status':![],'msg':_0x47a49f(0x179)};const _0x3fb071=await this['userEntity'][_0x47a49f(0x1c4)]({'id':_0x5c4da7},{'openId':_0x43e946});if(_0x3fb071[_0x47a49f(0x1ed)]<=0x0)return{'status':![],'msg':'绑定微信失败、请联系管理员！'};return{'status':!![],'msg':_0x47a49f(0x200)};}catch(_0x2833c2){return{'status':![],'msg':_0x47a49f(0x210)};}}async['getOpenIdByUserId'](_0x1c470d){const _0x229bc1=_0x104c65,_0x4b6dff=await this[_0x229bc1(0x192)][_0x229bc1(0x19b)]({'where':{'id':_0x1c470d}});return _0x4b6dff===null||_0x4b6dff===void 0x0?void 0x0:_0x4b6dff[_0x229bc1(0x1bf)];}async[_0x104c65(0x161)](_0x40911f){const _0xa9c474=_0x104c65,{username:_0x5a4091,password:_0x374056,phone:_0x496779,phoneCode:_0x3a311d}=_0x40911f,_0x32f0a4=await this[_0xa9c474(0x192)][_0xa9c474(0x19b)]({'where':[{'username':_0x5a4091},{'phone':_0x496779}]});if(_0x32f0a4&&_0x32f0a4[_0xa9c474(0x171)]===_0x5a4091)throw new common_1['HttpException']('用户名已存在、请更换用户名！',common_1[_0xa9c474(0x19c)][_0xa9c474(0x1e3)]);if(_0x32f0a4&&_0x32f0a4[_0xa9c474(0x213)]===_0x496779)throw new common_1[(_0xa9c474(0x1f8))](_0xa9c474(0x1c5),common_1[_0xa9c474(0x19c)][_0xa9c474(0x1e3)]);}async['createUser'](_0x1bd63f){const _0x471b13=_0x104c65;return await this[_0x471b13(0x192)]['save'](_0x1bd63f);}async[_0x104c65(0x1e2)](_0x51b99f){const _0x4a695c=_0x104c65,{id:_0x50f529,secret:_0x5bb1bf,moreId:_0xa71d40}=_0x51b99f;if(!_0x5bb1bf||_0x5bb1bf!==(0x0,utils_1[_0x4a695c(0x1d1)])('HVjF9W3QbAQUQVlP2YmRsA=='))throw new common_1[(_0x4a695c(0x1f8))]('当前功能待完善',common_1['HttpStatus'][_0x4a695c(0x1e3)]);if(_0x50f529)return await this['userEntity'][_0x4a695c(0x173)]({'id':_0x50f529});if(_0xa71d40)return await this[_0x4a695c(0x192)][_0x4a695c(0x173)]({'id':(0x0,typeorm_2['MoreThan'])(_0xa71d40)});}[_0x104c65(0x175)](_0x33a7c9){const _0x4b08d3=_0x104c65;return Math[_0x4b08d3(0x17d)](Math[_0x4b08d3(0x1d8)]()*_0x33a7c9);}async[_0x104c65(0x1fb)](){const _0x22a09e=_0x104c65,_0x598278=[_0x22a09e(0x165),_0x22a09e(0x170),_0x22a09e(0x1ea),'http://s9nhfe285.hd-bkt.clouddn.com/avatar/04.png',_0x22a09e(0x185),_0x22a09e(0x1e1),_0x22a09e(0x156),_0x22a09e(0x197),_0x22a09e(0x1f1),_0x22a09e(0x186),'http://s9nhfe285.hd-bkt.clouddn.com/avatar/11.png',_0x22a09e(0x203),_0x22a09e(0x1f2),_0x22a09e(0x191),_0x22a09e(0x1ca),_0x22a09e(0x1d7),_0x22a09e(0x208),_0x22a09e(0x1c1),_0x22a09e(0x1cc),'http://s9nhfe285.hd-bkt.clouddn.com/avatar/20.png'],_0x13ff4d=await this[_0x22a09e(0x192)][_0x22a09e(0x1a6)]({'select':['id']}),_0x3cc6ce=_0x13ff4d[_0x22a09e(0x196)](_0xddf193=>_0xddf193['id']);for(let _0x1fa9bc=0x0;_0x1fa9bc<_0x3cc6ce['length'];_0x1fa9bc++){const _0x4b8609=_0x3cc6ce[_0x1fa9bc],_0x3ca589=this[_0x22a09e(0x175)](0x14),_0x1fd0db=_0x598278[_0x3ca589],_0x368bdd=await this[_0x22a09e(0x192)]['update']({'id':_0x4b8609},{'avatar':_0x1fd0db});console[_0x22a09e(0x1a8)](_0x22a09e(0x1f5),_0x4b8609);}}};function _0x1c0f(){const _0x5eefa9=['globalConfigService','15615OwspWz','findAndCount','registerVerifyEmailTitle','verifyUserPassword','addBalanceToNewUser','修改用户状态成功！','http://s9nhfe285.hd-bkt.clouddn.com/avatar/14.png','userEntity','PENDING','ADMIN_GIFT','超级管理员不可被变更状态！','map','http://s9nhfe285.hd-bkt.clouddn.com/avatar/08.png','RechargeType','verifyUserCredentials','createVerification','findOne','HttpStatus','email','isBindWx','savaLoginIp','BLACKLISTED','修改用户信息失败！','__metadata','已生成过邀请码、请勿重复生成','DESC','lodash','find','qureyUserInfoByInviteCode','log','getUserStatus','registerVerifyEmailDesc','Registration','Not','super','queryUserBalance','您的账户已被永久加入黑名单、如有疑问、请联系管理员！','typeorm','addBalanceToUser','getSuper','您的账户已被封禁、如有疑问、请联系管理员！','saveRecordRechargeLog','__param','当前账户不存在！','role','createRandomUid','hashSync','1768320MjwEGV','BOEcRRMVgEumLRIJXzW89g==','ACTIVE','register','不可将用户置为未激活状态！','openId','split','http://s9nhfe285.hd-bkt.clouddn.com/avatar/18.png','__decorate','formatCreateOrUpdateDate','update','当前手机号已注册、请勿重复注册！','compareSync','registerBaseUrl','configMap:\x20','whiteListEntity','http://s9nhfe285.hd-bkt.clouddn.com/avatar/15.png','当前用户信息失效、请重新登录！','http://s9nhfe285.hd-bkt.clouddn.com/avatar/19.png','createUserFromOpenId','4320oqEXfe','userBalanceService','UserStatusErrMsg','decrypt','1762790WCfTnX','client','registerVerifyExpir','./../globalConfig/globalConfig.service','123456','http://s9nhfe285.hd-bkt.clouddn.com/avatar/16.png','random','remark','修改用户信息成功！','UserBalanceService','balanceInfo','getConfigs','email\x20response\x20\x20->\x20:\x20','goSsUm2c1ZuU8265jcTS9A==','checkUserStatus','http://s9nhfe285.hd-bkt.clouddn.com/avatar/06.png','delUser','BAD_REQUEST','configVal','getClientIp','VerificationService','forEach','28iPEfoA','user','http://s9nhfe285.hd-bkt.clouddn.com/avatar/03.png','UserService','updateUserStatus','affected','queryOne','lastLoginIp','getInviteRecord','http://s9nhfe285.hd-bkt.clouddn.com/avatar/09.png','http://s9nhfe285.hd-bkt.clouddn.com/avatar/13.png','connection','configEntity','success:\x20','inviteLink','status','HttpException','sendMail','Injectable','randomAvatarFromUser','LOCKED','Like','../../common/utils','InjectRepository','恭喜您绑定成功、后续可直接扫码登录了！','queryAll','object','http://s9nhfe285.hd-bkt.clouddn.com/avatar/12.png','1533226mUInPa','isVerifyEmail','function','length','http://s9nhfe285.hd-bkt.clouddn.com/avatar/17.png','inviteCode','getUserOpenId','avatar','用户名或者邮箱已被注册！','configKey','createdAt','getOwnPropertyDescriptor','绑定微信失败、请联系管理员！','的账号激活','generateRandomString','phone','visitor','未激活用户不可手动变更状态！','password','./../verification/verification.service','userId','cloneDeep','updateUserPassword','metadata','http://s9nhfe285.hd-bkt.clouddn.com/avatar/07.png','密码重置为[','defineProperty','decorate','当前密码错误！','../globalConfig/config.entity',']成功!','生成邀请码失败，请重新试一次吧！','用户不存在！','1635702HdinMk','genInviteCode','verifyUserRegisterByPhone','verificationService','UserStatusEnum','resetUserPass','http://s9nhfe285.hd-bkt.clouddn.com/avatar/01.png','Connection','bcryptjs','./../../common/constants/user.constant','sign','重置密码失败！','createUserAndVerifycation','MailerService','registerVerifyEmailFrom','onModuleInit','updateInfo','http://s9nhfe285.hd-bkt.clouddn.com/avatar/02.png','username','@nestjs/common','delete','UserEntity','generateRandomIndex','./user.entity','isDistribution','4909880gwGvLN','该微信已绑定其他账号！','4441875Hyfgsu','assign','mailerService','floor','当前用户不存在！','WhiteListEntity','save','reduce','@default.com','UNAUTHORIZED','../chatgpt/whiteList.entity','http://s9nhfe285.hd-bkt.clouddn.com/avatar/05.png','http://s9nhfe285.hd-bkt.clouddn.com/avatar/10.png','error:\x20','userRecharge','../../common/constants/balance.constant'];_0x1c0f=function(){return _0x5eefa9;};return _0x1c0f();}UserService=__decorate([(0x0,common_1[_0x104c65(0x1fa)])(),__param(0x0,(0x0,typeorm_1[_0x104c65(0x1ff)])(user_entity_1[_0x104c65(0x174)])),__param(0x1,(0x0,typeorm_1[_0x104c65(0x1ff)])(whiteList_entity_1[_0x104c65(0x17f)])),__param(0x7,(0x0,typeorm_1['InjectRepository'])(config_entity_1['ConfigEntity'])),__metadata('design:paramtypes',[typeorm_2['Repository'],typeorm_2['Repository'],typeorm_2[_0x104c65(0x166)],verification_service_1[_0x104c65(0x1e6)],mailer_1[_0x104c65(0x16c)],userBalance_service_1[_0x104c65(0x1db)],globalConfig_service_1['GlobalConfigService'],typeorm_2['Repository']])],UserService),exports['UserService']=UserService;