'use strict';const _0x140985=_0x31d4;(function(_0x1db023,_0x365dc1){const _0x3dcf18=_0x31d4,_0x204477=_0x1db023();while(!![]){try{const _0x487783=-parseInt(_0x3dcf18(0x142))/0x1+-parseInt(_0x3dcf18(0x1a3))/0x2+parseInt(_0x3dcf18(0x153))/0x3*(parseInt(_0x3dcf18(0x17b))/0x4)+-parseInt(_0x3dcf18(0x13b))/0x5*(-parseInt(_0x3dcf18(0x158))/0x6)+-parseInt(_0x3dcf18(0x161))/0x7*(parseInt(_0x3dcf18(0x1b2))/0x8)+-parseInt(_0x3dcf18(0x13e))/0x9+-parseInt(_0x3dcf18(0x160))/0xa*(parseInt(_0x3dcf18(0x125))/0xb);if(_0x487783===_0x365dc1)break;else _0x204477['push'](_0x204477['shift']());}catch(_0x20fa48){_0x204477['push'](_0x204477['shift']());}}}(_0x6d7b,0xde1b8));var __decorate=this&&this[_0x140985(0x194)]||function(_0x3cd02a,_0x12ec3c,_0x83cf07,_0x29555b){const _0x12e4f7=_0x140985;var _0x59d685=arguments[_0x12e4f7(0x184)],_0x5896c1=_0x59d685<0x3?_0x12ec3c:_0x29555b===null?_0x29555b=Object[_0x12e4f7(0x176)](_0x12ec3c,_0x83cf07):_0x29555b,_0x3f19cc;if(typeof Reflect==='object'&&typeof Reflect['decorate']==='function')_0x5896c1=Reflect['decorate'](_0x3cd02a,_0x12ec3c,_0x83cf07,_0x29555b);else{for(var _0x3e8432=_0x3cd02a['length']-0x1;_0x3e8432>=0x0;_0x3e8432--)if(_0x3f19cc=_0x3cd02a[_0x3e8432])_0x5896c1=(_0x59d685<0x3?_0x3f19cc(_0x5896c1):_0x59d685>0x3?_0x3f19cc(_0x12ec3c,_0x83cf07,_0x5896c1):_0x3f19cc(_0x12ec3c,_0x83cf07))||_0x5896c1;}return _0x59d685>0x3&&_0x5896c1&&Object[_0x12e4f7(0x190)](_0x12ec3c,_0x83cf07,_0x5896c1),_0x5896c1;},__metadata=this&&this[_0x140985(0x19d)]||function(_0x59a8ca,_0x754765){const _0xcd8a47=_0x140985;if(typeof Reflect===_0xcd8a47(0x16b)&&typeof Reflect['metadata']===_0xcd8a47(0x175))return Reflect[_0xcd8a47(0x1ca)](_0x59a8ca,_0x754765);},__param=this&&this[_0x140985(0x1a0)]||function(_0x4fa67c,_0x28dfd7){return function(_0x198623,_0x1582d0){_0x28dfd7(_0x198623,_0x1582d0,_0x4fa67c);};};Object[_0x140985(0x190)](exports,_0x140985(0x162),{'value':!![]}),exports[_0x140985(0x14d)]=void 0x0;const typeorm_1=require(_0x140985(0x196)),typeorm_2=require('typeorm'),common_1=require('@nestjs/common'),crypto=require('crypto'),axios_1=require('axios'),order_entity_1=require(_0x140985(0x14f)),cramiPackage_entity_1=require('../crami/cramiPackage.entity'),userBalance_service_1=require(_0x140985(0x149)),globalConfig_service_1=require('../globalConfig/globalConfig.service'),utils_1=require(_0x140985(0x17a)),user_service_1=require(_0x140985(0x131));let PayService=class PayService{constructor(_0x451137,_0x169bcf,_0xc074,_0x32315c,_0x18fe6c){const _0x2ff0cd=_0x140985;this[_0x2ff0cd(0x1af)]=_0x451137,this['orderEntity']=_0x169bcf,this[_0x2ff0cd(0x12d)]=_0xc074,this['globalConfigService']=_0x32315c,this['userService']=_0x18fe6c;}async[_0x140985(0x18e)](){const _0xfe18e2=_0x140985,_0xef974f=await(0x0,utils_1['importDynamic'])('wechatpay-node-v3');this['WxPay']=(_0xef974f===null||_0xef974f===void 0x0?void 0x0:_0xef974f['default'])?_0xef974f[_0xfe18e2(0x17f)]:_0xef974f;}async['notify'](_0x577571){const _0x397733=_0x140985;if(_0x577571[_0x397733(0x151)]==_0x397733(0x1a7))return this['notifyEpay'](_0x577571);if(_0x577571[_0x397733(0x13c)]==_0x397733(0x173))return this[_0x397733(0x170)](_0x577571);if(typeof _0x577571[_0x397733(0x14b)]==_0x397733(0x16b))return this[_0x397733(0x14a)](_0x577571);return this[_0x397733(0x14e)](_0x577571);}async[_0x140985(0x138)](_0x78ead7,_0x16c254,_0x19068c=_0x140985(0x16c)){const _0x4d0642=_0x140985,_0x57901c=await this[_0x4d0642(0x17c)][_0x4d0642(0x1b9)]({'where':{'userId':_0x78ead7,'orderId':_0x16c254}});if(!_0x57901c)throw new common_1['HttpException'](_0x4d0642(0x133),common_1['HttpStatus']['BAD_REQUEST']);const _0x550788=await this['cramiPackageEntity'][_0x4d0642(0x1b9)]({'where':{'id':_0x57901c[_0x4d0642(0x152)]}});if(!_0x550788)throw new common_1[(_0x4d0642(0x11f))](_0x4d0642(0x16d),common_1[_0x4d0642(0x178)][_0x4d0642(0x18a)]);try{if(_0x57901c[_0x4d0642(0x159)]==_0x4d0642(0x168))return this[_0x4d0642(0x1bd)](_0x78ead7,_0x16c254,_0x19068c);if(_0x57901c[_0x4d0642(0x159)]==_0x4d0642(0x1a7))return this[_0x4d0642(0x1c1)](_0x78ead7,_0x16c254,_0x19068c);if(_0x57901c[_0x4d0642(0x159)]==_0x4d0642(0x1b6))return this['payMpay'](_0x78ead7,_0x16c254,_0x19068c);if(_0x57901c[_0x4d0642(0x159)]==_0x4d0642(0x173))return this[_0x4d0642(0x16a)](_0x78ead7,_0x16c254,_0x19068c);}catch(_0x28061c){console['log'](_0x4d0642(0x1c9),_0x28061c);throw new common_1[(_0x4d0642(0x11f))](_0x4d0642(0x157),common_1[_0x4d0642(0x178)][_0x4d0642(0x18a)]);}}async[_0x140985(0x15e)](_0x2d0066){const _0xc0bc5e=_0x140985,_0x56a2fe=await this[_0xc0bc5e(0x17c)][_0xc0bc5e(0x1b9)]({'where':{'orderId':_0x2d0066}});if(!_0x56a2fe)throw new common_1[(_0xc0bc5e(0x11f))](_0xc0bc5e(0x133),common_1[_0xc0bc5e(0x178)][_0xc0bc5e(0x18a)]);return _0x56a2fe;}async['notifyHupi'](_0x15fe3e){const _0x189ae1=_0x140985,_0x28d537=await this[_0x189ae1(0x1b3)][_0x189ae1(0x181)](['payHupiSecret']),_0x17d07f=_0x15fe3e['hash'];delete _0x15fe3e[_0x189ae1(0x1b0)];if(this['sign'](_0x15fe3e,_0x28d537)!=_0x17d07f)return _0x189ae1(0x1c7);const _0x32bfcd=await this[_0x189ae1(0x17c)]['findOne']({'where':{'orderId':_0x15fe3e['trade_order_id'],'status':0x0}});if(!_0x32bfcd)return _0x189ae1(0x1c7);await this[_0x189ae1(0x12d)][_0x189ae1(0x155)](_0x32bfcd);const _0x2dd55b=await this['orderEntity']['update']({'orderId':_0x15fe3e[_0x189ae1(0x150)]},{'status':0x1,'paydAt':new Date()});if(_0x2dd55b[_0x189ae1(0x171)]!=0x1)return'failed';return _0x189ae1(0x186);}async[_0x140985(0x16a)](_0x418fa1,_0x531b0f,_0x1b0b9b=_0x140985(0x16c)){const _0x351353=_0x140985,_0x3a40a0=await this[_0x351353(0x17c)][_0x351353(0x1b9)]({'where':{'userId':_0x418fa1,'orderId':_0x531b0f}});if(!_0x3a40a0)throw new common_1['HttpException']('订单不存在!',common_1[_0x351353(0x178)][_0x351353(0x18a)]);const _0x4a1895=await this[_0x351353(0x1af)][_0x351353(0x1b9)]({'where':{'id':_0x3a40a0[_0x351353(0x152)]}});if(!_0x4a1895)throw new common_1[(_0x351353(0x11f))](_0x351353(0x16d),common_1['HttpStatus'][_0x351353(0x18a)]);const {payHupiAppId:_0x3549c0,payHupiSecret:_0x5943d4,payHupiNotifyUrl:_0x2a1de0,payHupiReturnUrl:_0x321c93,payHupiGatewayUrl:_0xa3710f}=await this[_0x351353(0x1b3)][_0x351353(0x181)]([_0x351353(0x145),_0x351353(0x19c),_0x351353(0x1be),_0x351353(0x19f),_0x351353(0x189)]),_0x11ec8a={};_0x11ec8a['version']=_0x351353(0x182),_0x11ec8a['appid']=_0x3549c0,_0x11ec8a[_0x351353(0x179)]=(Date[_0x351353(0x1a6)]()/0x3e8)[_0x351353(0x163)](0x0),_0x11ec8a[_0x351353(0x16f)]=(0x0,utils_1[_0x351353(0x1bb)])(0x20),_0x11ec8a['trade_order_id']=_0x531b0f,_0x11ec8a['title']=_0x4a1895[_0x351353(0x15a)],_0x11ec8a['total_fee']=_0x3a40a0['total'],_0x11ec8a[_0x351353(0x1c2)]=_0x2a1de0,_0x11ec8a['return_url']=_0x321c93,_0x11ec8a[_0x351353(0x13c)]=_0x351353(0x173),_0x11ec8a[_0x351353(0x1b0)]=this[_0x351353(0x15f)](_0x11ec8a,_0x5943d4);const {data:{errcode:_0x22a805,errmsg:_0x3b0e20,url_qrcode:_0x2b896e,url:_0x3a81c7}}=await axios_1[_0x351353(0x17f)][_0x351353(0x147)](_0xa3710f||'https://api.xunhupay.com/payment/do.html',_0x11ec8a);if(_0x22a805!=0x0)throw new common_1[(_0x351353(0x11f))](_0x3b0e20,common_1[_0x351353(0x178)][_0x351353(0x18a)]);return{'url_qrcode':_0x2b896e,'url':_0x3a81c7};}async[_0x140985(0x198)](_0x389996){const _0x15333e=_0x140985,{payHupiAppId:_0x17580d,payHupiSecret:_0x853be0}=await this['globalConfigService'][_0x15333e(0x181)]([_0x15333e(0x145),'payHupiSecret']),_0x21d231={};_0x21d231[_0x15333e(0x1c8)]='1.1',_0x21d231['appid']=_0x17580d,_0x21d231[_0x15333e(0x179)]=(Date[_0x15333e(0x1a6)]()/0x3e8)[_0x15333e(0x163)](0x0),_0x21d231[_0x15333e(0x16f)]=(0x0,utils_1[_0x15333e(0x1bb)])(0x20),_0x21d231[_0x15333e(0x18b)]=_0x389996,_0x21d231[_0x15333e(0x1b0)]=this['sign'](_0x21d231,_0x853be0);const {data:{errcode:_0x2c94ec,errmsg:_0x9f00cc,data:_0x416532}}=await axios_1[_0x15333e(0x17f)][_0x15333e(0x147)](_0x15333e(0x154),_0x21d231);if(_0x2c94ec!=0x0)throw new common_1['HttpException'](_0x9f00cc,common_1[_0x15333e(0x178)][_0x15333e(0x18a)]);return _0x416532;}async[_0x140985(0x1bc)](_0x57bd2a){const _0x32e6bf=_0x140985,_0x508dd2=_0x57bd2a[_0x32e6bf(0x15f)];delete _0x57bd2a[_0x32e6bf(0x15f)],delete _0x57bd2a[_0x32e6bf(0x12b)];const _0x4dc372=await this['globalConfigService']['getConfigs']([_0x32e6bf(0x128)]);if(this['sign'](_0x57bd2a,_0x4dc372)!=_0x508dd2)return _0x32e6bf(0x1c7);const _0x4217c4=await this[_0x32e6bf(0x17c)][_0x32e6bf(0x1b9)]({'where':{'orderId':_0x57bd2a['out_trade_no'],'status':0x0}});if(!_0x4217c4)return _0x32e6bf(0x1c7);const _0x1e3fb3=_0x57bd2a[_0x32e6bf(0x195)]==_0x32e6bf(0x165)?0x1:0x2,_0x26fcd8=await this[_0x32e6bf(0x17c)][_0x32e6bf(0x14c)]({'orderId':_0x57bd2a[_0x32e6bf(0x1a8)]},{'status':_0x1e3fb3,'paydAt':new Date()});_0x1e3fb3===0x1&&await this['userBalanceService'][_0x32e6bf(0x155)](_0x4217c4);if(_0x26fcd8[_0x32e6bf(0x171)]!=0x1)return _0x32e6bf(0x1c7);return'success';}async[_0x140985(0x1c1)](_0x1fef19,_0x1c40cc,_0x5860b5='alipay'){const _0x1ff232=_0x140985,_0x35db77=await this[_0x1ff232(0x17c)][_0x1ff232(0x1b9)]({'where':{'userId':_0x1fef19,'orderId':_0x1c40cc}});if(!_0x35db77)throw new common_1[(_0x1ff232(0x11f))](_0x1ff232(0x133),common_1[_0x1ff232(0x178)][_0x1ff232(0x18a)]);const _0xf37006=await this[_0x1ff232(0x1af)][_0x1ff232(0x1b9)]({'where':{'id':_0x35db77[_0x1ff232(0x152)]}});if(!_0xf37006)throw new common_1[(_0x1ff232(0x11f))]('套餐不存在!',common_1['HttpStatus'][_0x1ff232(0x18a)]);const {payEpayPid:_0x3714d0,payEpaySecret:_0x24ea7e,payEpayNotifyUrl:_0x3a53e5,payEpayReturnUrl:_0x5d7ebf,payEpayApiPayUrl:_0x24adcb}=await this[_0x1ff232(0x1b3)][_0x1ff232(0x181)]([_0x1ff232(0x13f),_0x1ff232(0x128),_0x1ff232(0x1a4),_0x1ff232(0x140),_0x1ff232(0x141)]);let _0x53a799;_0x3714d0[_0x1ff232(0x184)]<=0x10?_0x53a799=Number(_0x3714d0):_0x53a799=BigInt(_0x3714d0);const _0x5ee354={};_0x5ee354[_0x1ff232(0x18f)]=_0x53a799,_0x5ee354[_0x1ff232(0x143)]=_0x5860b5,_0x5ee354[_0x1ff232(0x1a8)]=_0x1c40cc,_0x5ee354[_0x1ff232(0x15a)]=_0xf37006[_0x1ff232(0x15a)],_0x5ee354['money']=_0x35db77[_0x1ff232(0x135)],_0x5ee354[_0x1ff232(0x127)]=_0x1ff232(0x144),_0x5ee354[_0x1ff232(0x17d)]='pc',_0x5ee354['notify_url']=_0x3a53e5,_0x5ee354[_0x1ff232(0x1c3)]=_0x5d7ebf,_0x5ee354['param']=_0x1ff232(0x1a7),_0x5ee354['sign']=this[_0x1ff232(0x15f)](_0x5ee354,_0x24ea7e),_0x5ee354[_0x1ff232(0x12b)]=_0x1ff232(0x12c);const _0x24fb15=new URLSearchParams(_0x5ee354)[_0x1ff232(0x180)](),_0x1d3e24=_0x24adcb+'?'+_0x24fb15;if(_0x24adcb['includes'](_0x1ff232(0x1c6)))return{'url_qrcode':null,'redirectUrl':_0x1d3e24,'channel':_0x5860b5,'isRedirect':!![]};else{const _0x5cab46=await axios_1[_0x1ff232(0x17f)][_0x1ff232(0x139)](_0x24adcb,{'params':_0x5ee354});console[_0x1ff232(0x1a1)](_0x1ff232(0x19b),_0x5cab46[_0x1ff232(0x1cb)]);const {data:{code:_0x3a7b9c,msg:_0x5a7622,qrcode:_0x1fe3db}}=_0x5cab46;if(_0x3a7b9c!=0x1)throw new common_1[(_0x1ff232(0x11f))](_0x5a7622,common_1[_0x1ff232(0x178)][_0x1ff232(0x18a)]);return{'url_qrcode':_0x1fe3db,'redirectUrl':null,'channel':_0x5860b5,'isRedirect':![]};}}async[_0x140985(0x18d)](_0x4d9966){const _0x13578d=_0x140985,{payEpayPid:_0x400615,payEpaySecret:_0x1bfe0f,payEpayApiQueryUrl:_0x58ca9e}=await this[_0x13578d(0x1b3)][_0x13578d(0x181)](['payEpayPid',_0x13578d(0x128),_0x13578d(0x18c)]),_0x57f3a7={};_0x57f3a7[_0x13578d(0x1ac)]=_0x13578d(0x1ad),_0x57f3a7[_0x13578d(0x1a8)]=_0x4d9966,_0x57f3a7[_0x13578d(0x18f)]=_0x400615,_0x57f3a7[_0x13578d(0x12e)]=_0x1bfe0f;const {data:{code:_0x4602c5,msg:_0x52a118,data:_0x2caab2}}=await axios_1[_0x13578d(0x17f)][_0x13578d(0x139)](_0x58ca9e,{'params':_0x57f3a7});if(_0x4602c5!=0x1)throw new common_1[(_0x13578d(0x11f))](_0x52a118,common_1[_0x13578d(0x178)]['BAD_REQUEST']);return _0x2caab2;}async[_0x140985(0x14e)](_0x304a9d){const _0x353fa5=_0x140985,_0x38ea16=_0x304a9d[_0x353fa5(0x15f)];delete _0x304a9d[_0x353fa5(0x15f)],delete _0x304a9d[_0x353fa5(0x12b)];const _0x1df640=await this[_0x353fa5(0x1b3)][_0x353fa5(0x181)]([_0x353fa5(0x129)]);if(this['sign'](_0x304a9d,_0x1df640)!=_0x38ea16)return _0x353fa5(0x1c7);const _0x17e14c=await this[_0x353fa5(0x17c)][_0x353fa5(0x1b9)]({'where':{'orderId':_0x304a9d[_0x353fa5(0x1a8)],'status':0x0}});if(!_0x17e14c)return _0x353fa5(0x1c7);const _0x4fa09d=_0x304a9d[_0x353fa5(0x195)]=='TRADE_SUCCESS'?0x1:0x2;console[_0x353fa5(0x1a1)](_0x353fa5(0x156),_0x4fa09d);const _0x1d61f0=await this[_0x353fa5(0x17c)]['update']({'orderId':_0x304a9d[_0x353fa5(0x1a8)]},{'status':_0x4fa09d,'paydAt':new Date()});_0x4fa09d===0x1&&await this['userBalanceService'][_0x353fa5(0x155)](_0x17e14c);if(_0x1d61f0[_0x353fa5(0x171)]!=0x1)return _0x353fa5(0x1c7);return _0x353fa5(0x186);}async[_0x140985(0x183)](_0x2e1d66,_0xc22eab,_0x283549=_0x140985(0x16c)){const _0x416c26=_0x140985,_0x511d97=await this['orderEntity'][_0x416c26(0x1b9)]({'where':{'userId':_0x2e1d66,'orderId':_0xc22eab}});if(!_0x511d97)throw new common_1['HttpException'](_0x416c26(0x133),common_1['HttpStatus'][_0x416c26(0x18a)]);const _0x494b6d=await this[_0x416c26(0x1af)][_0x416c26(0x1b9)]({'where':{'id':_0x511d97['goodsId']}});if(!_0x494b6d)throw new common_1['HttpException'](_0x416c26(0x16d),common_1[_0x416c26(0x178)][_0x416c26(0x18a)]);const {payMpayPid:_0x127815,payMpaySecret:_0x14d18b,payMpayNotifyUrl:_0x4b6e0d,payMpayReturnUrl:_0x5e18aa,payMpayApiPayUrl:_0x1f69ac}=await this[_0x416c26(0x1b3)]['getConfigs']([_0x416c26(0x148),_0x416c26(0x129),_0x416c26(0x185),_0x416c26(0x1b1),_0x416c26(0x1ae)]),_0x45eb00={};_0x45eb00[_0x416c26(0x18f)]=Number(_0x127815),_0x45eb00[_0x416c26(0x143)]=_0x283549,_0x45eb00[_0x416c26(0x1a8)]=_0xc22eab,_0x45eb00[_0x416c26(0x15a)]=_0x494b6d[_0x416c26(0x15a)],_0x45eb00[_0x416c26(0x1b4)]=_0x511d97[_0x416c26(0x135)],_0x45eb00['notify_url']=_0x4b6e0d,_0x45eb00[_0x416c26(0x1c3)]=_0x5e18aa,_0x45eb00['sign']=this[_0x416c26(0x15f)](_0x45eb00,_0x14d18b),_0x45eb00[_0x416c26(0x12b)]=_0x416c26(0x12c);const _0x1a8e3b=new URLSearchParams(_0x45eb00)[_0x416c26(0x180)](),_0x165e70=_0x1f69ac+'?'+_0x1a8e3b;return{'url_qrcode':null,'redirectUrl':_0x165e70,'channel':_0x283549,'isRedirect':!![]};}async[_0x140985(0x1b5)](_0x29073e){const _0x1f2315=_0x140985,{payMpayApiQueryUrl:_0xda384d}=await this[_0x1f2315(0x1b3)]['getConfigs']([_0x1f2315(0x148),_0x1f2315(0x129),_0x1f2315(0x123)]),_0x3cf022={};_0x3cf022[_0x1f2315(0x143)]=0x2,_0x3cf022[_0x1f2315(0x15b)]=_0x29073e;const {data:{code:_0x2974e4,msg:_0x4793a3,data:_0x4affa8}}=await axios_1['default'][_0x1f2315(0x139)](_0xda384d,{'params':_0x3cf022});if(_0x2974e4!=0x1)throw new common_1['HttpException'](_0x4793a3,common_1[_0x1f2315(0x178)]['BAD_REQUEST']);return _0x4affa8;}async[_0x140985(0x14a)](_0x44458c){const _0x3080ab=_0x140985;console[_0x3080ab(0x1a1)](_0x3080ab(0x1bf),_0x44458c);const {payWeChatAppId:_0x51b6b1,payWeChatMchId:_0x48b84c,payWeChatSecret:_0x4c4497,payWeChatPublicKey:_0x3d006e,payWeChatPrivateKey:_0x252b78}=await this[_0x3080ab(0x1b3)][_0x3080ab(0x181)]([_0x3080ab(0x121),_0x3080ab(0x1cc),'payWeChatSecret',_0x3080ab(0x177),'payWeChatPrivateKey']),_0x460f05=new this[(_0x3080ab(0x12f))]({'appid':_0x51b6b1,'mchid':_0x48b84c,'publicKey':_0x3d006e,'privateKey':_0x252b78});try{if(_0x44458c[_0x3080ab(0x1b7)]=='TRANSACTION.SUCCESS'){const {ciphertext:_0x34f2ba,associated_data:_0x26ca18,nonce:_0xa07529}=_0x44458c[_0x3080ab(0x14b)],_0x2ca852=_0x460f05[_0x3080ab(0x164)](_0x34f2ba,_0x26ca18,_0xa07529,_0x4c4497),_0x244bd1=await this[_0x3080ab(0x17c)][_0x3080ab(0x1b9)]({'where':{'orderId':_0x2ca852[_0x3080ab(0x1a8)],'status':0x0}});if(!_0x244bd1)return _0x3080ab(0x1c7);const _0x302d4a=_0x2ca852[_0x3080ab(0x1a9)]=='SUCCESS'?0x1:0x2,_0x578d22=await this[_0x3080ab(0x17c)]['update']({'orderId':_0x2ca852[_0x3080ab(0x1a8)]},{'status':_0x302d4a,'paydAt':new Date()});_0x302d4a===0x1&&await this[_0x3080ab(0x12d)][_0x3080ab(0x155)](_0x244bd1);if(_0x578d22[_0x3080ab(0x171)]!=0x1)return _0x3080ab(0x1c7);}return _0x3080ab(0x186);}catch(_0x39544c){return console[_0x3080ab(0x1a1)]('error:\x20',_0x39544c),console[_0x3080ab(0x1a1)](_0x3080ab(0x199),_0x39544c),'failed';}}async[_0x140985(0x1bd)](_0x4af409,_0x2ec682,_0x10ab00=_0x140985(0x172)){const _0xc90967=_0x140985;var _0xc211bd,_0x300adc,_0x4e934f;console[_0xc90967(0x1a1)](_0xc90967(0x146),_0x10ab00);const _0x7d29b2=await this[_0xc90967(0x17c)]['findOne']({'where':{'userId':_0x4af409,'orderId':_0x2ec682}});if(!_0x7d29b2)throw new common_1['HttpException'](_0xc90967(0x133),common_1[_0xc90967(0x178)]['BAD_REQUEST']);const _0x273a4f=await this[_0xc90967(0x1af)]['findOne']({'where':{'id':_0x7d29b2[_0xc90967(0x152)]}});if(!_0x273a4f)throw new common_1['HttpException'](_0xc90967(0x16d),common_1[_0xc90967(0x178)][_0xc90967(0x18a)]);const {payWeChatAppId:_0x4f288f,payWeChatMchId:_0x1b50d0,payWeChatPublicKey:_0x247592,payWeChatPrivateKey:_0x320b77,payWeChatNotifyUrl:_0x36c1a0,payWeChatH5Name:_0x8517a,payWeChatH5Url:_0x92eceb}=await this[_0xc90967(0x1b3)][_0xc90967(0x181)]([_0xc90967(0x121),_0xc90967(0x1cc),'payWeChatPublicKey',_0xc90967(0x130),_0xc90967(0x1ba),_0xc90967(0x12a),_0xc90967(0x15c)]),_0x38519d=new this[(_0xc90967(0x12f))]({'appid':_0x4f288f,'mchid':_0x1b50d0,'publicKey':_0x247592,'privateKey':_0x320b77}),_0x391185={'appid':_0x4f288f,'mchid':_0x1b50d0,'description':_0x273a4f[_0xc90967(0x15a)],'out_trade_no':_0x2ec682,'notify_url':_0x36c1a0,'amount':{'total':Number(_0x7d29b2[_0xc90967(0x135)]*0x64)},'scene_info':{'payer_client_ip':_0xc90967(0x144)}};console[_0xc90967(0x1a1)](_0xc90967(0x120),_0x391185);if(_0x10ab00=='h5'){_0x391185['scene_info'][_0xc90967(0x15d)]={'type':_0xc90967(0x13d),'app_name':_0x8517a,'app_url':_0x92eceb};const _0x518124=await _0x38519d[_0xc90967(0x122)](_0x391185);if(_0x518124[_0xc90967(0x124)]===0x193){const _0x11b61c=(_0x4e934f=(_0x300adc=(_0xc211bd=_0x518124===null||_0x518124===void 0x0?void 0x0:_0x518124['errRaw'])===null||_0xc211bd===void 0x0?void 0x0:_0xc211bd[_0xc90967(0x16e)])===null||_0x300adc===void 0x0?void 0x0:_0x300adc[_0xc90967(0x174)])===null||_0x4e934f===void 0x0?void 0x0:_0x4e934f[_0xc90967(0x187)];throw new common_1[(_0xc90967(0x11f))]((_0x518124===null||_0x518124===void 0x0?void 0x0:_0x518124[_0xc90967(0x187)])||_0xc90967(0x1a5),common_1[_0xc90967(0x178)]['BAD_REQUEST']);}const {h5_url:_0x20a3b9}=_0x518124;return{'url':_0x20a3b9};}if(_0x10ab00=='jsapi'){const _0x19c012=await this[_0xc90967(0x132)][_0xc90967(0x197)](_0x4af409);console['log'](_0xc90967(0x1aa),_0x19c012),_0x391185[_0xc90967(0x1a2)]={'openid':_0x19c012};const _0xe1994e=await _0x38519d[_0xc90967(0x13a)](_0x391185);return console['log'](_0xc90967(0x192),_0xe1994e),_0xe1994e;}if(_0x10ab00==_0xc90967(0x172)){const _0x15a1f3=await _0x38519d[_0xc90967(0x136)](_0x391185),{code_url:_0x58d9eb}=_0x15a1f3;return!_0x58d9eb&&console[_0xc90967(0x1a1)](_0xc90967(0x1c5),_0x15a1f3),{'url_qrcode':_0x58d9eb,'isRedirect':![]};}throw new common_1['HttpException'](_0xc90967(0x1c4),common_1['HttpStatus'][_0xc90967(0x18a)]);}async[_0x140985(0x169)](_0xb2c38){const _0x3d5da6=_0x140985,{payWeChatAppId:_0x14e6aa,payWeChatMchId:_0x3349f1,payWeChatPublicKey:_0x202db0,payWeChatPrivateKey:_0x3406fc,payWeChatNotifyUrl:_0x370b59,payWeChatH5Name:_0x522f06,payWeChatH5Url:_0x5e5c5c}=await this[_0x3d5da6(0x1b3)][_0x3d5da6(0x181)]([_0x3d5da6(0x121),_0x3d5da6(0x1cc),'payWeChatPublicKey',_0x3d5da6(0x130)]),_0x187c83=new this[(_0x3d5da6(0x12f))]({'appid':_0x14e6aa,'mchid':_0x3349f1,'publicKey':_0x202db0,'privateKey':_0x3406fc}),_0x4a510b=await _0x187c83['query']({'out_trade_no':_0xb2c38});return _0x4a510b;}[_0x140985(0x15f)](_0x3fa5a7,_0x3584ea){const _0x286ea9=_0x140985,_0x1697fd=Object[_0x286ea9(0x134)](_0x3fa5a7)[_0x286ea9(0x166)]()['map'](_0x4e27ad=>_0x4e27ad+'='+_0x3fa5a7[_0x4e27ad])['join']('&')+_0x3584ea;return crypto[_0x286ea9(0x19e)](_0x286ea9(0x137))[_0x286ea9(0x14c)](_0x1697fd)[_0x286ea9(0x1b8)](_0x286ea9(0x167));}};function _0x31d4(_0x1d4635,_0x2c7b1b){const _0x6d7b16=_0x6d7b();return _0x31d4=function(_0x31d410,_0x89fac5){_0x31d410=_0x31d410-0x11f;let _0x1b4d75=_0x6d7b16[_0x31d410];return _0x1b4d75;},_0x31d4(_0x1d4635,_0x2c7b1b);}function _0x6d7b(){const _0x315b84=['sign','6023120FFGIyn','114996awWAOl','__esModule','toFixed','decipher_gcm','TRADE_SUCCESS','sort','hex','wechat','queryWeChat','payHupi','object','wxpay','套餐不存在!','response','nonce_str','notifyHupi','affected','native','hupi','text','function','getOwnPropertyDescriptor','payWeChatPublicKey','HttpStatus','time','../../common/utils','103712bEZnLN','orderEntity','device','CramiPackageEntity','default','toString','getConfigs','1.1','payMpay','length','payMpayNotifyUrl','success','message','Repository','payHupiGatewayUrl','BAD_REQUEST','out_trade_order','payEpayApiQueryUrl','queryEpay','onModuleInit','pid','defineProperty','GlobalConfigService','jsapi支付结果返回值:\x20','Injectable','__decorate','trade_status','@nestjs/typeorm','getOpenIdByUserId','queryHupi','支付通知验证失败:\x20','OrderEntity','epay\x20--->\x20res:\x20','payHupiSecret','__metadata','createHash','payHupiReturnUrl','__param','log','payer','58140EWndqm','payEpayNotifyUrl','微信H5支付失败！','now','epay','out_trade_no','trade_state','用户openId:\x20','InjectRepository','act','order','payMpayApiPayUrl','cramiPackageEntity','hash','payMpayReturnUrl','472LPBumz','globalConfigService','money','queryMpay','mpay','event_type','digest','findOne','payWeChatNotifyUrl','createRandomNonceStr','notifyEpay','payWeChat','payHupiNotifyUrl','微信支付通知params:\x20','UserBalanceService','payEpay','notify_url','return_url','unsupported\x20pay\x20type','wx-native','submit.php','failed','version','支付请求失败:\x20','metadata','data','payWeChatMchId','HttpException','wechat-pay:\x20','payWeChatAppId','transactions_h5','payMpayApiQueryUrl','status','11XPMcQg','UserService','clientip','payEpaySecret','payMpaySecret','payWeChatH5Name','sign_type','MD5','userBalanceService','key','WxPay','payWeChatPrivateKey','../user/user.service','userService','订单不存在!','keys','total','transactions_native','md5','pay','get','transactions_jsapi','541115zvMOWi','attach','Wap','1877112lTYQkp','payEpayPid','payEpayReturnUrl','payEpayApiPayUrl','719351sQxqns','type','192.168.1.100','payHupiAppId','payType:\x20','post','payMpayPid','../userBalance/userBalance.service','notifyWeChat','resource','update','PayService','notifyMpay','../order/order.entity','trade_order_id','param','goodsId','210SgUfwj','https://api.xunhupay.com/payment/query.html','addBalanceToOrder','status:\x20','支付请求失败!','90uelEBq','payPlatform','name','order_no','payWeChatH5Url','h5_info','query'];_0x6d7b=function(){return _0x315b84;};return _0x6d7b();}PayService=__decorate([(0x0,common_1[_0x140985(0x193)])(),__param(0x0,(0x0,typeorm_1[_0x140985(0x1ab)])(cramiPackage_entity_1[_0x140985(0x17e)])),__param(0x1,(0x0,typeorm_1[_0x140985(0x1ab)])(order_entity_1[_0x140985(0x19a)])),__metadata('design:paramtypes',[typeorm_2[_0x140985(0x188)],typeorm_2[_0x140985(0x188)],userBalance_service_1[_0x140985(0x1c0)],globalConfig_service_1[_0x140985(0x191)],user_service_1[_0x140985(0x126)]])],PayService),exports[_0x140985(0x14d)]=PayService;