'use strict';const _0x19025e=_0x44ec;(function(_0x30b026,_0x54dea7){const _0x1fe369=_0x44ec,_0x281cfc=_0x30b026();while(!![]){try{const _0x2850fc=parseInt(_0x1fe369(0x99))/0x1+-parseInt(_0x1fe369(0x8a))/0x2*(parseInt(_0x1fe369(0x73))/0x3)+parseInt(_0x1fe369(0x66))/0x4*(parseInt(_0x1fe369(0x65))/0x5)+-parseInt(_0x1fe369(0xa1))/0x6*(parseInt(_0x1fe369(0x6e))/0x7)+parseInt(_0x1fe369(0x8c))/0x8+-parseInt(_0x1fe369(0xb4))/0x9*(parseInt(_0x1fe369(0x9e))/0xa)+-parseInt(_0x1fe369(0xc0))/0xb;if(_0x2850fc===_0x54dea7)break;else _0x281cfc['push'](_0x281cfc['shift']());}catch(_0x21d5ea){_0x281cfc['push'](_0x281cfc['shift']());}}}(_0xd68e,0x86e4a));function _0x44ec(_0xc40d0e,_0x1f030e){const _0xd68eed=_0xd68e();return _0x44ec=function(_0x44ecc3,_0x1fda13){_0x44ecc3=_0x44ecc3-0x64;let _0x29d09c=_0xd68eed[_0x44ecc3];return _0x29d09c;},_0x44ec(_0xc40d0e,_0x1f030e);}var __decorate=this&&this['__decorate']||function(_0x17596f,_0x45733e,_0xdb0c6b,_0x20253c){const _0x5312f4=_0x44ec;var _0x3e15b1=arguments[_0x5312f4(0x6b)],_0x7e96fc=_0x3e15b1<0x3?_0x45733e:_0x20253c===null?_0x20253c=Object['getOwnPropertyDescriptor'](_0x45733e,_0xdb0c6b):_0x20253c,_0x59b0d2;if(typeof Reflect==='object'&&typeof Reflect[_0x5312f4(0xbe)]===_0x5312f4(0x92))_0x7e96fc=Reflect[_0x5312f4(0xbe)](_0x17596f,_0x45733e,_0xdb0c6b,_0x20253c);else{for(var _0x3afa53=_0x17596f['length']-0x1;_0x3afa53>=0x0;_0x3afa53--)if(_0x59b0d2=_0x17596f[_0x3afa53])_0x7e96fc=(_0x3e15b1<0x3?_0x59b0d2(_0x7e96fc):_0x3e15b1>0x3?_0x59b0d2(_0x45733e,_0xdb0c6b,_0x7e96fc):_0x59b0d2(_0x45733e,_0xdb0c6b))||_0x7e96fc;}return _0x3e15b1>0x3&&_0x7e96fc&&Object[_0x5312f4(0xc1)](_0x45733e,_0xdb0c6b,_0x7e96fc),_0x7e96fc;},__metadata=this&&this[_0x19025e(0xc3)]||function(_0xa8e618,_0x4f7f81){const _0x292108=_0x19025e;if(typeof Reflect===_0x292108(0x90)&&typeof Reflect[_0x292108(0xbd)]===_0x292108(0x92))return Reflect['metadata'](_0xa8e618,_0x4f7f81);};Object[_0x19025e(0xc1)](exports,'__esModule',{'value':!![]}),exports[_0x19025e(0xc6)]=void 0x0;const chatgpt_service_1=require(_0x19025e(0x94)),globalConfig_service_1=require(_0x19025e(0x68)),auth_service_1=require(_0x19025e(0x86)),user_service_1=require(_0x19025e(0x9a)),autoreply_service_1=require(_0x19025e(0xc2)),common_1=require(_0x19025e(0x77)),crypto=require(_0x19025e(0xb3)),axios_1=require(_0x19025e(0x74)),utils_1=require('../../common/utils');function _0xd68e(){const _0x53d966=['getJsapiTicket','wechatOfficialToken','1810263dwzXna','genXmlMsg','</CreateTime>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<MsgType><![CDATA[text]]></MsgType>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<Content><![CDATA[','digest','\x0a\x20\x20\x20\x20<xml>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<ToUserName><![CDATA[','3krLWqM','axios','sort','loginByOpenId','@nestjs/common','&url=','sha1','&secret=','由于公众号的回复限制、过长的问题我们可能无法回复、您可以前往我们的官方站点享受更加完善的服务、如果您有更多问题、欢迎像我提问！','getConfigs','get','wechatJsapiTicket','design:paramtypes','UserService','&timestamp=','update','createRandomNonceStr','globalConfigService','user','./../auth/auth.service','tousername','checkAutoReply',']]></FromUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<CreateTime>','1345334USafJh','getTime','8526376KLGdpV','GlobalConfigService',']]></Content>\x0a\x20\x20\x20\x20</xml>','getQRCodeTicket','object','log','function','getUserOpenId','./../chatgpt/chatgpt.service','scanBindWx','sceneStrMap',']]></ToUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<FromUserName><![CDATA[','&redirect_uri=','1055467AGluIb','./../user/user.service','getRedirectUrl','jsapi_ticket=','AutoreplyService','4350CQEAyn','非法参数','回跳跳转地址:\x20','6qVXbNo','BAD_REQUEST','authService','genXmlMsgByConfig','getWechatAccessToken','AuthService','wechatOfficialAppSecret','post','https://api.weixin.qq.com/cgi-bin/qrcode/create?access_token=','chatgptService','https://api.weixin.qq.com/sns/oauth2/access_token?appid=','https://open.weixin.qq.com/connect/oauth2/authorize?appid=','getQRSceneStrByBind','请求超时','&response_type=code&scope=snsapi_base&state=weChatLogin#wechat_redirect','&code=','str:\x20','now','crypto','6237vyeubq','fromusername','&noncestr=','fetchQRCodeTicket','bindWx','QR_STR_SCENE','HttpException','getUserFromOpenId','HttpStatus','metadata','decorate','default','10772916samCXL','defineProperty','./../autoreply/autoreply.service','__metadata','scan','scanedSceneStrMap','OfficialService','loginBySceneStr','25GhVhEg','514676indYNf','autoreplyService','./../globalConfig/globalConfig.service','wechatOfficialAppId','userService','length'];_0xd68e=function(){return _0x53d966;};return _0xd68e();}let OfficialService=class OfficialService{constructor(_0x113144,_0x256612,_0x1fc4d2,_0x51b087,_0x1cc703){const _0x51f4ee=_0x19025e;this[_0x51f4ee(0x67)]=_0x113144,this[_0x51f4ee(0x6a)]=_0x256612,this['authService']=_0x1fc4d2,this['globalConfigService']=_0x51b087,this[_0x51f4ee(0xaa)]=_0x1cc703,this['sceneStrMap']={},this[_0x51f4ee(0xc5)]={};}async['onModuleInit'](){const _0x27beca=_0x19025e;await this[_0x27beca(0x84)][_0x27beca(0xa5)](!![]);}async['getQRSceneStr'](_0x11e4dd){const _0x2e02a6=_0x19025e,{invitedBy:_0x969ccb}=_0x11e4dd;let _0x882082=(0x0,utils_1[_0x2e02a6(0x83)])(0x20);return _0x969ccb&&(_0x882082+=':'+_0x969ccb),this[_0x2e02a6(0x96)][_0x882082]=!![],_0x882082;}async[_0x19025e(0xad)](_0x16ab68){const _0x1bf942=_0x19025e,{id:_0x4d4c3c}=_0x16ab68[_0x1bf942(0x85)],_0x25cf1d=(0x0,utils_1[_0x1bf942(0x83)])(0x20)+'/'+_0x4d4c3c;return this[_0x1bf942(0x96)][_0x25cf1d]=!![],_0x25cf1d;}async[_0x19025e(0x8f)](_0x203e55){const _0x33e505=_0x19025e;return this[_0x33e505(0xb7)](_0x203e55);}async[_0x19025e(0x9b)](_0x482f1b){const _0x23a4a0=_0x19025e,_0x323c61=await this[_0x23a4a0(0x84)][_0x23a4a0(0x7c)]([_0x23a4a0(0x69)]),_0x4d9a53=_0x23a4a0(0xac)+_0x323c61+_0x23a4a0(0x98)+encodeURIComponent(_0x482f1b)+_0x23a4a0(0xaf);return console[_0x23a4a0(0x91)](_0x23a4a0(0xa0),_0x4d9a53),_0x4d9a53;}async[_0x19025e(0x6c)](_0xc1d2a0){const _0x1e2b20=_0x19025e,_0x186ede=(0x0,utils_1[_0x1e2b20(0x83)])(0x20),_0x273faa=(Date[_0x1e2b20(0xb2)]()/0x3e8)['toFixed'](0x0),_0x149988=await this[_0x1e2b20(0x84)][_0x1e2b20(0x7c)]([_0x1e2b20(0x7e)]),_0x320731=await this['globalConfigService'][_0x1e2b20(0x7c)]([_0x1e2b20(0x69)]);console['log']('appId:\x20',_0x320731);const _0x4c5819=_0x1e2b20(0x9c)+_0x149988+_0x1e2b20(0xb6)+_0x186ede+_0x1e2b20(0x81)+_0x273faa+_0x1e2b20(0x78)+_0xc1d2a0;console[_0x1e2b20(0x91)](_0x1e2b20(0xb1),_0x4c5819);const _0x2a6b77=this[_0x1e2b20(0x79)](_0x4c5819);return{'appId':_0x320731,'nonceStr':_0x186ede,'timestamp':_0x273faa,'signature':_0x2a6b77};}async['fetchQRCodeTicket'](_0x3d8ef5){const _0x436720=_0x19025e,_0x8764d9=await this[_0x436720(0x84)][_0x436720(0x7c)](['wechatAccessToken']),_0x467f24={'action_name':_0x436720(0xb9),'action_info':{'scene':{'scene_str':_0x3d8ef5}}},_0x30219d=await axios_1['default'][_0x436720(0xa8)](_0x436720(0xa9)+_0x8764d9,_0x467f24),{data:{errmsg:_0x21dc50,ticket:_0x11a9fd}}=_0x30219d;if(_0x21dc50)throw new common_1[(_0x436720(0xba))](_0x21dc50,common_1[_0x436720(0xbc)][_0x436720(0xa2)]);return _0x11a9fd;}async['loginByCode'](_0xe384ee,_0x2f0db2){const _0x17b6b8=_0x19025e,_0x504375=await this[_0x17b6b8(0x84)]['getConfigs']([_0x17b6b8(0x69)]),_0x3890e0=await this[_0x17b6b8(0x84)]['getConfigs']([_0x17b6b8(0xa7)]),_0x3eaae7=await axios_1[_0x17b6b8(0xbf)][_0x17b6b8(0x7d)](_0x17b6b8(0xab)+_0x504375+_0x17b6b8(0x7a)+_0x3890e0+_0x17b6b8(0xb0)+_0x2f0db2+'&grant_type=authorization_code'),{data:{errmsg:_0x36b8a4,openid:_0x21c0c4}}=_0x3eaae7;if(_0x36b8a4)throw new common_1[(_0x17b6b8(0xba))](_0x36b8a4,common_1[_0x17b6b8(0xbc)]['BAD_REQUEST']);let _0x3a3a77;return _0x3a3a77=await this[_0x17b6b8(0x6a)][_0x17b6b8(0x93)](_0x21c0c4),!_0x3a3a77&&(_0x3a3a77=await this[_0x17b6b8(0x6a)][_0x17b6b8(0xbb)](_0x21c0c4)),this['authService']['loginByOpenId'](_0x3a3a77,_0xe384ee);}async[_0x19025e(0xc4)](_0x5367cc,_0xa43856){const _0x330eba=_0x19025e;if(!this[_0x330eba(0x96)][_0xa43856])throw new common_1['HttpException'](_0x330eba(0x9f),common_1[_0x330eba(0xbc)]['BAD_REQUEST']);const _0x247b42=await this[_0x330eba(0x6a)][_0x330eba(0xbb)](_0x5367cc,_0xa43856);this['scanedSceneStrMap'][_0xa43856]=_0x247b42['id'];}async[_0x19025e(0x64)](_0x4ea80c,_0xf7103e){const _0x4a4efa=_0x19025e;if(!this[_0x4a4efa(0x96)][_0xf7103e])return;const _0x34a7d9=this[_0x4a4efa(0xc5)][_0xf7103e];if(!_0x34a7d9)return'';const _0x53f8fd=await this[_0x4a4efa(0x6a)]['getUserById'](_0x34a7d9);return delete this[_0x4a4efa(0xc5)][_0xf7103e],this[_0x4a4efa(0xa3)][_0x4a4efa(0x76)](_0x53f8fd,_0x4ea80c);}async[_0x19025e(0x95)](_0xc005c1,_0x20614a){const _0xd48589=_0x19025e;if(!this['sceneStrMap'][_0x20614a])throw new common_1[(_0xd48589(0xba))](_0xd48589(0x9f),common_1[_0xd48589(0xbc)][_0xd48589(0xa2)]);const _0x29c6ce=_0x20614a['split']('/')[0x1],_0x38a910=await this[_0xd48589(0x6a)][_0xd48589(0xb8)](_0xc005c1,_0x29c6ce);this[_0xd48589(0xc5)][_0x20614a]=_0x38a910;}async['bindWxBySceneStr'](_0x45f4ee,_0x8f5217){const _0x134b80=_0x19025e;if(!this[_0x134b80(0x96)][_0x8f5217])throw new common_1[(_0x134b80(0xba))](_0x134b80(0x9f),common_1[_0x134b80(0xbc)][_0x134b80(0xa2)]);const {id:_0x51b57d}=_0x45f4ee['user'],_0x2eaac0=this['scanedSceneStrMap'][_0x8f5217];if(!_0x2eaac0)return'';return delete this[_0x134b80(0xc5)][_0x8f5217],_0x2eaac0;}async['verify'](_0x4e190e,_0x1b95f0,_0x2336f7){const _0x5bcaf9=_0x19025e,_0xd62587=await this['globalConfigService']['getConfigs']([_0x5bcaf9(0x6d)])||'jiangly';return await this[_0x5bcaf9(0x79)]([_0xd62587,_0x1b95f0,_0x2336f7][_0x5bcaf9(0x75)]()['join'](''))==_0x4e190e;}['sha1'](_0x42ec31){const _0x19b1e7=_0x19025e;return crypto['createHash']('sha1')[_0x19b1e7(0x82)](_0x42ec31)[_0x19b1e7(0x71)]('hex');}async[_0x19025e(0xa4)](_0x481845,_0x2e9033){const _0x23fa76=_0x19025e,_0x251aca=await this['globalConfigService']['getConfigs']([_0x2e9033]);return this[_0x23fa76(0x6f)](_0x481845,_0x251aca);}async[_0x19025e(0x6f)](_0x4a76c5,_0x54024e){const _0x4bb1f2=_0x19025e;return _0x4bb1f2(0x72)+_0x4a76c5[_0x4bb1f2(0xb5)][0x0]+_0x4bb1f2(0x97)+_0x4a76c5[_0x4bb1f2(0x87)][0x0]+_0x4bb1f2(0x89)+new Date()[_0x4bb1f2(0x8b)]()+_0x4bb1f2(0x70)+_0x54024e+_0x4bb1f2(0x8e);}async['aotoPlay'](_0x12e866){const _0x2a637b=_0x19025e,_0x125bfc=new Promise((_0x524c12,_0x591ecc)=>{setTimeout(()=>{const _0x4a3804=_0x44ec;_0x591ecc(new Error(_0x4a3804(0xae)));},0x12c0);});let _0x2fe7cc='';return _0x2fe7cc=await this[_0x2a637b(0x67)][_0x2a637b(0x88)](_0x12e866)||await this['globalConfigService'][_0x2a637b(0x7c)](['officialAutoReplyText'])||_0x2a637b(0x7b),_0x2fe7cc;}};OfficialService=__decorate([(0x0,common_1['Injectable'])(),__metadata(_0x19025e(0x7f),[autoreply_service_1[_0x19025e(0x9d)],user_service_1[_0x19025e(0x80)],auth_service_1[_0x19025e(0xa6)],globalConfig_service_1[_0x19025e(0x8d)],chatgpt_service_1['ChatgptService']])],OfficialService),exports[_0x19025e(0xc6)]=OfficialService;