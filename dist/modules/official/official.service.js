'use strict';function _0x4308(_0x126d85,_0x31e829){const _0x30501e=_0x3050();return _0x4308=function(_0x4308d8,_0x42b3ea){_0x4308d8=_0x4308d8-0x74;let _0x274aba=_0x30501e[_0x4308d8];return _0x274aba;},_0x4308(_0x126d85,_0x31e829);}const _0x2f1855=_0x4308;(function(_0x2e93d6,_0x4a4607){const _0x45fe1a=_0x4308,_0x4d5425=_0x2e93d6();while(!![]){try{const _0x4ee9c8=-parseInt(_0x45fe1a(0x88))/0x1+parseInt(_0x45fe1a(0x8d))/0x2*(parseInt(_0x45fe1a(0xc6))/0x3)+parseInt(_0x45fe1a(0x7c))/0x4+parseInt(_0x45fe1a(0x9f))/0x5+-parseInt(_0x45fe1a(0xd7))/0x6*(parseInt(_0x45fe1a(0xa4))/0x7)+parseInt(_0x45fe1a(0x94))/0x8*(-parseInt(_0x45fe1a(0xc9))/0x9)+-parseInt(_0x45fe1a(0xa8))/0xa*(-parseInt(_0x45fe1a(0xd6))/0xb);if(_0x4ee9c8===_0x4a4607)break;else _0x4d5425['push'](_0x4d5425['shift']());}catch(_0x55cdd4){_0x4d5425['push'](_0x4d5425['shift']());}}}(_0x3050,0x36a9a));var __decorate=this&&this['__decorate']||function(_0x360fe4,_0x2a4d85,_0x103474,_0x262597){const _0x30accc=_0x4308;var _0x4a9d45=arguments['length'],_0x1d86de=_0x4a9d45<0x3?_0x2a4d85:_0x262597===null?_0x262597=Object[_0x30accc(0xd0)](_0x2a4d85,_0x103474):_0x262597,_0x2139ab;if(typeof Reflect===_0x30accc(0xb7)&&typeof Reflect[_0x30accc(0xc4)]===_0x30accc(0x76))_0x1d86de=Reflect['decorate'](_0x360fe4,_0x2a4d85,_0x103474,_0x262597);else{for(var _0x527511=_0x360fe4[_0x30accc(0xd5)]-0x1;_0x527511>=0x0;_0x527511--)if(_0x2139ab=_0x360fe4[_0x527511])_0x1d86de=(_0x4a9d45<0x3?_0x2139ab(_0x1d86de):_0x4a9d45>0x3?_0x2139ab(_0x2a4d85,_0x103474,_0x1d86de):_0x2139ab(_0x2a4d85,_0x103474))||_0x1d86de;}return _0x4a9d45>0x3&&_0x1d86de&&Object[_0x30accc(0x7e)](_0x2a4d85,_0x103474,_0x1d86de),_0x1d86de;},__metadata=this&&this[_0x2f1855(0x9c)]||function(_0x473ef8,_0x427942){const _0x12a065=_0x2f1855;if(typeof Reflect==='object'&&typeof Reflect[_0x12a065(0x74)]===_0x12a065(0x76))return Reflect[_0x12a065(0x74)](_0x473ef8,_0x427942);};function _0x3050(){const _0x1020af=['bindWxBySceneStr','HttpException','getOwnPropertyDescriptor','&code=','Injectable','./../autoreply/autoreply.service','tousername','length','22tVSzVb','102XrMToS','\x0a\x20\x20\x20\x20<xml>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<ToUserName><![CDATA[','metadata','&secret=','function','officialAutoReplyText','../../common/utils','design:paramtypes','GlobalConfigService','log','1336420tHiXDM','genXmlMsg','defineProperty','fetchQRCodeTicket',']]></ToUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<FromUserName><![CDATA[','jiangly','appId:\x20','https://api.weixin.qq.com/sns/oauth2/access_token?appid=','&redirect_uri=','loginByOpenId','bindWx','getWechatAccessToken','370679LWSYiu','chatgptService','非法参数','wechatOfficialAppSecret','sha1','2UGIsHn','回跳跳转地址:\x20','https://api.weixin.qq.com/cgi-bin/qrcode/create?access_token=','verify','toFixed','user','get','8pJUEVg','now','getUserOpenId','scanedSceneStrMap','crypto',']]></FromUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<CreateTime>','@nestjs/common','QR_STR_SCENE','__metadata','scan','post','212950dYtbCk','https://open.weixin.qq.com/connect/oauth2/authorize?appid=','default','update','getUserById','28511evUPLU','ChatgptService','loginByCode','&url=','2073450nbYAmc','</CreateTime>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<MsgType><![CDATA[text]]></MsgType>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<Content><![CDATA[','createRandomNonceStr','onModuleInit','checkAutoReply','userService','AutoreplyService','&noncestr=','sceneStrMap','split','getConfigs','wechatAccessToken','由于公众号的回复限制、过长的问题我们可能无法回复、您可以前往我们的官方站点享受更加完善的服务、如果您有更多问题、欢迎像我提问！','BAD_REQUEST','getRedirectUrl','object','globalConfigService','jsapi_ticket=','getJsapiTicket','autoreplyService','str:\x20','getQRSceneStrByBind','wechatOfficialToken','wechatJsapiTicket','getQRCodeTicket','getQRSceneStr','HttpStatus','wechatOfficialAppId','decorate','fromusername','451377xeIIYt','join','sort','2502234idSbpM','genXmlMsgByConfig','aotoPlay','请求超时','OfficialService'];_0x3050=function(){return _0x1020af;};return _0x3050();}Object[_0x2f1855(0x7e)](exports,'__esModule',{'value':!![]}),exports[_0x2f1855(0xcd)]=void 0x0;const chatgpt_service_1=require('./../chatgpt/chatgpt.service'),globalConfig_service_1=require('./../globalConfig/globalConfig.service'),auth_service_1=require('./../auth/auth.service'),user_service_1=require('./../user/user.service'),autoreply_service_1=require(_0x2f1855(0xd3)),common_1=require(_0x2f1855(0x9a)),crypto=require(_0x2f1855(0x98)),axios_1=require('axios'),utils_1=require(_0x2f1855(0x78));let OfficialService=class OfficialService{constructor(_0xa84f46,_0x4cc43e,_0x4df1dd,_0x11fd3a,_0x3d2e8f){const _0x1aeb70=_0x2f1855;this['autoreplyService']=_0xa84f46,this[_0x1aeb70(0xad)]=_0x4cc43e,this['authService']=_0x4df1dd,this['globalConfigService']=_0x11fd3a,this[_0x1aeb70(0x89)]=_0x3d2e8f,this[_0x1aeb70(0xb0)]={},this[_0x1aeb70(0x97)]={};}async[_0x2f1855(0xab)](){const _0x90e393=_0x2f1855;await this['globalConfigService'][_0x90e393(0x87)](!![]);}async[_0x2f1855(0xc1)](_0x3d91c6){const _0xcb973c=_0x2f1855,{invitedBy:_0xda9afb}=_0x3d91c6;let _0x562287=(0x0,utils_1[_0xcb973c(0xaa)])(0x20);return _0xda9afb&&(_0x562287+=':'+_0xda9afb),this[_0xcb973c(0xb0)][_0x562287]=!![],_0x562287;}async[_0x2f1855(0xbd)](_0x213d91){const _0x333531=_0x2f1855,{id:_0x5e263f}=_0x213d91[_0x333531(0x92)],_0x2c9770=(0x0,utils_1[_0x333531(0xaa)])(0x20)+'/'+_0x5e263f;return this['sceneStrMap'][_0x2c9770]=!![],_0x2c9770;}async[_0x2f1855(0xc0)](_0xfac8a1){const _0x1bc9a7=_0x2f1855;return this[_0x1bc9a7(0x7f)](_0xfac8a1);}async[_0x2f1855(0xb6)](_0x16b3d6){const _0x36b5c8=_0x2f1855,_0x2fe26b=await this['globalConfigService'][_0x36b5c8(0xb2)]([_0x36b5c8(0xc3)]),_0x231696=_0x36b5c8(0xa0)+_0x2fe26b+_0x36b5c8(0x84)+encodeURIComponent(_0x16b3d6)+'&response_type=code&scope=snsapi_base&state=weChatLogin#wechat_redirect';return console[_0x36b5c8(0x7b)](_0x36b5c8(0x8e),_0x231696),_0x231696;}async[_0x2f1855(0xba)](_0x2bc108){const _0x5abb9f=_0x2f1855,_0x25fe20=(0x0,utils_1[_0x5abb9f(0xaa)])(0x20),_0x481685=(Date[_0x5abb9f(0x95)]()/0x3e8)[_0x5abb9f(0x91)](0x0),_0x124304=await this[_0x5abb9f(0xb8)]['getConfigs']([_0x5abb9f(0xbf)]),_0x52c4cd=await this[_0x5abb9f(0xb8)][_0x5abb9f(0xb2)]([_0x5abb9f(0xc3)]);console[_0x5abb9f(0x7b)](_0x5abb9f(0x82),_0x52c4cd);const _0x4f03da=_0x5abb9f(0xb9)+_0x124304+_0x5abb9f(0xaf)+_0x25fe20+'&timestamp='+_0x481685+_0x5abb9f(0xa7)+_0x2bc108;console[_0x5abb9f(0x7b)](_0x5abb9f(0xbc),_0x4f03da);const _0x2e4474=this[_0x5abb9f(0x8c)](_0x4f03da);return{'appId':_0x52c4cd,'nonceStr':_0x25fe20,'timestamp':_0x481685,'signature':_0x2e4474};}async[_0x2f1855(0x7f)](_0x2a5837){const _0x2e150b=_0x2f1855,_0x5567f0=await this[_0x2e150b(0xb8)][_0x2e150b(0xb2)]([_0x2e150b(0xb3)]),_0xbd01ab={'action_name':_0x2e150b(0x9b),'action_info':{'scene':{'scene_str':_0x2a5837}}},_0x1c1c91=await axios_1[_0x2e150b(0xa1)][_0x2e150b(0x9e)](_0x2e150b(0x8f)+_0x5567f0,_0xbd01ab),{data:{errmsg:_0x30310c,ticket:_0xaedfd6}}=_0x1c1c91;if(_0x30310c)throw new common_1[(_0x2e150b(0xcf))](_0x30310c,common_1['HttpStatus']['BAD_REQUEST']);return _0xaedfd6;}async[_0x2f1855(0xa6)](_0x32226f,_0xa22955){const _0x46e15e=_0x2f1855,_0x139aee=await this['globalConfigService'][_0x46e15e(0xb2)]([_0x46e15e(0xc3)]),_0xeb8cf5=await this[_0x46e15e(0xb8)][_0x46e15e(0xb2)]([_0x46e15e(0x8b)]),_0x42bae4=await axios_1[_0x46e15e(0xa1)][_0x46e15e(0x93)](_0x46e15e(0x83)+_0x139aee+_0x46e15e(0x75)+_0xeb8cf5+_0x46e15e(0xd1)+_0xa22955+'&grant_type=authorization_code'),{data:{errmsg:_0x4a3988,openid:_0x26216d}}=_0x42bae4;if(_0x4a3988)throw new common_1[(_0x46e15e(0xcf))](_0x4a3988,common_1[_0x46e15e(0xc2)][_0x46e15e(0xb5)]);let _0x5e5872;return _0x5e5872=await this['userService'][_0x46e15e(0x96)](_0x26216d),!_0x5e5872&&(_0x5e5872=await this[_0x46e15e(0xad)]['getUserFromOpenId'](_0x26216d)),this['authService']['loginByOpenId'](_0x5e5872,_0x32226f);}async[_0x2f1855(0x9d)](_0x5c798,_0x509d6b){const _0x2568f9=_0x2f1855;if(!this['sceneStrMap'][_0x509d6b])throw new common_1[(_0x2568f9(0xcf))]('非法参数',common_1['HttpStatus']['BAD_REQUEST']);const _0xb759cc=await this[_0x2568f9(0xad)]['getUserFromOpenId'](_0x5c798,_0x509d6b);this[_0x2568f9(0x97)][_0x509d6b]=_0xb759cc['id'];}async['loginBySceneStr'](_0x1d87d8,_0x48ce5e){const _0x1fb14e=_0x2f1855;if(!this[_0x1fb14e(0xb0)][_0x48ce5e])return;const _0x3a9004=this[_0x1fb14e(0x97)][_0x48ce5e];if(!_0x3a9004)return'';const _0x53eae4=await this['userService'][_0x1fb14e(0xa3)](_0x3a9004);return delete this['scanedSceneStrMap'][_0x48ce5e],this['authService'][_0x1fb14e(0x85)](_0x53eae4,_0x1d87d8);}async['scanBindWx'](_0x409770,_0x5c7992){const _0x58f3bf=_0x2f1855;if(!this[_0x58f3bf(0xb0)][_0x5c7992])throw new common_1[(_0x58f3bf(0xcf))](_0x58f3bf(0x8a),common_1[_0x58f3bf(0xc2)][_0x58f3bf(0xb5)]);const _0x190841=_0x5c7992[_0x58f3bf(0xb1)]('/')[0x1],_0x4c779c=await this[_0x58f3bf(0xad)][_0x58f3bf(0x86)](_0x409770,_0x190841);this[_0x58f3bf(0x97)][_0x5c7992]=_0x4c779c;}async[_0x2f1855(0xce)](_0x2863e8,_0x3e9cf6){const _0x5f5a6e=_0x2f1855;if(!this[_0x5f5a6e(0xb0)][_0x3e9cf6])throw new common_1[(_0x5f5a6e(0xcf))](_0x5f5a6e(0x8a),common_1[_0x5f5a6e(0xc2)][_0x5f5a6e(0xb5)]);const {id:_0x4e39ee}=_0x2863e8[_0x5f5a6e(0x92)],_0x29abb8=this[_0x5f5a6e(0x97)][_0x3e9cf6];if(!_0x29abb8)return'';return delete this[_0x5f5a6e(0x97)][_0x3e9cf6],_0x29abb8;}async[_0x2f1855(0x90)](_0x4990ed,_0x3686ad,_0xde5c30){const _0x31753c=_0x2f1855,_0x1f7875=await this[_0x31753c(0xb8)][_0x31753c(0xb2)]([_0x31753c(0xbe)])||_0x31753c(0x81);return await this[_0x31753c(0x8c)]([_0x1f7875,_0x3686ad,_0xde5c30][_0x31753c(0xc8)]()[_0x31753c(0xc7)](''))==_0x4990ed;}[_0x2f1855(0x8c)](_0x31b421){const _0x29c22c=_0x2f1855;return crypto['createHash'](_0x29c22c(0x8c))[_0x29c22c(0xa2)](_0x31b421)['digest']('hex');}async[_0x2f1855(0xca)](_0x123ba2,_0x1ef56b){const _0x4f22b2=_0x2f1855,_0x55cc0b=await this[_0x4f22b2(0xb8)][_0x4f22b2(0xb2)]([_0x1ef56b]);return this[_0x4f22b2(0x7d)](_0x123ba2,_0x55cc0b);}async['genXmlMsg'](_0xa02f9,_0x39f576){const _0x22387e=_0x2f1855;return _0x22387e(0xd8)+_0xa02f9[_0x22387e(0xc5)][0x0]+_0x22387e(0x80)+_0xa02f9[_0x22387e(0xd4)][0x0]+_0x22387e(0x99)+new Date()['getTime']()+_0x22387e(0xa9)+_0x39f576+']]></Content>\x0a\x20\x20\x20\x20</xml>';}async[_0x2f1855(0xcb)](_0x12c13e){const _0x5a612c=_0x2f1855,_0xcf95e7=new Promise((_0x24c14f,_0x1f2c74)=>{setTimeout(()=>{const _0x1eb9ee=_0x4308;_0x1f2c74(new Error(_0x1eb9ee(0xcc)));},0x12c0);});let _0x408eb1='';return _0x408eb1=await this[_0x5a612c(0xbb)][_0x5a612c(0xac)](_0x12c13e)||await this['globalConfigService'][_0x5a612c(0xb2)]([_0x5a612c(0x77)])||_0x5a612c(0xb4),_0x408eb1;}};OfficialService=__decorate([(0x0,common_1[_0x2f1855(0xd2)])(),__metadata(_0x2f1855(0x79),[autoreply_service_1[_0x2f1855(0xae)],user_service_1['UserService'],auth_service_1['AuthService'],globalConfig_service_1[_0x2f1855(0x7a)],chatgpt_service_1[_0x2f1855(0xa5)]])],OfficialService),exports['OfficialService']=OfficialService;