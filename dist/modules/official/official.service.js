'use strict';const _0x34d47a=_0x3b89;(function(_0x1b06a3,_0x8fa0cf){const _0x3fc70c=_0x3b89,_0x2e69b9=_0x1b06a3();while(!![]){try{const _0xde844=-parseInt(_0x3fc70c(0x7f))/0x1+-parseInt(_0x3fc70c(0xb7))/0x2*(-parseInt(_0x3fc70c(0xa4))/0x3)+-parseInt(_0x3fc70c(0x97))/0x4*(-parseInt(_0x3fc70c(0x99))/0x5)+-parseInt(_0x3fc70c(0xd4))/0x6+-parseInt(_0x3fc70c(0x8e))/0x7*(parseInt(_0x3fc70c(0xb6))/0x8)+parseInt(_0x3fc70c(0xbd))/0x9*(parseInt(_0x3fc70c(0x90))/0xa)+-parseInt(_0x3fc70c(0xc8))/0xb;if(_0xde844===_0x8fa0cf)break;else _0x2e69b9['push'](_0x2e69b9['shift']());}catch(_0x3d9951){_0x2e69b9['push'](_0x2e69b9['shift']());}}}(_0x3a5a,0xab4c5));var __decorate=this&&this[_0x34d47a(0x89)]||function(_0x2514f5,_0x2d62e,_0x57b45d,_0x58e5d0){const _0x53d400=_0x34d47a;var _0x292d1b=arguments[_0x53d400(0xdb)],_0x13e452=_0x292d1b<0x3?_0x2d62e:_0x58e5d0===null?_0x58e5d0=Object[_0x53d400(0xbe)](_0x2d62e,_0x57b45d):_0x58e5d0,_0x1d4ec7;if(typeof Reflect==='object'&&typeof Reflect[_0x53d400(0x7e)]===_0x53d400(0xd6))_0x13e452=Reflect[_0x53d400(0x7e)](_0x2514f5,_0x2d62e,_0x57b45d,_0x58e5d0);else{for(var _0x2afb39=_0x2514f5[_0x53d400(0xdb)]-0x1;_0x2afb39>=0x0;_0x2afb39--)if(_0x1d4ec7=_0x2514f5[_0x2afb39])_0x13e452=(_0x292d1b<0x3?_0x1d4ec7(_0x13e452):_0x292d1b>0x3?_0x1d4ec7(_0x2d62e,_0x57b45d,_0x13e452):_0x1d4ec7(_0x2d62e,_0x57b45d))||_0x13e452;}return _0x292d1b>0x3&&_0x13e452&&Object[_0x53d400(0x88)](_0x2d62e,_0x57b45d,_0x13e452),_0x13e452;},__metadata=this&&this[_0x34d47a(0xb0)]||function(_0x142f21,_0x21212f){const _0x4ee6ef=_0x34d47a;if(typeof Reflect===_0x4ee6ef(0xdf)&&typeof Reflect[_0x4ee6ef(0x84)]==='function')return Reflect[_0x4ee6ef(0x84)](_0x142f21,_0x21212f);};Object[_0x34d47a(0x88)](exports,_0x34d47a(0xc1),{'value':!![]}),exports[_0x34d47a(0xcb)]=void 0x0;const chatgpt_service_1=require(_0x34d47a(0xb9)),globalConfig_service_1=require(_0x34d47a(0xe0)),auth_service_1=require(_0x34d47a(0x9b)),user_service_1=require(_0x34d47a(0x94)),autoreply_service_1=require('./../autoreply/autoreply.service'),common_1=require('@nestjs/common'),crypto=require('crypto'),axios_1=require(_0x34d47a(0xd9)),utils_1=require(_0x34d47a(0xba));function _0x3b89(_0x53d0ad,_0x1a2d65){const _0x3a5a19=_0x3a5a();return _0x3b89=function(_0x3b8925,_0x3077fe){_0x3b8925=_0x3b8925-0x7e;let _0x5531bc=_0x3a5a19[_0x3b8925];return _0x5531bc;},_0x3b89(_0x53d0ad,_0x1a2d65);}function _0x3a5a(){const _0x40076e=['toFixed','jiangly','authService','createRandomNonceStr','loginByCode','回跳跳转地址:\x20','3201DZgvKX','fetchQRCodeTicket','user','digest','BAD_REQUEST','getQRSceneStrByBind','verify','getConfigs','getTime','QR_STR_SCENE','jsapi_ticket=','bindWx','__metadata','getUserOpenId','sceneStrMap','join','sort','getWechatAccessToken','1695824OMqBqy','2290aGhufs','getUserById','./../chatgpt/chatgpt.service','../../common/utils','scan','officialAutoReplyText','208323TwMKcA','getOwnPropertyDescriptor','hex','globalConfigService','__esModule','loginBySceneStr',']]></FromUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<CreateTime>','loginByOpenId','&grant_type=authorization_code',']]></ToUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<FromUserName><![CDATA[','getRedirectUrl','2587420ktLxaZ','now','onModuleInit','OfficialService','get',']]></Content>\x0a\x20\x20\x20\x20</xml>','chatgptService','&noncestr=','HttpStatus','wechatOfficialAppSecret','https://api.weixin.qq.com/cgi-bin/qrcode/create?access_token=','checkAutoReply','2855172rRcVcm','&code=','function','log','post','axios','split','length','非法参数','createHash','fromusername','object','./../globalConfig/globalConfig.service','wechatJsapiTicket','decorate','378229aUdpGR','&response_type=code&scope=snsapi_base&state=weChatLogin#wechat_redirect','</CreateTime>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<MsgType><![CDATA[text]]></MsgType>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<Content><![CDATA[','default','genXmlMsgByConfig','metadata','Injectable','AutoreplyService','wechatOfficialToken','defineProperty','__decorate','&timestamp=','&redirect_uri=','wechatOfficialAppId','scanedSceneStrMap','7FIGCax','AuthService','160phJwTP','getQRCodeTicket','sha1','genXmlMsg','./../user/user.service','bindWxBySceneStr','由于公众号的回复限制、过长的问题我们可能无法回复、您可以前往我们的官方站点享受更加完善的服务、如果您有更多问题、欢迎像我提问！','1643436mggnAx','str:\x20','5WzyWOE','HttpException','./../auth/auth.service','userService','\x0a\x20\x20\x20\x20<xml>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<ToUserName><![CDATA['];_0x3a5a=function(){return _0x40076e;};return _0x3a5a();}let OfficialService=class OfficialService{constructor(_0x215af0,_0x570714,_0x3b0e7d,_0x24c21a,_0x5482e1){const _0x56efc1=_0x34d47a;this['autoreplyService']=_0x215af0,this[_0x56efc1(0x9c)]=_0x570714,this[_0x56efc1(0xa0)]=_0x3b0e7d,this['globalConfigService']=_0x24c21a,this[_0x56efc1(0xce)]=_0x5482e1,this[_0x56efc1(0xb2)]={},this[_0x56efc1(0x8d)]={};}async[_0x34d47a(0xca)](){const _0x5c6965=_0x34d47a;await this['globalConfigService'][_0x5c6965(0xb5)](!![]);}async['getQRSceneStr'](_0x41df38){const _0x26d37b=_0x34d47a,{invitedBy:_0x4714c8}=_0x41df38;let _0x29c6dc=(0x0,utils_1[_0x26d37b(0xa1)])(0x20);return _0x4714c8&&(_0x29c6dc+=':'+_0x4714c8),this[_0x26d37b(0xb2)][_0x29c6dc]=!![],_0x29c6dc;}async[_0x34d47a(0xa9)](_0x5f1775){const _0x1eb5fa=_0x34d47a,{id:_0x1d22f7}=_0x5f1775[_0x1eb5fa(0xa6)],_0x5867af=(0x0,utils_1[_0x1eb5fa(0xa1)])(0x20)+'/'+_0x1d22f7;return this['sceneStrMap'][_0x5867af]=!![],_0x5867af;}async[_0x34d47a(0x91)](_0x44ee8b){const _0xe7ae28=_0x34d47a;return this[_0xe7ae28(0xa5)](_0x44ee8b);}async[_0x34d47a(0xc7)](_0xc0e74c){const _0x467abb=_0x34d47a,_0x3781bd=await this[_0x467abb(0xc0)][_0x467abb(0xab)]([_0x467abb(0x8c)]),_0x5ea18e='https://open.weixin.qq.com/connect/oauth2/authorize?appid='+_0x3781bd+_0x467abb(0x8b)+encodeURIComponent(_0xc0e74c)+_0x467abb(0x80);return console['log'](_0x467abb(0xa3),_0x5ea18e),_0x5ea18e;}async['getJsapiTicket'](_0x5dab60){const _0x100623=_0x34d47a,_0x37645e=(0x0,utils_1['createRandomNonceStr'])(0x20),_0x53c4ec=(Date[_0x100623(0xc9)]()/0x3e8)[_0x100623(0x9e)](0x0),_0x714e5f=await this[_0x100623(0xc0)]['getConfigs']([_0x100623(0xe1)]),_0x177632=await this[_0x100623(0xc0)]['getConfigs']([_0x100623(0x8c)]);console[_0x100623(0xd7)]('appId:\x20',_0x177632);const _0x29a958=_0x100623(0xae)+_0x714e5f+_0x100623(0xcf)+_0x37645e+_0x100623(0x8a)+_0x53c4ec+'&url='+_0x5dab60;console[_0x100623(0xd7)](_0x100623(0x98),_0x29a958);const _0x78f734=this[_0x100623(0x92)](_0x29a958);return{'appId':_0x177632,'nonceStr':_0x37645e,'timestamp':_0x53c4ec,'signature':_0x78f734};}async[_0x34d47a(0xa5)](_0x2e1539){const _0x3d2c1d=_0x34d47a,_0xbf4579=await this[_0x3d2c1d(0xc0)][_0x3d2c1d(0xab)](['wechatAccessToken']),_0x5262ae={'action_name':_0x3d2c1d(0xad),'action_info':{'scene':{'scene_str':_0x2e1539}}},_0x3a56ab=await axios_1[_0x3d2c1d(0x82)][_0x3d2c1d(0xd8)](_0x3d2c1d(0xd2)+_0xbf4579,_0x5262ae),{data:{errmsg:_0x35bfbd,ticket:_0x62f2da}}=_0x3a56ab;if(_0x35bfbd)throw new common_1[(_0x3d2c1d(0x9a))](_0x35bfbd,common_1['HttpStatus'][_0x3d2c1d(0xa8)]);return _0x62f2da;}async[_0x34d47a(0xa2)](_0x5c7134,_0x1b71b0){const _0x5e90ff=_0x34d47a,_0x3bb7be=await this[_0x5e90ff(0xc0)]['getConfigs']([_0x5e90ff(0x8c)]),_0x47952b=await this['globalConfigService'][_0x5e90ff(0xab)]([_0x5e90ff(0xd1)]),_0xe4c27b=await axios_1[_0x5e90ff(0x82)][_0x5e90ff(0xcc)]('https://api.weixin.qq.com/sns/oauth2/access_token?appid='+_0x3bb7be+'&secret='+_0x47952b+_0x5e90ff(0xd5)+_0x1b71b0+_0x5e90ff(0xc5)),{data:{errmsg:_0x27c98b,openid:_0x27e8e2}}=_0xe4c27b;if(_0x27c98b)throw new common_1[(_0x5e90ff(0x9a))](_0x27c98b,common_1[_0x5e90ff(0xd0)][_0x5e90ff(0xa8)]);let _0x12222a;return _0x12222a=await this[_0x5e90ff(0x9c)][_0x5e90ff(0xb1)](_0x27e8e2),!_0x12222a&&(_0x12222a=await this[_0x5e90ff(0x9c)]['getUserFromOpenId'](_0x27e8e2)),this[_0x5e90ff(0xa0)]['loginByOpenId'](_0x12222a,_0x5c7134);}async[_0x34d47a(0xbb)](_0x215c7d,_0x5baf58){const _0x362353=_0x34d47a;if(!this[_0x362353(0xb2)][_0x5baf58])throw new common_1[(_0x362353(0x9a))]('非法参数',common_1[_0x362353(0xd0)][_0x362353(0xa8)]);const _0x4cf8f3=await this[_0x362353(0x9c)]['getUserFromOpenId'](_0x215c7d,_0x5baf58);this['scanedSceneStrMap'][_0x5baf58]=_0x4cf8f3['id'];}async[_0x34d47a(0xc2)](_0x58f55d,_0x5b8561){const _0x165d6f=_0x34d47a;if(!this[_0x165d6f(0xb2)][_0x5b8561])return;const _0x3cf6b1=this[_0x165d6f(0x8d)][_0x5b8561];if(!_0x3cf6b1)return'';const _0x170e91=await this[_0x165d6f(0x9c)][_0x165d6f(0xb8)](_0x3cf6b1);return delete this['scanedSceneStrMap'][_0x5b8561],this[_0x165d6f(0xa0)][_0x165d6f(0xc4)](_0x170e91,_0x58f55d);}async['scanBindWx'](_0x5aafa0,_0x2db186){const _0x1f04ae=_0x34d47a;if(!this[_0x1f04ae(0xb2)][_0x2db186])throw new common_1['HttpException'](_0x1f04ae(0xdc),common_1[_0x1f04ae(0xd0)][_0x1f04ae(0xa8)]);const _0x541348=_0x2db186[_0x1f04ae(0xda)]('/')[0x1],_0x3dd599=await this[_0x1f04ae(0x9c)][_0x1f04ae(0xaf)](_0x5aafa0,_0x541348);this['scanedSceneStrMap'][_0x2db186]=_0x3dd599;}async[_0x34d47a(0x95)](_0x1655b7,_0x3798b0){const _0x82f968=_0x34d47a;if(!this[_0x82f968(0xb2)][_0x3798b0])throw new common_1[(_0x82f968(0x9a))]('非法参数',common_1[_0x82f968(0xd0)]['BAD_REQUEST']);const {id:_0x1a9a96}=_0x1655b7[_0x82f968(0xa6)],_0x4969f1=this[_0x82f968(0x8d)][_0x3798b0];if(!_0x4969f1)return'';return delete this[_0x82f968(0x8d)][_0x3798b0],_0x4969f1;}async[_0x34d47a(0xaa)](_0x2a6f06,_0x3b5724,_0x5553df){const _0x4d0d60=_0x34d47a,_0x149370=await this[_0x4d0d60(0xc0)][_0x4d0d60(0xab)]([_0x4d0d60(0x87)])||_0x4d0d60(0x9f);return await this[_0x4d0d60(0x92)]([_0x149370,_0x3b5724,_0x5553df][_0x4d0d60(0xb4)]()[_0x4d0d60(0xb3)](''))==_0x2a6f06;}[_0x34d47a(0x92)](_0x56da5c){const _0x38be9a=_0x34d47a;return crypto[_0x38be9a(0xdd)](_0x38be9a(0x92))['update'](_0x56da5c)[_0x38be9a(0xa7)](_0x38be9a(0xbf));}async[_0x34d47a(0x83)](_0x4f79e5,_0x51acb5){const _0x493b30=_0x34d47a,_0x3a579a=await this[_0x493b30(0xc0)]['getConfigs']([_0x51acb5]);return this[_0x493b30(0x93)](_0x4f79e5,_0x3a579a);}async[_0x34d47a(0x93)](_0x492b8a,_0x2c12d1){const _0x424176=_0x34d47a;return _0x424176(0x9d)+_0x492b8a[_0x424176(0xde)][0x0]+_0x424176(0xc6)+_0x492b8a['tousername'][0x0]+_0x424176(0xc3)+new Date()[_0x424176(0xac)]()+_0x424176(0x81)+_0x2c12d1+_0x424176(0xcd);}async['aotoPlay'](_0x2b7519){const _0x2573d8=_0x34d47a,_0x5f2635=new Promise((_0x27322d,_0x18e53e)=>{setTimeout(()=>{_0x18e53e(new Error('请求超时'));},0x12c0);});let _0x4e2196='';return _0x4e2196=await this['autoreplyService'][_0x2573d8(0xd3)](_0x2b7519)||await this['globalConfigService'][_0x2573d8(0xab)]([_0x2573d8(0xbc)])||_0x2573d8(0x96),_0x4e2196;}};OfficialService=__decorate([(0x0,common_1[_0x34d47a(0x85)])(),__metadata('design:paramtypes',[autoreply_service_1[_0x34d47a(0x86)],user_service_1['UserService'],auth_service_1[_0x34d47a(0x8f)],globalConfig_service_1['GlobalConfigService'],chatgpt_service_1['ChatgptService']])],OfficialService),exports['OfficialService']=OfficialService;