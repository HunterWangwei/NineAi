'use strict';const _0x2d80c3=_0x179c;(function(_0x4d66b5,_0xb2963a){const _0x3e2c96=_0x179c,_0x5f4715=_0x4d66b5();while(!![]){try{const _0x3f8a6c=-parseInt(_0x3e2c96(0x130))/0x1+-parseInt(_0x3e2c96(0x11f))/0x2+parseInt(_0x3e2c96(0x105))/0x3*(-parseInt(_0x3e2c96(0x128))/0x4)+parseInt(_0x3e2c96(0x12f))/0x5+parseInt(_0x3e2c96(0x136))/0x6*(parseInt(_0x3e2c96(0x10e))/0x7)+parseInt(_0x3e2c96(0x10c))/0x8*(-parseInt(_0x3e2c96(0x11b))/0x9)+parseInt(_0x3e2c96(0x102))/0xa;if(_0x3f8a6c===_0xb2963a)break;else _0x5f4715['push'](_0x5f4715['shift']());}catch(_0x18c95e){_0x5f4715['push'](_0x5f4715['shift']());}}}(_0x22cc,0xdec6e));function _0x179c(_0x4b2069,_0x57cda6){const _0x22cca2=_0x22cc();return _0x179c=function(_0x179c89,_0x417185){_0x179c89=_0x179c89-0xfc;let _0x3cfeed=_0x22cca2[_0x179c89];return _0x3cfeed;},_0x179c(_0x4b2069,_0x57cda6);}var __decorate=this&&this[_0x2d80c3(0x107)]||function(_0x3abd7c,_0x378a64,_0x42767a,_0x197715){const _0x2ece53=_0x2d80c3;var _0x2c2061=arguments[_0x2ece53(0x10a)],_0x43796b=_0x2c2061<0x3?_0x378a64:_0x197715===null?_0x197715=Object[_0x2ece53(0x108)](_0x378a64,_0x42767a):_0x197715,_0x4c4dbc;if(typeof Reflect==='object'&&typeof Reflect[_0x2ece53(0xfe)]===_0x2ece53(0x147))_0x43796b=Reflect[_0x2ece53(0xfe)](_0x3abd7c,_0x378a64,_0x42767a,_0x197715);else{for(var _0x4f9f5c=_0x3abd7c[_0x2ece53(0x10a)]-0x1;_0x4f9f5c>=0x0;_0x4f9f5c--)if(_0x4c4dbc=_0x3abd7c[_0x4f9f5c])_0x43796b=(_0x2c2061<0x3?_0x4c4dbc(_0x43796b):_0x2c2061>0x3?_0x4c4dbc(_0x378a64,_0x42767a,_0x43796b):_0x4c4dbc(_0x378a64,_0x42767a))||_0x43796b;}return _0x2c2061>0x3&&_0x43796b&&Object[_0x2ece53(0x139)](_0x378a64,_0x42767a,_0x43796b),_0x43796b;},__metadata=this&&this['__metadata']||function(_0x1c9395,_0x35d8b3){const _0xcd8e04=_0x2d80c3;if(typeof Reflect===_0xcd8e04(0x151)&&typeof Reflect[_0xcd8e04(0x144)]==='function')return Reflect[_0xcd8e04(0x144)](_0x1c9395,_0x35d8b3);};Object['defineProperty'](exports,_0x2d80c3(0x106),{'value':!![]}),exports[_0x2d80c3(0x150)]=void 0x0;const chatgpt_service_1=require('./../chatgpt/chatgpt.service'),globalConfig_service_1=require(_0x2d80c3(0x114)),auth_service_1=require(_0x2d80c3(0x157)),user_service_1=require(_0x2d80c3(0x103)),autoreply_service_1=require('./../autoreply/autoreply.service'),common_1=require(_0x2d80c3(0x14f)),crypto=require(_0x2d80c3(0x11e)),axios_1=require(_0x2d80c3(0x154)),utils_1=require(_0x2d80c3(0x118));let OfficialService=class OfficialService{constructor(_0x54e277,_0x1e0299,_0x3b0248,_0x32193a,_0x694a93){const _0x5571e9=_0x2d80c3;this[_0x5571e9(0x13b)]=_0x54e277,this[_0x5571e9(0x13c)]=_0x1e0299,this[_0x5571e9(0x119)]=_0x3b0248,this[_0x5571e9(0x10f)]=_0x32193a,this[_0x5571e9(0x153)]=_0x694a93,this[_0x5571e9(0x113)]={},this[_0x5571e9(0x11d)]={};}async[_0x2d80c3(0x134)](){const _0x3602ae=_0x2d80c3;await this[_0x3602ae(0x10f)]['getWechatAccessToken'](!![]);}async[_0x2d80c3(0x14d)](_0x509ac3){const _0x243210=_0x2d80c3,{invitedBy:_0x45bc3d}=_0x509ac3;let _0x3a577d=(0x0,utils_1[_0x243210(0x132)])(0x20);return _0x45bc3d&&(_0x3a577d+=':'+_0x45bc3d),this[_0x243210(0x113)][_0x3a577d]=!![],_0x3a577d;}async['getQRSceneStrByBind'](_0x4cc186){const _0x46dd36=_0x2d80c3,{id:_0x41d97b}=_0x4cc186[_0x46dd36(0x124)],_0x5c2aaf=(0x0,utils_1[_0x46dd36(0x132)])(0x20)+'/'+_0x41d97b;return this[_0x46dd36(0x113)][_0x5c2aaf]=!![],_0x5c2aaf;}async[_0x2d80c3(0xff)](_0x230a0f){return this['fetchQRCodeTicket'](_0x230a0f);}async[_0x2d80c3(0x126)](_0x216a56){const _0xb10332=_0x2d80c3,_0x5d2bc3=await this[_0xb10332(0x10f)][_0xb10332(0xfd)]([_0xb10332(0x12d)]),_0x5112ae=_0xb10332(0x133)+_0x5d2bc3+_0xb10332(0x12c)+encodeURIComponent(_0x216a56)+_0xb10332(0x116);return console['log'](_0xb10332(0x158),_0x5112ae),_0x5112ae;}async[_0x2d80c3(0x12a)](_0x2be614){const _0x4cd406=_0x2d80c3,_0x2b6854=(0x0,utils_1[_0x4cd406(0x132)])(0x20),_0x2e3273=(Date[_0x4cd406(0x13f)]()/0x3e8)[_0x4cd406(0x145)](0x0),_0x26e507=await this[_0x4cd406(0x10f)][_0x4cd406(0xfd)](['wechatJsapiTicket']),_0xe60200=await this['globalConfigService'][_0x4cd406(0xfd)]([_0x4cd406(0x12d)]);console[_0x4cd406(0x112)](_0x4cd406(0x117),_0xe60200);const _0x22097b='jsapi_ticket='+_0x26e507+_0x4cd406(0x148)+_0x2b6854+_0x4cd406(0x138)+_0x2e3273+_0x4cd406(0x146)+_0x2be614;console['log'](_0x4cd406(0x12e),_0x22097b);const _0x4aa295=this['sha1'](_0x22097b);return{'appId':_0xe60200,'nonceStr':_0x2b6854,'timestamp':_0x2e3273,'signature':_0x4aa295};}async[_0x2d80c3(0x14b)](_0x18d6f5){const _0x5a48b3=_0x2d80c3,_0x3a4701=await this[_0x5a48b3(0x10f)][_0x5a48b3(0xfd)](['wechatAccessToken']),_0x5e62b1={'action_name':'QR_STR_SCENE','action_info':{'scene':{'scene_str':_0x18d6f5}}},_0x1cf5d5=await axios_1['default']['post'](_0x5a48b3(0x135)+_0x3a4701,_0x5e62b1),{data:{errmsg:_0x3cabe9,ticket:_0x2d8cf8}}=_0x1cf5d5;if(_0x3cabe9)throw new common_1['HttpException'](_0x3cabe9,common_1[_0x5a48b3(0x123)][_0x5a48b3(0x115)]);return _0x2d8cf8;}async[_0x2d80c3(0x14a)](_0x475c89,_0x35503b){const _0x42ae50=_0x2d80c3,_0x4bccaf=await this[_0x42ae50(0x10f)][_0x42ae50(0xfd)]([_0x42ae50(0x12d)]),_0xfb161=await this[_0x42ae50(0x10f)][_0x42ae50(0xfd)]([_0x42ae50(0x110)]),_0x137663=await axios_1['default']['get'](_0x42ae50(0x149)+_0x4bccaf+_0x42ae50(0x152)+_0xfb161+_0x42ae50(0x155)+_0x35503b+_0x42ae50(0x13d)),{data:{errmsg:_0x124e5f,openid:_0x6741ea}}=_0x137663;if(_0x124e5f)throw new common_1[(_0x42ae50(0x11c))](_0x124e5f,common_1[_0x42ae50(0x123)][_0x42ae50(0x115)]);let _0x14895d;return _0x14895d=await this[_0x42ae50(0x13c)][_0x42ae50(0x122)](_0x6741ea),!_0x14895d&&(_0x14895d=await this[_0x42ae50(0x13c)][_0x42ae50(0x129)](_0x6741ea)),this[_0x42ae50(0x119)][_0x42ae50(0x159)](_0x14895d,_0x475c89);}async[_0x2d80c3(0x111)](_0x17e0f6,_0x37cfe9){const _0x48f356=_0x2d80c3;if(!this[_0x48f356(0x113)][_0x37cfe9])throw new common_1[(_0x48f356(0x11c))](_0x48f356(0x14c),common_1[_0x48f356(0x123)][_0x48f356(0x115)]);const _0x251bcd=await this[_0x48f356(0x13c)][_0x48f356(0x129)](_0x17e0f6,_0x37cfe9);this[_0x48f356(0x11d)][_0x37cfe9]=_0x251bcd['id'];}async[_0x2d80c3(0x12b)](_0x4fa2e4,_0x42c8dc){const _0x27eece=_0x2d80c3;if(!this[_0x27eece(0x113)][_0x42c8dc])return;const _0x337b99=this[_0x27eece(0x11d)][_0x42c8dc];if(!_0x337b99)return'';const _0x39841e=await this[_0x27eece(0x13c)][_0x27eece(0x10d)](_0x337b99);return delete this['scanedSceneStrMap'][_0x42c8dc],this[_0x27eece(0x119)][_0x27eece(0x159)](_0x39841e,_0x4fa2e4);}async['scanBindWx'](_0x29a45e,_0x340552){const _0x4b8013=_0x2d80c3;if(!this[_0x4b8013(0x113)][_0x340552])throw new common_1['HttpException'](_0x4b8013(0x14c),common_1[_0x4b8013(0x123)][_0x4b8013(0x115)]);const _0xce1c60=_0x340552['split']('/')[0x1],_0x5aa159=await this[_0x4b8013(0x13c)][_0x4b8013(0x121)](_0x29a45e,_0xce1c60);this[_0x4b8013(0x11d)][_0x340552]=_0x5aa159;}async[_0x2d80c3(0x11a)](_0x1ce7a5,_0x580e35){const _0x35eb74=_0x2d80c3;if(!this[_0x35eb74(0x113)][_0x580e35])throw new common_1[(_0x35eb74(0x11c))]('非法参数',common_1[_0x35eb74(0x123)]['BAD_REQUEST']);const {id:_0x197a88}=_0x1ce7a5[_0x35eb74(0x124)],_0x25010a=this['scanedSceneStrMap'][_0x580e35];if(!_0x25010a)return'';return delete this['scanedSceneStrMap'][_0x580e35],_0x25010a;}async[_0x2d80c3(0x140)](_0x3dfb39,_0x269125,_0x260c6c){const _0x936f02=_0x2d80c3,_0x45cfc4=await this[_0x936f02(0x10f)][_0x936f02(0xfd)]([_0x936f02(0x100)])||_0x936f02(0x101);return await this[_0x936f02(0x109)]([_0x45cfc4,_0x269125,_0x260c6c][_0x936f02(0x13a)]()['join'](''))==_0x3dfb39;}['sha1'](_0x14b2c3){const _0x1aa227=_0x2d80c3;return crypto[_0x1aa227(0x131)]('sha1')['update'](_0x14b2c3)[_0x1aa227(0x13e)](_0x1aa227(0x120));}async['genXmlMsgByConfig'](_0x3afc0f,_0x5ec7fc){const _0x292e29=_0x2d80c3,_0x3e7342=await this['globalConfigService'][_0x292e29(0xfd)]([_0x5ec7fc]);return this['genXmlMsg'](_0x3afc0f,_0x3e7342);}async['genXmlMsg'](_0x593d24,_0x35d31b){const _0x55d52f=_0x2d80c3;return _0x55d52f(0x137)+_0x593d24[_0x55d52f(0xfc)][0x0]+']]></ToUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<FromUserName><![CDATA['+_0x593d24['tousername'][0x0]+_0x55d52f(0x125)+new Date()[_0x55d52f(0x141)]()+_0x55d52f(0x143)+_0x35d31b+_0x55d52f(0x142);}async['aotoPlay'](_0x444999){const _0x109ee2=_0x2d80c3,_0x1e18a4=new Promise((_0x43797a,_0x1dd820)=>{setTimeout(()=>{const _0x699ad1=_0x179c;_0x1dd820(new Error(_0x699ad1(0x10b)));},0x12c0);});let _0x2a2f8e='';return _0x2a2f8e=await this['autoreplyService'][_0x109ee2(0x104)](_0x444999)||await this['globalConfigService'][_0x109ee2(0xfd)]([_0x109ee2(0x127)])||'由于公众号的回复限制、过长的问题我们可能无法回复、您可以前往我们的官方站点享受更加完善的服务、如果您有更多问题、欢迎像我提问！',_0x2a2f8e;}};function _0x22cc(){const _0x194c2d=['&code=','ChatgptService','./../auth/auth.service','回跳跳转地址:\x20','loginByOpenId','fromusername','getConfigs','decorate','getQRCodeTicket','wechatOfficialToken','jiangly','25458660sXtmbu','./../user/user.service','checkAutoReply','79071DBERNl','__esModule','__decorate','getOwnPropertyDescriptor','sha1','length','请求超时','3224056OvVVIk','getUserById','112LocCKH','globalConfigService','wechatOfficialAppSecret','scan','log','sceneStrMap','./../globalConfig/globalConfig.service','BAD_REQUEST','&response_type=code&scope=snsapi_base&state=weChatLogin#wechat_redirect','appId:\x20','../../common/utils','authService','bindWxBySceneStr','27Rkbmxq','HttpException','scanedSceneStrMap','crypto','2230018CuiTLn','hex','bindWx','getUserOpenId','HttpStatus','user',']]></FromUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<CreateTime>','getRedirectUrl','officialAutoReplyText','168vJJMQo','getUserFromOpenId','getJsapiTicket','loginBySceneStr','&redirect_uri=','wechatOfficialAppId','str:\x20','8728080WPrfGB','369644qfboog','createHash','createRandomNonceStr','https://open.weixin.qq.com/connect/oauth2/authorize?appid=','onModuleInit','https://api.weixin.qq.com/cgi-bin/qrcode/create?access_token=','158130yxPjek','\x0a\x20\x20\x20\x20<xml>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<ToUserName><![CDATA[','&timestamp=','defineProperty','sort','autoreplyService','userService','&grant_type=authorization_code','digest','now','verify','getTime',']]></Content>\x0a\x20\x20\x20\x20</xml>','</CreateTime>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<MsgType><![CDATA[text]]></MsgType>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<Content><![CDATA[','metadata','toFixed','&url=','function','&noncestr=','https://api.weixin.qq.com/sns/oauth2/access_token?appid=','loginByCode','fetchQRCodeTicket','非法参数','getQRSceneStr','GlobalConfigService','@nestjs/common','OfficialService','object','&secret=','chatgptService','axios'];_0x22cc=function(){return _0x194c2d;};return _0x22cc();}OfficialService=__decorate([(0x0,common_1['Injectable'])(),__metadata('design:paramtypes',[autoreply_service_1['AutoreplyService'],user_service_1['UserService'],auth_service_1['AuthService'],globalConfig_service_1[_0x2d80c3(0x14e)],chatgpt_service_1[_0x2d80c3(0x156)]])],OfficialService),exports['OfficialService']=OfficialService;