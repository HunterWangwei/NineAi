'use strict';const _0x5301ba=_0x3c03;(function(_0x5c7cdf,_0x5c2e12){const _0x45849d=_0x3c03,_0xd2eba=_0x5c7cdf();while(!![]){try{const _0x263603=-parseInt(_0x45849d(0x195))/0x1*(parseInt(_0x45849d(0x1b5))/0x2)+parseInt(_0x45849d(0x1a8))/0x3+-parseInt(_0x45849d(0x1c7))/0x4*(parseInt(_0x45849d(0x18d))/0x5)+-parseInt(_0x45849d(0x1a1))/0x6+-parseInt(_0x45849d(0x1c0))/0x7*(-parseInt(_0x45849d(0x1a2))/0x8)+-parseInt(_0x45849d(0x1b2))/0x9+parseInt(_0x45849d(0x198))/0xa;if(_0x263603===_0x5c2e12)break;else _0xd2eba['push'](_0xd2eba['shift']());}catch(_0x5e89b9){_0xd2eba['push'](_0xd2eba['shift']());}}}(_0x1c42,0x5e2da));var __decorate=this&&this['__decorate']||function(_0x58233d,_0x5990ca,_0x1001b0,_0x60598a){const _0x16bc4b=_0x3c03;var _0x31a2b6=arguments[_0x16bc4b(0x186)],_0x567d69=_0x31a2b6<0x3?_0x5990ca:_0x60598a===null?_0x60598a=Object['getOwnPropertyDescriptor'](_0x5990ca,_0x1001b0):_0x60598a,_0x2df485;if(typeof Reflect===_0x16bc4b(0x178)&&typeof Reflect[_0x16bc4b(0x1c9)]===_0x16bc4b(0x17e))_0x567d69=Reflect[_0x16bc4b(0x1c9)](_0x58233d,_0x5990ca,_0x1001b0,_0x60598a);else{for(var _0x450fc9=_0x58233d[_0x16bc4b(0x186)]-0x1;_0x450fc9>=0x0;_0x450fc9--)if(_0x2df485=_0x58233d[_0x450fc9])_0x567d69=(_0x31a2b6<0x3?_0x2df485(_0x567d69):_0x31a2b6>0x3?_0x2df485(_0x5990ca,_0x1001b0,_0x567d69):_0x2df485(_0x5990ca,_0x1001b0))||_0x567d69;}return _0x31a2b6>0x3&&_0x567d69&&Object[_0x16bc4b(0x1ab)](_0x5990ca,_0x1001b0,_0x567d69),_0x567d69;},__metadata=this&&this['__metadata']||function(_0x276e1a,_0x520024){const _0x40aeb0=_0x3c03;if(typeof Reflect===_0x40aeb0(0x178)&&typeof Reflect[_0x40aeb0(0x1c3)]===_0x40aeb0(0x17e))return Reflect[_0x40aeb0(0x1c3)](_0x276e1a,_0x520024);};Object[_0x5301ba(0x1ab)](exports,'__esModule',{'value':!![]}),exports[_0x5301ba(0x19c)]=void 0x0;const chatgpt_service_1=require(_0x5301ba(0x1cd)),globalConfig_service_1=require(_0x5301ba(0x17d)),auth_service_1=require(_0x5301ba(0x1b3)),user_service_1=require(_0x5301ba(0x1ba)),autoreply_service_1=require('./../autoreply/autoreply.service'),common_1=require(_0x5301ba(0x1a5)),crypto=require('crypto'),axios_1=require(_0x5301ba(0x1a9)),utils_1=require(_0x5301ba(0x183));let OfficialService=class OfficialService{constructor(_0xa2db97,_0x4b3b73,_0x522bcf,_0x1855f7,_0x7d4959){const _0xb2068b=_0x5301ba;this[_0xb2068b(0x192)]=_0xa2db97,this[_0xb2068b(0x1be)]=_0x4b3b73,this[_0xb2068b(0x173)]=_0x522bcf,this[_0xb2068b(0x191)]=_0x1855f7,this[_0xb2068b(0x189)]=_0x7d4959,this[_0xb2068b(0x1bd)]={},this[_0xb2068b(0x170)]={};}async[_0x5301ba(0x18a)](){const _0xceddf0=_0x5301ba;await this[_0xceddf0(0x191)][_0xceddf0(0x1cb)](!![]);}async[_0x5301ba(0x1aa)](_0x40ca82){const _0x2306ad=_0x5301ba,{invitedBy:_0x238f5e}=_0x40ca82;let _0x1505ef=(0x0,utils_1[_0x2306ad(0x1a0)])(0x20);return _0x238f5e&&(_0x1505ef+=':'+_0x238f5e),this['sceneStrMap'][_0x1505ef]=!![],_0x1505ef;}async['getQRSceneStrByBind'](_0x1007e7){const _0x438e12=_0x5301ba,{id:_0x426212}=_0x1007e7[_0x438e12(0x1a3)],_0x422d4f=(0x0,utils_1[_0x438e12(0x1a0)])(0x20)+'/'+_0x426212;return this[_0x438e12(0x1bd)][_0x422d4f]=!![],_0x422d4f;}async[_0x5301ba(0x171)](_0x4afeb4){const _0x2fda85=_0x5301ba;return this[_0x2fda85(0x1a7)](_0x4afeb4);}async[_0x5301ba(0x199)](_0x100829){const _0x5ee5e2=_0x5301ba,_0x184485=await this[_0x5ee5e2(0x191)][_0x5ee5e2(0x1c4)]([_0x5ee5e2(0x175)]),_0x485074='https://open.weixin.qq.com/connect/oauth2/authorize?appid='+_0x184485+'&redirect_uri='+encodeURIComponent(_0x100829)+_0x5ee5e2(0x1bc);return console[_0x5ee5e2(0x1b7)]('回跳跳转地址:\x20',_0x485074),_0x485074;}async['getJsapiTicket'](_0xa85d15){const _0x7416ca=_0x5301ba,_0x21059d=(0x0,utils_1[_0x7416ca(0x1a0)])(0x20),_0x1756ad=(Date['now']()/0x3e8)[_0x7416ca(0x1c5)](0x0),_0x453384=await this[_0x7416ca(0x191)][_0x7416ca(0x1c4)]([_0x7416ca(0x1b9)]),_0x625d08=await this[_0x7416ca(0x191)][_0x7416ca(0x1c4)](['wechatOfficialAppId']);console[_0x7416ca(0x1b7)]('appId:\x20',_0x625d08);const _0x481d04=_0x7416ca(0x194)+_0x453384+_0x7416ca(0x179)+_0x21059d+'&timestamp='+_0x1756ad+_0x7416ca(0x1b8)+_0xa85d15;console[_0x7416ca(0x1b7)](_0x7416ca(0x19e),_0x481d04);const _0x3d4d9a=this['sha1'](_0x481d04);return{'appId':_0x625d08,'nonceStr':_0x21059d,'timestamp':_0x1756ad,'signature':_0x3d4d9a};}async[_0x5301ba(0x1a7)](_0x9cd2a5){const _0x113903=_0x5301ba,_0xbf1542=await this['globalConfigService'][_0x113903(0x1c4)]([_0x113903(0x17b)]),_0x4b40cc={'action_name':'QR_STR_SCENE','action_info':{'scene':{'scene_str':_0x9cd2a5}}},_0x2fbbaf=await axios_1[_0x113903(0x1a6)][_0x113903(0x18b)]('https://api.weixin.qq.com/cgi-bin/qrcode/create?access_token='+_0xbf1542,_0x4b40cc),{data:{errmsg:_0x12bc04,ticket:_0xf5d95f}}=_0x2fbbaf;if(_0x12bc04)throw new common_1[(_0x113903(0x1c1))](_0x12bc04,common_1[_0x113903(0x1ae)][_0x113903(0x180)]);return _0xf5d95f;}async[_0x5301ba(0x184)](_0x41338c,_0x43eb57){const _0xfd1304=_0x5301ba,_0x8be6ed=await this[_0xfd1304(0x191)][_0xfd1304(0x1c4)](['wechatOfficialAppId']),_0x17554d=await this[_0xfd1304(0x191)][_0xfd1304(0x1c4)]([_0xfd1304(0x185)]),_0xefc93d=await axios_1[_0xfd1304(0x1a6)][_0xfd1304(0x1b0)]('https://api.weixin.qq.com/sns/oauth2/access_token?appid='+_0x8be6ed+_0xfd1304(0x193)+_0x17554d+_0xfd1304(0x18f)+_0x43eb57+_0xfd1304(0x1ca)),{data:{errmsg:_0x5acc71,openid:_0x44efcf}}=_0xefc93d;if(_0x5acc71)throw new common_1[(_0xfd1304(0x1c1))](_0x5acc71,common_1[_0xfd1304(0x1ae)][_0xfd1304(0x180)]);let _0x55bd4f;return _0x55bd4f=await this['userService'][_0xfd1304(0x1bb)](_0x44efcf),!_0x55bd4f&&(_0x55bd4f=await this[_0xfd1304(0x1be)][_0xfd1304(0x1c8)](_0x44efcf)),this[_0xfd1304(0x173)][_0xfd1304(0x1ce)](_0x55bd4f,_0x41338c);}async['scan'](_0xf80994,_0x4d359c){const _0x41ccc4=_0x5301ba;if(!this['sceneStrMap'][_0x4d359c])throw new common_1[(_0x41ccc4(0x1c1))](_0x41ccc4(0x187),common_1[_0x41ccc4(0x1ae)][_0x41ccc4(0x180)]);const _0x3e4ea8=await this[_0x41ccc4(0x1be)][_0x41ccc4(0x1c8)](_0xf80994,_0x4d359c);this[_0x41ccc4(0x170)][_0x4d359c]=_0x3e4ea8['id'];}async[_0x5301ba(0x1b6)](_0x1f4376,_0x456d38){const _0x5a0049=_0x5301ba;if(!this['sceneStrMap'][_0x456d38])return;const _0x3f493d=this[_0x5a0049(0x170)][_0x456d38];if(!_0x3f493d)return'';const _0x343e3a=await this[_0x5a0049(0x1be)][_0x5a0049(0x172)](_0x3f493d);return delete this['scanedSceneStrMap'][_0x456d38],this[_0x5a0049(0x173)]['loginByOpenId'](_0x343e3a,_0x1f4376);}async[_0x5301ba(0x1ac)](_0x12a168,_0xc7f263){const _0x64014=_0x5301ba;if(!this[_0x64014(0x1bd)][_0xc7f263])throw new common_1[(_0x64014(0x1c1))](_0x64014(0x187),common_1[_0x64014(0x1ae)][_0x64014(0x180)]);const _0x311bc6=_0xc7f263['split']('/')[0x1],_0x4530da=await this[_0x64014(0x1be)][_0x64014(0x19a)](_0x12a168,_0x311bc6);this[_0x64014(0x170)][_0xc7f263]=_0x4530da;}async['bindWxBySceneStr'](_0xf04fcf,_0x18898b){const _0x13e1b5=_0x5301ba;if(!this['sceneStrMap'][_0x18898b])throw new common_1['HttpException']('非法参数',common_1[_0x13e1b5(0x1ae)][_0x13e1b5(0x180)]);const {id:_0x381e79}=_0xf04fcf[_0x13e1b5(0x1a3)],_0x1b0ac4=this['scanedSceneStrMap'][_0x18898b];if(!_0x1b0ac4)return'';return delete this[_0x13e1b5(0x170)][_0x18898b],_0x1b0ac4;}async[_0x5301ba(0x17c)](_0x4eb433,_0x5e2994,_0x19bfad){const _0x193d69=_0x5301ba,_0x34b8ed=await this['globalConfigService'][_0x193d69(0x1c4)]([_0x193d69(0x19d)])||_0x193d69(0x190);return await this[_0x193d69(0x182)]([_0x34b8ed,_0x5e2994,_0x19bfad]['sort']()[_0x193d69(0x1ad)](''))==_0x4eb433;}['sha1'](_0x52a081){const _0x40b5e8=_0x5301ba;return crypto[_0x40b5e8(0x19b)](_0x40b5e8(0x182))[_0x40b5e8(0x1b4)](_0x52a081)['digest'](_0x40b5e8(0x174));}async[_0x5301ba(0x197)](_0x246012,_0x28bab0){const _0x9b3367=_0x5301ba,_0x504e62=await this[_0x9b3367(0x191)]['getConfigs']([_0x28bab0]);return this[_0x9b3367(0x1c2)](_0x246012,_0x504e62);}async[_0x5301ba(0x1c2)](_0x302745,_0x85c049){const _0x1b13a9=_0x5301ba;return _0x1b13a9(0x196)+_0x302745[_0x1b13a9(0x1af)][0x0]+_0x1b13a9(0x1a4)+_0x302745[_0x1b13a9(0x1bf)][0x0]+_0x1b13a9(0x177)+new Date()['getTime']()+_0x1b13a9(0x19f)+_0x85c049+_0x1b13a9(0x18e);}async[_0x5301ba(0x1b1)](_0x474d59){const _0x40a9fd=_0x5301ba,_0x1e21bd=new Promise((_0x327b74,_0x543b07)=>{setTimeout(()=>{const _0xdf21e8=_0x3c03;_0x543b07(new Error(_0xdf21e8(0x18c)));},0x12c0);});let _0xb4bb74='';return _0xb4bb74=await this[_0x40a9fd(0x192)][_0x40a9fd(0x188)](_0x474d59)||await this[_0x40a9fd(0x191)][_0x40a9fd(0x1c4)]([_0x40a9fd(0x176)])||_0x40a9fd(0x17f),_0xb4bb74;}};function _0x3c03(_0xad52a7,_0x3c05e3){const _0x1c4263=_0x1c42();return _0x3c03=function(_0x3c0361,_0x2406e1){_0x3c0361=_0x3c0361-0x170;let _0x3b912c=_0x1c4263[_0x3c0361];return _0x3b912c;},_0x3c03(_0xad52a7,_0x3c05e3);}function _0x1c42(){const _0x52b2dc=['loginByOpenId','scanedSceneStrMap','getQRCodeTicket','getUserById','authService','hex','wechatOfficialAppId','officialAutoReplyText',']]></FromUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<CreateTime>','object','&noncestr=','Injectable','wechatAccessToken','verify','./../globalConfig/globalConfig.service','function','由于公众号的回复限制、过长的问题我们可能无法回复、您可以前往我们的官方站点享受更加完善的服务、如果您有更多问题、欢迎像我提问！','BAD_REQUEST','AuthService','sha1','../../common/utils','loginByCode','wechatOfficialAppSecret','length','非法参数','checkAutoReply','chatgptService','onModuleInit','post','请求超时','5upUXhZ',']]></Content>\x0a\x20\x20\x20\x20</xml>','&code=','jiangly','globalConfigService','autoreplyService','&secret=','jsapi_ticket=','1hUKXyw','\x0a\x20\x20\x20\x20<xml>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<ToUserName><![CDATA[','genXmlMsgByConfig','12337480eBOVQt','getRedirectUrl','bindWx','createHash','OfficialService','wechatOfficialToken','str:\x20','</CreateTime>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<MsgType><![CDATA[text]]></MsgType>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<Content><![CDATA[','createRandomNonceStr','2565300xvRMjI','170712JyYveE','user',']]></ToUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<FromUserName><![CDATA[','@nestjs/common','default','fetchQRCodeTicket','1120671YDDNiW','axios','getQRSceneStr','defineProperty','scanBindWx','join','HttpStatus','fromusername','get','aotoPlay','564066sPrHYP','./../auth/auth.service','update','62298owOmOw','loginBySceneStr','log','&url=','wechatJsapiTicket','./../user/user.service','getUserOpenId','&response_type=code&scope=snsapi_base&state=weChatLogin#wechat_redirect','sceneStrMap','userService','tousername','7VULCko','HttpException','genXmlMsg','metadata','getConfigs','toFixed','design:paramtypes','2886068EBDfIm','getUserFromOpenId','decorate','&grant_type=authorization_code','getWechatAccessToken','GlobalConfigService','./../chatgpt/chatgpt.service'];_0x1c42=function(){return _0x52b2dc;};return _0x1c42();}OfficialService=__decorate([(0x0,common_1[_0x5301ba(0x17a)])(),__metadata(_0x5301ba(0x1c6),[autoreply_service_1['AutoreplyService'],user_service_1['UserService'],auth_service_1[_0x5301ba(0x181)],globalConfig_service_1[_0x5301ba(0x1cc)],chatgpt_service_1['ChatgptService']])],OfficialService),exports['OfficialService']=OfficialService;