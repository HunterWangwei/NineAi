'use strict';const _0x23a2db=_0x368d;(function(_0x48bd59,_0x5be30a){const _0x2cb93f=_0x368d,_0x4eef5a=_0x48bd59();while(!![]){try{const _0x56c7b1=-parseInt(_0x2cb93f(0x19e))/0x1+parseInt(_0x2cb93f(0x1b9))/0x2+-parseInt(_0x2cb93f(0x155))/0x3+-parseInt(_0x2cb93f(0x1d9))/0x4*(parseInt(_0x2cb93f(0x181))/0x5)+parseInt(_0x2cb93f(0x1a3))/0x6*(parseInt(_0x2cb93f(0x15e))/0x7)+-parseInt(_0x2cb93f(0x196))/0x8*(parseInt(_0x2cb93f(0x1a5))/0x9)+parseInt(_0x2cb93f(0x164))/0xa;if(_0x56c7b1===_0x5be30a)break;else _0x4eef5a['push'](_0x4eef5a['shift']());}catch(_0x2dc728){_0x4eef5a['push'](_0x4eef5a['shift']());}}}(_0x2239,0xd7f7b));function _0x368d(_0x11949e,_0x2ec21f){const _0x22392b=_0x2239();return _0x368d=function(_0x368dd3,_0x461873){_0x368dd3=_0x368dd3-0x150;let _0x212872=_0x22392b[_0x368dd3];return _0x212872;},_0x368d(_0x11949e,_0x2ec21f);}var __decorate=this&&this[_0x23a2db(0x1b0)]||function(_0x1d19ff,_0xf651d0,_0x1089e2,_0x384713){const _0x303219=_0x23a2db;var _0xd089e1=arguments['length'],_0x8d1d9b=_0xd089e1<0x3?_0xf651d0:_0x384713===null?_0x384713=Object[_0x303219(0x1a2)](_0xf651d0,_0x1089e2):_0x384713,_0x2b1f1e;if(typeof Reflect===_0x303219(0x1cb)&&typeof Reflect[_0x303219(0x1d5)]===_0x303219(0x1c7))_0x8d1d9b=Reflect[_0x303219(0x1d5)](_0x1d19ff,_0xf651d0,_0x1089e2,_0x384713);else{for(var _0xff62b=_0x1d19ff[_0x303219(0x176)]-0x1;_0xff62b>=0x0;_0xff62b--)if(_0x2b1f1e=_0x1d19ff[_0xff62b])_0x8d1d9b=(_0xd089e1<0x3?_0x2b1f1e(_0x8d1d9b):_0xd089e1>0x3?_0x2b1f1e(_0xf651d0,_0x1089e2,_0x8d1d9b):_0x2b1f1e(_0xf651d0,_0x1089e2))||_0x8d1d9b;}return _0xd089e1>0x3&&_0x8d1d9b&&Object[_0x303219(0x150)](_0xf651d0,_0x1089e2,_0x8d1d9b),_0x8d1d9b;},__metadata=this&&this['__metadata']||function(_0x2a884d,_0x39b2a1){const _0x521ad3=_0x23a2db;if(typeof Reflect===_0x521ad3(0x1cb)&&typeof Reflect[_0x521ad3(0x189)]===_0x521ad3(0x1c7))return Reflect['metadata'](_0x2a884d,_0x39b2a1);},__param=this&&this['__param']||function(_0x3ef8c3,_0x36d6b1){return function(_0xde88a2,_0x285eca){_0x36d6b1(_0xde88a2,_0x285eca,_0x3ef8c3);};};Object[_0x23a2db(0x150)](exports,_0x23a2db(0x175),{'value':!![]}),exports[_0x23a2db(0x1a1)]=void 0x0;function _0x2239(){const _0x178324=['modelInfo','slice','maxResponseTokens','maxTokens','ModelsTypeEntity','./modelKeys.entity','number','getDefaultModel','1196346inrKdo','key:\x20','HttpException','Injectable','filter','refreshBaiduAccesstoken','Logger','getBaseConfig','choices','count','user','status','delModelType','map','function','getModelTypeDetailFromId','gpt-4-gizmo','modelTypes','object','push','当前模型下还有KEY、请删除当前模型下的KEY后再删除模型','getOpenPluginList','init','assign','isDefaultModel','queryModelType','lockKey','saveUseLog','decorate','getModelTypeIdFromModelName','set','https://api.gptgod.online/','9496AJYzqo','defineProperty','model','stringify','getFullUrl','setModelType','2850135oWQMSV','modelsList','modelTypeId','ModelMaxtokenMap','../../common/constants/plugin','data','InjectRepository','isArray','join','10633VEekgq','HttpStatus','useToken\x20+\x20','getUseDrawModelKey','typeorm','isGpts','40032670RlJOqn','all','getPluginList','findBy','modelsTypeEntity','getTtsModelKey','Bearer\x20','search-gpts','design:paramtypes','\x20已经添加过！','includes','onModuleInit','keyType','modelKeysEntity','application/json','BAD_REQUEST','无效参数！','__esModule','length','response','POST','pluginList','Repository','DESC','../../common/constants/models','removeSpecialCharacters','content','keyPoolIndexMap','axios','1165zJgAFg','error','super','delete','hideString','save','forEach','parse','metadata','模型名称\x20->\x20','findOne','getMaxToken','secret','keyPoolMap','modelMaps','delModelKey','execute','ModelKeysEntity','PluginDefaultList','getCurrentModelKeyInfo','find','8nlXCrj','log','useCount\x20+\x201','搜索异常！','getModelTypeIdFromGpts','编辑模型失败\x20->\x20','findAndCount','sk-70QvIwbE2GVk7NDF6d44U31vSPx46fl7rZF5VOqmd70kW1XX','1714633JgpQxq','count:\x20','createQueryBuilder','ModelsService','getOwnPropertyDescriptor','1344wIgDWP','setModelKey','7553457IjDdZE','message','key','isDallDraw','添加Key失败！','getUseToolsModelKey','queryModelKey','affected','where','compilerParams','update','__decorate'];_0x2239=function(){return _0x178324;};return _0x2239();}const common_1=require('@nestjs/common'),typeorm_1=require('@nestjs/typeorm'),typeorm_2=require(_0x23a2db(0x162)),utils_1=require('../../common/utils'),modelType_entity_1=require('./modelType.entity'),modelKeys_entity_1=require(_0x23a2db(0x1b6)),models_1=require(_0x23a2db(0x17c)),plugin_1=require(_0x23a2db(0x159)),axios_1=require(_0x23a2db(0x180));let ModelsService=class ModelsService{constructor(_0xe4fb9a,_0x336235){const _0x220285=_0x23a2db;this[_0x220285(0x168)]=_0xe4fb9a,this['modelKeysEntity']=_0x336235,this[_0x220285(0x1ca)]=[],this[_0x220285(0x18f)]={},this[_0x220285(0x18e)]={},this[_0x220285(0x17f)]={},this[_0x220285(0x179)]=[];}async[_0x23a2db(0x16f)](){await this['init']();}async[_0x23a2db(0x1cf)](){const _0x1e95f8=_0x23a2db;this[_0x1e95f8(0x1ca)]=[],this['modelMaps']={},this[_0x1e95f8(0x18e)]={},this[_0x1e95f8(0x17f)]={},this[_0x1e95f8(0x1ca)]=await this[_0x1e95f8(0x168)][_0x1e95f8(0x195)]();const _0x202d1a=this[_0x1e95f8(0x1ca)][_0x1e95f8(0x1c6)](_0x4c9c48=>_0x4c9c48['id']),_0x35d23c=await this[_0x1e95f8(0x171)][_0x1e95f8(0x195)]({'where':{'modelTypeId':(0x0,typeorm_2['In'])(_0x202d1a),'status':!![]}});this[_0x1e95f8(0x1ca)][_0x1e95f8(0x187)](_0x27bf2b=>{const _0x3adb25=_0x1e95f8,_0x7df4e7=_0x35d23c['filter'](_0x308083=>_0x308083[_0x3adb25(0x157)]===_0x27bf2b['id']);this[_0x3adb25(0x18f)][_0x27bf2b['id']]=_0x7df4e7;}),this[_0x1e95f8(0x1ca)]['forEach'](_0x232b57=>{const _0xcc691=_0x1e95f8,{id:_0x587f6e}=_0x232b57,_0x516bc2=this[_0xcc691(0x18f)][_0x587f6e];if(!this['keyPoolMap'][_0x587f6e])this['keyPoolMap'][_0x587f6e]=[];_0x516bc2[_0xcc691(0x187)](_0x181ee1=>{const _0x17f0eb=_0xcc691,{keyWeight:_0xd784df,id:_0x447d01}=_0x181ee1;let _0xc8109f=Number(_0xd784df);if(typeof _0xc8109f!==_0x17f0eb(0x1b7))_0xc8109f=0x1;for(let _0x2bd7ff=0x0;_0x2bd7ff<_0xd784df;_0x2bd7ff++){this['keyPoolMap'][_0x587f6e][_0x17f0eb(0x1cc)](_0x447d01);}});if(!this['keyPoolIndexMap'][_0x587f6e])this[_0xcc691(0x17f)][_0x587f6e]=0x0;}),await this['initPluginList']();}['getModelTypeIdFromPluginId'](_0x3be815){const _0x529c44=_0x23a2db;var _0x49e586;return(_0x49e586=this[_0x529c44(0x179)][_0x529c44(0x195)](_0x17f881=>_0x17f881['id']===_0x3be815))===null||_0x49e586===void 0x0?void 0x0:_0x49e586[_0x529c44(0x157)];}async[_0x23a2db(0x19a)](){const _0x1edf18=_0x23a2db;var _0x46483d;return(_0x46483d=this[_0x1edf18(0x1ca)][_0x1edf18(0x195)](_0x26daa6=>_0x26daa6[_0x1edf18(0x151)]===_0x1edf18(0x1c9)))===null||_0x46483d===void 0x0?void 0x0:_0x46483d['id'];}['initPluginList'](){const _0xfdc914=_0x23a2db,_0x789435=plugin_1[_0xfdc914(0x193)][_0xfdc914(0x1bd)](_0x18fed=>{const _0x483785=_0xfdc914,{pluginModelName:_0x1171bc}=_0x18fed,_0x437d1f=this[_0x483785(0x1ca)][_0x483785(0x1bd)](_0x13763c=>{const _0x2df32f=_0x483785;var _0x12371e;const {id:_0x5ee34e}=_0x13763c;return((_0x12371e=this['keyPoolMap'][_0x5ee34e])===null||_0x12371e===void 0x0?void 0x0:_0x12371e[_0x2df32f(0x176)])||!_0x1171bc;})[_0x483785(0x1c6)](_0x2635aa=>{const _0x59dd04=_0x483785;return _0x2635aa[_0x59dd04(0x151)];});return _0x437d1f[_0x483785(0x16e)](_0x1171bc)||!_0x1171bc;});this[_0xfdc914(0x179)]=_0x789435['map'](_0x3558bc=>{const _0x4a9c1b=_0xfdc914;var _0x3a1500;const {pluginModelName:_0x241a12}=_0x3558bc,_0x5ef83c=(_0x3a1500=this[_0x4a9c1b(0x1ca)][_0x4a9c1b(0x195)](_0x4b4344=>_0x4b4344[_0x4a9c1b(0x151)]===_0x241a12))===null||_0x3a1500===void 0x0?void 0x0:_0x3a1500['id'];return Object[_0x4a9c1b(0x1d0)](Object[_0x4a9c1b(0x1d0)]({},_0x3558bc),{'modelTypeId':_0x5ef83c});});}[_0x23a2db(0x1ce)](){const _0x5e222d=_0x23a2db;return this[_0x5e222d(0x179)][_0x5e222d(0x1c6)](_0x41029d=>{const _0x4ee5bd=_0x5e222d;var _0x2ca0a2;const {pluginModelName:_0x48d4ce,pluginName:_0x2eaa7c,icon:_0x1e32ef,id:_0x37a163}=_0x41029d,_0x1c062c=(_0x2ca0a2=this['modelTypes']['find'](_0x2cbecc=>_0x2cbecc[_0x4ee5bd(0x151)]===_0x48d4ce))===null||_0x2ca0a2===void 0x0?void 0x0:_0x2ca0a2['id'];return Object[_0x4ee5bd(0x1d0)](Object[_0x4ee5bd(0x1d0)]({},_0x41029d),{'pluginId':_0x37a163,'modelTypeId':_0x1c062c});});}async[_0x23a2db(0x1d3)](_0x2b2f8d,_0x2d9f7c,_0x27904f=-0x1){const _0x544351=_0x23a2db,_0x25f1bb=await this[_0x544351(0x171)][_0x544351(0x1af)]({'id':_0x2b2f8d},{'status':![],'keyStatus':_0x27904f,'remark':_0x2d9f7c});common_1[_0x544351(0x1bf)][_0x544351(0x182)](_0x544351(0x1ba)+_0x2b2f8d+'\x20欠费或被官方封禁导致不可用，已被系统自动锁定'),this['init']();}async[_0x23a2db(0x1c0)](_0x57bd8d){const _0x4230e5=_0x23a2db;if(!this['modelTypes'][_0x4230e5(0x176)]){common_1['Logger']['debug']('当前未配置任何模型分类，请先配置模型分类！');return;}let _0x5e4211=null;if(_0x57bd8d===null||_0x57bd8d===void 0x0?void 0x0:_0x57bd8d[_0x4230e5(0x157)])_0x5e4211=await this['getModelTypeDetailFromId'](_0x57bd8d===null||_0x57bd8d===void 0x0?void 0x0:_0x57bd8d['modelTypeId']);else{if(_0x57bd8d===null||_0x57bd8d===void 0x0?void 0x0:_0x57bd8d[_0x4230e5(0x163)]){const _0x47c6f0=await this[_0x4230e5(0x1d6)]('gpt-4-gizmo');_0x5e4211=this[_0x4230e5(0x1ca)][_0x4230e5(0x195)](_0xa207c4=>_0xa207c4['id']===_0x47c6f0);}else _0x5e4211=await this[_0x4230e5(0x1b8)]();}if(!_0x5e4211)return;const {id:_0xe6dfa0,maxRounds:_0x13540d,maxResponseTokens:_0x5690fd}=_0x5e4211;return{'modelTypeId':_0xe6dfa0,'modelConfig':{'maxResponseTokens':_0x5690fd,'topN':0x1,'systemMessage':'','rounds':_0x13540d}};}async['getDefaultModel'](){const _0x531e52=_0x23a2db;let _0x2ee724=null;_0x2ee724=this[_0x531e52(0x1ca)][_0x531e52(0x195)](_0x4fa010=>_0x4fa010[_0x531e52(0x1d1)]);if(!_0x2ee724){const _0x75775f=this['modelTypes'][_0x531e52(0x1bd)](_0x1e4568=>_0x1e4568[_0x531e52(0x1c4)]);_0x75775f[_0x531e52(0x176)]&&(_0x2ee724=_0x75775f[0x0]);}return _0x2ee724;}async[_0x23a2db(0x156)](){const _0x314ec2=_0x23a2db,_0x29a721=await this[_0x314ec2(0x168)]['find']({'order':{'order':_0x314ec2(0x17b)}});return _0x29a721;}async[_0x23a2db(0x166)](){const _0x3f461d=_0x23a2db;return this[_0x3f461d(0x179)];}async[_0x23a2db(0x1d4)](_0x274cf2,_0x46be88,_0x3f8508){const _0x260ab5=_0x23a2db;await this[_0x260ab5(0x171)][_0x260ab5(0x1a0)]()[_0x260ab5(0x1af)](modelKeys_entity_1[_0x260ab5(0x192)])[_0x260ab5(0x1d7)]({'useCount':()=>_0x260ab5(0x198),'useToken':()=>_0x260ab5(0x160)+_0x3f8508})[_0x260ab5(0x1ad)]('id\x20=\x20:id',{'id':_0x274cf2})['execute'](),await this['modelsTypeEntity'][_0x260ab5(0x1a0)]()[_0x260ab5(0x1af)](modelType_entity_1['ModelsTypeEntity'])[_0x260ab5(0x1d7)]({'useCount':()=>_0x260ab5(0x198),'useToken':()=>_0x260ab5(0x160)+_0x3f8508})[_0x260ab5(0x1ad)]('id\x20=\x20:id',{'id':_0x46be88})[_0x260ab5(0x191)]();}async[_0x23a2db(0x1be)](){}async[_0x23a2db(0x1d2)](_0x45bd5b){const _0x422fd2=_0x23a2db,{keyType:_0x319383,status:_0x58ed25,model:_0x3dca08,page:page=0x1,size:size=0xa}=_0x45bd5b,_0x366c51={};_0x319383&&(_0x366c51[_0x422fd2(0x170)]=_0x319383),_0x3dca08&&(_0x366c51['model']=_0x3dca08),_0x58ed25&&(_0x366c51[_0x422fd2(0x1c4)]=Number(_0x58ed25)===0x1?!![]:![]);const [_0x53598e,_0x78a902]=await this['modelsTypeEntity']['findAndCount']({'where':_0x366c51,'skip':(page-0x1)*size,'take':size,'order':{'order':'DESC'}}),_0x5ee13b=_0x53598e[_0x422fd2(0x1c6)](_0x51d520=>_0x51d520['id']),_0x549e97={};for(const _0x1e32bd of _0x5ee13b){const _0x312285=await this[_0x422fd2(0x171)][_0x422fd2(0x1c2)]({'where':{'modelTypeId':_0x1e32bd}});_0x549e97[_0x1e32bd]=_0x312285;}return _0x53598e[_0x422fd2(0x187)](_0x5db067=>{_0x5db067['keyCount']=_0x549e97[_0x5db067['id']]||0x0;}),{'rows':_0x53598e,'count':_0x78a902};}async[_0x23a2db(0x154)](_0x5af697){const _0x97db60=_0x23a2db;try{const {id:_0x3d90c4,modelName:_0x4dd73d}=_0x5af697,_0x3ac475=this[_0x97db60(0x1ae)](_0x5af697);if(_0x3d90c4){const _0x34da3f=await this[_0x97db60(0x168)]['update']({'id':_0x3d90c4},_0x3ac475);return await this[_0x97db60(0x1cf)](),_0x34da3f[_0x97db60(0x1ac)]>0x0;}else{const _0x1b4314=await this[_0x97db60(0x168)][_0x97db60(0x18b)]({'where':{'modelName':_0x4dd73d}});if(_0x1b4314)throw new common_1['HttpException'](_0x97db60(0x18a)+_0x4dd73d+_0x97db60(0x16d),common_1[_0x97db60(0x15f)][_0x97db60(0x173)]);const _0x220769=await this[_0x97db60(0x168)][_0x97db60(0x186)](_0x3ac475);return await this[_0x97db60(0x1cf)](),_0x220769;}}catch(_0x463008){throw new common_1[(_0x97db60(0x1bb))](_0x97db60(0x19b)+(_0x463008===null||_0x463008===void 0x0?void 0x0:_0x463008[_0x97db60(0x177)]),common_1[_0x97db60(0x15f)][_0x97db60(0x173)]);}}async[_0x23a2db(0x1c5)](_0x1439b1){const _0x13e012=_0x23a2db,{id:_0x203d36}=_0x1439b1;if(!_0x203d36)throw new common_1[(_0x13e012(0x1bb))](_0x13e012(0x174),common_1[_0x13e012(0x15f)][_0x13e012(0x173)]);const _0x3c1ed4=await this['modelsTypeEntity']['findOne']({'where':{'id':_0x203d36}});if(!_0x3c1ed4)throw new common_1[(_0x13e012(0x1bb))]('无效参数！',common_1['HttpStatus'][_0x13e012(0x173)]);else{const _0x492513=await this[_0x13e012(0x171)]['count']({'where':{'modelTypeId':_0x203d36}});console[_0x13e012(0x197)](_0x13e012(0x19f),_0x492513);if(_0x492513)throw new common_1[(_0x13e012(0x1bb))](_0x13e012(0x1cd),common_1[_0x13e012(0x15f)][_0x13e012(0x173)]);const _0x580c09=await this[_0x13e012(0x168)][_0x13e012(0x184)]({'id':_0x203d36});return this[_0x13e012(0x1cf)](),_0x580c09[_0x13e012(0x1ac)];}}async[_0x23a2db(0x1ab)](_0x3abb9c,_0x2f50f9){const _0x21fafc=_0x23a2db,{role:_0x4131ba}=_0x3abb9c[_0x21fafc(0x1c3)],{modelTypeId:_0x5dbdc7,status:_0x4fe44e,page:page=0x1,size:size=0xa}=_0x2f50f9,_0x2c5ae5={};_0x5dbdc7&&(_0x2c5ae5[_0x21fafc(0x157)]=_0x5dbdc7),_0x4fe44e&&(_0x2c5ae5[_0x21fafc(0x1c4)]=Number(_0x4fe44e)===0x1?!![]:![]);const [_0x2399a4,_0x3c437b]=await this[_0x21fafc(0x171)][_0x21fafc(0x19c)]({'where':_0x2c5ae5,'skip':(page-0x1)*size,'take':size}),_0x2cdef2=_0x2399a4['map'](_0x13b222=>_0x13b222['modelTypeId']),_0x381ea0=await this[_0x21fafc(0x168)][_0x21fafc(0x167)]({'id':(0x0,typeorm_2['In'])(_0x2cdef2)});return _0x2399a4[_0x21fafc(0x187)](_0x51cf62=>{const _0x334aea=_0x21fafc,_0x5335c9=_0x381ea0[_0x334aea(0x195)](_0x3088ff=>_0x3088ff['id']===_0x51cf62['modelTypeId']);_0x51cf62[_0x334aea(0x1b1)]=_0x5335c9,_0x4131ba!==_0x334aea(0x183)&&(_0x51cf62[_0x334aea(0x1a7)]&&(_0x51cf62['key']=(0x0,utils_1['hideString'])(_0x51cf62[_0x334aea(0x1a7)])),_0x51cf62[_0x334aea(0x18d)]&&(_0x51cf62['secret']=(0x0,utils_1[_0x334aea(0x185)])(_0x51cf62[_0x334aea(0x18d)])));}),{'rows':_0x2399a4,'count':_0x3c437b};}async[_0x23a2db(0x1a4)](_0x4ac742){const _0x5f2cdc=_0x23a2db;try{const {id:_0x4f458d,key:_0x187138,modelTypeId:_0x3ed27b}=_0x4ac742;if(_0x4f458d){const _0x91366c=JSON[_0x5f2cdc(0x188)](JSON[_0x5f2cdc(0x152)](_0x4ac742));_0x91366c[_0x5f2cdc(0x1a7)]=_0x4ac742[_0x5f2cdc(0x1a7)][0x0],_0x91366c[_0x5f2cdc(0x157)]=_0x3ed27b[0x0];const _0x480d2f=await this[_0x5f2cdc(0x171)][_0x5f2cdc(0x1af)]({'id':_0x4f458d},_0x91366c);return await this[_0x5f2cdc(0x1cf)](),_0x480d2f[_0x5f2cdc(0x1ac)]>0x0;}if(!_0x4f458d){const _0xb3740=[];return _0x3ed27b[_0x5f2cdc(0x187)](_0x4f3d6f=>_0xb3740[_0x5f2cdc(0x1cc)](this[_0x5f2cdc(0x171)]['save'](Object['assign'](Object[_0x5f2cdc(0x1d0)]({},_0x4ac742),{'modelTypeId':_0x4f3d6f,'order':0x64})))),await Promise[_0x5f2cdc(0x165)](_0xb3740),await this[_0x5f2cdc(0x1cf)](),!![];}}catch(_0x22d53b){console['log']('error:\x20',_0x22d53b);throw new common_1['HttpException'](_0x5f2cdc(0x1a9),common_1[_0x5f2cdc(0x15f)][_0x5f2cdc(0x173)]);}}async[_0x23a2db(0x190)](_0x945749){const _0x101dff=_0x23a2db,{id:_0x125150}=_0x945749;if(!_0x125150)throw new common_1[(_0x101dff(0x1bb))](_0x101dff(0x174),common_1[_0x101dff(0x15f)][_0x101dff(0x173)]);const _0x4f1bc5=await this[_0x101dff(0x171)][_0x101dff(0x18b)]({'where':{'id':_0x125150}});if(!_0x4f1bc5)throw new common_1[(_0x101dff(0x1bb))]('无效参数！',common_1[_0x101dff(0x15f)][_0x101dff(0x173)]);else{const _0x545efe=await this[_0x101dff(0x171)][_0x101dff(0x184)]({'id':_0x125150});return this['init'](),_0x545efe['affected'];}}[_0x23a2db(0x18c)](_0xde696d,_0x5700e3){const _0x4aa0d1=_0x23a2db;let _0x8f8c9b=models_1[_0x4aa0d1(0x158)][_0xde696d];return!_0x8f8c9b?_0x8f8c9b=0x1000:_0x5700e3<_0x8f8c9b&&_0x5700e3>0x0&&(_0x8f8c9b=_0x5700e3),_0x8f8c9b;}[_0x23a2db(0x1ae)](_0x1ef886){const _0x2d2afb=_0x23a2db,_0x4fa8fd=JSON['parse'](JSON[_0x2d2afb(0x152)](_0x1ef886)),{model:_0x1007b9,maxTokens:_0x518f2c}=_0x4fa8fd,_0x237801=models_1['ModelMaxtokenMap'][_0x1007b9];return _0x4fa8fd[_0x2d2afb(0x1b4)]=this[_0x2d2afb(0x18c)](_0x1007b9,_0x518f2c),_0x4fa8fd[_0x2d2afb(0x1b4)]<0x1388&&(_0x4fa8fd[_0x2d2afb(0x1b3)]=0x800),_0x4fa8fd[_0x2d2afb(0x1b4)]>0x1388&&_0x4fa8fd['maxTokens']<0x2710&&(_0x4fa8fd[_0x2d2afb(0x1b3)]=0x1000),_0x4fa8fd[_0x2d2afb(0x1b4)]>0x2710&&_0x4fa8fd[_0x2d2afb(0x1b4)]<0x7530&&(_0x4fa8fd[_0x2d2afb(0x1b3)]=0x2000),_0x4fa8fd[_0x2d2afb(0x1b4)]>0x7530&&_0x4fa8fd['maxTokens']<0xc350&&(_0x4fa8fd['maxResponseTokens']=0x3e80),_0x4fa8fd['maxTokens']>0xc350&&(_0x4fa8fd[_0x2d2afb(0x1b3)]=0x9c4),_0x4fa8fd;}async[_0x23a2db(0x1c8)](_0x1b3f00){const _0x362f62=_0x23a2db;return await this[_0x362f62(0x1ca)][_0x362f62(0x195)](_0x319008=>_0x319008['id']===_0x1b3f00);}async[_0x23a2db(0x1aa)](){const _0x3ac2dc=_0x23a2db;var _0x42f03e;const _0x3f98ff=(_0x42f03e=this[_0x3ac2dc(0x1ca)][_0x3ac2dc(0x195)](_0x3c04c5=>_0x3c04c5['isUseTool']))===null||_0x42f03e===void 0x0?void 0x0:_0x42f03e['id'];if(!_0x3f98ff)return;const _0x5a8d2f=this[_0x3ac2dc(0x18f)][_0x3f98ff];if(!_0x5a8d2f[_0x3ac2dc(0x176)])return;const _0x40014e=this[_0x3ac2dc(0x17f)][_0x3f98ff],_0x3b7226=_0x5a8d2f[_0x40014e];return this['keyPoolIndexMap'][_0x3f98ff]++,this[_0x3ac2dc(0x17f)][_0x3f98ff]>=_0x5a8d2f[_0x3ac2dc(0x176)]&&(this['keyPoolIndexMap'][_0x3f98ff]=0x0),_0x3b7226;}async[_0x23a2db(0x194)](_0x412a88){const _0x573736=_0x23a2db;if(!_0x412a88)return;const _0x5d76ef=this[_0x573736(0x18f)][_0x412a88];if(!_0x5d76ef[_0x573736(0x176)])return;const _0x20b87f=this[_0x573736(0x17f)][_0x412a88],_0x392a4a=_0x5d76ef[_0x20b87f];return this['keyPoolIndexMap'][_0x412a88]++,this[_0x573736(0x17f)][_0x412a88]>=_0x5d76ef['length']&&(this[_0x573736(0x17f)][_0x412a88]=0x0),_0x392a4a;}async[_0x23a2db(0x161)](){const _0x498937=_0x23a2db;var _0x2d5d2c;const _0x4a7054=(_0x2d5d2c=this[_0x498937(0x1ca)]['find'](_0x1b433c=>_0x1b433c[_0x498937(0x1a8)]))===null||_0x2d5d2c===void 0x0?void 0x0:_0x2d5d2c['id'];if(!_0x4a7054)return;const _0xd54670=this[_0x498937(0x18f)][_0x4a7054];if(!_0xd54670['length'])return;const _0x45c436=this[_0x498937(0x17f)][_0x4a7054],_0x4af1b3=_0xd54670[_0x45c436];return this[_0x498937(0x17f)][_0x4a7054]++,this[_0x498937(0x17f)][_0x4a7054]>=_0xd54670[_0x498937(0x176)]&&(this[_0x498937(0x17f)][_0x4a7054]=0x0),_0x4af1b3;}async[_0x23a2db(0x169)](){const _0x58e8ac=_0x23a2db;var _0x2ca1e9;const _0x1713d0=await((_0x2ca1e9=this[_0x58e8ac(0x1ca)][_0x58e8ac(0x195)](_0x3a8c1c=>_0x3a8c1c[_0x58e8ac(0x151)][_0x58e8ac(0x16e)]('tts')))===null||_0x2ca1e9===void 0x0?void 0x0:_0x2ca1e9['id']);return this[_0x58e8ac(0x194)](_0x1713d0);}async[_0x23a2db(0x1d6)](_0x4d6c6a){const _0xa489=_0x23a2db;var _0x21b0a7;if(!_0x4d6c6a){const _0xc36481=await this['getDefaultModel']();return _0xc36481?_0xc36481['id']:null;}return(_0x21b0a7=this['modelTypes'][_0xa489(0x195)](_0x87f9b5=>_0x87f9b5[_0xa489(0x151)]===_0x4d6c6a))===null||_0x21b0a7===void 0x0?void 0x0:_0x21b0a7['id'];}[_0x23a2db(0x153)](_0x292a5f){const _0x116349=_0x23a2db,_0xa07c4c=_0x292a5f['endsWith']('/')?_0x292a5f[_0x116349(0x1b2)](0x0,-0x1):_0x292a5f,_0x3ee07c=_0xa07c4c||'https://api.openai.com';return _0x3ee07c+'/v1/chat/completions';}async['searchGpts'](_0x56e9c7,_0x16ae25){const _0x524723=_0x23a2db;var _0x19775a,_0x1a26d9,_0x6a212c,_0x1054ff;const {keyword:_0x378556}=_0x16ae25,_0x39371b=await this[_0x524723(0x1d6)](_0x524723(0x16b));let _0x551745=await this[_0x524723(0x194)](_0x39371b);!_0x551745&&(_0x551745={'key':_0x524723(0x19d),'proxyUrl':_0x524723(0x1d8)});const {key:_0x1c57fd,proxyUrl:_0x3fdd77}=_0x551745,_0x1980d8={'method':_0x524723(0x178),'url':this[_0x524723(0x153)](_0x3fdd77),'headers':{'Content-Type':_0x524723(0x172),'Authorization':_0x524723(0x16a)+(0x0,utils_1[_0x524723(0x17d)])(_0x1c57fd)},'data':{'max_tokens':0x1f40,'model':_0x524723(0x16b),'messages':[{'role':_0x524723(0x1c3),'content':_0x378556}]}};try{const _0xd07c95=await(0x0,axios_1['default'])(_0x1980d8);if(_0xd07c95['status']!==0xc8||!((_0x19775a=_0xd07c95===null||_0xd07c95===void 0x0?void 0x0:_0xd07c95[_0x524723(0x15a)])===null||_0x19775a===void 0x0?void 0x0:_0x19775a['choices'][_0x524723(0x176)]))throw new common_1['HttpException'](_0x524723(0x199),common_1[_0x524723(0x15f)]['BAD_REQUEST']);this[_0x524723(0x1d4)](_0x551745['id'],_0x551745[_0x524723(0x157)],0x0);const _0x39b171=(_0x1054ff=(_0x6a212c=(_0x1a26d9=_0xd07c95===null||_0xd07c95===void 0x0?void 0x0:_0xd07c95[_0x524723(0x15a)])===null||_0x1a26d9===void 0x0?void 0x0:_0x1a26d9[_0x524723(0x1c1)][0x0])===null||_0x6a212c===void 0x0?void 0x0:_0x6a212c[_0x524723(0x1a6)])===null||_0x1054ff===void 0x0?void 0x0:_0x1054ff[_0x524723(0x17e)],_0x257bae=JSON[_0x524723(0x188)](_0x39b171);return _0x257bae['items']['map'](_0x243144=>{const _0x2371fa=_0x524723,{gizmo:_0xaf98f2,tools:_0x4b1fd3}=_0x243144,{id:_0x40ea9f,display:_0x1f7430,vanity_metrics:_0x7cfb0}=_0xaf98f2,{name:_0xa5a8f3,description:_0x2e259d,prompt_starters:_0x5634b4,profile_picture_url:_0x26f9ad,welcome_message:_0x293859}=_0x1f7430,{num_conversations_str:_0x741056,created_ago_str:_0x34acfd}=_0x7cfb0;return{'gptsId':_0x40ea9f,'name':_0xa5a8f3,'des':_0x2e259d,'demoData':Array[_0x2371fa(0x15c)](_0x5634b4)?_0x5634b4[_0x2371fa(0x15d)]('\x0a'):_0x5634b4,'coverImg':_0x26f9ad,'heat':_0x741056,'createTime':_0x34acfd,'welcome_message':_0x293859,'isGpts':!![]};});}catch(_0x4bc5a8){console['log']('error:\x20',_0x4bc5a8);throw new common_1[(_0x524723(0x1bb))](_0x524723(0x199),common_1['HttpStatus']['BAD_REQUEST']);}}};ModelsService=__decorate([(0x0,common_1[_0x23a2db(0x1bc)])(),__param(0x0,(0x0,typeorm_1[_0x23a2db(0x15b)])(modelType_entity_1[_0x23a2db(0x1b5)])),__param(0x1,(0x0,typeorm_1[_0x23a2db(0x15b)])(modelKeys_entity_1['ModelKeysEntity'])),__metadata(_0x23a2db(0x16c),[typeorm_2['Repository'],typeorm_2[_0x23a2db(0x17a)]])],ModelsService),exports['ModelsService']=ModelsService;