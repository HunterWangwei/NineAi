'use strict';const _0x3cff35=_0x372b;(function(_0x27abd8,_0x596004){const _0x27e0b3=_0x372b,_0x2efdc5=_0x27abd8();while(!![]){try{const _0x38c4f2=-parseInt(_0x27e0b3(0x11d))/0x1*(parseInt(_0x27e0b3(0xc0))/0x2)+-parseInt(_0x27e0b3(0x107))/0x3*(parseInt(_0x27e0b3(0x10f))/0x4)+parseInt(_0x27e0b3(0xea))/0x5+-parseInt(_0x27e0b3(0x11b))/0x6+-parseInt(_0x27e0b3(0xb3))/0x7+-parseInt(_0x27e0b3(0xda))/0x8*(-parseInt(_0x27e0b3(0x12a))/0x9)+parseInt(_0x27e0b3(0x118))/0xa;if(_0x38c4f2===_0x596004)break;else _0x2efdc5['push'](_0x2efdc5['shift']());}catch(_0x10c987){_0x2efdc5['push'](_0x2efdc5['shift']());}}}(_0x16e7,0x6cb3f));function _0x372b(_0xd19589,_0x52f8b5){const _0x16e759=_0x16e7();return _0x372b=function(_0x372b11,_0x5c886e){_0x372b11=_0x372b11-0xa0;let _0x59f0e6=_0x16e759[_0x372b11];return _0x59f0e6;},_0x372b(_0xd19589,_0x52f8b5);}var __decorate=this&&this['__decorate']||function(_0x31a82f,_0x53130a,_0x490577,_0xf6aa41){const _0x20e070=_0x372b;var _0x280122=arguments[_0x20e070(0x122)],_0x23b761=_0x280122<0x3?_0x53130a:_0xf6aa41===null?_0xf6aa41=Object[_0x20e070(0xe0)](_0x53130a,_0x490577):_0xf6aa41,_0x548b3d;if(typeof Reflect===_0x20e070(0x103)&&typeof Reflect[_0x20e070(0xb4)]===_0x20e070(0xc7))_0x23b761=Reflect[_0x20e070(0xb4)](_0x31a82f,_0x53130a,_0x490577,_0xf6aa41);else{for(var _0x250410=_0x31a82f['length']-0x1;_0x250410>=0x0;_0x250410--)if(_0x548b3d=_0x31a82f[_0x250410])_0x23b761=(_0x280122<0x3?_0x548b3d(_0x23b761):_0x280122>0x3?_0x548b3d(_0x53130a,_0x490577,_0x23b761):_0x548b3d(_0x53130a,_0x490577))||_0x23b761;}return _0x280122>0x3&&_0x23b761&&Object[_0x20e070(0xe1)](_0x53130a,_0x490577,_0x23b761),_0x23b761;},__metadata=this&&this[_0x3cff35(0x12c)]||function(_0xdbc5e4,_0x33e122){const _0x3dcd25=_0x3cff35;if(typeof Reflect===_0x3dcd25(0x103)&&typeof Reflect[_0x3dcd25(0x130)]==='function')return Reflect[_0x3dcd25(0x130)](_0xdbc5e4,_0x33e122);},__param=this&&this[_0x3cff35(0xd4)]||function(_0x36e581,_0x2b0c96){return function(_0x44332f,_0x31219c){_0x2b0c96(_0x44332f,_0x31219c,_0x36e581);};};function _0x16e7(){const _0x1886d6=['join','saveUseLog','BAD_REQUEST','2094304FSTbZj','refreshBaiduAccesstoken','modelMaps','@nestjs/typeorm','data','Logger','getOwnPropertyDescriptor','defineProperty','getCurrentModelKeyInfo','keyPoolMap','affected','status','removeSpecialCharacters','system','error:\x20','HttpStatus','4406720xiEHse','ModelMaxtokenMap','getModelTypeIdFromPluginId','isArray','../../common/utils','design:paramtypes','Injectable','gpt-4-gizmo','key:\x20','count:\x20','compilerParams','findAndCount','pluginList','getModelTypeDetailFromId','endsWith','slice','无效参数！','default','setModelType','log','\x20已经添加过！','modelsList','order','findBy','maxTokens','object','getTtsModelKey','set','maxResponseTokens','385623rTNCly','id\x20=\x20:id','./modelType.entity','ModelsService','添加Key失败！','push','createQueryBuilder','HttpException','12zCEkwi','searchGpts','lockKey','isDefaultModel','axios','getMaxToken','filter','ModelKeysEntity','map','124870kRPDgN','模型名称\x20->\x20','stringify','118614cIFwAX','execute','348tBvsWO','/v1/chat/completions','管理员未开放此功能、敬请期待！','delete','getDefaultModel','length','secret','getPluginList','key','isDallDraw','update','onModuleInit','keyType','27gfpvca','./modelKeys.entity','__metadata','parse','tts','content','metadata','delModelKey','isGpts','getUseDrawModelKey','assign','number','hideString','items','modelTypeId','initPluginList','POST','getFullUrl','options:\x20','setModelKey','modelsTypeEntity','choices','keyPoolIndexMap','../../common/constants/plugin','编辑模型失败\x20->\x20','init','当前模型下还有KEY、请删除当前模型下的KEY后再删除模型','4749976XRRAeG','decorate','search-gpts','useToken\x20+\x20','当前未配置任何模型分类，请先配置模型分类！','InjectRepository','application/json','getUseToolsModelKey','super','error','response','Repository','搜索异常！','862GPmott','getBaseConfig','Bearer\x20','modelInfo','\x20欠费或被官方封禁导致不可用，已被系统自动锁定','model','findOne','function','save','isUseTool','count','@nestjs/common','forEach','includes','ModelsTypeEntity','find','where','modelTypes','DESC','getModelTypeIdFromModelName','__param','modelKeysEntity','useCount\x20+\x201'];_0x16e7=function(){return _0x1886d6;};return _0x16e7();}Object[_0x3cff35(0xe1)](exports,'__esModule',{'value':!![]}),exports[_0x3cff35(0x10a)]=void 0x0;const common_1=require(_0x3cff35(0xcb)),typeorm_1=require(_0x3cff35(0xdd)),typeorm_2=require('typeorm'),utils_1=require(_0x3cff35(0xee)),modelType_entity_1=require(_0x3cff35(0x109)),modelKeys_entity_1=require(_0x3cff35(0x12b)),models_1=require('../../common/constants/models'),plugin_1=require(_0x3cff35(0xaf)),axios_1=require(_0x3cff35(0x113));let ModelsService=class ModelsService{constructor(_0x19d45e,_0x265ac4){const _0x2ed665=_0x3cff35;this[_0x2ed665(0xac)]=_0x19d45e,this['modelKeysEntity']=_0x265ac4,this[_0x2ed665(0xd1)]=[],this['modelMaps']={},this[_0x2ed665(0xe3)]={},this[_0x2ed665(0xae)]={},this[_0x2ed665(0xf6)]=[];}async[_0x3cff35(0x128)](){const _0xaee148=_0x3cff35;await this[_0xaee148(0xb1)]();}async[_0x3cff35(0xb1)](){const _0x41aeda=_0x3cff35;this[_0x41aeda(0xd1)]=[],this[_0x41aeda(0xdc)]={},this['keyPoolMap']={},this['keyPoolIndexMap']={},this[_0x41aeda(0xd1)]=await this['modelsTypeEntity'][_0x41aeda(0xcf)]();const _0x50be2d=this[_0x41aeda(0xd1)][_0x41aeda(0x117)](_0x32d863=>_0x32d863['id']),_0x34e18a=await this['modelKeysEntity']['find']({'where':{'modelTypeId':(0x0,typeorm_2['In'])(_0x50be2d)}});this[_0x41aeda(0xd1)][_0x41aeda(0xcc)](_0xa0dc1d=>{const _0x523773=_0x41aeda,_0x393f49=_0x34e18a[_0x523773(0x115)](_0x59e128=>_0x59e128[_0x523773(0xa6)]===_0xa0dc1d['id']);this[_0x523773(0xdc)][_0xa0dc1d['id']]=_0x393f49;}),this[_0x41aeda(0xd1)][_0x41aeda(0xcc)](_0x82df5c=>{const _0x19e914=_0x41aeda,{id:_0x585f1d}=_0x82df5c,_0x2987a8=this[_0x19e914(0xdc)][_0x585f1d];if(!this[_0x19e914(0xe3)][_0x585f1d])this[_0x19e914(0xe3)][_0x585f1d]=[];_0x2987a8[_0x19e914(0xcc)](_0x158bac=>{const _0x393733=_0x19e914,{keyWeight:_0x1a3c5e,id:_0xd2e9cd}=_0x158bac;let _0x418848=Number(_0x1a3c5e);if(typeof _0x418848!==_0x393733(0xa3))_0x418848=0x1;for(let _0x160270=0x0;_0x160270<_0x1a3c5e;_0x160270++){this[_0x393733(0xe3)][_0x585f1d][_0x393733(0x10c)](_0xd2e9cd);}});if(!this[_0x19e914(0xae)][_0x585f1d])this[_0x19e914(0xae)][_0x585f1d]=0x0;}),await this[_0x41aeda(0xa7)]();}[_0x3cff35(0xec)](_0x40c20c){const _0x4d3b6f=_0x3cff35;var _0x4c5b43;return(_0x4c5b43=this['pluginList'][_0x4d3b6f(0xcf)](_0xc6f3f2=>_0xc6f3f2['id']===_0x40c20c))===null||_0x4c5b43===void 0x0?void 0x0:_0x4c5b43['modelTypeId'];}async['getModelTypeIdFromGpts'](){const _0x4a2568=_0x3cff35;var _0x3194a2;return(_0x3194a2=this['modelTypes']['find'](_0x35553c=>_0x35553c['model']===_0x4a2568(0xf1)))===null||_0x3194a2===void 0x0?void 0x0:_0x3194a2['id'];}['initPluginList'](){const _0x445943=_0x3cff35,_0x6b14d3=plugin_1['PluginDefaultList'][_0x445943(0x115)](_0x34ab1f=>{const _0x575e4d=_0x445943,{pluginModelName:_0x42bf1d}=_0x34ab1f,_0x361272=this['modelTypes']['filter'](_0x2acf33=>{const _0x37e6cd=_0x372b;var _0x2b81f0;const {id:_0x3bb488}=_0x2acf33;return((_0x2b81f0=this[_0x37e6cd(0xe3)][_0x3bb488])===null||_0x2b81f0===void 0x0?void 0x0:_0x2b81f0[_0x37e6cd(0x122)])||!_0x42bf1d;})[_0x575e4d(0x117)](_0x15b8c7=>{const _0xca17dd=_0x575e4d;return _0x15b8c7[_0xca17dd(0xc5)];});return _0x361272[_0x575e4d(0xcd)](_0x42bf1d)||!_0x42bf1d;});this[_0x445943(0xf6)]=_0x6b14d3[_0x445943(0x117)](_0x1f8173=>{const _0x3cc1dd=_0x445943;var _0x25dafc;const {pluginModelName:_0x4c856f}=_0x1f8173,_0x46efd4=(_0x25dafc=this[_0x3cc1dd(0xd1)]['find'](_0x4fcbaa=>_0x4fcbaa['model']===_0x4c856f))===null||_0x25dafc===void 0x0?void 0x0:_0x25dafc['id'];return Object[_0x3cc1dd(0xa2)](Object[_0x3cc1dd(0xa2)]({},_0x1f8173),{'modelTypeId':_0x46efd4});});}['getOpenPluginList'](){const _0x14b54e=_0x3cff35;return this[_0x14b54e(0xf6)]['map'](_0x12820d=>{const _0x3b33ba=_0x14b54e;var _0x584adb;const {pluginModelName:_0x37f269,pluginName:_0x461db4,icon:_0x4b912e,id:_0x4d1ec8}=_0x12820d,_0x5ef89d=(_0x584adb=this['modelTypes'][_0x3b33ba(0xcf)](_0x4f1771=>_0x4f1771[_0x3b33ba(0xc5)]===_0x37f269))===null||_0x584adb===void 0x0?void 0x0:_0x584adb['id'];return Object['assign'](Object[_0x3b33ba(0xa2)]({},_0x12820d),{'pluginId':_0x4d1ec8,'modelTypeId':_0x5ef89d});});}async[_0x3cff35(0x111)](_0x52e2c6,_0x37133d,_0x1c5843=-0x1){const _0x528bdf=_0x3cff35,_0x9187dc=await this[_0x528bdf(0xd5)][_0x528bdf(0x127)]({'id':_0x52e2c6},{'status':![],'keyStatus':_0x1c5843,'remark':_0x37133d});common_1[_0x528bdf(0xdf)][_0x528bdf(0xbc)](_0x528bdf(0xf2)+_0x52e2c6+_0x528bdf(0xc4)),this['init']();}async[_0x3cff35(0xc1)](_0x504a12){const _0x182836=_0x3cff35;if(!this['modelTypes']['length']){common_1[_0x182836(0xdf)]['debug'](_0x182836(0xb7));return;}let _0x5db21e=null;if(_0x504a12===null||_0x504a12===void 0x0?void 0x0:_0x504a12['modelTypeId'])_0x5db21e=await this[_0x182836(0xf7)](_0x504a12===null||_0x504a12===void 0x0?void 0x0:_0x504a12['modelTypeId']);else{if(_0x504a12===null||_0x504a12===void 0x0?void 0x0:_0x504a12[_0x182836(0xa0)]){const _0x44545f=await this[_0x182836(0xd3)]('gpt-4-gizmo');_0x5db21e=this[_0x182836(0xd1)][_0x182836(0xcf)](_0x32d468=>_0x32d468['id']===_0x44545f);}else _0x5db21e=await this['getDefaultModel']();}if(!_0x5db21e)return;const {id:_0x5b65de,maxRounds:_0x3d909b,maxResponseTokens:_0x395054}=_0x5db21e;return{'modelTypeId':_0x5b65de,'modelConfig':{'maxResponseTokens':_0x395054,'topN':0x1,'systemMessage':'','rounds':_0x3d909b}};}async[_0x3cff35(0x121)](){const _0x467984=_0x3cff35;let _0x55e0f6=null;_0x55e0f6=this['modelTypes'][_0x467984(0xcf)](_0x5b5d37=>_0x5b5d37[_0x467984(0x112)]);if(!_0x55e0f6){const _0x1ea2f4=this[_0x467984(0xd1)][_0x467984(0x115)](_0x264b7c=>_0x264b7c['status']);_0x1ea2f4['length']&&(_0x55e0f6=_0x1ea2f4[0x0]);}return _0x55e0f6;}async[_0x3cff35(0xff)](){const _0x5c2277=_0x3cff35,_0x1a9cb8=await this[_0x5c2277(0xac)][_0x5c2277(0xcf)]({'order':{'order':_0x5c2277(0xd2)}});return _0x1a9cb8;}async[_0x3cff35(0x124)](){return this['pluginList'];}async[_0x3cff35(0xd8)](_0x491c2f,_0x5c5ac1,_0x32dc14){const _0xd69322=_0x3cff35;await this[_0xd69322(0xd5)][_0xd69322(0x10d)]()[_0xd69322(0x127)](modelKeys_entity_1['ModelKeysEntity'])[_0xd69322(0x105)]({'useCount':()=>_0xd69322(0xd6),'useToken':()=>'useToken\x20+\x20'+_0x32dc14})[_0xd69322(0xd0)](_0xd69322(0x108),{'id':_0x491c2f})[_0xd69322(0x11c)](),await this[_0xd69322(0xac)][_0xd69322(0x10d)]()[_0xd69322(0x127)](modelType_entity_1[_0xd69322(0xce)])[_0xd69322(0x105)]({'useCount':()=>_0xd69322(0xd6),'useToken':()=>_0xd69322(0xb6)+_0x32dc14})[_0xd69322(0xd0)](_0xd69322(0x108),{'id':_0x5c5ac1})[_0xd69322(0x11c)]();}async[_0x3cff35(0xdb)](){}async['queryModelType'](_0x47eacd){const _0x52439f=_0x3cff35,{keyType:_0xfc09d,status:_0x3b4ae5,model:_0x55db9a,page:page=0x1,size:size=0xa}=_0x47eacd,_0x129be3={};_0xfc09d&&(_0x129be3[_0x52439f(0x129)]=_0xfc09d),_0x55db9a&&(_0x129be3['model']=_0x55db9a),_0x3b4ae5&&(_0x129be3[_0x52439f(0xe5)]=Number(_0x3b4ae5)===0x1?!![]:![]);const [_0x4fdab6,_0xd56d64]=await this[_0x52439f(0xac)][_0x52439f(0xf5)]({'where':_0x129be3,'skip':(page-0x1)*size,'take':size,'order':{'order':'DESC'}});return{'rows':_0x4fdab6,'count':_0xd56d64};}async[_0x3cff35(0xfc)](_0x5a8ab5){const _0x4f1f31=_0x3cff35;try{const {id:_0x4b2b36,modelName:_0x47011e}=_0x5a8ab5,_0x1aeec6=this[_0x4f1f31(0xf4)](_0x5a8ab5);if(_0x4b2b36){const _0x156f5f=await this['modelsTypeEntity'][_0x4f1f31(0x127)]({'id':_0x4b2b36},_0x1aeec6);return await this['init'](),_0x156f5f[_0x4f1f31(0xe4)]>0x0;}else{const _0x18fc68=await this['modelsTypeEntity']['findOne']({'where':{'modelName':_0x47011e}});if(_0x18fc68)throw new common_1[(_0x4f1f31(0x10e))](_0x4f1f31(0x119)+_0x47011e+_0x4f1f31(0xfe),common_1[_0x4f1f31(0xe9)][_0x4f1f31(0xd9)]);const _0x1e2ff4=await this[_0x4f1f31(0xac)][_0x4f1f31(0xc8)](_0x1aeec6);return await this[_0x4f1f31(0xb1)](),_0x1e2ff4;}}catch(_0x3308b2){throw new common_1[(_0x4f1f31(0x10e))](_0x4f1f31(0xb0)+(_0x3308b2===null||_0x3308b2===void 0x0?void 0x0:_0x3308b2[_0x4f1f31(0xbd)]),common_1[_0x4f1f31(0xe9)]['BAD_REQUEST']);}}async['delModelType'](_0x65b4b){const _0x39354e=_0x3cff35,{id:_0x2421e5}=_0x65b4b;if(!_0x2421e5)throw new common_1[(_0x39354e(0x10e))](_0x39354e(0xfa),common_1['HttpStatus'][_0x39354e(0xd9)]);const _0x51bf25=await this[_0x39354e(0xac)][_0x39354e(0xc6)]({'where':{'id':_0x2421e5}});if(!_0x51bf25)throw new common_1['HttpException']('无效参数！',common_1['HttpStatus']['BAD_REQUEST']);else{const _0x52fe90=await this[_0x39354e(0xd5)][_0x39354e(0xca)]({'where':{'modelTypeId':_0x2421e5}});console['log'](_0x39354e(0xf3),_0x52fe90);if(_0x52fe90)throw new common_1[(_0x39354e(0x10e))](_0x39354e(0xb2),common_1[_0x39354e(0xe9)][_0x39354e(0xd9)]);const _0x19acb2=await this[_0x39354e(0xac)][_0x39354e(0x120)]({'id':_0x2421e5});return _0x19acb2[_0x39354e(0xe4)];}}async['queryModelKey'](_0x1fc2b9,_0xfcdf54){const _0x18a1d3=_0x3cff35,{role:_0x182002}=_0x1fc2b9['user'],{modelTypeId:_0x320670,status:_0x516752,page:page=0x1,size:size=0xa}=_0xfcdf54,_0x4e5fbd={};_0x320670&&(_0x4e5fbd[_0x18a1d3(0xa6)]=_0x320670),_0x516752&&(_0x4e5fbd[_0x18a1d3(0xe5)]=Number(_0x516752)===0x1?!![]:![]);const [_0x5f3d0d,_0x50b0ab]=await this[_0x18a1d3(0xd5)][_0x18a1d3(0xf5)]({'where':_0x4e5fbd,'skip':(page-0x1)*size,'take':size}),_0x102c98=_0x5f3d0d[_0x18a1d3(0x117)](_0x4bbe8f=>_0x4bbe8f[_0x18a1d3(0xa6)]),_0x3986cb=await this[_0x18a1d3(0xac)][_0x18a1d3(0x101)]({'id':(0x0,typeorm_2['In'])(_0x102c98)});return _0x5f3d0d[_0x18a1d3(0xcc)](_0x453ca0=>{const _0x6c138=_0x18a1d3,_0x5c5059=_0x3986cb[_0x6c138(0xcf)](_0x5b71b0=>_0x5b71b0['id']===_0x453ca0[_0x6c138(0xa6)]);_0x453ca0[_0x6c138(0xc3)]=_0x5c5059,_0x182002!==_0x6c138(0xbb)&&(_0x453ca0[_0x6c138(0x125)]&&(_0x453ca0[_0x6c138(0x125)]=(0x0,utils_1['hideString'])(_0x453ca0['key'])),_0x453ca0[_0x6c138(0x123)]&&(_0x453ca0[_0x6c138(0x123)]=(0x0,utils_1[_0x6c138(0xa4)])(_0x453ca0['secret'])));}),{'rows':_0x5f3d0d,'count':_0x50b0ab};}async[_0x3cff35(0xab)](_0xa65be0){const _0xc34122=_0x3cff35;try{const {id:_0xa9a277,key:_0x2bed7f}=_0xa65be0;if(_0xa9a277){const _0x44a29c=Array[_0xc34122(0xed)](_0xa65be0[_0xc34122(0x125)]);_0x44a29c&&(_0xa65be0[_0xc34122(0x125)]=_0xa65be0[_0xc34122(0x125)][0x0]);const _0x37a1eb=await this[_0xc34122(0xd5)][_0xc34122(0x127)]({'id':_0xa9a277},_0xa65be0);return await this[_0xc34122(0xb1)](),_0x37a1eb[_0xc34122(0xe4)]>0x0;}if(!_0xa9a277){const _0x2974d6=Array[_0xc34122(0xed)](_0xa65be0[_0xc34122(0x125)]);if(!_0x2974d6){const _0x1722d6=await this['modelKeysEntity'][_0xc34122(0xc8)](_0xa65be0);return await this[_0xc34122(0xb1)](),this['refreshBaiduAccesstoken'](),_0x1722d6;}else{const _0x4451ce=_0x2bed7f['map'](_0x18f70d=>{const _0x322223=_0xc34122;try{const _0x1e571e=JSON[_0x322223(0x12d)](JSON[_0x322223(0x11a)](_0xa65be0));return _0x1e571e[_0x322223(0x125)]=_0x18f70d,!_0x1e571e[_0x322223(0x100)]&&(_0x1e571e['order']=0x64),_0x1e571e;}catch(_0xe711be){}})[_0xc34122(0x115)](_0x13e9ae=>_0x13e9ae),_0x4ad537=await this[_0xc34122(0xd5)][_0xc34122(0xc8)](_0x4451ce);return await this[_0xc34122(0xb1)](),_0x4ad537;}}}catch(_0x5d664e){throw new common_1[(_0xc34122(0x10e))](_0xc34122(0x10b),common_1['HttpStatus'][_0xc34122(0xd9)]);}}async[_0x3cff35(0x131)](_0x3a93a6){const _0x1a79bc=_0x3cff35,{id:_0x2898d3}=_0x3a93a6;if(!_0x2898d3)throw new common_1[(_0x1a79bc(0x10e))](_0x1a79bc(0xfa),common_1[_0x1a79bc(0xe9)]['BAD_REQUEST']);const _0x12b880=await this[_0x1a79bc(0xd5)][_0x1a79bc(0xc6)]({'where':{'id':_0x2898d3}});if(!_0x12b880)throw new common_1[(_0x1a79bc(0x10e))]('无效参数！',common_1['HttpStatus']['BAD_REQUEST']);else{const _0x238986=await this[_0x1a79bc(0xd5)][_0x1a79bc(0x120)]({'id':_0x2898d3});return _0x238986[_0x1a79bc(0xe4)];}}[_0x3cff35(0x114)](_0x23329c,_0x451515){let _0x3b1368=models_1['ModelMaxtokenMap'][_0x23329c];return!_0x3b1368?_0x3b1368=0x1000:_0x451515<_0x3b1368&&_0x451515>0x0&&(_0x3b1368=_0x451515),_0x3b1368;}[_0x3cff35(0xf4)](_0x5da717){const _0x59de32=_0x3cff35,_0x1d696b=JSON['parse'](JSON['stringify'](_0x5da717)),{model:_0x3f889e,maxTokens:_0x447305}=_0x1d696b,_0x5f0b0e=models_1[_0x59de32(0xeb)][_0x3f889e];return _0x1d696b['maxTokens']=this[_0x59de32(0x114)](_0x3f889e,_0x447305),_0x1d696b[_0x59de32(0x102)]<0x1388&&(_0x1d696b[_0x59de32(0x106)]=0x800),_0x1d696b[_0x59de32(0x102)]>0x1388&&_0x1d696b[_0x59de32(0x102)]<0x2710&&(_0x1d696b[_0x59de32(0x106)]=0x1000),_0x1d696b['maxTokens']>0x2710&&_0x1d696b['maxTokens']<0x7530&&(_0x1d696b[_0x59de32(0x106)]=0x2000),_0x1d696b[_0x59de32(0x102)]>0x7530&&_0x1d696b[_0x59de32(0x102)]<0xc350&&(_0x1d696b['maxResponseTokens']=0x3e80),_0x1d696b[_0x59de32(0x102)]>0xc350&&(_0x1d696b[_0x59de32(0x106)]=0x9c4),_0x1d696b;}async[_0x3cff35(0xf7)](_0x3dda80){const _0x2a4ccc=_0x3cff35;return await this[_0x2a4ccc(0xd1)][_0x2a4ccc(0xcf)](_0x35ebcb=>_0x35ebcb['id']===_0x3dda80);}async[_0x3cff35(0xba)](){const _0x4c4fb9=_0x3cff35;var _0x26e20f;const _0x237ea8=(_0x26e20f=this[_0x4c4fb9(0xd1)][_0x4c4fb9(0xcf)](_0x16d57a=>_0x16d57a[_0x4c4fb9(0xc9)]))===null||_0x26e20f===void 0x0?void 0x0:_0x26e20f['id'];if(!_0x237ea8)return;const _0x5f75c6=this['modelMaps'][_0x237ea8];if(!_0x5f75c6[_0x4c4fb9(0x122)])return;const _0x3fc55b=this['keyPoolIndexMap'][_0x237ea8],_0x299777=_0x5f75c6[_0x3fc55b];return this[_0x4c4fb9(0xae)][_0x237ea8]++,this['keyPoolIndexMap'][_0x237ea8]>=_0x5f75c6[_0x4c4fb9(0x122)]&&(this[_0x4c4fb9(0xae)][_0x237ea8]=0x0),_0x299777;}async[_0x3cff35(0xe2)](_0x2df2d4){const _0x17ad62=_0x3cff35;if(!_0x2df2d4)return;const _0x22e9d6=this['modelMaps'][_0x2df2d4];if(!_0x22e9d6['length'])return;const _0x1ca164=this['keyPoolIndexMap'][_0x2df2d4],_0x1a235a=_0x22e9d6[_0x1ca164];return this['keyPoolIndexMap'][_0x2df2d4]++,this[_0x17ad62(0xae)][_0x2df2d4]>=_0x22e9d6[_0x17ad62(0x122)]&&(this[_0x17ad62(0xae)][_0x2df2d4]=0x0),_0x1a235a;}async[_0x3cff35(0xa1)](){const _0x3e9eb3=_0x3cff35;var _0x1c2769;const _0x4fc7e5=(_0x1c2769=this[_0x3e9eb3(0xd1)][_0x3e9eb3(0xcf)](_0x585a57=>_0x585a57[_0x3e9eb3(0x126)]))===null||_0x1c2769===void 0x0?void 0x0:_0x1c2769['id'];if(!_0x4fc7e5)return;const _0x19174c=this[_0x3e9eb3(0xdc)][_0x4fc7e5];if(!_0x19174c[_0x3e9eb3(0x122)])return;const _0x299f34=this['keyPoolIndexMap'][_0x4fc7e5],_0x19e4a3=_0x19174c[_0x299f34];return this[_0x3e9eb3(0xae)][_0x4fc7e5]++,this[_0x3e9eb3(0xae)][_0x4fc7e5]>=_0x19174c[_0x3e9eb3(0x122)]&&(this[_0x3e9eb3(0xae)][_0x4fc7e5]=0x0),_0x19e4a3;}async[_0x3cff35(0x104)](){const _0x35df02=_0x3cff35;var _0x57527d;const _0x218ac4=await((_0x57527d=this[_0x35df02(0xd1)][_0x35df02(0xcf)](_0x19fb4d=>_0x19fb4d[_0x35df02(0xc5)]['includes'](_0x35df02(0x12e))))===null||_0x57527d===void 0x0?void 0x0:_0x57527d['id']);return this[_0x35df02(0xe2)](_0x218ac4);}async[_0x3cff35(0xd3)](_0x2a1a11){const _0x3c2d70=_0x3cff35;var _0x1aced1;if(!_0x2a1a11){const _0x52d895=await this[_0x3c2d70(0x121)]();return _0x52d895?_0x52d895['id']:null;}return(_0x1aced1=this[_0x3c2d70(0xd1)][_0x3c2d70(0xcf)](_0x1f47e8=>_0x1f47e8[_0x3c2d70(0xc5)]===_0x2a1a11))===null||_0x1aced1===void 0x0?void 0x0:_0x1aced1['id'];}[_0x3cff35(0xa9)](_0x47fa00){const _0x5d02ae=_0x3cff35,_0x1643fb=_0x47fa00[_0x5d02ae(0xf8)]('/')?_0x47fa00[_0x5d02ae(0xf9)](0x0,-0x1):_0x47fa00,_0x44dd4e=_0x1643fb||'https://api.openai.com';return _0x44dd4e+_0x5d02ae(0x11e);}async[_0x3cff35(0x110)](_0x506215,_0x44734e){const _0x3be9a2=_0x3cff35;var _0x277b5f,_0x475d09,_0x57a597,_0x57bd5d;const {keyword:_0x597674}=_0x44734e,_0xb41850=await this[_0x3be9a2(0xd3)](_0x3be9a2(0xb5)),_0x5ac972=await this[_0x3be9a2(0xe2)](_0xb41850);if(!_0x5ac972)throw new common_1[(_0x3be9a2(0x10e))](_0x3be9a2(0x11f),common_1[_0x3be9a2(0xe9)][_0x3be9a2(0xd9)]);const {key:_0x18afe7,proxyUrl:_0x971c8c}=_0x5ac972,_0x283a7b={'method':_0x3be9a2(0xa8),'url':this[_0x3be9a2(0xa9)](_0x971c8c),'headers':{'Content-Type':_0x3be9a2(0xb9),'Authorization':_0x3be9a2(0xc2)+(0x0,utils_1[_0x3be9a2(0xe6)])(_0x18afe7)},'data':{'max_tokens':0xc8,'model':_0x3be9a2(0xb5),'messages':[{'role':_0x3be9a2(0xe7),'content':_0x597674}]}};console[_0x3be9a2(0xfd)](_0x3be9a2(0xaa),_0x283a7b);try{const _0xf7d158=await(0x0,axios_1[_0x3be9a2(0xfb)])(_0x283a7b);if(_0xf7d158[_0x3be9a2(0xe5)]!==0xc8||!((_0x277b5f=_0xf7d158===null||_0xf7d158===void 0x0?void 0x0:_0xf7d158[_0x3be9a2(0xde)])===null||_0x277b5f===void 0x0?void 0x0:_0x277b5f[_0x3be9a2(0xad)][_0x3be9a2(0x122)]))throw new common_1[(_0x3be9a2(0x10e))](_0x3be9a2(0xbf),common_1[_0x3be9a2(0xe9)][_0x3be9a2(0xd9)]);const _0x1501d5=(_0x57bd5d=(_0x57a597=(_0x475d09=_0xf7d158===null||_0xf7d158===void 0x0?void 0x0:_0xf7d158[_0x3be9a2(0xde)])===null||_0x475d09===void 0x0?void 0x0:_0x475d09[_0x3be9a2(0xad)][0x0])===null||_0x57a597===void 0x0?void 0x0:_0x57a597['message'])===null||_0x57bd5d===void 0x0?void 0x0:_0x57bd5d[_0x3be9a2(0x12f)],_0x18b08b=JSON['parse'](_0x1501d5);return _0x18b08b[_0x3be9a2(0xa5)][_0x3be9a2(0x117)](_0x26f0bf=>{const _0x336273=_0x3be9a2,{gizmo:_0x35b169,tools:_0x323f92}=_0x26f0bf,{id:_0x3391bf,display:_0x597461,vanity_metrics:_0x29a2ba}=_0x35b169,{name:_0x41c391,description:_0x3accf5,prompt_starters:_0x399b43,profile_picture_url:_0x2f748e,welcome_message:_0x53f1f0}=_0x597461,{num_conversations_str:_0x3da219,created_ago_str:_0x555f22}=_0x29a2ba;return{'gptsId':_0x3391bf,'name':_0x41c391,'des':_0x3accf5,'demoData':Array[_0x336273(0xed)](_0x399b43)?_0x399b43[_0x336273(0xd7)]('\x0a'):_0x399b43,'coverImg':_0x2f748e,'heat':_0x3da219,'createTime':_0x555f22,'welcome_message':_0x53f1f0,'isGpts':!![]};});}catch(_0xf58374){console['log'](_0x3be9a2(0xe8),_0xf58374);throw new common_1['HttpException']('搜索异常！',common_1[_0x3be9a2(0xe9)][_0x3be9a2(0xd9)]);}}};ModelsService=__decorate([(0x0,common_1[_0x3cff35(0xf0)])(),__param(0x0,(0x0,typeorm_1[_0x3cff35(0xb8)])(modelType_entity_1['ModelsTypeEntity'])),__param(0x1,(0x0,typeorm_1[_0x3cff35(0xb8)])(modelKeys_entity_1[_0x3cff35(0x116)])),__metadata(_0x3cff35(0xef),[typeorm_2[_0x3cff35(0xbe)],typeorm_2[_0x3cff35(0xbe)]])],ModelsService),exports[_0x3cff35(0x10a)]=ModelsService;