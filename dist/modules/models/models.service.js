'use strict';const _0x164fb0=_0x18d8;(function(_0x367e1a,_0x287692){const _0x45517b=_0x18d8,_0xb270ed=_0x367e1a();while(!![]){try{const _0x417a47=parseInt(_0x45517b(0xb3))/0x1+-parseInt(_0x45517b(0xfa))/0x2*(parseInt(_0x45517b(0x77))/0x3)+-parseInt(_0x45517b(0xed))/0x4*(parseInt(_0x45517b(0xa4))/0x5)+-parseInt(_0x45517b(0x7a))/0x6+-parseInt(_0x45517b(0x8d))/0x7*(parseInt(_0x45517b(0xa9))/0x8)+parseInt(_0x45517b(0xeb))/0x9*(parseInt(_0x45517b(0x8f))/0xa)+parseInt(_0x45517b(0xc2))/0xb*(parseInt(_0x45517b(0x75))/0xc);if(_0x417a47===_0x287692)break;else _0xb270ed['push'](_0xb270ed['shift']());}catch(_0x5cee2f){_0xb270ed['push'](_0xb270ed['shift']());}}}(_0x4f0e,0xe0d7b));function _0x4f0e(){const _0x5e13ac=['getPluginList','385995qcKnpK','initPluginList','./modelKeys.entity','1374750DsbWyp','../../common/constants/plugin','modelMaps','getDefaultModel','keyPoolIndexMap','delModelType','findOne','Injectable','useCount\x20+\x201','模型名称\x20->\x20','saveUseLog','Logger','Bearer\x20','\x20欠费或被官方封禁导致不可用，已被系统自动锁定','getOwnPropertyDescriptor','error','user','design:paramtypes','function','45157jsFqty','forEach','20DOClOy','stringify','getTtsModelKey','removeSpecialCharacters','modelInfo','search-gpts','getUseDrawModelKey','update','setModelKey','ModelKeysEntity','queryModelType','../../common/constants/models','count:\x20','keyPoolMap','number','当前未配置任何模型分类，请先配置模型分类！','modelKeysEntity','save','isGpts','getMaxToken','ModelsTypeEntity','250msfPSk','keyCount','maxResponseTokens','PluginDefaultList','getModelTypeIdFromGpts','1584wanTfX','queryModelKey','compilerParams','无效参数！','HttpException','count','gpt-4-gizmo','includes','getModelTypeIdFromPluginId','defineProperty','235129bGremf','createQueryBuilder','当前模型下还有KEY、请删除当前模型下的KEY后再删除模型','application/json','keyType','secret','data','join','refreshBaiduAccesstoken','key:\x20','getFullUrl','affected','InjectRepository','https://api.gptgod.online/','findBy','8596093jiAFRO','modelsTypeEntity','parse','\x20已经添加过！','all','error:\x20','filter','searchGpts','getCurrentModelKeyInfo','find','Repository','hideString','getModelTypeIdFromModelName','status','delete','https://api.openai.com','endsWith','maxTokens','map','typeorm','DESC','modelTypeId','tts','pluginList','object','__param','init','getModelTypeDetailFromId','key','metadata','assign','BAD_REQUEST','log','../../common/utils','HttpStatus','isUseTool','default','modelTypes','__decorate','items','choices','1410588HENhrC','push','141696BWfhXa','where','decorate','slice','__metadata','id\x20=\x20:id','super','/v1/chat/completions','modelsList','findAndCount','execute','编辑模型失败\x20->\x20','./modelType.entity','4wqVXlS','搜索异常！','model','length','ModelMaxtokenMap','useToken\x20+\x20','添加Key失败！','60oNCVWC'];_0x4f0e=function(){return _0x5e13ac;};return _0x4f0e();}var __decorate=this&&this[_0x164fb0(0xe8)]||function(_0x4725e7,_0x5ab03f,_0x465d89,_0x12c8c9){const _0x5187e6=_0x164fb0;var _0x588b98=arguments[_0x5187e6(0xfd)],_0x5db84c=_0x588b98<0x3?_0x5ab03f:_0x12c8c9===null?_0x12c8c9=Object[_0x5187e6(0x88)](_0x5ab03f,_0x465d89):_0x12c8c9,_0x362a3f;if(typeof Reflect===_0x5187e6(0xda)&&typeof Reflect['decorate']===_0x5187e6(0x8c))_0x5db84c=Reflect[_0x5187e6(0xef)](_0x4725e7,_0x5ab03f,_0x465d89,_0x12c8c9);else{for(var _0x259f58=_0x4725e7['length']-0x1;_0x259f58>=0x0;_0x259f58--)if(_0x362a3f=_0x4725e7[_0x259f58])_0x5db84c=(_0x588b98<0x3?_0x362a3f(_0x5db84c):_0x588b98>0x3?_0x362a3f(_0x5ab03f,_0x465d89,_0x5db84c):_0x362a3f(_0x5ab03f,_0x465d89))||_0x5db84c;}return _0x588b98>0x3&&_0x5db84c&&Object[_0x5187e6(0xb2)](_0x5ab03f,_0x465d89,_0x5db84c),_0x5db84c;},__metadata=this&&this[_0x164fb0(0xf1)]||function(_0x89a5fd,_0x442660){const _0x53ff57=_0x164fb0;if(typeof Reflect===_0x53ff57(0xda)&&typeof Reflect[_0x53ff57(0xdf)]===_0x53ff57(0x8c))return Reflect[_0x53ff57(0xdf)](_0x89a5fd,_0x442660);},__param=this&&this[_0x164fb0(0xdb)]||function(_0x4852e3,_0x2e0394){return function(_0x4ba2e7,_0x317b2b){_0x2e0394(_0x4ba2e7,_0x317b2b,_0x4852e3);};};function _0x18d8(_0x532b59,_0x15b202){const _0x4f0eeb=_0x4f0e();return _0x18d8=function(_0x18d8b2,_0x4ea2b9){_0x18d8b2=_0x18d8b2-0x74;let _0x1f9426=_0x4f0eeb[_0x18d8b2];return _0x1f9426;},_0x18d8(_0x532b59,_0x15b202);}Object[_0x164fb0(0xb2)](exports,'__esModule',{'value':!![]}),exports['ModelsService']=void 0x0;const common_1=require('@nestjs/common'),typeorm_1=require('@nestjs/typeorm'),typeorm_2=require(_0x164fb0(0xd5)),utils_1=require(_0x164fb0(0xe3)),modelType_entity_1=require(_0x164fb0(0xf9)),modelKeys_entity_1=require(_0x164fb0(0x79)),models_1=require(_0x164fb0(0x9a)),plugin_1=require(_0x164fb0(0x7b)),axios_1=require('axios');let ModelsService=class ModelsService{constructor(_0x383d53,_0x31d28e){const _0x8797ee=_0x164fb0;this[_0x8797ee(0xc3)]=_0x383d53,this[_0x8797ee(0x9f)]=_0x31d28e,this[_0x8797ee(0xe7)]=[],this[_0x8797ee(0x7c)]={},this[_0x8797ee(0x9c)]={},this['keyPoolIndexMap']={},this[_0x8797ee(0xd9)]=[];}async['onModuleInit'](){const _0x22fbb9=_0x164fb0;await this[_0x22fbb9(0xdc)]();}async[_0x164fb0(0xdc)](){const _0x41bd04=_0x164fb0;this[_0x41bd04(0xe7)]=[],this[_0x41bd04(0x7c)]={},this[_0x41bd04(0x9c)]={},this[_0x41bd04(0x7e)]={},this[_0x41bd04(0xe7)]=await this[_0x41bd04(0xc3)]['find']();const _0x1f236e=this[_0x41bd04(0xe7)][_0x41bd04(0xd4)](_0x474d8d=>_0x474d8d['id']),_0xa38843=await this[_0x41bd04(0x9f)]['find']({'where':{'modelTypeId':(0x0,typeorm_2['In'])(_0x1f236e),'status':!![]}});this[_0x41bd04(0xe7)][_0x41bd04(0x8e)](_0x50f213=>{const _0x4e298d=_0x41bd04,_0x39f3ac=_0xa38843['filter'](_0x27cec0=>_0x27cec0[_0x4e298d(0xd7)]===_0x50f213['id']);this[_0x4e298d(0x7c)][_0x50f213['id']]=_0x39f3ac;}),this['modelTypes'][_0x41bd04(0x8e)](_0x3796cb=>{const _0x114bfb=_0x41bd04,{id:_0x55e4f9}=_0x3796cb,_0x2cb57f=this[_0x114bfb(0x7c)][_0x55e4f9];if(!this[_0x114bfb(0x9c)][_0x55e4f9])this[_0x114bfb(0x9c)][_0x55e4f9]=[];_0x2cb57f['forEach'](_0x15daa4=>{const _0x1db119=_0x114bfb,{keyWeight:_0x39f967,id:_0x43eec5}=_0x15daa4;let _0xe8a139=Number(_0x39f967);if(typeof _0xe8a139!==_0x1db119(0x9d))_0xe8a139=0x1;for(let _0x5c0b32=0x0;_0x5c0b32<_0x39f967;_0x5c0b32++){this[_0x1db119(0x9c)][_0x55e4f9][_0x1db119(0xec)](_0x43eec5);}});if(!this[_0x114bfb(0x7e)][_0x55e4f9])this['keyPoolIndexMap'][_0x55e4f9]=0x0;}),await this[_0x41bd04(0x78)]();}[_0x164fb0(0xb1)](_0xc39907){const _0x7115f1=_0x164fb0;var _0x5b654e;return(_0x5b654e=this[_0x7115f1(0xd9)]['find'](_0x2597a0=>_0x2597a0['id']===_0xc39907))===null||_0x5b654e===void 0x0?void 0x0:_0x5b654e[_0x7115f1(0xd7)];}async[_0x164fb0(0xa8)](){const _0x48a8cc=_0x164fb0;var _0x3a753d;return(_0x3a753d=this[_0x48a8cc(0xe7)][_0x48a8cc(0xcb)](_0x1f1513=>_0x1f1513[_0x48a8cc(0xfc)]===_0x48a8cc(0xaf)))===null||_0x3a753d===void 0x0?void 0x0:_0x3a753d['id'];}[_0x164fb0(0x78)](){const _0x31096d=_0x164fb0,_0x211a98=plugin_1[_0x31096d(0xa7)][_0x31096d(0xc8)](_0x1d4c75=>{const _0x3c9d31=_0x31096d,{pluginModelName:_0x21c6d2}=_0x1d4c75,_0x59ecec=this['modelTypes'][_0x3c9d31(0xc8)](_0x1b732b=>{const _0x2adace=_0x3c9d31;var _0x13ba55;const {id:_0x416795}=_0x1b732b;return((_0x13ba55=this[_0x2adace(0x9c)][_0x416795])===null||_0x13ba55===void 0x0?void 0x0:_0x13ba55['length'])||!_0x21c6d2;})[_0x3c9d31(0xd4)](_0x47eab6=>{return _0x47eab6['model'];});return _0x59ecec[_0x3c9d31(0xb0)](_0x21c6d2)||!_0x21c6d2;});this[_0x31096d(0xd9)]=_0x211a98[_0x31096d(0xd4)](_0x779c22=>{const _0xd677=_0x31096d;var _0x216014;const {pluginModelName:_0x1a3d7c}=_0x779c22,_0x364247=(_0x216014=this['modelTypes'][_0xd677(0xcb)](_0x1e937d=>_0x1e937d[_0xd677(0xfc)]===_0x1a3d7c))===null||_0x216014===void 0x0?void 0x0:_0x216014['id'];return Object[_0xd677(0xe0)](Object['assign']({},_0x779c22),{'modelTypeId':_0x364247});});}['getOpenPluginList'](){const _0x312141=_0x164fb0;return this[_0x312141(0xd9)][_0x312141(0xd4)](_0x34beb3=>{const _0x2ec6c0=_0x312141;var _0x10cc6a;const {pluginModelName:_0x24f838,pluginName:_0x38379a,icon:_0xceecdb,id:_0x18a388}=_0x34beb3,_0x19f3cc=(_0x10cc6a=this['modelTypes'][_0x2ec6c0(0xcb)](_0x4e8f90=>_0x4e8f90[_0x2ec6c0(0xfc)]===_0x24f838))===null||_0x10cc6a===void 0x0?void 0x0:_0x10cc6a['id'];return Object[_0x2ec6c0(0xe0)](Object[_0x2ec6c0(0xe0)]({},_0x34beb3),{'pluginId':_0x18a388,'modelTypeId':_0x19f3cc});});}async['lockKey'](_0x11b530,_0x28c9cf,_0x1f9610=-0x1){const _0x1a660b=_0x164fb0,_0x1ec26e=await this[_0x1a660b(0x9f)][_0x1a660b(0x96)]({'id':_0x11b530},{'status':![],'keyStatus':_0x1f9610,'remark':_0x28c9cf});common_1[_0x1a660b(0x85)][_0x1a660b(0x89)](_0x1a660b(0xbc)+_0x11b530+_0x1a660b(0x87)),this[_0x1a660b(0xdc)]();}async['getBaseConfig'](_0xf1844e){const _0x489e1a=_0x164fb0;if(!this[_0x489e1a(0xe7)][_0x489e1a(0xfd)]){common_1[_0x489e1a(0x85)]['debug'](_0x489e1a(0x9e));return;}let _0x3ad569=null;if(_0xf1844e===null||_0xf1844e===void 0x0?void 0x0:_0xf1844e[_0x489e1a(0xd7)])_0x3ad569=await this['getModelTypeDetailFromId'](_0xf1844e===null||_0xf1844e===void 0x0?void 0x0:_0xf1844e['modelTypeId']);else{if(_0xf1844e===null||_0xf1844e===void 0x0?void 0x0:_0xf1844e[_0x489e1a(0xa1)]){const _0x4e6bcb=await this[_0x489e1a(0xce)]('gpt-4-gizmo');_0x3ad569=this[_0x489e1a(0xe7)]['find'](_0x4b953e=>_0x4b953e['id']===_0x4e6bcb);}else _0x3ad569=await this[_0x489e1a(0x7d)]();}if(!_0x3ad569)return;const {id:_0x71cafe,maxRounds:_0x2b78b6,maxResponseTokens:_0x38884f}=_0x3ad569;return{'modelTypeId':_0x71cafe,'modelConfig':{'maxResponseTokens':_0x38884f,'topN':0.8,'systemMessage':'','rounds':_0x2b78b6}};}async['getDefaultModel'](){const _0x57cc69=_0x164fb0;let _0x527268=null;_0x527268=this[_0x57cc69(0xe7)][_0x57cc69(0xcb)](_0x46ccd9=>_0x46ccd9['isDefaultModel']);if(!_0x527268){const _0x5d5b6a=this['modelTypes'][_0x57cc69(0xc8)](_0x2f4b43=>_0x2f4b43[_0x57cc69(0xcf)]);_0x5d5b6a[_0x57cc69(0xfd)]&&(_0x527268=_0x5d5b6a[0x0]);}return _0x527268;}async[_0x164fb0(0xf5)](){const _0x4d25ac=_0x164fb0,_0x41f97e=await this['modelsTypeEntity'][_0x4d25ac(0xcb)]({'order':{'order':_0x4d25ac(0xd6)}});return _0x41f97e;}async[_0x164fb0(0x76)](){const _0x202ed2=_0x164fb0;return this[_0x202ed2(0xd9)];}async['saveUseLog'](_0x53d0bf,_0x44c0a9,_0x15211d){const _0x1f0165=_0x164fb0;await this[_0x1f0165(0x9f)][_0x1f0165(0xb4)]()[_0x1f0165(0x96)](modelKeys_entity_1['ModelKeysEntity'])['set']({'useCount':()=>_0x1f0165(0x82),'useToken':()=>_0x1f0165(0xff)+_0x15211d})[_0x1f0165(0xee)]('id\x20=\x20:id',{'id':_0x53d0bf})['execute'](),await this[_0x1f0165(0xc3)][_0x1f0165(0xb4)]()[_0x1f0165(0x96)](modelType_entity_1[_0x1f0165(0xa3)])['set']({'useCount':()=>'useCount\x20+\x201','useToken':()=>_0x1f0165(0xff)+_0x15211d})[_0x1f0165(0xee)](_0x1f0165(0xf2),{'id':_0x44c0a9})[_0x1f0165(0xf7)]();}async[_0x164fb0(0xbb)](){}async[_0x164fb0(0x99)](_0x402e98){const _0x40509e=_0x164fb0,{keyType:_0xec90f0,status:_0x2bc1d1,model:_0x2555c4,page:page=0x1,size:size=0xa}=_0x402e98,_0x2b66cd={};_0xec90f0&&(_0x2b66cd[_0x40509e(0xb7)]=_0xec90f0),_0x2555c4&&(_0x2b66cd[_0x40509e(0xfc)]=_0x2555c4),_0x2bc1d1&&(_0x2b66cd['status']=Number(_0x2bc1d1)===0x1?!![]:![]);const [_0x2f66b4,_0xda54ed]=await this['modelsTypeEntity'][_0x40509e(0xf6)]({'where':_0x2b66cd,'skip':(page-0x1)*size,'take':size,'order':{'order':_0x40509e(0xd6)}}),_0x4e8a1c=_0x2f66b4[_0x40509e(0xd4)](_0x3ace09=>_0x3ace09['id']),_0x44a228={};for(const _0x560872 of _0x4e8a1c){const _0x463edc=await this[_0x40509e(0x9f)][_0x40509e(0xae)]({'where':{'modelTypeId':_0x560872}});_0x44a228[_0x560872]=_0x463edc;}return _0x2f66b4[_0x40509e(0x8e)](_0x7630fe=>{const _0x3dc34b=_0x40509e;_0x7630fe[_0x3dc34b(0xa5)]=_0x44a228[_0x7630fe['id']]||0x0;}),{'rows':_0x2f66b4,'count':_0xda54ed};}async['setModelType'](_0x6eddbf){const _0x3b3bc4=_0x164fb0;try{const {id:_0x334a79,modelName:_0x45d834}=_0x6eddbf,_0x204fb0=this['compilerParams'](_0x6eddbf);if(_0x334a79){const _0x29d388=await this[_0x3b3bc4(0xc3)][_0x3b3bc4(0x96)]({'id':_0x334a79},_0x204fb0);return await this['init'](),_0x29d388[_0x3b3bc4(0xbe)]>0x0;}else{const _0x969c21=await this[_0x3b3bc4(0xc3)][_0x3b3bc4(0x80)]({'where':{'modelName':_0x45d834}});if(_0x969c21)throw new common_1[(_0x3b3bc4(0xad))](_0x3b3bc4(0x83)+_0x45d834+_0x3b3bc4(0xc5),common_1[_0x3b3bc4(0xe4)]['BAD_REQUEST']);const _0x286450=await this[_0x3b3bc4(0xc3)][_0x3b3bc4(0xa0)](_0x204fb0);return await this[_0x3b3bc4(0xdc)](),_0x286450;}}catch(_0x3d14ae){throw new common_1[(_0x3b3bc4(0xad))](_0x3b3bc4(0xf8)+(_0x3d14ae===null||_0x3d14ae===void 0x0?void 0x0:_0x3d14ae['response']),common_1['HttpStatus'][_0x3b3bc4(0xe1)]);}}async[_0x164fb0(0x7f)](_0x4d707a){const _0x1942bb=_0x164fb0,{id:_0x4a5aa0}=_0x4d707a;if(!_0x4a5aa0)throw new common_1['HttpException'](_0x1942bb(0xac),common_1[_0x1942bb(0xe4)][_0x1942bb(0xe1)]);const _0x2537fc=await this[_0x1942bb(0xc3)][_0x1942bb(0x80)]({'where':{'id':_0x4a5aa0}});if(!_0x2537fc)throw new common_1[(_0x1942bb(0xad))](_0x1942bb(0xac),common_1[_0x1942bb(0xe4)][_0x1942bb(0xe1)]);else{const _0x1f14b9=await this[_0x1942bb(0x9f)][_0x1942bb(0xae)]({'where':{'modelTypeId':_0x4a5aa0}});console[_0x1942bb(0xe2)](_0x1942bb(0x9b),_0x1f14b9);if(_0x1f14b9)throw new common_1[(_0x1942bb(0xad))](_0x1942bb(0xb5),common_1[_0x1942bb(0xe4)][_0x1942bb(0xe1)]);const _0x55edc7=await this[_0x1942bb(0xc3)][_0x1942bb(0xd0)]({'id':_0x4a5aa0});return this[_0x1942bb(0xdc)](),_0x55edc7['affected'];}}async[_0x164fb0(0xaa)](_0x373b3e,_0x23b037){const _0x5f106d=_0x164fb0,{role:_0x4a5691}=_0x373b3e[_0x5f106d(0x8a)],{modelTypeId:_0x2f1e65,status:_0x294055,page:page=0x1,size:size=0xa}=_0x23b037,_0x1fc9be={};_0x2f1e65&&(_0x1fc9be[_0x5f106d(0xd7)]=_0x2f1e65),_0x294055&&(_0x1fc9be[_0x5f106d(0xcf)]=Number(_0x294055)===0x1?!![]:![]);const [_0x3dcc61,_0x97eb5f]=await this[_0x5f106d(0x9f)]['findAndCount']({'where':_0x1fc9be,'skip':(page-0x1)*size,'take':size}),_0x3c83bf=_0x3dcc61[_0x5f106d(0xd4)](_0x23773f=>_0x23773f[_0x5f106d(0xd7)]),_0x3d1c42=await this['modelsTypeEntity'][_0x5f106d(0xc1)]({'id':(0x0,typeorm_2['In'])(_0x3c83bf)});return _0x3dcc61[_0x5f106d(0x8e)](_0xea2782=>{const _0x19dbaf=_0x5f106d,_0x51e8ef=_0x3d1c42[_0x19dbaf(0xcb)](_0x51078d=>_0x51078d['id']===_0xea2782[_0x19dbaf(0xd7)]);_0xea2782[_0x19dbaf(0x93)]=_0x51e8ef,_0x4a5691!==_0x19dbaf(0xf3)&&(_0xea2782[_0x19dbaf(0xde)]&&(_0xea2782[_0x19dbaf(0xde)]=(0x0,utils_1[_0x19dbaf(0xcd)])(_0xea2782[_0x19dbaf(0xde)])),_0xea2782[_0x19dbaf(0xb8)]&&(_0xea2782['secret']=(0x0,utils_1['hideString'])(_0xea2782['secret'])));}),{'rows':_0x3dcc61,'count':_0x97eb5f};}async[_0x164fb0(0x97)](_0x3140cd){const _0x5a24bd=_0x164fb0;try{const {id:_0x5cf354,key:_0x487c4b,modelTypeId:_0x2340ef}=_0x3140cd;if(_0x5cf354){const _0x2db3f3=JSON[_0x5a24bd(0xc4)](JSON[_0x5a24bd(0x90)](_0x3140cd));_0x2db3f3[_0x5a24bd(0xde)]=_0x3140cd[_0x5a24bd(0xde)][0x0],_0x2db3f3[_0x5a24bd(0xd7)]=_0x2340ef[0x0];const _0x3f556a=await this[_0x5a24bd(0x9f)][_0x5a24bd(0x96)]({'id':_0x5cf354},_0x2db3f3);return await this[_0x5a24bd(0xdc)](),_0x3f556a['affected']>0x0;}if(!_0x5cf354){const _0x308821=[];return _0x2340ef[_0x5a24bd(0x8e)](_0x28bcfd=>_0x308821['push'](this[_0x5a24bd(0x9f)][_0x5a24bd(0xa0)](Object[_0x5a24bd(0xe0)](Object['assign']({},_0x3140cd),{'modelTypeId':_0x28bcfd,'order':0x64})))),await Promise[_0x5a24bd(0xc6)](_0x308821),await this[_0x5a24bd(0xdc)](),!![];}}catch(_0x490891){console['log'](_0x5a24bd(0xc7),_0x490891);throw new common_1[(_0x5a24bd(0xad))](_0x5a24bd(0x74),common_1[_0x5a24bd(0xe4)]['BAD_REQUEST']);}}async['delModelKey'](_0x457d25){const _0x40649e=_0x164fb0,{id:_0xe0206}=_0x457d25;if(!_0xe0206)throw new common_1['HttpException'](_0x40649e(0xac),common_1[_0x40649e(0xe4)][_0x40649e(0xe1)]);const _0x4f1a2e=await this[_0x40649e(0x9f)][_0x40649e(0x80)]({'where':{'id':_0xe0206}});if(!_0x4f1a2e)throw new common_1['HttpException'](_0x40649e(0xac),common_1[_0x40649e(0xe4)]['BAD_REQUEST']);else{const _0x2a2d84=await this['modelKeysEntity']['delete']({'id':_0xe0206});return this[_0x40649e(0xdc)](),_0x2a2d84[_0x40649e(0xbe)];}}[_0x164fb0(0xa2)](_0x3fc032,_0x251963){const _0x328aae=_0x164fb0;let _0x5d191c=models_1[_0x328aae(0xfe)][_0x3fc032];return!_0x5d191c?_0x5d191c=0x1000:_0x251963<_0x5d191c&&_0x251963>0x0&&(_0x5d191c=_0x251963),_0x5d191c;}[_0x164fb0(0xab)](_0x2cb4e9){const _0x30b46e=_0x164fb0,_0x2297d8=JSON[_0x30b46e(0xc4)](JSON['stringify'](_0x2cb4e9)),{model:_0x5debcb,maxTokens:_0x1f3cf4}=_0x2297d8,_0x383986=models_1[_0x30b46e(0xfe)][_0x5debcb];return _0x2297d8['maxTokens']=this[_0x30b46e(0xa2)](_0x5debcb,_0x1f3cf4),_0x2297d8['maxTokens']<0x1388&&(_0x2297d8[_0x30b46e(0xa6)]=0x800),_0x2297d8['maxTokens']>0x1388&&_0x2297d8[_0x30b46e(0xd3)]<0x2710&&(_0x2297d8['maxResponseTokens']=0x1000),_0x2297d8[_0x30b46e(0xd3)]>0x2710&&_0x2297d8[_0x30b46e(0xd3)]<0x7530&&(_0x2297d8['maxResponseTokens']=0x2000),_0x2297d8[_0x30b46e(0xd3)]>0x7530&&_0x2297d8[_0x30b46e(0xd3)]<0xc350&&(_0x2297d8[_0x30b46e(0xa6)]=0x3e80),_0x2297d8['maxTokens']>0xc350&&(_0x2297d8[_0x30b46e(0xa6)]=0x9c4),_0x2297d8;}async[_0x164fb0(0xdd)](_0x10dcd3){const _0x1788e5=_0x164fb0;return await this['modelTypes'][_0x1788e5(0xcb)](_0xd13cff=>_0xd13cff['id']===_0x10dcd3);}async['getUseToolsModelKey'](){const _0x10f337=_0x164fb0;var _0x4202d2;const _0x5ed1bb=(_0x4202d2=this[_0x10f337(0xe7)]['find'](_0x1c48ab=>_0x1c48ab[_0x10f337(0xe5)]))===null||_0x4202d2===void 0x0?void 0x0:_0x4202d2['id'];if(!_0x5ed1bb)return;const _0x5618c4=this[_0x10f337(0x7c)][_0x5ed1bb];if(!_0x5618c4['length'])return;const _0x8041d8=this[_0x10f337(0x7e)][_0x5ed1bb],_0x4c5199=_0x5618c4[_0x8041d8];return this['keyPoolIndexMap'][_0x5ed1bb]++,this[_0x10f337(0x7e)][_0x5ed1bb]>=_0x5618c4['length']&&(this['keyPoolIndexMap'][_0x5ed1bb]=0x0),_0x4c5199;}async[_0x164fb0(0xca)](_0x1debb8){const _0x3c8797=_0x164fb0;if(!_0x1debb8)return;const _0x366bbc=this[_0x3c8797(0x7c)][_0x1debb8];if(!_0x366bbc['length'])return;const _0x45a978=this['keyPoolIndexMap'][_0x1debb8],_0x112b76=_0x366bbc[_0x45a978];return this['keyPoolIndexMap'][_0x1debb8]++,this[_0x3c8797(0x7e)][_0x1debb8]>=_0x366bbc[_0x3c8797(0xfd)]&&(this['keyPoolIndexMap'][_0x1debb8]=0x0),_0x112b76;}async[_0x164fb0(0x95)](){const _0x3720de=_0x164fb0;var _0x10e669;const _0x1541e4=(_0x10e669=this[_0x3720de(0xe7)]['find'](_0x186a74=>_0x186a74['isDallDraw']))===null||_0x10e669===void 0x0?void 0x0:_0x10e669['id'];if(!_0x1541e4)return;const _0x45d29e=this['modelMaps'][_0x1541e4];if(!_0x45d29e[_0x3720de(0xfd)])return;const _0x2836f3=this[_0x3720de(0x7e)][_0x1541e4],_0x52ea51=_0x45d29e[_0x2836f3];return this[_0x3720de(0x7e)][_0x1541e4]++,this['keyPoolIndexMap'][_0x1541e4]>=_0x45d29e[_0x3720de(0xfd)]&&(this[_0x3720de(0x7e)][_0x1541e4]=0x0),_0x52ea51;}async[_0x164fb0(0x91)](){const _0x4c743f=_0x164fb0;var _0x87067c;const _0x5bcafd=await((_0x87067c=this[_0x4c743f(0xe7)]['find'](_0x5cc8d9=>_0x5cc8d9[_0x4c743f(0xfc)][_0x4c743f(0xb0)](_0x4c743f(0xd8))))===null||_0x87067c===void 0x0?void 0x0:_0x87067c['id']);return this[_0x4c743f(0xca)](_0x5bcafd);}async[_0x164fb0(0xce)](_0x5d5d1b){const _0x4bbba6=_0x164fb0;var _0x2ec8e3;if(!_0x5d5d1b){const _0x504308=await this[_0x4bbba6(0x7d)]();return _0x504308?_0x504308['id']:null;}return(_0x2ec8e3=this[_0x4bbba6(0xe7)][_0x4bbba6(0xcb)](_0x2d784c=>_0x2d784c[_0x4bbba6(0xfc)]===_0x5d5d1b))===null||_0x2ec8e3===void 0x0?void 0x0:_0x2ec8e3['id'];}[_0x164fb0(0xbd)](_0x369a23){const _0x309b62=_0x164fb0,_0x45dc54=_0x369a23[_0x309b62(0xd2)]('/')?_0x369a23[_0x309b62(0xf0)](0x0,-0x1):_0x369a23,_0x559911=_0x45dc54||_0x309b62(0xd1);return _0x559911+_0x309b62(0xf4);}async[_0x164fb0(0xc9)](_0x3376d4,_0x20483c){const _0x1d8e1f=_0x164fb0;var _0x4f6bc7,_0xe919d9,_0x261a9f,_0x290e57;const {keyword:_0x118a25}=_0x20483c,_0x438ae8=await this[_0x1d8e1f(0xce)](_0x1d8e1f(0x94));let _0x295893=await this['getCurrentModelKeyInfo'](_0x438ae8);!_0x295893&&(_0x295893={'key':'sk-70QvIwbE2GVk7NDF6d44U31vSPx46fl7rZF5VOqmd70kW1XX','proxyUrl':_0x1d8e1f(0xc0)});const {key:_0x1aae11,proxyUrl:_0x596e40}=_0x295893,_0x2f9362={'method':'POST','url':this[_0x1d8e1f(0xbd)](_0x596e40),'headers':{'Content-Type':_0x1d8e1f(0xb6),'Authorization':_0x1d8e1f(0x86)+(0x0,utils_1[_0x1d8e1f(0x92)])(_0x1aae11)},'data':{'max_tokens':0x1f40,'model':'search-gpts','messages':[{'role':'user','content':_0x118a25}]}};try{const _0x35fdce=await(0x0,axios_1[_0x1d8e1f(0xe6)])(_0x2f9362);if(_0x35fdce[_0x1d8e1f(0xcf)]!==0xc8||!((_0x4f6bc7=_0x35fdce===null||_0x35fdce===void 0x0?void 0x0:_0x35fdce[_0x1d8e1f(0xb9)])===null||_0x4f6bc7===void 0x0?void 0x0:_0x4f6bc7[_0x1d8e1f(0xea)]['length']))throw new common_1[(_0x1d8e1f(0xad))](_0x1d8e1f(0xfb),common_1[_0x1d8e1f(0xe4)]['BAD_REQUEST']);this[_0x1d8e1f(0x84)](_0x295893['id'],_0x295893[_0x1d8e1f(0xd7)],0x0);const _0x313603=(_0x290e57=(_0x261a9f=(_0xe919d9=_0x35fdce===null||_0x35fdce===void 0x0?void 0x0:_0x35fdce['data'])===null||_0xe919d9===void 0x0?void 0x0:_0xe919d9[_0x1d8e1f(0xea)][0x0])===null||_0x261a9f===void 0x0?void 0x0:_0x261a9f['message'])===null||_0x290e57===void 0x0?void 0x0:_0x290e57['content'],_0x54bc58=JSON[_0x1d8e1f(0xc4)](_0x313603);return _0x54bc58[_0x1d8e1f(0xe9)][_0x1d8e1f(0xd4)](_0x2acc08=>{const _0xb4aec3=_0x1d8e1f,{gizmo:_0x5a280d,tools:_0x124b26}=_0x2acc08,{id:_0x3f9dd1,display:_0x398750,vanity_metrics:_0x2c8eaa}=_0x5a280d,{name:_0x3c33d0,description:_0x1f7f63,prompt_starters:_0x2d447d,profile_picture_url:_0x3bcbf2,welcome_message:_0x5a75a4}=_0x398750,{num_conversations_str:_0x2d2e13,created_ago_str:_0x126b86}=_0x2c8eaa;return{'gptsId':_0x3f9dd1,'name':_0x3c33d0,'des':_0x1f7f63,'demoData':Array['isArray'](_0x2d447d)?_0x2d447d[_0xb4aec3(0xba)]('\x0a'):_0x2d447d,'coverImg':_0x3bcbf2,'heat':_0x2d2e13,'createTime':_0x126b86,'welcome_message':_0x5a75a4,'isGpts':!![]};});}catch(_0xa36cff){console[_0x1d8e1f(0xe2)](_0x1d8e1f(0xc7),_0xa36cff);throw new common_1[(_0x1d8e1f(0xad))](_0x1d8e1f(0xfb),common_1[_0x1d8e1f(0xe4)]['BAD_REQUEST']);}}};ModelsService=__decorate([(0x0,common_1[_0x164fb0(0x81)])(),__param(0x0,(0x0,typeorm_1[_0x164fb0(0xbf)])(modelType_entity_1[_0x164fb0(0xa3)])),__param(0x1,(0x0,typeorm_1[_0x164fb0(0xbf)])(modelKeys_entity_1[_0x164fb0(0x98)])),__metadata(_0x164fb0(0x8b),[typeorm_2[_0x164fb0(0xcc)],typeorm_2[_0x164fb0(0xcc)]])],ModelsService),exports['ModelsService']=ModelsService;