'use strict';function _0x57d7(_0x22ed8e,_0x17a082){const _0x21ccd7=_0x21cc();return _0x57d7=function(_0x57d78b,_0x4780f5){_0x57d78b=_0x57d78b-0x137;let _0x5587d5=_0x21ccd7[_0x57d78b];return _0x5587d5;},_0x57d7(_0x22ed8e,_0x17a082);}const _0x240118=_0x57d7;(function(_0x2933cc,_0x41cfb0){const _0x5c8816=_0x57d7,_0xcbea9d=_0x2933cc();while(!![]){try{const _0x49c77d=parseInt(_0x5c8816(0x175))/0x1*(-parseInt(_0x5c8816(0x139))/0x2)+-parseInt(_0x5c8816(0x155))/0x3+parseInt(_0x5c8816(0x14a))/0x4+parseInt(_0x5c8816(0x15b))/0x5+parseInt(_0x5c8816(0x154))/0x6*(parseInt(_0x5c8816(0x168))/0x7)+-parseInt(_0x5c8816(0x17c))/0x8+-parseInt(_0x5c8816(0x13e))/0x9;if(_0x49c77d===_0x41cfb0)break;else _0xcbea9d['push'](_0xcbea9d['shift']());}catch(_0x173142){_0xcbea9d['push'](_0xcbea9d['shift']());}}}(_0x21cc,0xccd5a));var __decorate=this&&this[_0x240118(0x165)]||function(_0x1ff69a,_0x5c8f34,_0x36f2b5,_0x177659){const _0x4367b3=_0x240118;var _0x338626=arguments[_0x4367b3(0x171)],_0x51c0dd=_0x338626<0x3?_0x5c8f34:_0x177659===null?_0x177659=Object['getOwnPropertyDescriptor'](_0x5c8f34,_0x36f2b5):_0x177659,_0x42eb6d;if(typeof Reflect===_0x4367b3(0x13f)&&typeof Reflect[_0x4367b3(0x13b)]==='function')_0x51c0dd=Reflect[_0x4367b3(0x13b)](_0x1ff69a,_0x5c8f34,_0x36f2b5,_0x177659);else{for(var _0x911f74=_0x1ff69a[_0x4367b3(0x171)]-0x1;_0x911f74>=0x0;_0x911f74--)if(_0x42eb6d=_0x1ff69a[_0x911f74])_0x51c0dd=(_0x338626<0x3?_0x42eb6d(_0x51c0dd):_0x338626>0x3?_0x42eb6d(_0x5c8f34,_0x36f2b5,_0x51c0dd):_0x42eb6d(_0x5c8f34,_0x36f2b5))||_0x51c0dd;}return _0x338626>0x3&&_0x51c0dd&&Object['defineProperty'](_0x5c8f34,_0x36f2b5,_0x51c0dd),_0x51c0dd;},__metadata=this&&this[_0x240118(0x173)]||function(_0x29c20c,_0x58e95c){const _0x4106e7=_0x240118;if(typeof Reflect===_0x4106e7(0x13f)&&typeof Reflect[_0x4106e7(0x162)]==='function')return Reflect[_0x4106e7(0x162)](_0x29c20c,_0x58e95c);},__param=this&&this[_0x240118(0x186)]||function(_0x10c4fb,_0x48ea3d){return function(_0x1017e7,_0x34194d){_0x48ea3d(_0x1017e7,_0x34194d,_0x10c4fb);};};Object[_0x240118(0x16e)](exports,'__esModule',{'value':!![]}),exports[_0x240118(0x172)]=void 0x0;const common_1=require(_0x240118(0x14c)),crami_entity_1=require(_0x240118(0x15c)),typeorm_1=require('@nestjs/typeorm'),typeorm_2=require(_0x240118(0x15a)),cramiPackage_entity_1=require('./cramiPackage.entity'),utils_1=require('../../common/utils'),user_entity_1=require('../user/user.entity'),userBalance_service_1=require(_0x240118(0x153)),balance_constant_1=require(_0x240118(0x140));function _0x21cc(){const _0x4c4e9d=['../userBalance/userBalance.service','7994358GFxiAK','1219977kKIOjg','自定义卡密必须至少一项余额不为0️零！','saveRecordRechargeLog','affected','log','typeorm','7924150magIMi','./crami.entity','user','套餐名称或套餐等级重复、请检查！','Injectable','更新套餐失败、请重试！','当前卡密不存在、请确认您要删除的卡密是否存在！','metadata','当前套餐不存在、请检查你的输入参数！','create','__decorate','forEach','HttpStatus','7fqeVbz','status','BAD_REQUEST','delete','generateCramiCode','count','defineProperty','find','DESC','length','CramiService','__metadata','Like','272236SqYsMu','更新套餐成功！','cramiEntity','every','CramiEntity','当前套餐下存在卡密、请先删除卡密后才可删除套餐！','role','5982472EMUCLr','assign','UserBalanceService','packageId','maskEmail','username','RechargeType','CramiPackageEntity','design:paramtypes','createPackage','__param','删除卡密成功！','useCrami','delPackage','useId','name','Repository','UserEntity','cramiPackageEntity','findOne','LessThanOrEqual','userEntity','当前卡密已被使用、已使用的卡密禁止删除！','delCrami','HttpException','MoreThan','batchDelCrami','8eQcmEx','updatePackage','decorate','userBalanceService','createCrami','13393071ukUYdv','object','../../common/constants/balance.constant','maskCrami','InjectRepository','packageName','generateCrami','Not','map','email','删除卡密失败、请重试！','addBalanceToUser','6613240Acvedp','error:\x20','@nestjs/common','update','queryAllPackage','push','当前卡密不存在、请确认您输入的卡密是否正确！','findAndCount','code'];_0x21cc=function(){return _0x4c4e9d;};return _0x21cc();}let CramiService=class CramiService{constructor(_0x141ea1,_0x31ac4f,_0x2b54e6,_0x1e21e7){const _0x580a8a=_0x240118;this[_0x580a8a(0x177)]=_0x141ea1,this[_0x580a8a(0x18e)]=_0x31ac4f,this[_0x580a8a(0x191)]=_0x2b54e6,this[_0x580a8a(0x13c)]=_0x1e21e7;}async['queryOnePackage'](_0x4c74aa){const _0x20a89c=_0x240118;return await this['cramiPackageEntity'][_0x20a89c(0x18f)]({'where':{'id':_0x4c74aa}});}async[_0x240118(0x14e)](_0x111a92){const _0x1b1e66=_0x240118;try{const {page:page=0x1,size:size=0xa,name:_0x5654c2,status:_0x44dbdd,type:_0x4a2569}=_0x111a92,_0x39ad81={};_0x5654c2&&Object[_0x1b1e66(0x17d)](_0x39ad81,{'name':(0x0,typeorm_2[_0x1b1e66(0x174)])('%'+_0x5654c2+'%')}),_0x44dbdd&&Object[_0x1b1e66(0x17d)](_0x39ad81,{'status':_0x44dbdd});_0x4a2569&&(_0x4a2569>0x0?Object[_0x1b1e66(0x17d)](_0x39ad81,{'days':(0x0,typeorm_2[_0x1b1e66(0x137)])(0x0)}):Object[_0x1b1e66(0x17d)](_0x39ad81,{'days':(0x0,typeorm_2[_0x1b1e66(0x190)])(0x0)}));const [_0x4f761a,_0x9910d7]=await this[_0x1b1e66(0x18e)][_0x1b1e66(0x151)]({'skip':(page-0x1)*size,'take':size,'where':_0x39ad81,'order':{'order':_0x1b1e66(0x170)}});return{'rows':_0x4f761a,'count':_0x9910d7};}catch(_0x4ffea6){console[_0x1b1e66(0x159)](_0x1b1e66(0x14b),_0x4ffea6);}}async[_0x240118(0x185)](_0x2c10b4){const _0xe1a4a=_0x240118,{name:_0x3fe299,weight:_0x152d2d}=_0x2c10b4,_0x3ff606=await this[_0xe1a4a(0x18e)]['findOne']({'where':[{'name':_0x3fe299},{'weight':_0x152d2d}]});if(_0x3ff606)throw new common_1['HttpException'](_0xe1a4a(0x15e),common_1[_0xe1a4a(0x167)]['BAD_REQUEST']);try{return await this[_0xe1a4a(0x18e)]['save'](_0x2c10b4);}catch(_0x511bf6){console[_0xe1a4a(0x159)](_0xe1a4a(0x14b),_0x511bf6);throw new common_1[(_0xe1a4a(0x194))](_0x511bf6,common_1[_0xe1a4a(0x167)][_0xe1a4a(0x16a)]);}}async[_0x240118(0x13a)](_0x5ea61c){const _0x21cdb2=_0x240118,{id:_0x25602e,name:_0x388745,weight:_0x65989e}=_0x5ea61c,_0x1a2a5e=await this[_0x21cdb2(0x18e)][_0x21cdb2(0x18f)]({'where':{'id':_0x25602e}});if(!_0x1a2a5e)throw new common_1[(_0x21cdb2(0x194))](_0x21cdb2(0x163),common_1['HttpStatus'][_0x21cdb2(0x16a)]);const _0x4e516a=await this[_0x21cdb2(0x18e)][_0x21cdb2(0x16d)]({'where':[{'name':_0x388745,'id':(0x0,typeorm_2[_0x21cdb2(0x145)])(_0x25602e)},{'weight':_0x65989e,'id':(0x0,typeorm_2[_0x21cdb2(0x145)])(_0x25602e)}]});if(_0x4e516a)throw new common_1[(_0x21cdb2(0x194))](_0x21cdb2(0x15e),common_1[_0x21cdb2(0x167)][_0x21cdb2(0x16a)]);const _0xb7da7e=await this[_0x21cdb2(0x18e)]['update']({'id':_0x25602e},_0x5ea61c);if(_0xb7da7e[_0x21cdb2(0x158)]>0x0)return _0x21cdb2(0x176);else throw new common_1[(_0x21cdb2(0x194))](_0x21cdb2(0x160),common_1['HttpStatus']['BAD_REQUEST']);}async[_0x240118(0x189)](_0xcff918){const _0xf1aeb9=_0x240118,{id:_0x5477c5}=_0xcff918,_0x31fd62=await this[_0xf1aeb9(0x177)]['count']({'where':{'packageId':_0x5477c5}});if(_0x31fd62)throw new common_1['HttpException'](_0xf1aeb9(0x17a),common_1[_0xf1aeb9(0x167)]['BAD_REQUEST']);return await this['cramiPackageEntity']['delete']({'id':_0x5477c5});}async[_0x240118(0x13d)](_0x21025f){const _0x3a09c4=_0x240118,{packageId:_0x49fc78,count:count=0x1}=_0x21025f;if(_0x49fc78){const _0x5b48d0=await this[_0x3a09c4(0x18e)][_0x3a09c4(0x18f)]({'where':{'id':_0x49fc78}});if(!_0x5b48d0)throw new common_1['HttpException']('当前套餐不存在、请确认您选择的套餐是否存在！',common_1[_0x3a09c4(0x167)][_0x3a09c4(0x16a)]);const {days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x5b48d0,_0x425107={'packageId':_0x49fc78,'days':days,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this['generateCrami'](_0x425107,count);}if(!_0x49fc78){const {model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x21025f;if([model3Count,model4Count,drawMjCount][_0x3a09c4(0x178)](_0x5d0a14=>!_0x5d0a14))throw new common_1[(_0x3a09c4(0x194))](_0x3a09c4(0x156),common_1['HttpStatus']['BAD_REQUEST']);const _0x52c3fd={'days':-0x1,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this[_0x3a09c4(0x144)](_0x52c3fd,count);}}async['generateCrami'](_0x4d65d1,_0x22c100){const _0x45ebd4=_0x240118,_0x419332=[];for(let _0x3f85b1=0x0;_0x3f85b1<_0x22c100;_0x3f85b1++){const _0x47364b=(0x0,utils_1[_0x45ebd4(0x16c)])(),_0x1aae20=this[_0x45ebd4(0x177)][_0x45ebd4(0x164)](Object[_0x45ebd4(0x17d)](Object[_0x45ebd4(0x17d)]({},_0x4d65d1),{'code':_0x47364b}));_0x419332[_0x45ebd4(0x14f)](_0x1aae20);}return await this['cramiEntity']['save'](_0x419332);}async[_0x240118(0x188)](_0xa00133,_0x200313){const _0x311b18=_0x240118,{id:_0x4a3dfd}=_0xa00133[_0x311b18(0x15d)],_0x1db9ae=await this[_0x311b18(0x177)][_0x311b18(0x18f)]({'where':{'code':_0x200313[_0x311b18(0x152)]}});if(!_0x1db9ae)throw new common_1[(_0x311b18(0x194))](_0x311b18(0x150),common_1[_0x311b18(0x167)][_0x311b18(0x16a)]);const {status:_0x1b958b,days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0,packageId:_0x195827}=_0x1db9ae;if(_0x1b958b===0x1)throw new common_1[(_0x311b18(0x194))]('当前卡密已被使用、请确认您输入的卡密是否正确！',common_1[_0x311b18(0x167)][_0x311b18(0x16a)]);const _0x90603b={'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'packageId':_0x195827};return await this[_0x311b18(0x13c)][_0x311b18(0x149)](_0x4a3dfd,Object['assign']({},_0x90603b),days),await this[_0x311b18(0x13c)][_0x311b18(0x157)]({'userId':_0x4a3dfd,'rechargeType':balance_constant_1[_0x311b18(0x182)]['PACKAGE_GIFT'],'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'days':days}),await this[_0x311b18(0x177)][_0x311b18(0x14d)]({'code':_0x200313[_0x311b18(0x152)]},{'useId':_0x4a3dfd,'status':0x1}),'使用卡密成功';}async['queryAllCrami'](_0x210f32,_0x5f5ac3){const _0x4f1f00=_0x240118,{page:page=0x1,size:size=0xa,status:_0x1dcbf2,useId:_0x47174c}=_0x210f32,_0x422310={};_0x1dcbf2&&Object[_0x4f1f00(0x17d)](_0x422310,{'status':_0x1dcbf2}),_0x47174c&&Object[_0x4f1f00(0x17d)](_0x422310,{'useId':_0x47174c});const [_0x30f7f6,_0x3ce918]=await this[_0x4f1f00(0x177)]['findAndCount']({'skip':(page-0x1)*size,'take':size,'order':{'createdAt':_0x4f1f00(0x170)},'where':_0x422310}),_0x31b3e3=_0x30f7f6[_0x4f1f00(0x146)](_0x112fd8=>_0x112fd8[_0x4f1f00(0x18a)]),_0x37b382=_0x30f7f6[_0x4f1f00(0x146)](_0x1c962e=>_0x1c962e[_0x4f1f00(0x17f)]),_0x4982ec=await this[_0x4f1f00(0x191)][_0x4f1f00(0x16f)]({'where':{'id':(0x0,typeorm_2['In'])(_0x31b3e3)}}),_0x5c1540=await this[_0x4f1f00(0x18e)]['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x37b382)}});return _0x30f7f6[_0x4f1f00(0x166)](_0x32b63b=>{const _0x53aa0b=_0x4f1f00;var _0x4e4f35,_0x821645,_0x475878;_0x32b63b[_0x53aa0b(0x181)]=(_0x4e4f35=_0x4982ec[_0x53aa0b(0x16f)](_0x3eb41a=>_0x3eb41a['id']===_0x32b63b[_0x53aa0b(0x18a)]))===null||_0x4e4f35===void 0x0?void 0x0:_0x4e4f35['username'],_0x32b63b['email']=(_0x821645=_0x4982ec[_0x53aa0b(0x16f)](_0x5cc40a=>_0x5cc40a['id']===_0x32b63b['useId']))===null||_0x821645===void 0x0?void 0x0:_0x821645[_0x53aa0b(0x147)],_0x32b63b[_0x53aa0b(0x143)]=(_0x475878=_0x5c1540[_0x53aa0b(0x16f)](_0x2a4cc5=>_0x2a4cc5['id']===_0x32b63b[_0x53aa0b(0x17f)]))===null||_0x475878===void 0x0?void 0x0:_0x475878[_0x53aa0b(0x18b)];}),_0x5f5ac3[_0x4f1f00(0x15d)][_0x4f1f00(0x17b)]!=='super'&&_0x30f7f6[_0x4f1f00(0x166)](_0x23cc3f=>_0x23cc3f[_0x4f1f00(0x147)]=(0x0,utils_1[_0x4f1f00(0x180)])(_0x23cc3f['email'])),_0x5f5ac3[_0x4f1f00(0x15d)][_0x4f1f00(0x17b)]!=='super'&&_0x30f7f6['forEach'](_0xb97055=>_0xb97055['code']=(0x0,utils_1[_0x4f1f00(0x141)])(_0xb97055[_0x4f1f00(0x152)])),{'rows':_0x30f7f6,'count':_0x3ce918};}async[_0x240118(0x193)](_0x1b0351){const _0x38dbfa=_0x240118,_0x4f7f14=await this[_0x38dbfa(0x177)][_0x38dbfa(0x18f)]({'where':{'id':_0x1b0351}});if(!_0x4f7f14)throw new common_1[(_0x38dbfa(0x194))](_0x38dbfa(0x161),common_1[_0x38dbfa(0x167)]['BAD_REQUEST']);if(_0x4f7f14[_0x38dbfa(0x169)]===0x1)throw new common_1['HttpException'](_0x38dbfa(0x192),common_1[_0x38dbfa(0x167)][_0x38dbfa(0x16a)]);return await this[_0x38dbfa(0x177)]['delete']({'id':_0x1b0351});}async[_0x240118(0x138)](_0xaf9cb){const _0x41c5a0=_0x240118,{ids:_0x4f0b4c}=_0xaf9cb,_0x15acf8=await this[_0x41c5a0(0x177)][_0x41c5a0(0x16b)](_0x4f0b4c);if(_0x15acf8['affected']>0x0)return _0x41c5a0(0x187);else throw new common_1[(_0x41c5a0(0x194))](_0x41c5a0(0x148),common_1[_0x41c5a0(0x167)][_0x41c5a0(0x16a)]);}};CramiService=__decorate([(0x0,common_1[_0x240118(0x15f)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(crami_entity_1[_0x240118(0x179)])),__param(0x1,(0x0,typeorm_1[_0x240118(0x142)])(cramiPackage_entity_1[_0x240118(0x183)])),__param(0x2,(0x0,typeorm_1['InjectRepository'])(user_entity_1[_0x240118(0x18d)])),__metadata(_0x240118(0x184),[typeorm_2['Repository'],typeorm_2[_0x240118(0x18c)],typeorm_2['Repository'],userBalance_service_1[_0x240118(0x17e)]])],CramiService),exports[_0x240118(0x172)]=CramiService;