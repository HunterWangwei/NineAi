'use strict';const _0x588893=_0x5987;(function(_0x5a1695,_0x3fd45){const _0x4b0e3f=_0x5987,_0x4cf74e=_0x5a1695();while(!![]){try{const _0x2e9d70=parseInt(_0x4b0e3f(0xc5))/0x1*(parseInt(_0x4b0e3f(0xd5))/0x2)+parseInt(_0x4b0e3f(0xbe))/0x3+-parseInt(_0x4b0e3f(0xe1))/0x4+parseInt(_0x4b0e3f(0xe0))/0x5*(-parseInt(_0x4b0e3f(0x107))/0x6)+parseInt(_0x4b0e3f(0xd3))/0x7+-parseInt(_0x4b0e3f(0xcf))/0x8+-parseInt(_0x4b0e3f(0xf6))/0x9*(-parseInt(_0x4b0e3f(0xe3))/0xa);if(_0x2e9d70===_0x3fd45)break;else _0x4cf74e['push'](_0x4cf74e['shift']());}catch(_0x312d05){_0x4cf74e['push'](_0x4cf74e['shift']());}}}(_0x1697,0x58a3e));var __decorate=this&&this[_0x588893(0x11c)]||function(_0x29a872,_0x35cd15,_0x5566c8,_0x49f873){const _0x455578=_0x588893;var _0x5713d8=arguments['length'],_0x50c9f7=_0x5713d8<0x3?_0x35cd15:_0x49f873===null?_0x49f873=Object[_0x455578(0x106)](_0x35cd15,_0x5566c8):_0x49f873,_0xdf4149;if(typeof Reflect===_0x455578(0x11a)&&typeof Reflect[_0x455578(0xf1)]===_0x455578(0xc7))_0x50c9f7=Reflect['decorate'](_0x29a872,_0x35cd15,_0x5566c8,_0x49f873);else{for(var _0x1b87ef=_0x29a872['length']-0x1;_0x1b87ef>=0x0;_0x1b87ef--)if(_0xdf4149=_0x29a872[_0x1b87ef])_0x50c9f7=(_0x5713d8<0x3?_0xdf4149(_0x50c9f7):_0x5713d8>0x3?_0xdf4149(_0x35cd15,_0x5566c8,_0x50c9f7):_0xdf4149(_0x35cd15,_0x5566c8))||_0x50c9f7;}return _0x5713d8>0x3&&_0x50c9f7&&Object['defineProperty'](_0x35cd15,_0x5566c8,_0x50c9f7),_0x50c9f7;},__metadata=this&&this[_0x588893(0xc2)]||function(_0xc7157c,_0x21c782){const _0xceb9bc=_0x588893;if(typeof Reflect===_0xceb9bc(0x11a)&&typeof Reflect['metadata']===_0xceb9bc(0xc7))return Reflect[_0xceb9bc(0xca)](_0xc7157c,_0x21c782);},__param=this&&this[_0x588893(0xf3)]||function(_0x944fc5,_0x3a0389){return function(_0x1e7f2b,_0x7deaee){_0x3a0389(_0x1e7f2b,_0x7deaee,_0x944fc5);};};Object[_0x588893(0xeb)](exports,_0x588893(0xe8),{'value':!![]}),exports[_0x588893(0xd1)]=void 0x0;function _0x5987(_0x3d2d1b,_0x310411){const _0x1697c5=_0x1697();return _0x5987=function(_0x59875c,_0x1abd4f){_0x59875c=_0x59875c-0xbd;let _0x35b194=_0x1697c5[_0x59875c];return _0x35b194;},_0x5987(_0x3d2d1b,_0x310411);}function _0x1697(){const _0x5b6a52=['HttpStatus','findOne','__esModule','当前卡密已被使用、已使用的卡密禁止删除！','create','defineProperty','BAD_REQUEST','saveRecordRechargeLog','CramiPackageEntity','name','delete','decorate','batchDelCrami','__param','RechargeType','更新套餐成功！','5391BZHJSX','delCrami','role','@nestjs/typeorm','@nestjs/common','addBalanceToUser','map','cramiEntity','email','UserEntity','cramiPackageEntity','count','updatePackage','当前卡密不存在、请确认您输入的卡密是否正确！','MoreThan','../userBalance/userBalance.service','getOwnPropertyDescriptor','18fYKawp','maskCrami','username','maskEmail','useId','当前卡密已被使用、请确认您输入的卡密是否正确！','assign','套餐名称或套餐等级重复、请检查！','queryAllPackage','design:paramtypes','find','userEntity','packageId','LessThanOrEqual','使用卡密成功','Injectable','Repository','userBalanceService','generateCramiCode','object','status','__decorate','InjectRepository','log','1666044hUUTgw','DESC','当前卡密不存在、请确认您要删除的卡密是否存在！','../../common/constants/balance.constant','__metadata','HttpException','删除卡密失败、请重试！','13OSjoAx','Like','function','createCrami','findAndCount','metadata','code','delPackage','useCrami','当前套餐不存在、请检查你的输入参数！','4275240SnIPYq','user','CramiService','error:\x20','4209107hMskbz','super','57670SYAwAc','../../common/utils','../user/user.entity','generateCrami','affected','every','update','当前套餐下存在卡密、请先删除卡密后才可删除套餐！','删除卡密成功！','forEach','自定义卡密必须至少一项余额不为0️零！','686155aZOBiG','1596164ndgsAj','PACKAGE_GIFT','2950NDJjuU','UserBalanceService','当前套餐不存在、请确认您选择的套餐是否存在！'];_0x1697=function(){return _0x5b6a52;};return _0x1697();}const common_1=require(_0x588893(0xfa)),crami_entity_1=require('./crami.entity'),typeorm_1=require(_0x588893(0xf9)),typeorm_2=require('typeorm'),cramiPackage_entity_1=require('./cramiPackage.entity'),utils_1=require(_0x588893(0xd6)),user_entity_1=require(_0x588893(0xd7)),userBalance_service_1=require(_0x588893(0x105)),balance_constant_1=require(_0x588893(0xc1));let CramiService=class CramiService{constructor(_0x6a80ce,_0x11e914,_0x4a8c49,_0x6fbb40){const _0x55c433=_0x588893;this[_0x55c433(0xfd)]=_0x6a80ce,this[_0x55c433(0x100)]=_0x11e914,this[_0x55c433(0x112)]=_0x4a8c49,this[_0x55c433(0x118)]=_0x6fbb40;}async['queryOnePackage'](_0x38b471){const _0x394a8f=_0x588893;return await this[_0x394a8f(0x100)][_0x394a8f(0xe7)]({'where':{'id':_0x38b471}});}async[_0x588893(0x10f)](_0x54666c){const _0x2f2f72=_0x588893;try{const {page:page=0x1,size:size=0xa,name:_0x1ff112,status:_0x282df6,type:_0x2508df}=_0x54666c,_0x38d3bb={};_0x1ff112&&Object['assign'](_0x38d3bb,{'name':(0x0,typeorm_2[_0x2f2f72(0xc6)])('%'+_0x1ff112+'%')}),_0x282df6&&Object['assign'](_0x38d3bb,{'status':_0x282df6});_0x2508df&&(_0x2508df>0x0?Object['assign'](_0x38d3bb,{'days':(0x0,typeorm_2[_0x2f2f72(0x104)])(0x0)}):Object[_0x2f2f72(0x10d)](_0x38d3bb,{'days':(0x0,typeorm_2[_0x2f2f72(0x114)])(0x0)}));const [_0x4b2db5,_0x3dff1f]=await this[_0x2f2f72(0x100)][_0x2f2f72(0xc9)]({'skip':(page-0x1)*size,'take':size,'where':_0x38d3bb,'order':{'order':_0x2f2f72(0xbf)}});return{'rows':_0x4b2db5,'count':_0x3dff1f};}catch(_0x42448a){console[_0x2f2f72(0xbd)](_0x2f2f72(0xd2),_0x42448a);}}async['createPackage'](_0x2a9126){const _0x453f12=_0x588893,{name:_0x28823d,weight:_0xde2bb5}=_0x2a9126,_0x2d02f0=await this[_0x453f12(0x100)][_0x453f12(0xe7)]({'where':[{'name':_0x28823d},{'weight':_0xde2bb5}]});if(_0x2d02f0)throw new common_1[(_0x453f12(0xc3))](_0x453f12(0x10e),common_1[_0x453f12(0xe6)][_0x453f12(0xec)]);try{return await this[_0x453f12(0x100)]['save'](_0x2a9126);}catch(_0x5d87fb){console['log'](_0x453f12(0xd2),_0x5d87fb);throw new common_1['HttpException'](_0x5d87fb,common_1[_0x453f12(0xe6)][_0x453f12(0xec)]);}}async[_0x588893(0x102)](_0x56cd7b){const _0x38e9d0=_0x588893,{id:_0x1824c9,name:_0x55adaa,weight:_0x366c7b}=_0x56cd7b,_0x42ceaa=await this['cramiPackageEntity'][_0x38e9d0(0xe7)]({'where':{'id':_0x1824c9}});if(!_0x42ceaa)throw new common_1['HttpException'](_0x38e9d0(0xce),common_1['HttpStatus'][_0x38e9d0(0xec)]);const _0x2b9936=await this[_0x38e9d0(0x100)]['count']({'where':[{'name':_0x55adaa,'id':(0x0,typeorm_2['Not'])(_0x1824c9)},{'weight':_0x366c7b,'id':(0x0,typeorm_2['Not'])(_0x1824c9)}]});if(_0x2b9936)throw new common_1[(_0x38e9d0(0xc3))](_0x38e9d0(0x10e),common_1[_0x38e9d0(0xe6)][_0x38e9d0(0xec)]);const _0x3fd36b=await this[_0x38e9d0(0x100)][_0x38e9d0(0xdb)]({'id':_0x1824c9},_0x56cd7b);if(_0x3fd36b['affected']>0x0)return _0x38e9d0(0xf5);else throw new common_1[(_0x38e9d0(0xc3))]('更新套餐失败、请重试！',common_1['HttpStatus']['BAD_REQUEST']);}async[_0x588893(0xcc)](_0x3f656a){const _0x457177=_0x588893,{id:_0x566987}=_0x3f656a,_0x443b15=await this['cramiEntity'][_0x457177(0x101)]({'where':{'packageId':_0x566987}});if(_0x443b15)throw new common_1[(_0x457177(0xc3))](_0x457177(0xdc),common_1[_0x457177(0xe6)][_0x457177(0xec)]);return await this[_0x457177(0x100)][_0x457177(0xf0)]({'id':_0x566987});}async[_0x588893(0xc8)](_0x1d19d9){const _0x17dd3e=_0x588893,{packageId:_0x49472f,count:count=0x1}=_0x1d19d9;if(_0x49472f){const _0xe61fe0=await this[_0x17dd3e(0x100)][_0x17dd3e(0xe7)]({'where':{'id':_0x49472f}});if(!_0xe61fe0)throw new common_1['HttpException'](_0x17dd3e(0xe5),common_1[_0x17dd3e(0xe6)][_0x17dd3e(0xec)]);const {days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0xe61fe0,_0x4317be={'packageId':_0x49472f,'days':days,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this[_0x17dd3e(0xd8)](_0x4317be,count);}if(!_0x49472f){const {model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0}=_0x1d19d9;if([model3Count,model4Count,drawMjCount][_0x17dd3e(0xda)](_0x361280=>!_0x361280))throw new common_1[(_0x17dd3e(0xc3))](_0x17dd3e(0xdf),common_1[_0x17dd3e(0xe6)][_0x17dd3e(0xec)]);const _0x37fa81={'days':-0x1,'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount};return await this['generateCrami'](_0x37fa81,count);}}async[_0x588893(0xd8)](_0xd0988a,_0x140898){const _0x5ebdf2=_0x588893,_0x47c0ab=[];for(let _0x24b5ed=0x0;_0x24b5ed<_0x140898;_0x24b5ed++){const _0x145ce5=(0x0,utils_1[_0x5ebdf2(0x119)])(),_0x462015=this['cramiEntity'][_0x5ebdf2(0xea)](Object[_0x5ebdf2(0x10d)](Object[_0x5ebdf2(0x10d)]({},_0xd0988a),{'code':_0x145ce5}));_0x47c0ab['push'](_0x462015);}return await this['cramiEntity']['save'](_0x47c0ab);}async[_0x588893(0xcd)](_0x312ca7,_0x8ebd42){const _0x255ca1=_0x588893,{id:_0x919e9e}=_0x312ca7[_0x255ca1(0xd0)],_0x5651de=await this[_0x255ca1(0xfd)][_0x255ca1(0xe7)]({'where':{'code':_0x8ebd42[_0x255ca1(0xcb)]}});if(!_0x5651de)throw new common_1[(_0x255ca1(0xc3))](_0x255ca1(0x103),common_1[_0x255ca1(0xe6)][_0x255ca1(0xec)]);const {status:_0x5d66a8,days:days=-0x1,model3Count:model3Count=0x0,model4Count:model4Count=0x0,drawMjCount:drawMjCount=0x0,packageId:_0x547264}=_0x5651de;if(_0x5d66a8===0x1)throw new common_1['HttpException'](_0x255ca1(0x10c),common_1[_0x255ca1(0xe6)][_0x255ca1(0xec)]);const _0x4bb763={'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'packageId':_0x547264};return await this[_0x255ca1(0x118)][_0x255ca1(0xfb)](_0x919e9e,Object[_0x255ca1(0x10d)]({},_0x4bb763),days),await this[_0x255ca1(0x118)][_0x255ca1(0xed)]({'userId':_0x919e9e,'rechargeType':balance_constant_1[_0x255ca1(0xf4)][_0x255ca1(0xe2)],'model3Count':model3Count,'model4Count':model4Count,'drawMjCount':drawMjCount,'days':days}),await this['cramiEntity'][_0x255ca1(0xdb)]({'code':_0x8ebd42['code']},{'useId':_0x919e9e,'status':0x1}),_0x255ca1(0x115);}async['queryAllCrami'](_0x404921,_0x41aedc){const _0x48f226=_0x588893,{page:page=0x1,size:size=0xa,status:_0x5cb369,useId:_0x3f8b02}=_0x404921,_0xf724a0={};_0x5cb369&&Object['assign'](_0xf724a0,{'status':_0x5cb369}),_0x3f8b02&&Object[_0x48f226(0x10d)](_0xf724a0,{'useId':_0x3f8b02});const [_0x494173,_0x450a2d]=await this['cramiEntity'][_0x48f226(0xc9)]({'skip':(page-0x1)*size,'take':size,'order':{'createdAt':_0x48f226(0xbf)},'where':_0xf724a0}),_0x73e989=_0x494173[_0x48f226(0xfc)](_0x22bd93=>_0x22bd93['useId']),_0x18df37=_0x494173['map'](_0xa647d2=>_0xa647d2[_0x48f226(0x113)]),_0x4f410f=await this['userEntity']['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x73e989)}}),_0x3533cb=await this[_0x48f226(0x100)]['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x18df37)}});return _0x494173[_0x48f226(0xde)](_0x5330b0=>{const _0x2b4541=_0x48f226;var _0x583e6b,_0x19ef19,_0x7e6e2e;_0x5330b0['username']=(_0x583e6b=_0x4f410f[_0x2b4541(0x111)](_0x3a6bfc=>_0x3a6bfc['id']===_0x5330b0[_0x2b4541(0x10b)]))===null||_0x583e6b===void 0x0?void 0x0:_0x583e6b[_0x2b4541(0x109)],_0x5330b0[_0x2b4541(0xfe)]=(_0x19ef19=_0x4f410f[_0x2b4541(0x111)](_0x328314=>_0x328314['id']===_0x5330b0[_0x2b4541(0x10b)]))===null||_0x19ef19===void 0x0?void 0x0:_0x19ef19[_0x2b4541(0xfe)],_0x5330b0['packageName']=(_0x7e6e2e=_0x3533cb[_0x2b4541(0x111)](_0x288cac=>_0x288cac['id']===_0x5330b0['packageId']))===null||_0x7e6e2e===void 0x0?void 0x0:_0x7e6e2e[_0x2b4541(0xef)];}),_0x41aedc['user'][_0x48f226(0xf8)]!==_0x48f226(0xd4)&&_0x494173[_0x48f226(0xde)](_0x20b918=>_0x20b918['email']=(0x0,utils_1[_0x48f226(0x10a)])(_0x20b918[_0x48f226(0xfe)])),_0x41aedc[_0x48f226(0xd0)]['role']!=='super'&&_0x494173[_0x48f226(0xde)](_0x74bb24=>_0x74bb24[_0x48f226(0xcb)]=(0x0,utils_1[_0x48f226(0x108)])(_0x74bb24[_0x48f226(0xcb)])),{'rows':_0x494173,'count':_0x450a2d};}async[_0x588893(0xf7)](_0x446f73){const _0x55621f=_0x588893,_0x230e8d=await this[_0x55621f(0xfd)][_0x55621f(0xe7)]({'where':{'id':_0x446f73}});if(!_0x230e8d)throw new common_1[(_0x55621f(0xc3))](_0x55621f(0xc0),common_1[_0x55621f(0xe6)][_0x55621f(0xec)]);if(_0x230e8d[_0x55621f(0x11b)]===0x1)throw new common_1[(_0x55621f(0xc3))](_0x55621f(0xe9),common_1[_0x55621f(0xe6)][_0x55621f(0xec)]);return await this[_0x55621f(0xfd)][_0x55621f(0xf0)]({'id':_0x446f73});}async[_0x588893(0xf2)](_0x69d802){const _0x5d3e01=_0x588893,{ids:_0x118f95}=_0x69d802,_0x4a9be0=await this[_0x5d3e01(0xfd)][_0x5d3e01(0xf0)](_0x118f95);if(_0x4a9be0[_0x5d3e01(0xd9)]>0x0)return _0x5d3e01(0xdd);else throw new common_1[(_0x5d3e01(0xc3))](_0x5d3e01(0xc4),common_1[_0x5d3e01(0xe6)][_0x5d3e01(0xec)]);}};CramiService=__decorate([(0x0,common_1[_0x588893(0x116)])(),__param(0x0,(0x0,typeorm_1[_0x588893(0x11d)])(crami_entity_1['CramiEntity'])),__param(0x1,(0x0,typeorm_1[_0x588893(0x11d)])(cramiPackage_entity_1[_0x588893(0xee)])),__param(0x2,(0x0,typeorm_1[_0x588893(0x11d)])(user_entity_1[_0x588893(0xff)])),__metadata(_0x588893(0x110),[typeorm_2[_0x588893(0x117)],typeorm_2[_0x588893(0x117)],typeorm_2[_0x588893(0x117)],userBalance_service_1[_0x588893(0xe4)]])],CramiService),exports[_0x588893(0xd1)]=CramiService;