'use strict';const _0x551bb2=_0x1196;function _0x5072(){const _0x42ec73=['stringify','__param','map','当前应用已经开启了一个对话无需新建了！','MoreThan','chatGroupEntity','23WOstKy','del','Repository','parse','title','metadata','__esModule','698735AVdMLT','appEntity','appId','affected','defineProperty','非法操作、您在使用一个不存在的应用！','imgUrl','InjectRepository','typeorm','function','getGroupInfoFromId','BAD_REQUEST','app','filter','ChatGroupService','新对话','getOwnPropertyDescriptor','应用对话名称不能修改哟！','isGpts','user','length','../app/app.entity','log','design:paramtypes','des','3563000xKfFYt','query','object','config','ModelsService','Injectable','coverImg','includes','64172werBjE','387800iXHpsh','1915137dzShUH','appLogo','非法操作、您在使用一个未启用的应用！','create','documentUrl','9FbuScl','删除失败！','save','keyType','findOne','getModelTypeIdFromModelName','isSticky','update','parseJson','find','DESC','number','delAll','assign','HttpException','6AyvoQL','pluginModelName','count','pluginId','删除成功','error:\x20','decorate','../models/models.service','PluginDefaultList','HttpStatus','./chatGroup.entity','1421244pghEdI','更新对话失败！','__metadata','modelsService','29568830gaMpZX'];_0x5072=function(){return _0x42ec73;};return _0x5072();}(function(_0x145409,_0x4f5bbe){const _0x50ce93=_0x1196,_0x121948=_0x145409();while(!![]){try{const _0x3a025b=-parseInt(_0x50ce93(0x1b8))/0x1*(parseInt(_0x50ce93(0x18c))/0x2)+-parseInt(_0x50ce93(0x18e))/0x3+-parseInt(_0x50ce93(0x1ad))/0x4+-parseInt(_0x50ce93(0x1bf))/0x5*(parseInt(_0x50ce93(0x1a2))/0x6)+-parseInt(_0x50ce93(0x18d))/0x7+-parseInt(_0x50ce93(0x184))/0x8+-parseInt(_0x50ce93(0x193))/0x9*(-parseInt(_0x50ce93(0x1b1))/0xa);if(_0x3a025b===_0x4f5bbe)break;else _0x121948['push'](_0x121948['shift']());}catch(_0x57a505){_0x121948['push'](_0x121948['shift']());}}}(_0x5072,0x8ebf5));var __decorate=this&&this['__decorate']||function(_0x5b7452,_0x39fe7a,_0x3593fc,_0x4f1135){const _0x134201=_0x1196;var _0x5c7a8c=arguments['length'],_0x2935ad=_0x5c7a8c<0x3?_0x39fe7a:_0x4f1135===null?_0x4f1135=Object[_0x134201(0x17b)](_0x39fe7a,_0x3593fc):_0x4f1135,_0x3d681a;if(typeof Reflect===_0x134201(0x186)&&typeof Reflect[_0x134201(0x1a8)]===_0x134201(0x174))_0x2935ad=Reflect[_0x134201(0x1a8)](_0x5b7452,_0x39fe7a,_0x3593fc,_0x4f1135);else{for(var _0x165247=_0x5b7452[_0x134201(0x17f)]-0x1;_0x165247>=0x0;_0x165247--)if(_0x3d681a=_0x5b7452[_0x165247])_0x2935ad=(_0x5c7a8c<0x3?_0x3d681a(_0x2935ad):_0x5c7a8c>0x3?_0x3d681a(_0x39fe7a,_0x3593fc,_0x2935ad):_0x3d681a(_0x39fe7a,_0x3593fc))||_0x2935ad;}return _0x5c7a8c>0x3&&_0x2935ad&&Object[_0x134201(0x1c3)](_0x39fe7a,_0x3593fc,_0x2935ad),_0x2935ad;},__metadata=this&&this[_0x551bb2(0x1af)]||function(_0x558291,_0xbe9764){const _0x46715a=_0x551bb2;if(typeof Reflect==='object'&&typeof Reflect[_0x46715a(0x1bd)]===_0x46715a(0x174))return Reflect[_0x46715a(0x1bd)](_0x558291,_0xbe9764);},__param=this&&this[_0x551bb2(0x1b3)]||function(_0x3e0e37,_0xcd7543){return function(_0x1c59cd,_0x2d93f5){_0xcd7543(_0x1c59cd,_0x2d93f5,_0x3e0e37);};};Object[_0x551bb2(0x1c3)](exports,_0x551bb2(0x1be),{'value':!![]}),exports['ChatGroupService']=void 0x0;const common_1=require('@nestjs/common'),chatGroup_entity_1=require(_0x551bb2(0x1ac)),typeorm_1=require('@nestjs/typeorm'),typeorm_2=require(_0x551bb2(0x173)),app_entity_1=require(_0x551bb2(0x180)),models_service_1=require(_0x551bb2(0x1a9)),plugin_1=require('../../common/constants/plugin');function _0x1196(_0x4f3ac1,_0x22bee9){const _0x507299=_0x5072();return _0x1196=function(_0x119613,_0x38a3ab){_0x119613=_0x119613-0x170;let _0x2fe100=_0x507299[_0x119613];return _0x2fe100;},_0x1196(_0x4f3ac1,_0x22bee9);}let ChatGroupService=class ChatGroupService{constructor(_0x528090,_0x56f2c8,_0x1c29aa){const _0x586c8e=_0x551bb2;this[_0x586c8e(0x1b7)]=_0x528090,this[_0x586c8e(0x1c0)]=_0x56f2c8,this[_0x586c8e(0x1b0)]=_0x1c29aa;}async[_0x551bb2(0x191)](_0x4b5b71,_0x310b75){const _0x32a92f=_0x551bb2,{id:_0x4aab62}=_0x310b75[_0x32a92f(0x17e)],{appId:_0x374036}=_0x4b5b71,_0x59941b={'title':_0x32a92f(0x17a),'userId':_0x4aab62};let _0x51d194=null;if(_0x374036){_0x51d194=await this[_0x32a92f(0x1c0)]['findOne']({'where':{'id':_0x374036}});if(!_0x51d194)throw new common_1[(_0x32a92f(0x1a1))](_0x32a92f(0x170),common_1['HttpStatus'][_0x32a92f(0x176)]);else{const {status:_0x12f1bf,name:_0x64ecee,modelTypeId:_0x104dcc}=_0x51d194,_0x2617ff=await this['chatGroupEntity'][_0x32a92f(0x1a4)]({'where':{'userId':_0x4aab62,'appId':_0x374036,'isDelete':![]}});if(_0x2617ff>0x0)throw new common_1[(_0x32a92f(0x1a1))](_0x32a92f(0x1b5),common_1[_0x32a92f(0x1ab)]['BAD_REQUEST']);if(![0x1,0x3,0x4,0x5][_0x32a92f(0x18b)](_0x12f1bf))throw new common_1[(_0x32a92f(0x1a1))](_0x32a92f(0x190),common_1[_0x32a92f(0x1ab)][_0x32a92f(0x176)]);_0x64ecee&&(_0x59941b[_0x32a92f(0x1bc)]=_0x64ecee),_0x374036&&(_0x59941b[_0x32a92f(0x1c1)]=_0x374036);}}const _0x5de72c=await this[_0x32a92f(0x1b0)]['getBaseConfig'](_0x51d194);if(!_0x5de72c)throw new common_1[(_0x32a92f(0x1a1))]('管理员未配置此任务AI模型、请先联系管理员开通配置！',common_1[_0x32a92f(0x1ab)][_0x32a92f(0x176)]);return _0x374036&&(_0x5de72c['appId']=_0x374036),await this['chatGroupEntity'][_0x32a92f(0x195)](Object[_0x32a92f(0x1a0)](Object[_0x32a92f(0x1a0)]({},_0x59941b),{'config':JSON[_0x32a92f(0x1b2)](_0x5de72c)}));}async[_0x551bb2(0x185)](_0x10827){const _0x3d41e0=_0x551bb2;try{const {id:_0x2917a3}=_0x10827[_0x3d41e0(0x17e)],_0x342244={'userId':_0x2917a3,'isDelete':![]},_0x419512=await this[_0x3d41e0(0x1b7)][_0x3d41e0(0x19c)]({'where':_0x342244,'order':{'isSticky':_0x3d41e0(0x19d),'id':_0x3d41e0(0x19d)}}),_0x8e9cb=_0x419512[_0x3d41e0(0x178)](_0x33d7f0=>_0x33d7f0[_0x3d41e0(0x1c1)])[_0x3d41e0(0x1b4)](_0x29c10b=>_0x29c10b['appId']),_0xb18d49=await this[_0x3d41e0(0x1c0)][_0x3d41e0(0x19c)]({'where':{'id':(0x0,typeorm_2['In'])(_0x8e9cb)}});return _0x419512['map'](_0x4e4136=>{const _0x3e3931=_0x3d41e0,_0x5d745a=_0xb18d49[_0x3e3931(0x19c)](_0x45df44=>_0x45df44['id']===_0x4e4136[_0x3e3931(0x1c1)]);return _0x4e4136[_0x3e3931(0x18f)]=(_0x5d745a===null||_0x5d745a===void 0x0?void 0x0:_0x5d745a[_0x3e3931(0x18a)])||(_0x5d745a===null||_0x5d745a===void 0x0?void 0x0:_0x5d745a['gptsImg']),_0x4e4136[_0x3e3931(0x183)]=_0x5d745a===null||_0x5d745a===void 0x0?void 0x0:_0x5d745a[_0x3e3931(0x183)],_0x4e4136[_0x3e3931(0x17d)]=_0x5d745a===null||_0x5d745a===void 0x0?void 0x0:_0x5d745a['isGpts'],_0x4e4136;});}catch(_0x3c4314){console[_0x3d41e0(0x181)](_0x3d41e0(0x1a7),_0x3c4314);}}async[_0x551bb2(0x19a)](_0x3843d8,_0x202e33){const _0x1be098=_0x551bb2;var _0x294467;const {title:_0x359a3b,isSticky:_0x9d8267,groupId:_0x53b74e,config:_0x3ffc09,pluginId:_0x205daa,imgUrl:_0x4bc830,documentUrl:_0x481a96}=_0x3843d8,{id:_0x247b85}=_0x202e33[_0x1be098(0x17e)],_0x4edbc9=await this[_0x1be098(0x1b7)][_0x1be098(0x197)]({'where':{'id':_0x53b74e,'userId':_0x247b85}});if(!_0x4edbc9)throw new common_1['HttpException']('请先选择一个对话或者新加一个对话再操作！',common_1[_0x1be098(0x1ab)][_0x1be098(0x176)]);const {appId:_0x1a7ff8}=_0x4edbc9;if(_0x1a7ff8&&!_0x359a3b)try{const _0x4fbd74=JSON[_0x1be098(0x1bb)](_0x3ffc09);if(Number(_0x4fbd74[_0x1be098(0x196)])!==0x1)throw new common_1[(_0x1be098(0x1a1))](_0x1be098(0x17c),common_1[_0x1be098(0x1ab)][_0x1be098(0x176)]);}catch(_0xd3d502){}try{const _0x3f93d6={};_0x359a3b&&(_0x3f93d6[_0x1be098(0x1bc)]=_0x359a3b),typeof _0x9d8267!=='undefined'&&(_0x3f93d6[_0x1be098(0x199)]=_0x9d8267),_0x3ffc09&&(_0x3f93d6[_0x1be098(0x187)]=_0x3ffc09),_0x4bc830&&(_0x3f93d6[_0x1be098(0x171)]=_0x4bc830),_0x481a96&&(_0x3f93d6[_0x1be098(0x192)]=_0x481a96);let _0x95eac9={};if(typeof _0x205daa===_0x1be098(0x19e)){_0x3f93d6[_0x1be098(0x1a5)]=_0x205daa,_0x3f93d6['imgUrl']=null,_0x3f93d6[_0x1be098(0x192)]=null;const _0x337431=await this['chatGroupEntity'][_0x1be098(0x197)]({'where':{'id':_0x53b74e}}),_0x529175=this[_0x1be098(0x19b)](_0x337431['config']),_0x34f76f=(_0x294467=plugin_1[_0x1be098(0x1aa)]['find'](_0x1ee4a5=>_0x1ee4a5['id']===_0x205daa))===null||_0x294467===void 0x0?void 0x0:_0x294467[_0x1be098(0x1a3)],_0x252d9a=await this[_0x1be098(0x1b0)][_0x1be098(0x198)](_0x34f76f);_0x529175['modelTypeId']=_0x252d9a,_0x95eac9={'config':JSON[_0x1be098(0x1b2)](_0x529175)};}const _0x5f1195=await this[_0x1be098(0x1b7)][_0x1be098(0x19a)]({'id':_0x53b74e},Object[_0x1be098(0x1a0)](Object[_0x1be098(0x1a0)]({},_0x3f93d6),_0x95eac9));if(_0x5f1195[_0x1be098(0x1c2)])return!![];else throw new common_1[(_0x1be098(0x1a1))](_0x1be098(0x1ae),common_1[_0x1be098(0x1ab)][_0x1be098(0x176)]);}catch(_0x8d17b0){console[_0x1be098(0x181)]('error:\x20',_0x8d17b0);throw new common_1['HttpException'](_0x1be098(0x1ae),common_1[_0x1be098(0x1ab)][_0x1be098(0x176)]);}}[_0x551bb2(0x19b)](_0x5b38c0){const _0x58fea2=_0x551bb2;let _0x1cf24d={};try{_0x1cf24d=JSON[_0x58fea2(0x1bb)](_0x5b38c0);}catch(_0x5d7a8b){_0x1cf24d={};}return _0x1cf24d;}async[_0x551bb2(0x1b9)](_0x3a72dc,_0x28264c){const _0x1f3f2a=_0x551bb2,{groupId:_0x4ff3bd}=_0x3a72dc,{id:_0x20848e}=_0x28264c[_0x1f3f2a(0x17e)],_0x22f288=await this[_0x1f3f2a(0x1b7)][_0x1f3f2a(0x197)]({'where':{'id':_0x4ff3bd,'userId':_0x20848e}});if(!_0x22f288)throw new common_1['HttpException']('非法操作、您在删除一个非法资源！',common_1[_0x1f3f2a(0x1ab)]['BAD_REQUEST']);const _0x30ab48=await this[_0x1f3f2a(0x1b7)][_0x1f3f2a(0x19a)]({'id':_0x4ff3bd},{'isDelete':!![]});if(_0x30ab48[_0x1f3f2a(0x1c2)])return'删除成功';else throw new common_1['HttpException'](_0x1f3f2a(0x194),common_1[_0x1f3f2a(0x1ab)][_0x1f3f2a(0x176)]);}async[_0x551bb2(0x19f)](_0x461637,_0x477dfd){const _0x56f209=_0x551bb2,_0x46bcdd=(_0x477dfd===null||_0x477dfd===void 0x0?void 0x0:_0x477dfd['type'])===_0x56f209(0x177),{id:_0x2a5a1d}=_0x461637[_0x56f209(0x17e)],_0x3b3dc4={'userId':_0x2a5a1d,'isSticky':![],'isDelete':![]};_0x46bcdd&&(_0x3b3dc4[_0x56f209(0x1c1)]=(0x0,typeorm_2[_0x56f209(0x1b6)])(0x0)),!_0x46bcdd&&(_0x3b3dc4[_0x56f209(0x1c1)]=(0x0,typeorm_2['IsNull'])());const _0x46657d=await this[_0x56f209(0x1b7)][_0x56f209(0x19a)](_0x3b3dc4,{'isDelete':!![]});if(_0x46657d['affected'])return _0x56f209(0x1a6);else throw new common_1['HttpException'](_0x56f209(0x194),common_1[_0x56f209(0x1ab)]['BAD_REQUEST']);}async[_0x551bb2(0x175)](_0x4f0c18){const _0x273146=_0x551bb2;if(!_0x4f0c18)return;return await this[_0x273146(0x1b7)][_0x273146(0x197)]({'where':{'id':_0x4f0c18}});}};ChatGroupService=__decorate([(0x0,common_1[_0x551bb2(0x189)])(),__param(0x0,(0x0,typeorm_1[_0x551bb2(0x172)])(chatGroup_entity_1['ChatGroupEntity'])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(app_entity_1['AppEntity'])),__metadata(_0x551bb2(0x182),[typeorm_2[_0x551bb2(0x1ba)],typeorm_2['Repository'],models_service_1[_0x551bb2(0x188)]])],ChatGroupService),exports[_0x551bb2(0x179)]=ChatGroupService;