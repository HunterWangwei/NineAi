'use strict';const _0x1eb2c0=_0x5891;(function(_0x2a9525,_0x42c4be){const _0x3cc5e8=_0x5891,_0xfd3030=_0x2a9525();while(!![]){try{const _0x564c3d=-parseInt(_0x3cc5e8(0xeb))/0x1+parseInt(_0x3cc5e8(0xb9))/0x2*(-parseInt(_0x3cc5e8(0xb2))/0x3)+-parseInt(_0x3cc5e8(0xd1))/0x4+parseInt(_0x3cc5e8(0xdf))/0x5*(-parseInt(_0x3cc5e8(0xa8))/0x6)+parseInt(_0x3cc5e8(0xd3))/0x7+-parseInt(_0x3cc5e8(0xbc))/0x8+parseInt(_0x3cc5e8(0xf1))/0x9;if(_0x564c3d===_0x42c4be)break;else _0xfd3030['push'](_0xfd3030['shift']());}catch(_0x215d82){_0xfd3030['push'](_0xfd3030['shift']());}}}(_0x51f6,0x87a9e));function _0x5891(_0x15485f,_0x2e8549){const _0x51f61b=_0x51f6();return _0x5891=function(_0x5891df,_0x3cab18){_0x5891df=_0x5891df-0xa5;let _0x1e4839=_0x51f61b[_0x5891df];return _0x1e4839;},_0x5891(_0x15485f,_0x2e8549);}var __decorate=this&&this['__decorate']||function(_0x31ba87,_0x4133b7,_0x1e18cb,_0x16e00c){const _0x821f6a=_0x5891;var _0x517f42=arguments[_0x821f6a(0xbb)],_0x5be05f=_0x517f42<0x3?_0x4133b7:_0x16e00c===null?_0x16e00c=Object[_0x821f6a(0xd6)](_0x4133b7,_0x1e18cb):_0x16e00c,_0x31a923;if(typeof Reflect===_0x821f6a(0xf0)&&typeof Reflect[_0x821f6a(0xe3)]==='function')_0x5be05f=Reflect[_0x821f6a(0xe3)](_0x31ba87,_0x4133b7,_0x1e18cb,_0x16e00c);else{for(var _0x59e5a8=_0x31ba87[_0x821f6a(0xbb)]-0x1;_0x59e5a8>=0x0;_0x59e5a8--)if(_0x31a923=_0x31ba87[_0x59e5a8])_0x5be05f=(_0x517f42<0x3?_0x31a923(_0x5be05f):_0x517f42>0x3?_0x31a923(_0x4133b7,_0x1e18cb,_0x5be05f):_0x31a923(_0x4133b7,_0x1e18cb))||_0x5be05f;}return _0x517f42>0x3&&_0x5be05f&&Object[_0x821f6a(0xd7)](_0x4133b7,_0x1e18cb,_0x5be05f),_0x5be05f;},__metadata=this&&this[_0x1eb2c0(0xe0)]||function(_0x3ae68d,_0x5aa105){const _0xb7f3b1=_0x1eb2c0;if(typeof Reflect===_0xb7f3b1(0xf0)&&typeof Reflect[_0xb7f3b1(0xc0)]===_0xb7f3b1(0xe2))return Reflect['metadata'](_0x3ae68d,_0x5aa105);},__param=this&&this[_0x1eb2c0(0xa9)]||function(_0x16f4ee,_0x2ce372){return function(_0x432e07,_0x33d700){_0x2ce372(_0x432e07,_0x33d700,_0x16f4ee);};};function _0x51f6(){const _0x1380dd=['user','@nestjs/typeorm','isGpts','keyType','affected','19401dFWedK','__esModule','modelTypeId','HttpException','@nestjs/common','findOne','documentUrl','258vxXVpJ','includes','length','2918496WUqrhg','app','HttpStatus','BAD_REQUEST','metadata','isSticky','MoreThan','filter','parse','appId','pluginModelName','ModelsService','stringify','更新对话失败！','管理员未配置此任务AI模型、请先联系管理员开通配置！','log','assign','新对话','pluginId','imgUrl','type','2428064sONpKe','chatGroupEntity','2236269PCFfKr','../app/app.entity','DESC','getOwnPropertyDescriptor','defineProperty','ChatGroupEntity','config','appEntity','number','find','请先选择一个对话或者新加一个对话再操作！','删除成功','469195crZZeJ','__metadata','AppEntity','function','decorate','des','coverImg','modelsService','undefined','InjectRepository','../../common/constants/plugin','非法操作、您在使用一个未启用的应用！','218447TpQXIo','Repository','typeorm','非法操作、您在删除一个非法资源！','map','object','22035663vzgnpF','appLogo','删除失败！','count','title','design:paramtypes','ChatGroupService','query','getGroupInfoFromId','12DqPoqH','__param','getModelTypeIdFromModelName','PluginDefaultList','Injectable'];_0x51f6=function(){return _0x1380dd;};return _0x51f6();}Object[_0x1eb2c0(0xd7)](exports,_0x1eb2c0(0xb3),{'value':!![]}),exports[_0x1eb2c0(0xa5)]=void 0x0;const common_1=require(_0x1eb2c0(0xb6)),chatGroup_entity_1=require('./chatGroup.entity'),typeorm_1=require(_0x1eb2c0(0xae)),typeorm_2=require(_0x1eb2c0(0xed)),app_entity_1=require(_0x1eb2c0(0xd4)),models_service_1=require('../models/models.service'),plugin_1=require(_0x1eb2c0(0xe9));let ChatGroupService=class ChatGroupService{constructor(_0x4c7d2e,_0x1a3a01,_0x2ba678){const _0x508b1a=_0x1eb2c0;this[_0x508b1a(0xd2)]=_0x4c7d2e,this['appEntity']=_0x1a3a01,this['modelsService']=_0x2ba678;}async['create'](_0x39e596,_0x381b23){const _0x126da2=_0x1eb2c0,{id:_0x19f569}=_0x381b23['user'],{appId:_0x2934cf}=_0x39e596,_0x3d85ab={'title':_0x126da2(0xcd),'userId':_0x19f569};let _0x1f934d=null;if(_0x2934cf){_0x1f934d=await this[_0x126da2(0xda)]['findOne']({'where':{'id':_0x2934cf}});if(!_0x1f934d)throw new common_1[(_0x126da2(0xb5))]('非法操作、您在使用一个不存在的应用！',common_1[_0x126da2(0xbe)]['BAD_REQUEST']);else{const {status:_0x212726,name:_0x48b42c,modelTypeId:_0x52c76d}=_0x1f934d,_0x44f49f=await this[_0x126da2(0xd2)][_0x126da2(0xf4)]({'where':{'userId':_0x19f569,'appId':_0x2934cf,'isDelete':![]}});if(_0x44f49f>0x0)throw new common_1['HttpException']('当前应用已经开启了一个对话无需新建了！',common_1['HttpStatus']['BAD_REQUEST']);if(![0x1,0x3,0x4,0x5][_0x126da2(0xba)](_0x212726))throw new common_1[(_0x126da2(0xb5))](_0x126da2(0xea),common_1['HttpStatus']['BAD_REQUEST']);_0x48b42c&&(_0x3d85ab[_0x126da2(0xf5)]=_0x48b42c),_0x2934cf&&(_0x3d85ab[_0x126da2(0xc5)]=_0x2934cf);}}const _0x415063=await this[_0x126da2(0xe6)]['getBaseConfig'](_0x1f934d);if(!_0x415063)throw new common_1[(_0x126da2(0xb5))](_0x126da2(0xca),common_1[_0x126da2(0xbe)][_0x126da2(0xbf)]);return _0x2934cf&&(_0x415063[_0x126da2(0xc5)]=_0x2934cf),await this[_0x126da2(0xd2)]['save'](Object[_0x126da2(0xcc)](Object[_0x126da2(0xcc)]({},_0x3d85ab),{'config':JSON[_0x126da2(0xc8)](_0x415063)}));}async[_0x1eb2c0(0xa6)](_0x345a1e){const _0x4ff465=_0x1eb2c0;try{const {id:_0x361717}=_0x345a1e[_0x4ff465(0xad)],_0x37f939={'userId':_0x361717,'isDelete':![]},_0xda7a10=await this['chatGroupEntity'][_0x4ff465(0xdc)]({'where':_0x37f939,'order':{'isSticky':_0x4ff465(0xd5),'id':_0x4ff465(0xd5)}}),_0x2471d9=_0xda7a10[_0x4ff465(0xc3)](_0x4436e7=>_0x4436e7['appId'])[_0x4ff465(0xef)](_0x645068=>_0x645068[_0x4ff465(0xc5)]),_0x54b119=await this[_0x4ff465(0xda)][_0x4ff465(0xdc)]({'where':{'id':(0x0,typeorm_2['In'])(_0x2471d9)}});return _0xda7a10[_0x4ff465(0xef)](_0x2f2591=>{const _0x1686b5=_0x4ff465,_0x32d981=_0x54b119[_0x1686b5(0xdc)](_0x264ddb=>_0x264ddb['id']===_0x2f2591[_0x1686b5(0xc5)]);return _0x2f2591[_0x1686b5(0xf2)]=(_0x32d981===null||_0x32d981===void 0x0?void 0x0:_0x32d981[_0x1686b5(0xe5)])||(_0x32d981===null||_0x32d981===void 0x0?void 0x0:_0x32d981['gptsImg']),_0x2f2591['des']=_0x32d981===null||_0x32d981===void 0x0?void 0x0:_0x32d981[_0x1686b5(0xe4)],_0x2f2591[_0x1686b5(0xaf)]=_0x32d981===null||_0x32d981===void 0x0?void 0x0:_0x32d981['isGpts'],_0x2f2591;});}catch(_0x37b582){console['log']('error:\x20',_0x37b582);}}async['update'](_0x179de8,_0x2b2bd0){const _0x3592ec=_0x1eb2c0;var _0x4f9cb4;const {title:_0x488d4d,isSticky:_0x2e7247,groupId:_0x382728,config:_0x59ba6d,pluginId:_0x39f8cc,imgUrl:_0x6c5d00,documentUrl:_0x4c4739}=_0x179de8,{id:_0x42de47}=_0x2b2bd0[_0x3592ec(0xad)],_0x4efa90=await this[_0x3592ec(0xd2)][_0x3592ec(0xb7)]({'where':{'id':_0x382728,'userId':_0x42de47}});if(!_0x4efa90)throw new common_1[(_0x3592ec(0xb5))](_0x3592ec(0xdd),common_1[_0x3592ec(0xbe)]['BAD_REQUEST']);const {appId:_0x4a35e3}=_0x4efa90;if(_0x4a35e3&&!_0x488d4d)try{const _0x36a59b=JSON[_0x3592ec(0xc4)](_0x59ba6d);if(Number(_0x36a59b[_0x3592ec(0xb0)])!==0x1)throw new common_1[(_0x3592ec(0xb5))]('应用对话名称不能修改哟！',common_1['HttpStatus'][_0x3592ec(0xbf)]);}catch(_0x5ecc8b){}try{const _0x14e276={};_0x488d4d&&(_0x14e276[_0x3592ec(0xf5)]=_0x488d4d),typeof _0x2e7247!==_0x3592ec(0xe7)&&(_0x14e276[_0x3592ec(0xc1)]=_0x2e7247),_0x59ba6d&&(_0x14e276['config']=_0x59ba6d),_0x6c5d00&&(_0x14e276[_0x3592ec(0xcf)]=_0x6c5d00),_0x4c4739&&(_0x14e276[_0x3592ec(0xb8)]=_0x4c4739);let _0x4ca7cb={'config':_0x59ba6d};if(typeof _0x39f8cc===_0x3592ec(0xdb)&&_0x39f8cc>-0x1){_0x14e276[_0x3592ec(0xce)]=_0x39f8cc,_0x14e276[_0x3592ec(0xcf)]=null,_0x14e276[_0x3592ec(0xb8)]=null;const _0x33f4a9=await this[_0x3592ec(0xd2)][_0x3592ec(0xb7)]({'where':{'id':_0x382728}}),_0x507259=this['parseJson'](_0x33f4a9[_0x3592ec(0xd9)]),_0x5e1db9=(_0x4f9cb4=plugin_1[_0x3592ec(0xab)][_0x3592ec(0xdc)](_0x56a294=>_0x56a294['id']===_0x39f8cc))===null||_0x4f9cb4===void 0x0?void 0x0:_0x4f9cb4[_0x3592ec(0xc6)],_0x22e24d=await this['modelsService'][_0x3592ec(0xaa)](_0x5e1db9);_0x507259[_0x3592ec(0xb4)]=_0x22e24d,_0x4ca7cb={'config':JSON[_0x3592ec(0xc8)](_0x507259)};}const _0x5d7317=await this['chatGroupEntity']['update']({'id':_0x382728},Object[_0x3592ec(0xcc)](Object[_0x3592ec(0xcc)]({},_0x14e276),_0x4ca7cb));if(_0x5d7317['affected'])return!![];else throw new common_1['HttpException']('更新对话失败！',common_1[_0x3592ec(0xbe)][_0x3592ec(0xbf)]);}catch(_0x3ebd88){console[_0x3592ec(0xcb)]('error:\x20',_0x3ebd88);throw new common_1[(_0x3592ec(0xb5))](_0x3592ec(0xc9),common_1[_0x3592ec(0xbe)][_0x3592ec(0xbf)]);}}['parseJson'](_0x5e8f21){const _0x3fa662=_0x1eb2c0;let _0x3acb3e={};try{_0x3acb3e=JSON[_0x3fa662(0xc4)](_0x5e8f21);}catch(_0xec2ee7){_0x3acb3e={};}return _0x3acb3e;}async['del'](_0x190f8a,_0x49d7ac){const _0x497d09=_0x1eb2c0,{groupId:_0x41ca3d}=_0x190f8a,{id:_0x3491ac}=_0x49d7ac['user'],_0x2b0e15=await this[_0x497d09(0xd2)]['findOne']({'where':{'id':_0x41ca3d,'userId':_0x3491ac}});if(!_0x2b0e15)throw new common_1[(_0x497d09(0xb5))](_0x497d09(0xee),common_1[_0x497d09(0xbe)][_0x497d09(0xbf)]);const _0x589a06=await this[_0x497d09(0xd2)]['update']({'id':_0x41ca3d},{'isDelete':!![]});if(_0x589a06[_0x497d09(0xb1)])return _0x497d09(0xde);else throw new common_1[(_0x497d09(0xb5))](_0x497d09(0xf3),common_1[_0x497d09(0xbe)]['BAD_REQUEST']);}async['delAll'](_0x392cf7,_0x350b8b){const _0x4d5bc8=_0x1eb2c0,_0x4ce673=(_0x350b8b===null||_0x350b8b===void 0x0?void 0x0:_0x350b8b[_0x4d5bc8(0xd0)])===_0x4d5bc8(0xbd),{id:_0x38373d}=_0x392cf7[_0x4d5bc8(0xad)],_0x638e76={'userId':_0x38373d,'isSticky':![],'isDelete':![]};_0x4ce673&&(_0x638e76[_0x4d5bc8(0xc5)]=(0x0,typeorm_2[_0x4d5bc8(0xc2)])(0x0)),!_0x4ce673&&(_0x638e76[_0x4d5bc8(0xc5)]=(0x0,typeorm_2['IsNull'])());const _0x5e36dc=await this[_0x4d5bc8(0xd2)]['update'](_0x638e76,{'isDelete':!![]});if(_0x5e36dc[_0x4d5bc8(0xb1)])return _0x4d5bc8(0xde);else throw new common_1[(_0x4d5bc8(0xb5))](_0x4d5bc8(0xf3),common_1[_0x4d5bc8(0xbe)][_0x4d5bc8(0xbf)]);}async[_0x1eb2c0(0xa7)](_0x1a35ab){const _0x49e8d6=_0x1eb2c0;if(!_0x1a35ab)return;return await this[_0x49e8d6(0xd2)][_0x49e8d6(0xb7)]({'where':{'id':_0x1a35ab}});}};ChatGroupService=__decorate([(0x0,common_1[_0x1eb2c0(0xac)])(),__param(0x0,(0x0,typeorm_1[_0x1eb2c0(0xe8)])(chatGroup_entity_1[_0x1eb2c0(0xd8)])),__param(0x1,(0x0,typeorm_1[_0x1eb2c0(0xe8)])(app_entity_1[_0x1eb2c0(0xe1)])),__metadata(_0x1eb2c0(0xf6),[typeorm_2['Repository'],typeorm_2[_0x1eb2c0(0xec)],models_service_1[_0x1eb2c0(0xc7)]])],ChatGroupService),exports['ChatGroupService']=ChatGroupService;