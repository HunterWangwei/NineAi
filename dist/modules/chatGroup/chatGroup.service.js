'use strict';function _0x26ed(_0x5f513a,_0x45dade){const _0x43e0a7=_0x43e0();return _0x26ed=function(_0x26ed73,_0x15904d){_0x26ed73=_0x26ed73-0x8d;let _0x302d45=_0x43e0a7[_0x26ed73];return _0x302d45;},_0x26ed(_0x5f513a,_0x45dade);}const _0xd2c39a=_0x26ed;(function(_0x4e8854,_0x22e086){const _0x58cb06=_0x26ed,_0x50a523=_0x4e8854();while(!![]){try{const _0x3542d7=parseInt(_0x58cb06(0xb4))/0x1+-parseInt(_0x58cb06(0xd7))/0x2*(-parseInt(_0x58cb06(0x90))/0x3)+parseInt(_0x58cb06(0xaf))/0x4+-parseInt(_0x58cb06(0xd2))/0x5*(parseInt(_0x58cb06(0xaa))/0x6)+parseInt(_0x58cb06(0xcb))/0x7+-parseInt(_0x58cb06(0xbf))/0x8*(-parseInt(_0x58cb06(0xb0))/0x9)+parseInt(_0x58cb06(0xb2))/0xa*(-parseInt(_0x58cb06(0x8e))/0xb);if(_0x3542d7===_0x22e086)break;else _0x50a523['push'](_0x50a523['shift']());}catch(_0x45b6aa){_0x50a523['push'](_0x50a523['shift']());}}}(_0x43e0,0xdc362));var __decorate=this&&this[_0xd2c39a(0xac)]||function(_0x4c59a1,_0x1b7fdd,_0x124b0a,_0x426d95){const _0x5197a2=_0xd2c39a;var _0x51d21d=arguments['length'],_0x4f5be2=_0x51d21d<0x3?_0x1b7fdd:_0x426d95===null?_0x426d95=Object[_0x5197a2(0xa1)](_0x1b7fdd,_0x124b0a):_0x426d95,_0x10753c;if(typeof Reflect===_0x5197a2(0xd4)&&typeof Reflect['decorate']===_0x5197a2(0xc6))_0x4f5be2=Reflect[_0x5197a2(0xc3)](_0x4c59a1,_0x1b7fdd,_0x124b0a,_0x426d95);else{for(var _0x217070=_0x4c59a1[_0x5197a2(0x8d)]-0x1;_0x217070>=0x0;_0x217070--)if(_0x10753c=_0x4c59a1[_0x217070])_0x4f5be2=(_0x51d21d<0x3?_0x10753c(_0x4f5be2):_0x51d21d>0x3?_0x10753c(_0x1b7fdd,_0x124b0a,_0x4f5be2):_0x10753c(_0x1b7fdd,_0x124b0a))||_0x4f5be2;}return _0x51d21d>0x3&&_0x4f5be2&&Object[_0x5197a2(0x9b)](_0x1b7fdd,_0x124b0a,_0x4f5be2),_0x4f5be2;},__metadata=this&&this['__metadata']||function(_0x430492,_0x50b100){const _0x582dab=_0xd2c39a;if(typeof Reflect===_0x582dab(0xd4)&&typeof Reflect['metadata']===_0x582dab(0xc6))return Reflect[_0x582dab(0x9d)](_0x430492,_0x50b100);},__param=this&&this[_0xd2c39a(0x9a)]||function(_0x188720,_0x34d471){return function(_0x3bb99c,_0x3cba8d){_0x34d471(_0x3bb99c,_0x3cba8d,_0x188720);};};Object['defineProperty'](exports,_0xd2c39a(0x99),{'value':!![]}),exports[_0xd2c39a(0xc0)]=void 0x0;const common_1=require(_0xd2c39a(0xa3)),chatGroup_entity_1=require('./chatGroup.entity'),typeorm_1=require(_0xd2c39a(0x98)),typeorm_2=require(_0xd2c39a(0xda)),app_entity_1=require(_0xd2c39a(0x91)),models_service_1=require(_0xd2c39a(0xbe)),plugin_1=require(_0xd2c39a(0xdb));function _0x43e0(){const _0x3a50c2=['404631OTWWiS','非法操作、您在使用一个未启用的应用！','70FVAUej','error:\x20','1161560PYzkyR','HttpException','includes','user','delAll','del','undefined','log','appId','IsNull','../models/models.service','312fWdmWP','ChatGroupService','MoreThan','design:paramtypes','decorate','title','create','function','isSticky','appEntity','type','pluginId','5736290ubMtSP','ChatGroupEntity','ModelsService','应用对话名称不能修改哟！','modelTypeId','des','findOne','6805955aYXJtE','BAD_REQUEST','object','save','affected','4eCsCuo','当前应用已经开启了一个对话无需新建了！','PluginDefaultList','typeorm','../../common/constants/plugin','Repository','删除失败！','DESC','更新对话失败！','app','pluginModelName','map','getBaseConfig','length','4354933BbihbT','config','123027cErafW','../app/app.entity','imgUrl','Injectable','非法操作、您在删除一个非法资源！','update','documentUrl','parseJson','@nestjs/typeorm','__esModule','__param','defineProperty','InjectRepository','metadata','gptsImg','chatGroupEntity','HttpStatus','getOwnPropertyDescriptor','appLogo','@nestjs/common','管理员未配置此任务AI模型、请先联系管理员开通配置！','filter','新对话','getModelTypeIdFromModelName','query','parse','6FWVToh','find','__decorate','AppEntity','assign','4872196lbkhsS'];_0x43e0=function(){return _0x3a50c2;};return _0x43e0();}let ChatGroupService=class ChatGroupService{constructor(_0x2b2715,_0x4ae2d6,_0x2de933){const _0x3bd242=_0xd2c39a;this[_0x3bd242(0x9f)]=_0x2b2715,this[_0x3bd242(0xc8)]=_0x4ae2d6,this['modelsService']=_0x2de933;}async[_0xd2c39a(0xc5)](_0x26bfa8,_0x4bb2d6){const _0x306369=_0xd2c39a,{id:_0x532e7d}=_0x4bb2d6[_0x306369(0xb7)],{appId:_0x321a62}=_0x26bfa8,_0x34dc95={'title':_0x306369(0xa6),'userId':_0x532e7d};let _0x11bfda=null;if(_0x321a62){_0x11bfda=await this[_0x306369(0xc8)][_0x306369(0xd1)]({'where':{'id':_0x321a62}});if(!_0x11bfda)throw new common_1[(_0x306369(0xb5))]('非法操作、您在使用一个不存在的应用！',common_1['HttpStatus'][_0x306369(0xd3)]);else{const {status:_0x5a2728,name:_0x5caae7,modelTypeId:_0xa552d9}=_0x11bfda,_0xc807fa=await this['chatGroupEntity']['count']({'where':{'userId':_0x532e7d,'appId':_0x321a62,'isDelete':![]}});if(_0xc807fa>0x0)throw new common_1['HttpException'](_0x306369(0xd8),common_1[_0x306369(0xa0)][_0x306369(0xd3)]);if(![0x1,0x3,0x4,0x5][_0x306369(0xb6)](_0x5a2728))throw new common_1[(_0x306369(0xb5))](_0x306369(0xb1),common_1[_0x306369(0xa0)][_0x306369(0xd3)]);_0x5caae7&&(_0x34dc95[_0x306369(0xc4)]=_0x5caae7),_0x321a62&&(_0x34dc95['appId']=_0x321a62);}}const _0x34babd=await this['modelsService'][_0x306369(0xe3)](_0x11bfda);if(!_0x34babd)throw new common_1['HttpException'](_0x306369(0xa4),common_1[_0x306369(0xa0)][_0x306369(0xd3)]);return _0x321a62&&(_0x34babd['appId']=_0x321a62),await this[_0x306369(0x9f)][_0x306369(0xd5)](Object['assign'](Object[_0x306369(0xae)]({},_0x34dc95),{'config':JSON['stringify'](_0x34babd)}));}async[_0xd2c39a(0xa8)](_0x5aefe3){const _0x1537ec=_0xd2c39a;try{const {id:_0x2ffe31}=_0x5aefe3['user'],_0x4ba402={'userId':_0x2ffe31,'isDelete':![]},_0x3bf62f=await this[_0x1537ec(0x9f)][_0x1537ec(0xab)]({'where':_0x4ba402,'order':{'isSticky':_0x1537ec(0xde),'id':'DESC'}}),_0x5af7b2=_0x3bf62f[_0x1537ec(0xa5)](_0x18f951=>_0x18f951[_0x1537ec(0xbc)])[_0x1537ec(0xe2)](_0x53c31b=>_0x53c31b[_0x1537ec(0xbc)]),_0x5f571d=await this[_0x1537ec(0xc8)][_0x1537ec(0xab)]({'where':{'id':(0x0,typeorm_2['In'])(_0x5af7b2)}});return _0x3bf62f[_0x1537ec(0xe2)](_0x108aad=>{const _0x33cdf2=_0x1537ec,_0x35aaa7=_0x5f571d[_0x33cdf2(0xab)](_0x527de4=>_0x527de4['id']===_0x108aad[_0x33cdf2(0xbc)]);return _0x108aad[_0x33cdf2(0xa2)]=(_0x35aaa7===null||_0x35aaa7===void 0x0?void 0x0:_0x35aaa7['coverImg'])||(_0x35aaa7===null||_0x35aaa7===void 0x0?void 0x0:_0x35aaa7[_0x33cdf2(0x9e)]),_0x108aad[_0x33cdf2(0xd0)]=_0x35aaa7===null||_0x35aaa7===void 0x0?void 0x0:_0x35aaa7['des'],_0x108aad['isGpts']=_0x35aaa7===null||_0x35aaa7===void 0x0?void 0x0:_0x35aaa7['isGpts'],_0x108aad;});}catch(_0x655047){console['log']('error:\x20',_0x655047);}}async[_0xd2c39a(0x95)](_0x1acb65,_0xf995a8){const _0x36efe3=_0xd2c39a;var _0x97f437;const {title:_0x5d01c5,isSticky:_0x2d95e,groupId:_0x330d52,config:_0x3fe987,pluginId:_0x2239a3,imgUrl:_0x384776,documentUrl:_0x560225}=_0x1acb65,{id:_0x186251}=_0xf995a8[_0x36efe3(0xb7)],_0x2db263=await this['chatGroupEntity'][_0x36efe3(0xd1)]({'where':{'id':_0x330d52,'userId':_0x186251}});if(!_0x2db263)throw new common_1['HttpException']('请先选择一个对话或者新加一个对话再操作！',common_1[_0x36efe3(0xa0)][_0x36efe3(0xd3)]);const {appId:_0x527171}=_0x2db263;if(_0x527171&&!_0x5d01c5)try{const _0xc3d1c9=JSON[_0x36efe3(0xa9)](_0x3fe987);if(Number(_0xc3d1c9['keyType'])!==0x1)throw new common_1[(_0x36efe3(0xb5))](_0x36efe3(0xce),common_1[_0x36efe3(0xa0)]['BAD_REQUEST']);}catch(_0x12249d){}try{const _0x548209={};_0x5d01c5&&(_0x548209['title']=_0x5d01c5),typeof _0x2d95e!==_0x36efe3(0xba)&&(_0x548209[_0x36efe3(0xc7)]=_0x2d95e),_0x3fe987&&(_0x548209[_0x36efe3(0x8f)]=_0x3fe987),_0x384776&&(_0x548209[_0x36efe3(0x92)]=_0x384776),_0x560225&&(_0x548209['documentUrl']=_0x560225);let _0x75b068={'config':_0x3fe987};if(typeof _0x2239a3==='number'&&_0x2239a3>-0x1){_0x548209[_0x36efe3(0xca)]=_0x2239a3,_0x548209[_0x36efe3(0x92)]=null,_0x548209[_0x36efe3(0x96)]=null;const _0x2fe31e=await this['chatGroupEntity'][_0x36efe3(0xd1)]({'where':{'id':_0x330d52}}),_0x387afd=this['parseJson'](_0x2fe31e[_0x36efe3(0x8f)]),_0xbb9378=(_0x97f437=plugin_1[_0x36efe3(0xd9)][_0x36efe3(0xab)](_0x496b18=>_0x496b18['id']===_0x2239a3))===null||_0x97f437===void 0x0?void 0x0:_0x97f437[_0x36efe3(0xe1)],_0x301356=await this['modelsService'][_0x36efe3(0xa7)](_0xbb9378);_0x387afd[_0x36efe3(0xcf)]=_0x301356,_0x75b068={'config':JSON['stringify'](_0x387afd)};}const _0x451ff5=await this[_0x36efe3(0x9f)][_0x36efe3(0x95)]({'id':_0x330d52},Object[_0x36efe3(0xae)](Object[_0x36efe3(0xae)]({},_0x548209),_0x75b068));if(_0x451ff5[_0x36efe3(0xd6)])return!![];else throw new common_1[(_0x36efe3(0xb5))](_0x36efe3(0xdf),common_1[_0x36efe3(0xa0)][_0x36efe3(0xd3)]);}catch(_0x333d68){console[_0x36efe3(0xbb)](_0x36efe3(0xb3),_0x333d68);throw new common_1[(_0x36efe3(0xb5))]('更新对话失败！',common_1[_0x36efe3(0xa0)][_0x36efe3(0xd3)]);}}[_0xd2c39a(0x97)](_0x31cf9c){const _0x48d00a=_0xd2c39a;let _0x2124a3={};try{_0x2124a3=JSON[_0x48d00a(0xa9)](_0x31cf9c);}catch(_0x13780f){_0x2124a3={};}return _0x2124a3;}async[_0xd2c39a(0xb9)](_0x42ee1a,_0x464a5b){const _0x4cdb2b=_0xd2c39a,{groupId:_0x7e1fe1}=_0x42ee1a,{id:_0x5a6ded}=_0x464a5b[_0x4cdb2b(0xb7)],_0x2ee755=await this[_0x4cdb2b(0x9f)][_0x4cdb2b(0xd1)]({'where':{'id':_0x7e1fe1,'userId':_0x5a6ded}});if(!_0x2ee755)throw new common_1['HttpException'](_0x4cdb2b(0x94),common_1[_0x4cdb2b(0xa0)][_0x4cdb2b(0xd3)]);const _0x1c927b=await this[_0x4cdb2b(0x9f)][_0x4cdb2b(0x95)]({'id':_0x7e1fe1},{'isDelete':!![]});if(_0x1c927b[_0x4cdb2b(0xd6)])return'删除成功';else throw new common_1[(_0x4cdb2b(0xb5))](_0x4cdb2b(0xdd),common_1['HttpStatus']['BAD_REQUEST']);}async[_0xd2c39a(0xb8)](_0x365907,_0x25e733){const _0xc233e5=_0xd2c39a,_0x5cc70e=(_0x25e733===null||_0x25e733===void 0x0?void 0x0:_0x25e733[_0xc233e5(0xc9)])===_0xc233e5(0xe0),{id:_0x1b09b0}=_0x365907[_0xc233e5(0xb7)],_0x5e1c8d={'userId':_0x1b09b0,'isSticky':![],'isDelete':![]};_0x5cc70e&&(_0x5e1c8d[_0xc233e5(0xbc)]=(0x0,typeorm_2[_0xc233e5(0xc1)])(0x0)),!_0x5cc70e&&(_0x5e1c8d['appId']=(0x0,typeorm_2[_0xc233e5(0xbd)])());const _0x172168=await this[_0xc233e5(0x9f)][_0xc233e5(0x95)](_0x5e1c8d,{'isDelete':!![]});if(_0x172168['affected'])return'删除成功';else throw new common_1[(_0xc233e5(0xb5))](_0xc233e5(0xdd),common_1[_0xc233e5(0xa0)][_0xc233e5(0xd3)]);}async['getGroupInfoFromId'](_0x31604c){const _0x20f6b7=_0xd2c39a;if(!_0x31604c)return;return await this[_0x20f6b7(0x9f)][_0x20f6b7(0xd1)]({'where':{'id':_0x31604c}});}};ChatGroupService=__decorate([(0x0,common_1[_0xd2c39a(0x93)])(),__param(0x0,(0x0,typeorm_1[_0xd2c39a(0x9c)])(chatGroup_entity_1[_0xd2c39a(0xcc)])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(app_entity_1[_0xd2c39a(0xad)])),__metadata(_0xd2c39a(0xc2),[typeorm_2[_0xd2c39a(0xdc)],typeorm_2[_0xd2c39a(0xdc)],models_service_1[_0xd2c39a(0xcd)]])],ChatGroupService),exports[_0xd2c39a(0xc0)]=ChatGroupService;