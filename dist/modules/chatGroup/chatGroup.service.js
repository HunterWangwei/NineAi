'use strict';const _0x22ed85=_0x51cd;(function(_0xd9ce1,_0x417a80){const _0x2f4995=_0x51cd,_0x34259d=_0xd9ce1();while(!![]){try{const _0x51f2f1=-parseInt(_0x2f4995(0x1d3))/0x1*(parseInt(_0x2f4995(0x210))/0x2)+-parseInt(_0x2f4995(0x20b))/0x3+-parseInt(_0x2f4995(0x1fe))/0x4*(parseInt(_0x2f4995(0x1d7))/0x5)+-parseInt(_0x2f4995(0x203))/0x6+parseInt(_0x2f4995(0x21d))/0x7*(-parseInt(_0x2f4995(0x206))/0x8)+parseInt(_0x2f4995(0x1e9))/0x9+parseInt(_0x2f4995(0x208))/0xa*(parseInt(_0x2f4995(0x218))/0xb);if(_0x51f2f1===_0x417a80)break;else _0x34259d['push'](_0x34259d['shift']());}catch(_0x3e4262){_0x34259d['push'](_0x34259d['shift']());}}}(_0x5660,0xe4eac));function _0x5660(){const _0x3cbf97=['8jhVQZL','管理员未配置此任务AI模型、请先联系管理员开通配置！','629630pbuxlL','Repository','stringify','2738532QiraCj','新对话','ChatGroupEntity','includes','filter','43512aDkqFJ','__decorate','删除失败！','findOne','ChatGroupService','getModelTypeIdFromModelName','gptsImg','AppEntity','484VSZxdb','非法操作、您在使用一个未启用的应用！','@nestjs/common','log','create','4406549ulNawB','../models/models.service','documentUrl','Injectable','number','HttpStatus','IsNull','请先选择一个对话或者新加一个对话再操作！','BAD_REQUEST','length','16KYAPnS','更新对话失败！','当前应用已经开启了一个对话无需新建了！','user','164150MlwDQU','update','DESC','ModelsService','parse','find','coverImg','error:\x20','chatGroupEntity','decorate','PluginDefaultList','删除成功','app','pluginModelName','InjectRepository','非法操作、您在使用一个不存在的应用！','./chatGroup.entity','getBaseConfig','11419695pBrYcj','affected','config','非法操作、您在删除一个非法资源！','@nestjs/typeorm','metadata','des','count','imgUrl','modelsService','HttpException','__metadata','../../common/constants/plugin','defineProperty','MoreThan','assign','getOwnPropertyDescriptor','map','typeorm','../app/app.entity','object','8QVVise','function','isGpts','type','title','6872856yYuzeX','appId','appEntity'];_0x5660=function(){return _0x3cbf97;};return _0x5660();}function _0x51cd(_0x13012b,_0x449126){const _0x566004=_0x5660();return _0x51cd=function(_0x51cd11,_0x4c84e2){_0x51cd11=_0x51cd11-0x1cc;let _0x655565=_0x566004[_0x51cd11];return _0x655565;},_0x51cd(_0x13012b,_0x449126);}var __decorate=this&&this[_0x22ed85(0x211)]||function(_0x4362b1,_0x475084,_0x4a87c8,_0x2094ad){const _0x38d504=_0x22ed85;var _0x21d99e=arguments[_0x38d504(0x1d2)],_0x57d56e=_0x21d99e<0x3?_0x475084:_0x2094ad===null?_0x2094ad=Object[_0x38d504(0x1f9)](_0x475084,_0x4a87c8):_0x2094ad,_0x26e1d9;if(typeof Reflect==='object'&&typeof Reflect[_0x38d504(0x1e0)]===_0x38d504(0x1ff))_0x57d56e=Reflect[_0x38d504(0x1e0)](_0x4362b1,_0x475084,_0x4a87c8,_0x2094ad);else{for(var _0x449806=_0x4362b1[_0x38d504(0x1d2)]-0x1;_0x449806>=0x0;_0x449806--)if(_0x26e1d9=_0x4362b1[_0x449806])_0x57d56e=(_0x21d99e<0x3?_0x26e1d9(_0x57d56e):_0x21d99e>0x3?_0x26e1d9(_0x475084,_0x4a87c8,_0x57d56e):_0x26e1d9(_0x475084,_0x4a87c8))||_0x57d56e;}return _0x21d99e>0x3&&_0x57d56e&&Object[_0x38d504(0x1f6)](_0x475084,_0x4a87c8,_0x57d56e),_0x57d56e;},__metadata=this&&this[_0x22ed85(0x1f4)]||function(_0x5eef0e,_0x304560){const _0x2a64b9=_0x22ed85;if(typeof Reflect===_0x2a64b9(0x1fd)&&typeof Reflect[_0x2a64b9(0x1ee)]==='function')return Reflect[_0x2a64b9(0x1ee)](_0x5eef0e,_0x304560);},__param=this&&this['__param']||function(_0x6bc0a5,_0x225605){return function(_0xf6b966,_0x51616d){_0x225605(_0xf6b966,_0x51616d,_0x6bc0a5);};};Object[_0x22ed85(0x1f6)](exports,'__esModule',{'value':!![]}),exports[_0x22ed85(0x214)]=void 0x0;const common_1=require(_0x22ed85(0x21a)),chatGroup_entity_1=require(_0x22ed85(0x1e7)),typeorm_1=require(_0x22ed85(0x1ed)),typeorm_2=require(_0x22ed85(0x1fb)),app_entity_1=require(_0x22ed85(0x1fc)),models_service_1=require(_0x22ed85(0x21e)),plugin_1=require(_0x22ed85(0x1f5));let ChatGroupService=class ChatGroupService{constructor(_0x385c18,_0x1d4fba,_0x1a7850){const _0x19613b=_0x22ed85;this[_0x19613b(0x1df)]=_0x385c18,this[_0x19613b(0x205)]=_0x1d4fba,this[_0x19613b(0x1f2)]=_0x1a7850;}async[_0x22ed85(0x21c)](_0x39e75a,_0x4c487f){const _0x42ec25=_0x22ed85,{id:_0x43352d}=_0x4c487f[_0x42ec25(0x1d6)],{appId:_0x275f89}=_0x39e75a,_0x100f8e={'title':_0x42ec25(0x20c),'userId':_0x43352d};let _0xca69dd=null;if(_0x275f89){_0xca69dd=await this[_0x42ec25(0x205)]['findOne']({'where':{'id':_0x275f89}});if(!_0xca69dd)throw new common_1[(_0x42ec25(0x1f3))](_0x42ec25(0x1e6),common_1[_0x42ec25(0x1ce)][_0x42ec25(0x1d1)]);else{const {status:_0x4d989d,name:_0x584c88,modelTypeId:_0x22ed8e}=_0xca69dd,_0x182422=await this[_0x42ec25(0x1df)][_0x42ec25(0x1f0)]({'where':{'userId':_0x43352d,'appId':_0x275f89,'isDelete':![]}});if(_0x182422>0x0)throw new common_1[(_0x42ec25(0x1f3))](_0x42ec25(0x1d5),common_1[_0x42ec25(0x1ce)][_0x42ec25(0x1d1)]);if(![0x1,0x3,0x4,0x5][_0x42ec25(0x20e)](_0x4d989d))throw new common_1[(_0x42ec25(0x1f3))](_0x42ec25(0x219),common_1[_0x42ec25(0x1ce)]['BAD_REQUEST']);_0x584c88&&(_0x100f8e[_0x42ec25(0x202)]=_0x584c88),_0x275f89&&(_0x100f8e[_0x42ec25(0x204)]=_0x275f89);}}const _0x1143e3=await this['modelsService'][_0x42ec25(0x1e8)](_0xca69dd);if(!_0x1143e3)throw new common_1[(_0x42ec25(0x1f3))](_0x42ec25(0x207),common_1[_0x42ec25(0x1ce)][_0x42ec25(0x1d1)]);return _0x275f89&&(_0x1143e3[_0x42ec25(0x204)]=_0x275f89),await this[_0x42ec25(0x1df)]['save'](Object[_0x42ec25(0x1f8)](Object[_0x42ec25(0x1f8)]({},_0x100f8e),{'config':JSON['stringify'](_0x1143e3)}));}async['query'](_0x153d0b){const _0x2a225b=_0x22ed85;try{const {id:_0x2630ec}=_0x153d0b[_0x2a225b(0x1d6)],_0x1c2f13={'userId':_0x2630ec,'isDelete':![]},_0x4d02c8=await this[_0x2a225b(0x1df)][_0x2a225b(0x1dc)]({'where':_0x1c2f13,'order':{'isSticky':_0x2a225b(0x1d9),'id':'DESC'}}),_0x13fa12=_0x4d02c8[_0x2a225b(0x20f)](_0x3ae05c=>_0x3ae05c[_0x2a225b(0x204)])[_0x2a225b(0x1fa)](_0xfddbf5=>_0xfddbf5[_0x2a225b(0x204)]),_0x305d8a=await this[_0x2a225b(0x205)][_0x2a225b(0x1dc)]({'where':{'id':(0x0,typeorm_2['In'])(_0x13fa12)}});return _0x4d02c8['map'](_0xb3f5ea=>{const _0x554e8c=_0x2a225b,_0x1dd97a=_0x305d8a['find'](_0x39ab56=>_0x39ab56['id']===_0xb3f5ea[_0x554e8c(0x204)]);return _0xb3f5ea['appLogo']=(_0x1dd97a===null||_0x1dd97a===void 0x0?void 0x0:_0x1dd97a[_0x554e8c(0x1dd)])||(_0x1dd97a===null||_0x1dd97a===void 0x0?void 0x0:_0x1dd97a[_0x554e8c(0x216)]),_0xb3f5ea[_0x554e8c(0x1ef)]=_0x1dd97a===null||_0x1dd97a===void 0x0?void 0x0:_0x1dd97a['des'],_0xb3f5ea['isGpts']=_0x1dd97a===null||_0x1dd97a===void 0x0?void 0x0:_0x1dd97a[_0x554e8c(0x200)],_0xb3f5ea;});}catch(_0x2b3cd8){console[_0x2a225b(0x21b)](_0x2a225b(0x1de),_0x2b3cd8);}}async[_0x22ed85(0x1d8)](_0x555342,_0x4de212){const _0x52fcfe=_0x22ed85;var _0x451106;const {title:_0x4f7896,isSticky:_0x1655e1,groupId:_0x3f944c,config:_0x27ebd5,pluginId:_0x26d937,imgUrl:_0x4d067f,documentUrl:_0x547164}=_0x555342,{id:_0x125b43}=_0x4de212['user'],_0x581500=await this[_0x52fcfe(0x1df)][_0x52fcfe(0x213)]({'where':{'id':_0x3f944c,'userId':_0x125b43}});if(!_0x581500)throw new common_1[(_0x52fcfe(0x1f3))](_0x52fcfe(0x1d0),common_1[_0x52fcfe(0x1ce)]['BAD_REQUEST']);const {appId:_0x3b35e5}=_0x581500;if(_0x3b35e5&&!_0x4f7896)try{const _0x156e85=JSON[_0x52fcfe(0x1db)](_0x27ebd5);if(Number(_0x156e85['keyType'])!==0x1)throw new common_1['HttpException']('应用对话名称不能修改哟！',common_1[_0x52fcfe(0x1ce)][_0x52fcfe(0x1d1)]);}catch(_0x4bc72d){}try{const _0x4df8f7={};_0x4f7896&&(_0x4df8f7[_0x52fcfe(0x202)]=_0x4f7896),typeof _0x1655e1!=='undefined'&&(_0x4df8f7['isSticky']=_0x1655e1),_0x27ebd5&&(_0x4df8f7[_0x52fcfe(0x1eb)]=_0x27ebd5),_0x4d067f&&(_0x4df8f7[_0x52fcfe(0x1f1)]=_0x4d067f),_0x547164&&(_0x4df8f7['documentUrl']=_0x547164);let _0x2bcc28={};if(typeof _0x26d937===_0x52fcfe(0x1cd)){_0x4df8f7['pluginId']=_0x26d937,_0x4df8f7[_0x52fcfe(0x1f1)]=null,_0x4df8f7[_0x52fcfe(0x21f)]=null;const _0x2b276a=await this[_0x52fcfe(0x1df)]['findOne']({'where':{'id':_0x3f944c}}),_0x1e78e6=this['parseJson'](_0x2b276a[_0x52fcfe(0x1eb)]),_0x45368d=(_0x451106=plugin_1[_0x52fcfe(0x1e1)][_0x52fcfe(0x1dc)](_0x1ce21e=>_0x1ce21e['id']===_0x26d937))===null||_0x451106===void 0x0?void 0x0:_0x451106[_0x52fcfe(0x1e4)],_0x15f647=await this[_0x52fcfe(0x1f2)][_0x52fcfe(0x215)](_0x45368d);_0x1e78e6['modelTypeId']=_0x15f647,_0x2bcc28={'config':JSON[_0x52fcfe(0x20a)](_0x1e78e6)};}const _0x2127f5=await this[_0x52fcfe(0x1df)][_0x52fcfe(0x1d8)]({'id':_0x3f944c},Object['assign'](Object['assign']({},_0x4df8f7),_0x2bcc28));if(_0x2127f5[_0x52fcfe(0x1ea)])return!![];else throw new common_1[(_0x52fcfe(0x1f3))](_0x52fcfe(0x1d4),common_1[_0x52fcfe(0x1ce)]['BAD_REQUEST']);}catch(_0x1a6668){console[_0x52fcfe(0x21b)](_0x52fcfe(0x1de),_0x1a6668);throw new common_1[(_0x52fcfe(0x1f3))](_0x52fcfe(0x1d4),common_1[_0x52fcfe(0x1ce)]['BAD_REQUEST']);}}['parseJson'](_0x28a29e){let _0x177ca6={};try{_0x177ca6=JSON['parse'](_0x28a29e);}catch(_0x110ca8){_0x177ca6={};}return _0x177ca6;}async['del'](_0x24e04d,_0x174b31){const _0x27c3d3=_0x22ed85,{groupId:_0x44f062}=_0x24e04d,{id:_0x1d4bbe}=_0x174b31['user'],_0x109232=await this[_0x27c3d3(0x1df)]['findOne']({'where':{'id':_0x44f062,'userId':_0x1d4bbe}});if(!_0x109232)throw new common_1[(_0x27c3d3(0x1f3))](_0x27c3d3(0x1ec),common_1[_0x27c3d3(0x1ce)]['BAD_REQUEST']);const _0x186a80=await this[_0x27c3d3(0x1df)][_0x27c3d3(0x1d8)]({'id':_0x44f062},{'isDelete':!![]});if(_0x186a80['affected'])return _0x27c3d3(0x1e2);else throw new common_1[(_0x27c3d3(0x1f3))](_0x27c3d3(0x212),common_1[_0x27c3d3(0x1ce)]['BAD_REQUEST']);}async['delAll'](_0x38fb99,_0x535df0){const _0x5ab055=_0x22ed85,_0x2b9079=(_0x535df0===null||_0x535df0===void 0x0?void 0x0:_0x535df0[_0x5ab055(0x201)])===_0x5ab055(0x1e3),{id:_0x2e87e8}=_0x38fb99[_0x5ab055(0x1d6)],_0x33c78f={'userId':_0x2e87e8,'isSticky':![],'isDelete':![]};_0x2b9079&&(_0x33c78f[_0x5ab055(0x204)]=(0x0,typeorm_2[_0x5ab055(0x1f7)])(0x0)),!_0x2b9079&&(_0x33c78f[_0x5ab055(0x204)]=(0x0,typeorm_2[_0x5ab055(0x1cf)])());const _0x50f3ef=await this[_0x5ab055(0x1df)][_0x5ab055(0x1d8)](_0x33c78f,{'isDelete':!![]});if(_0x50f3ef[_0x5ab055(0x1ea)])return _0x5ab055(0x1e2);else throw new common_1[(_0x5ab055(0x1f3))]('删除失败！',common_1[_0x5ab055(0x1ce)]['BAD_REQUEST']);}async['getGroupInfoFromId'](_0x4018f5){const _0x31e418=_0x22ed85;if(!_0x4018f5)return;return await this[_0x31e418(0x1df)][_0x31e418(0x213)]({'where':{'id':_0x4018f5}});}};ChatGroupService=__decorate([(0x0,common_1[_0x22ed85(0x1cc)])(),__param(0x0,(0x0,typeorm_1[_0x22ed85(0x1e5)])(chatGroup_entity_1[_0x22ed85(0x20d)])),__param(0x1,(0x0,typeorm_1[_0x22ed85(0x1e5)])(app_entity_1[_0x22ed85(0x217)])),__metadata('design:paramtypes',[typeorm_2[_0x22ed85(0x209)],typeorm_2[_0x22ed85(0x209)],models_service_1[_0x22ed85(0x1da)]])],ChatGroupService),exports[_0x22ed85(0x214)]=ChatGroupService;