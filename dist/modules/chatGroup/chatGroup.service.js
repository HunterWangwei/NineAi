'use strict';const _0x2456e2=_0xcd43;function _0x1d57(){const _0x4baa39=['新对话','modelTypeId','75OVdtnt','pluginModelName','undefined','@nestjs/common','imgUrl','BAD_REQUEST','91kDgBBU','metadata','defineProperty','376188LVlaxu','length','coverImg','AppEntity','1370rcoyIS','isSticky','删除失败！','number','当前应用已经开启了一个对话无需新建了！','../app/app.entity','IsNull','find','delAll','isGpts','@nestjs/typeorm','config','findOne','HttpStatus','title','decorate','object','HttpException','documentUrl','parseJson','parse','query','__param','DESC','非法操作、您在使用一个未启用的应用！','gptsImg','__metadata','../models/models.service','6300VFlfaq','72RSVchM','filter','update','stringify','125344LGCsNE','user','function','create','chatGroupEntity','Injectable','985uAuRnn','删除成功','./chatGroup.entity','assign','del','InjectRepository','count','getGroupInfoFromId','design:paramtypes','includes','4003615aszPgp','appLogo','affected','ChatGroupEntity','MoreThan','getOwnPropertyDescriptor','appId','51286MAccZQ','PluginDefaultList','Repository','modelsService','__decorate','typeorm','des','map','32660DoqxoV','更新对话失败！','getModelTypeIdFromModelName','ModelsService','__esModule','appEntity','应用对话名称不能修改哟！','type','非法操作、您在删除一个非法资源！','log','ChatGroupService'];_0x1d57=function(){return _0x4baa39;};return _0x1d57();}function _0xcd43(_0xfe51fa,_0x34b5a8){const _0x1d57f5=_0x1d57();return _0xcd43=function(_0xcd4307,_0x239548){_0xcd4307=_0xcd4307-0x18f;let _0x4ac2d0=_0x1d57f5[_0xcd4307];return _0x4ac2d0;},_0xcd43(_0xfe51fa,_0x34b5a8);}(function(_0x1629ff,_0x50d5b4){const _0x3b894d=_0xcd43,_0x3f1b17=_0x1629ff();while(!![]){try{const _0x26684c=parseInt(_0x3b894d(0x192))/0x1+-parseInt(_0x3b894d(0x1b0))/0x2+-parseInt(_0x3b894d(0x1a7))/0x3*(parseInt(_0x3b894d(0x19a))/0x4)+-parseInt(_0x3b894d(0x1db))/0x5*(-parseInt(_0x3b894d(0x1d1))/0x6)+-parseInt(_0x3b894d(0x1ad))/0x7*(-parseInt(_0x3b894d(0x1d5))/0x8)+-parseInt(_0x3b894d(0x1d0))/0x9*(parseInt(_0x3b894d(0x1b4))/0xa)+parseInt(_0x3b894d(0x1e5))/0xb;if(_0x26684c===_0x50d5b4)break;else _0x3f1b17['push'](_0x3f1b17['shift']());}catch(_0x230339){_0x3f1b17['push'](_0x3f1b17['shift']());}}}(_0x1d57,0x2083c));var __decorate=this&&this[_0x2456e2(0x196)]||function(_0x5a5f83,_0x3ca937,_0x39b32a,_0x2ef2b0){const _0x1cf18b=_0x2456e2;var _0x44ae98=arguments[_0x1cf18b(0x1b1)],_0x39c64c=_0x44ae98<0x3?_0x3ca937:_0x2ef2b0===null?_0x2ef2b0=Object[_0x1cf18b(0x190)](_0x3ca937,_0x39b32a):_0x2ef2b0,_0x5bcbe6;if(typeof Reflect===_0x1cf18b(0x1c4)&&typeof Reflect[_0x1cf18b(0x1c3)]===_0x1cf18b(0x1d7))_0x39c64c=Reflect[_0x1cf18b(0x1c3)](_0x5a5f83,_0x3ca937,_0x39b32a,_0x2ef2b0);else{for(var _0x429b48=_0x5a5f83['length']-0x1;_0x429b48>=0x0;_0x429b48--)if(_0x5bcbe6=_0x5a5f83[_0x429b48])_0x39c64c=(_0x44ae98<0x3?_0x5bcbe6(_0x39c64c):_0x44ae98>0x3?_0x5bcbe6(_0x3ca937,_0x39b32a,_0x39c64c):_0x5bcbe6(_0x3ca937,_0x39b32a))||_0x39c64c;}return _0x44ae98>0x3&&_0x39c64c&&Object['defineProperty'](_0x3ca937,_0x39b32a,_0x39c64c),_0x39c64c;},__metadata=this&&this[_0x2456e2(0x1ce)]||function(_0x137609,_0x7ddae3){const _0x439612=_0x2456e2;if(typeof Reflect==='object'&&typeof Reflect[_0x439612(0x1ae)]===_0x439612(0x1d7))return Reflect[_0x439612(0x1ae)](_0x137609,_0x7ddae3);},__param=this&&this[_0x2456e2(0x1ca)]||function(_0x554238,_0x38c747){return function(_0x3c4044,_0x22b0b4){_0x38c747(_0x3c4044,_0x22b0b4,_0x554238);};};Object[_0x2456e2(0x1af)](exports,_0x2456e2(0x19e),{'value':!![]}),exports[_0x2456e2(0x1a4)]=void 0x0;const common_1=require(_0x2456e2(0x1aa)),chatGroup_entity_1=require(_0x2456e2(0x1dd)),typeorm_1=require(_0x2456e2(0x1be)),typeorm_2=require(_0x2456e2(0x197)),app_entity_1=require(_0x2456e2(0x1b9)),models_service_1=require(_0x2456e2(0x1cf)),plugin_1=require('../../common/constants/plugin');let ChatGroupService=class ChatGroupService{constructor(_0x1a8582,_0x15c134,_0x2a8aea){const _0x288f9a=_0x2456e2;this[_0x288f9a(0x1d9)]=_0x1a8582,this['appEntity']=_0x15c134,this['modelsService']=_0x2a8aea;}async[_0x2456e2(0x1d8)](_0x348848,_0x170602){const _0xdd4b28=_0x2456e2,{id:_0xbb1f64}=_0x170602[_0xdd4b28(0x1d6)],{appId:_0x29ee8f}=_0x348848,_0x4917c2={'title':_0xdd4b28(0x1a5),'userId':_0xbb1f64};let _0x304b40=null;if(_0x29ee8f){_0x304b40=await this[_0xdd4b28(0x19f)][_0xdd4b28(0x1c0)]({'where':{'id':_0x29ee8f}});if(!_0x304b40)throw new common_1[(_0xdd4b28(0x1c5))]('非法操作、您在使用一个不存在的应用！',common_1[_0xdd4b28(0x1c1)][_0xdd4b28(0x1ac)]);else{const {status:_0x4670d3,name:_0x247a2d,modelTypeId:_0x3c0c36}=_0x304b40,_0x3d3366=await this[_0xdd4b28(0x1d9)][_0xdd4b28(0x1e1)]({'where':{'userId':_0xbb1f64,'appId':_0x29ee8f,'isDelete':![]}});if(_0x3d3366>0x0)throw new common_1['HttpException'](_0xdd4b28(0x1b8),common_1[_0xdd4b28(0x1c1)][_0xdd4b28(0x1ac)]);if(![0x1,0x3,0x4,0x5][_0xdd4b28(0x1e4)](_0x4670d3))throw new common_1[(_0xdd4b28(0x1c5))](_0xdd4b28(0x1cc),common_1['HttpStatus']['BAD_REQUEST']);_0x247a2d&&(_0x4917c2[_0xdd4b28(0x1c2)]=_0x247a2d),_0x29ee8f&&(_0x4917c2['appId']=_0x29ee8f);}}const _0x49d7bf=await this['modelsService']['getBaseConfig'](_0x304b40);if(!_0x49d7bf)throw new common_1[(_0xdd4b28(0x1c5))]('管理员未配置此任务AI模型、请先联系管理员开通配置！',common_1[_0xdd4b28(0x1c1)]['BAD_REQUEST']);return _0x29ee8f&&(_0x49d7bf[_0xdd4b28(0x191)]=_0x29ee8f),await this[_0xdd4b28(0x1d9)]['save'](Object['assign'](Object['assign']({},_0x4917c2),{'config':JSON[_0xdd4b28(0x1d4)](_0x49d7bf)}));}async[_0x2456e2(0x1c9)](_0x2de60c){const _0x1b60fd=_0x2456e2;try{const {id:_0x47154a}=_0x2de60c[_0x1b60fd(0x1d6)],_0x33e184={'userId':_0x47154a,'isDelete':![]},_0x1aa3e6=await this[_0x1b60fd(0x1d9)][_0x1b60fd(0x1bb)]({'where':_0x33e184,'order':{'isSticky':_0x1b60fd(0x1cb),'id':_0x1b60fd(0x1cb)}}),_0x121378=_0x1aa3e6[_0x1b60fd(0x1d2)](_0x5105f0=>_0x5105f0[_0x1b60fd(0x191)])[_0x1b60fd(0x199)](_0x3d516b=>_0x3d516b[_0x1b60fd(0x191)]),_0x20a5f6=await this['appEntity'][_0x1b60fd(0x1bb)]({'where':{'id':(0x0,typeorm_2['In'])(_0x121378)}});return _0x1aa3e6[_0x1b60fd(0x199)](_0x329fa7=>{const _0x5c8887=_0x1b60fd,_0x3c3eb4=_0x20a5f6[_0x5c8887(0x1bb)](_0x4acc4d=>_0x4acc4d['id']===_0x329fa7[_0x5c8887(0x191)]);return _0x329fa7[_0x5c8887(0x1e6)]=(_0x3c3eb4===null||_0x3c3eb4===void 0x0?void 0x0:_0x3c3eb4[_0x5c8887(0x1b2)])||(_0x3c3eb4===null||_0x3c3eb4===void 0x0?void 0x0:_0x3c3eb4[_0x5c8887(0x1cd)]),_0x329fa7[_0x5c8887(0x198)]=_0x3c3eb4===null||_0x3c3eb4===void 0x0?void 0x0:_0x3c3eb4[_0x5c8887(0x198)],_0x329fa7[_0x5c8887(0x1bd)]=_0x3c3eb4===null||_0x3c3eb4===void 0x0?void 0x0:_0x3c3eb4[_0x5c8887(0x1bd)],_0x329fa7;});}catch(_0x3a3647){console[_0x1b60fd(0x1a3)]('error:\x20',_0x3a3647);}}async['update'](_0x1b127c,_0x743595){const _0x5031d4=_0x2456e2;var _0x3d41f2;const {title:_0x1fb2fd,isSticky:_0x57dca8,groupId:_0x2a691c,config:_0x465e79,pluginId:_0x3260c3,imgUrl:_0x35b735,documentUrl:_0x510d43}=_0x1b127c,{id:_0x2ae3f4}=_0x743595[_0x5031d4(0x1d6)],_0x5e3d11=await this['chatGroupEntity']['findOne']({'where':{'id':_0x2a691c,'userId':_0x2ae3f4}});if(!_0x5e3d11)throw new common_1[(_0x5031d4(0x1c5))]('请先选择一个对话或者新加一个对话再操作！',common_1[_0x5031d4(0x1c1)][_0x5031d4(0x1ac)]);const {appId:_0xb5b8f3}=_0x5e3d11;if(_0xb5b8f3&&!_0x1fb2fd)try{const _0xf3ad1e=JSON[_0x5031d4(0x1c8)](_0x465e79);if(Number(_0xf3ad1e['keyType'])!==0x1)throw new common_1[(_0x5031d4(0x1c5))](_0x5031d4(0x1a0),common_1[_0x5031d4(0x1c1)][_0x5031d4(0x1ac)]);}catch(_0x12d9be){}try{const _0x7ceaa4={};_0x1fb2fd&&(_0x7ceaa4[_0x5031d4(0x1c2)]=_0x1fb2fd),typeof _0x57dca8!==_0x5031d4(0x1a9)&&(_0x7ceaa4[_0x5031d4(0x1b5)]=_0x57dca8),_0x465e79&&(_0x7ceaa4['config']=_0x465e79),_0x35b735&&(_0x7ceaa4[_0x5031d4(0x1ab)]=_0x35b735),_0x510d43&&(_0x7ceaa4[_0x5031d4(0x1c6)]=_0x510d43);let _0x26fa2c={'config':_0x465e79};if(typeof _0x3260c3===_0x5031d4(0x1b7)&&_0x3260c3>-0x1){_0x7ceaa4['pluginId']=_0x3260c3,_0x7ceaa4[_0x5031d4(0x1ab)]=null,_0x7ceaa4[_0x5031d4(0x1c6)]=null;const _0x3053ca=await this[_0x5031d4(0x1d9)]['findOne']({'where':{'id':_0x2a691c}}),_0xad0825=this[_0x5031d4(0x1c7)](_0x3053ca[_0x5031d4(0x1bf)]),_0x41cab7=(_0x3d41f2=plugin_1[_0x5031d4(0x193)][_0x5031d4(0x1bb)](_0x4ab4af=>_0x4ab4af['id']===_0x3260c3))===null||_0x3d41f2===void 0x0?void 0x0:_0x3d41f2[_0x5031d4(0x1a8)],_0x209481=await this[_0x5031d4(0x195)][_0x5031d4(0x19c)](_0x41cab7);_0xad0825[_0x5031d4(0x1a6)]=_0x209481,_0x26fa2c={'config':JSON[_0x5031d4(0x1d4)](_0xad0825)};}const _0x5f5589=await this[_0x5031d4(0x1d9)][_0x5031d4(0x1d3)]({'id':_0x2a691c},Object[_0x5031d4(0x1de)](Object[_0x5031d4(0x1de)]({},_0x7ceaa4),_0x26fa2c));if(_0x5f5589[_0x5031d4(0x1e7)])return!![];else throw new common_1[(_0x5031d4(0x1c5))](_0x5031d4(0x19b),common_1[_0x5031d4(0x1c1)][_0x5031d4(0x1ac)]);}catch(_0x209101){console[_0x5031d4(0x1a3)]('error:\x20',_0x209101);throw new common_1[(_0x5031d4(0x1c5))]('更新对话失败！',common_1[_0x5031d4(0x1c1)]['BAD_REQUEST']);}}['parseJson'](_0x542a22){const _0xa41b83=_0x2456e2;let _0x3d0abf={};try{_0x3d0abf=JSON[_0xa41b83(0x1c8)](_0x542a22);}catch(_0x5a0f27){_0x3d0abf={};}return _0x3d0abf;}async[_0x2456e2(0x1df)](_0x261564,_0x230539){const _0x31342d=_0x2456e2,{groupId:_0x1fd826}=_0x261564,{id:_0x5123a4}=_0x230539['user'],_0x2e2f27=await this['chatGroupEntity'][_0x31342d(0x1c0)]({'where':{'id':_0x1fd826,'userId':_0x5123a4}});if(!_0x2e2f27)throw new common_1[(_0x31342d(0x1c5))](_0x31342d(0x1a2),common_1['HttpStatus']['BAD_REQUEST']);const _0x4a29e0=await this[_0x31342d(0x1d9)][_0x31342d(0x1d3)]({'id':_0x1fd826},{'isDelete':!![]});if(_0x4a29e0[_0x31342d(0x1e7)])return _0x31342d(0x1dc);else throw new common_1[(_0x31342d(0x1c5))](_0x31342d(0x1b6),common_1['HttpStatus'][_0x31342d(0x1ac)]);}async[_0x2456e2(0x1bc)](_0x1ee370,_0x2a5720){const _0x5b32b3=_0x2456e2,_0x5dcbca=(_0x2a5720===null||_0x2a5720===void 0x0?void 0x0:_0x2a5720[_0x5b32b3(0x1a1)])==='app',{id:_0x1da506}=_0x1ee370[_0x5b32b3(0x1d6)],_0x28f2a0={'userId':_0x1da506,'isSticky':![],'isDelete':![]};_0x5dcbca&&(_0x28f2a0[_0x5b32b3(0x191)]=(0x0,typeorm_2[_0x5b32b3(0x18f)])(0x0)),!_0x5dcbca&&(_0x28f2a0[_0x5b32b3(0x191)]=(0x0,typeorm_2[_0x5b32b3(0x1ba)])());const _0x2493a0=await this['chatGroupEntity'][_0x5b32b3(0x1d3)](_0x28f2a0,{'isDelete':!![]});if(_0x2493a0[_0x5b32b3(0x1e7)])return _0x5b32b3(0x1dc);else throw new common_1[(_0x5b32b3(0x1c5))](_0x5b32b3(0x1b6),common_1[_0x5b32b3(0x1c1)][_0x5b32b3(0x1ac)]);}async[_0x2456e2(0x1e2)](_0x5d7dcc){const _0x32226c=_0x2456e2;if(!_0x5d7dcc)return;return await this[_0x32226c(0x1d9)][_0x32226c(0x1c0)]({'where':{'id':_0x5d7dcc}});}};ChatGroupService=__decorate([(0x0,common_1[_0x2456e2(0x1da)])(),__param(0x0,(0x0,typeorm_1[_0x2456e2(0x1e0)])(chatGroup_entity_1[_0x2456e2(0x1e8)])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(app_entity_1[_0x2456e2(0x1b3)])),__metadata(_0x2456e2(0x1e3),[typeorm_2[_0x2456e2(0x194)],typeorm_2[_0x2456e2(0x194)],models_service_1[_0x2456e2(0x19d)]])],ChatGroupService),exports[_0x2456e2(0x1a4)]=ChatGroupService;