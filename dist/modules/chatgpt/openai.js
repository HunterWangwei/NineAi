'use strict';const _0xbbf723=_0x2d58;function _0x1505(){const _0x1c91c7=['2892490aUDHjE','@dqbd/tiktoken','15jFYxgz','usage','375380QAbJqt','net-','[DONE]','https://api.openai.com','getTokenCount','9vOtMoe','split','__esModule','trim','length','222527olQIEb','cl100k_base','event-stream','removeSpecialCharacters','preview','defineProperty','2067956kemuDY','choices','getFullUrl','axios','parse\x20Error','POST','data','model','Bearer\x20','options:\x20','content','parse','1237992kAXymN','496530TSPbrl','gpt-4','role','application/json','sendMessageFromOpenAi','log','stream','2CsUOIp','slice','detail','24aLpuFs','/v1/chat/completions','1068888OONMgD','../../common/utils','includes','toString','data:','replace','32k','text','delta','get_encoding'];_0x1505=function(){return _0x1c91c7;};return _0x1505();}(function(_0x14ecfe,_0x9ccca4){const _0x1bddfd=_0x2d58,_0x2e6472=_0x14ecfe();while(!![]){try{const _0x15d821=parseInt(_0x1bddfd(0x194))/0x1*(parseInt(_0x1bddfd(0x177))/0x2)+-parseInt(_0x1bddfd(0x17c))/0x3+parseInt(_0x1bddfd(0x18a))/0x4*(-parseInt(_0x1bddfd(0x188))/0x5)+parseInt(_0x1bddfd(0x1a7))/0x6+-parseInt(_0x1bddfd(0x1a6))/0x7*(-parseInt(_0x1bddfd(0x17a))/0x8)+-parseInt(_0x1bddfd(0x18f))/0x9*(-parseInt(_0x1bddfd(0x186))/0xa)+-parseInt(_0x1bddfd(0x19a))/0xb;if(_0x15d821===_0x9ccca4)break;else _0x2e6472['push'](_0x2e6472['shift']());}catch(_0x4ed719){_0x2e6472['push'](_0x2e6472['shift']());}}}(_0x1505,0x49108));Object[_0xbbf723(0x199)](exports,_0xbbf723(0x191),{'value':!![]}),exports[_0xbbf723(0x18e)]=exports[_0xbbf723(0x174)]=exports[_0xbbf723(0x19c)]=void 0x0;const axios_1=require(_0xbbf723(0x19d)),tiktoken_1=require(_0xbbf723(0x187)),utils_1=require(_0xbbf723(0x17d)),es=require(_0xbbf723(0x196)),tokenizer=(0x0,tiktoken_1[_0xbbf723(0x185)])(_0xbbf723(0x195));function getFullUrl(_0x59067a){const _0x4ebf64=_0xbbf723,_0x2a0721=_0x59067a['endsWith']('/')?_0x59067a[_0x4ebf64(0x178)](0x0,-0x1):_0x59067a,_0x3b66ea=_0x2a0721||_0x4ebf64(0x18d);return _0x3b66ea+_0x4ebf64(0x17b);}exports[_0xbbf723(0x19c)]=getFullUrl;function sendMessageFromOpenAi(_0x412dfa,_0xb59981){const _0x2eac7f=_0xbbf723;var _0x30863a;const {onProgress:_0x472e54,maxToken:_0x2f0b70,apiKey:_0x5b06e5,model:_0x35b673,temperature:temperature=0.95,proxyUrl:_0x1683e5,usingNetwork:usingNetwork=![],gptsId:_0x1ab30e}=_0xb59981,_0x271878={'method':_0x2eac7f(0x19f),'url':getFullUrl(_0x1683e5),'responseType':_0x2eac7f(0x176),'headers':{'Content-Type':_0x2eac7f(0x1aa),'Authorization':_0x2eac7f(0x1a2)+(0x0,utils_1[_0x2eac7f(0x197)])(_0x5b06e5)},'data':{'stream':!![],'temperature':temperature,'model':_0x35b673,'messages':_0x412dfa}};usingNetwork&&(_0x271878[_0x2eac7f(0x1a0)][_0x2eac7f(0x1a1)]=_0x2eac7f(0x18b)+_0x271878['data'][_0x2eac7f(0x1a1)]);_0x1ab30e&&(_0x271878[_0x2eac7f(0x1a0)][_0x2eac7f(0x1a1)]=_0x271878[_0x2eac7f(0x1a0)][_0x2eac7f(0x1a1)]+'-'+_0x1ab30e);console[_0x2eac7f(0x175)](_0x2eac7f(0x1a3),_0x271878);const _0xeeddd2=(_0x30863a=_0x412dfa[_0x412dfa[_0x2eac7f(0x193)]-0x1])===null||_0x30863a===void 0x0?void 0x0:_0x30863a[_0x2eac7f(0x1a4)];return new Promise(async(_0x30511e,_0x172dd6)=>{const _0x43e649=_0x2eac7f;try{const _0x22ac66=await(0x0,axios_1['default'])(_0x271878),_0x55f537=_0x22ac66[_0x43e649(0x1a0)],_0x485234={'text':''};_0x55f537['pipe'](es[_0x43e649(0x190)]('\x0a'))['on'](_0x43e649(0x1a0),_0x4e0eaa=>{const _0x29987c=_0x43e649;var _0x226a04;let _0x3f6204=_0x4e0eaa?[_0x4e0eaa[_0x29987c(0x17f)]()]:[];if(_0x3f6204['length']&&_0x3f6204[0x0][_0x29987c(0x17e)](_0x29987c(0x18c)))_0x3f6204=[];for(const _0x513d42 of _0x3f6204){const _0x61dbe3=_0x513d42[_0x29987c(0x181)](_0x29987c(0x180),'');let _0x30e5c8=![];try{_0x30e5c8=JSON['parse'](_0x61dbe3)[_0x29987c(0x19b)][0x0]['finish_reason']==='stop';}catch(_0x548ed8){_0x30e5c8=![];}if(_0x61dbe3===_0x29987c(0x18c)||_0x30e5c8)return _0x485234[_0x29987c(0x183)]=_0x485234[_0x29987c(0x183)][_0x29987c(0x192)](),_0x485234;try{const _0xf82d44=JSON[_0x29987c(0x1a5)](_0x61dbe3);_0xf82d44['id']&&(_0x485234['id']=_0xf82d44['id']);if((_0x226a04=_0xf82d44['choices'])===null||_0x226a04===void 0x0?void 0x0:_0x226a04[_0x29987c(0x193)]){const _0x56311c=_0xf82d44[_0x29987c(0x19b)][0x0][_0x29987c(0x184)];_0x485234[_0x29987c(0x184)]=_0x56311c['content'];if(_0x56311c===null||_0x56311c===void 0x0?void 0x0:_0x56311c[_0x29987c(0x1a4)])_0x485234[_0x29987c(0x183)]+=_0x56311c[_0x29987c(0x1a4)];_0x56311c[_0x29987c(0x1a9)]&&(_0x485234[_0x29987c(0x1a9)]=_0x56311c[_0x29987c(0x1a9)]),_0x485234[_0x29987c(0x179)]=_0xf82d44;}_0x472e54&&_0x472e54({'text':_0x485234[_0x29987c(0x183)]});}catch(_0x57ecd5){console[_0x29987c(0x175)](_0x29987c(0x19e),_0x61dbe3);}}}),_0x55f537['on']('end',()=>{const _0xee377f=_0x43e649;if(_0x485234['detail']&&_0x485234[_0xee377f(0x183)]){const _0x3ebd31=getTokenCount(_0xeeddd2),_0x808ed=getTokenCount(_0x485234['text']);_0x485234['detail'][_0xee377f(0x189)]={'prompt_tokens':_0x3ebd31,'completion_tokens':_0x808ed,'total_tokens':_0x3ebd31+_0x808ed,'estimated':!![]};}return _0x30511e(_0x485234);});}catch(_0x474476){_0x172dd6(_0x474476);}});}exports['sendMessageFromOpenAi']=sendMessageFromOpenAi;function getTokenCount(_0x2d640d){const _0x37ed73=_0xbbf723;if(!_0x2d640d)return 0x0;return _0x2d640d=_0x2d640d[_0x37ed73(0x17f)]()[_0x37ed73(0x181)](/<\|endoftext\|>/g,''),tokenizer['encode'](_0x2d640d)[_0x37ed73(0x193)];}exports['getTokenCount']=getTokenCount;function _0x2d58(_0x395a42,_0x3b3495){const _0x150581=_0x1505();return _0x2d58=function(_0x2d58bb,_0x3d4baf){_0x2d58bb=_0x2d58bb-0x174;let _0x5ddd87=_0x150581[_0x2d58bb];return _0x5ddd87;},_0x2d58(_0x395a42,_0x3b3495);}function compilerToken(_0x34da49,_0x8ed8ee){const _0x364bba=_0xbbf723;let _0x24c6b1=0x0;return _0x34da49[_0x364bba(0x17e)](3.5)&&(_0x24c6b1=_0x8ed8ee>0x1000?0x1000:_0x8ed8ee),_0x34da49['includes'](_0x364bba(0x1a8))&&(_0x24c6b1=_0x8ed8ee>0x2000?0x2000:_0x8ed8ee),_0x34da49['includes'](_0x364bba(0x198))&&(_0x24c6b1=_0x8ed8ee>0x1000?0x1000:_0x8ed8ee),_0x34da49[_0x364bba(0x17e)](_0x364bba(0x182))&&(_0x24c6b1=_0x8ed8ee>0x8000?0x8000:_0x8ed8ee),_0x24c6b1;}