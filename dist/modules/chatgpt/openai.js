'use strict';function _0x5487(_0x53ae64,_0x2f1668){const _0x2776cd=_0x2776();return _0x5487=function(_0x54874f,_0x4a5a46){_0x54874f=_0x54874f-0x137;let _0x320e16=_0x2776cd[_0x54874f];return _0x320e16;},_0x5487(_0x53ae64,_0x2f1668);}const _0x2674ce=_0x5487;(function(_0x3298a2,_0x5a2811){const _0xc9df28=_0x5487,_0x5c801b=_0x3298a2();while(!![]){try{const _0x4dd160=-parseInt(_0xc9df28(0x14f))/0x1+-parseInt(_0xc9df28(0x151))/0x2+parseInt(_0xc9df28(0x147))/0x3*(-parseInt(_0xc9df28(0x143))/0x4)+parseInt(_0xc9df28(0x169))/0x5*(-parseInt(_0xc9df28(0x14c))/0x6)+-parseInt(_0xc9df28(0x163))/0x7*(parseInt(_0xc9df28(0x149))/0x8)+parseInt(_0xc9df28(0x13d))/0x9*(-parseInt(_0xc9df28(0x145))/0xa)+parseInt(_0xc9df28(0x146))/0xb*(parseInt(_0xc9df28(0x164))/0xc);if(_0x4dd160===_0x5a2811)break;else _0x5c801b['push'](_0x5c801b['shift']());}catch(_0x2f99c2){_0x5c801b['push'](_0x5c801b['shift']());}}}(_0x2776,0x6d76b));Object[_0x2674ce(0x140)](exports,_0x2674ce(0x144),{'value':!![]}),exports[_0x2674ce(0x13f)]=exports['sendMessageFromOpenAi']=exports['getFullUrl']=void 0x0;const axios_1=require(_0x2674ce(0x13b)),tiktoken_1=require('@dqbd/tiktoken'),utils_1=require(_0x2674ce(0x142)),es=require(_0x2674ce(0x14b)),tokenizer=(0x0,tiktoken_1[_0x2674ce(0x16d)])(_0x2674ce(0x157));function getFullUrl(_0x20f8b2){const _0x86c70d=_0x2674ce,_0x35487b=_0x20f8b2[_0x86c70d(0x159)]('/')?_0x20f8b2[_0x86c70d(0x137)](0x0,-0x1):_0x20f8b2,_0x5ed2a0=_0x35487b||_0x86c70d(0x16c);return _0x5ed2a0+_0x86c70d(0x16f);}exports[_0x2674ce(0x141)]=getFullUrl;function sendMessageFromOpenAi(_0x42c564,_0xab6584){const _0x36ff44=_0x2674ce;var _0x514129;const {onProgress:_0x15081c,maxToken:_0x1f8ab7,apiKey:_0x58b171,model:_0x278d11,temperature:temperature=0.95,proxyUrl:_0x25af21,usingNetwork:usingNetwork=![],gptsId:_0x55b459}=_0xab6584,_0x2dd2f0={'method':_0x36ff44(0x160),'url':getFullUrl(_0x25af21),'responseType':'stream','headers':{'Content-Type':_0x36ff44(0x13a),'Authorization':_0x36ff44(0x16e)+(0x0,utils_1[_0x36ff44(0x138)])(_0x58b171)},'data':{'max_tokens':_0x1f8ab7,'stream':!![],'temperature':temperature,'model':_0x278d11,'messages':_0x42c564}};usingNetwork&&(_0x2dd2f0[_0x36ff44(0x148)]['model']=_0x36ff44(0x14e)+_0x2dd2f0['data'][_0x36ff44(0x158)]);_0x55b459&&(_0x2dd2f0[_0x36ff44(0x148)][_0x36ff44(0x158)]=_0x2dd2f0['data']['model']+'-'+_0x55b459);const _0x30eb42=(_0x514129=_0x42c564[_0x42c564[_0x36ff44(0x13e)]-0x1])===null||_0x514129===void 0x0?void 0x0:_0x514129[_0x36ff44(0x14d)];return new Promise(async(_0x1ee414,_0x303077)=>{const _0x1015d2=_0x36ff44;try{const _0x18f059=await(0x0,axios_1[_0x1015d2(0x15c)])(_0x2dd2f0),_0x404f63=_0x18f059[_0x1015d2(0x148)],_0x2d0ed5={'text':''};_0x404f63[_0x1015d2(0x15e)](es[_0x1015d2(0x162)]('\x0a'))['on'](_0x1015d2(0x148),_0x169407=>{const _0x443674=_0x1015d2;var _0x167741;let _0x45617d=_0x169407?[_0x169407[_0x443674(0x153)]()]:[];if(_0x45617d[_0x443674(0x13e)]&&_0x45617d[0x0][_0x443674(0x152)](_0x443674(0x167)))_0x45617d=[];for(const _0x1bb58f of _0x45617d){const _0x308a95=_0x1bb58f[_0x443674(0x166)](_0x443674(0x165),'');let _0x5d44e6=![];try{_0x5d44e6=JSON['parse'](_0x308a95)[_0x443674(0x139)][0x0]['finish_reason']===_0x443674(0x16a);}catch(_0x2b483c){_0x5d44e6=![];}if(_0x308a95===_0x443674(0x167)||_0x5d44e6)return _0x2d0ed5['text']=_0x2d0ed5[_0x443674(0x14a)][_0x443674(0x161)](),_0x2d0ed5;try{const _0x122469=JSON[_0x443674(0x15f)](_0x308a95);_0x122469['id']&&(_0x2d0ed5['id']=_0x122469['id']);if((_0x167741=_0x122469[_0x443674(0x139)])===null||_0x167741===void 0x0?void 0x0:_0x167741[_0x443674(0x13e)]){const _0x58503=_0x122469['choices'][0x0][_0x443674(0x150)];_0x2d0ed5[_0x443674(0x150)]=_0x58503[_0x443674(0x14d)];if(_0x58503===null||_0x58503===void 0x0?void 0x0:_0x58503[_0x443674(0x14d)])_0x2d0ed5[_0x443674(0x14a)]+=_0x58503['content'];_0x58503[_0x443674(0x155)]&&(_0x2d0ed5['role']=_0x58503['role']),_0x2d0ed5['detail']=_0x122469;}_0x15081c&&_0x15081c({'text':_0x2d0ed5[_0x443674(0x14a)]});}catch(_0x487009){console[_0x443674(0x13c)](_0x443674(0x156),_0x308a95);}}}),_0x404f63['on'](_0x1015d2(0x15d),()=>{const _0x190233=_0x1015d2;if(_0x2d0ed5[_0x190233(0x154)]&&_0x2d0ed5[_0x190233(0x14a)]){const _0x5f4972=getTokenCount(_0x30eb42),_0x4dc41e=getTokenCount(_0x2d0ed5['text']);_0x2d0ed5[_0x190233(0x154)][_0x190233(0x15a)]={'prompt_tokens':_0x5f4972,'completion_tokens':_0x4dc41e,'total_tokens':_0x5f4972+_0x4dc41e,'estimated':!![]};}return _0x1ee414(_0x2d0ed5);});}catch(_0x441755){_0x303077(_0x441755);}});}function _0x2776(){const _0x2ef68d=['get_encoding','Bearer\x20','/v1/chat/completions','slice','removeSpecialCharacters','choices','application/json','axios','log','4923IUvxQD','length','getTokenCount','defineProperty','getFullUrl','../../common/utils','8JJLLlx','__esModule','650TIWqHv','143pSiPyS','110886KrFDJr','data','1302328PrxUUO','text','event-stream','18INZDcX','content','net-','150292heSYsY','delta','1500226vfDUyh','includes','toString','detail','role','parse\x20Error','cl100k_base','model','endsWith','usage','encode','default','end','pipe','parse','POST','trim','split','7cIdCDS','2046924OdGDQJ','data:','replace','[DONE]','gpt-4','994105xpdfYk','stop','32k','https://api.openai.com'];_0x2776=function(){return _0x2ef68d;};return _0x2776();}exports['sendMessageFromOpenAi']=sendMessageFromOpenAi;function getTokenCount(_0x207e48){const _0x1a2c61=_0x2674ce;if(!_0x207e48)return 0x0;return _0x207e48=_0x207e48[_0x1a2c61(0x153)]()[_0x1a2c61(0x166)](/<\|endoftext\|>/g,''),tokenizer[_0x1a2c61(0x15b)](_0x207e48)[_0x1a2c61(0x13e)];}exports[_0x2674ce(0x13f)]=getTokenCount;function compilerToken(_0x5ad033,_0x56a7e8){const _0x4bc148=_0x2674ce;let _0x330901=0x0;return _0x5ad033['includes'](3.5)&&(_0x330901=_0x56a7e8>0x1000?0x1000:_0x56a7e8),_0x5ad033[_0x4bc148(0x152)](_0x4bc148(0x168))&&(_0x330901=_0x56a7e8>0x2000?0x2000:_0x56a7e8),_0x5ad033[_0x4bc148(0x152)]('preview')&&(_0x330901=_0x56a7e8>0x1000?0x1000:_0x56a7e8),_0x5ad033['includes'](_0x4bc148(0x16b))&&(_0x330901=_0x56a7e8>0x8000?0x8000:_0x56a7e8),_0x330901;}