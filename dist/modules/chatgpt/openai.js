'use strict';const _0x5acbd7=_0x4cc1;(function(_0x258c55,_0x16ce2b){const _0x8c342d=_0x4cc1,_0x647b91=_0x258c55();while(!![]){try{const _0x51c28e=-parseInt(_0x8c342d(0x104))/0x1+-parseInt(_0x8c342d(0x10a))/0x2+-parseInt(_0x8c342d(0x122))/0x3*(parseInt(_0x8c342d(0x10b))/0x4)+parseInt(_0x8c342d(0x105))/0x5+-parseInt(_0x8c342d(0x118))/0x6*(parseInt(_0x8c342d(0x11d))/0x7)+parseInt(_0x8c342d(0x109))/0x8*(parseInt(_0x8c342d(0x10e))/0x9)+parseInt(_0x8c342d(0x11c))/0xa;if(_0x51c28e===_0x16ce2b)break;else _0x647b91['push'](_0x647b91['shift']());}catch(_0x6d812){_0x647b91['push'](_0x647b91['shift']());}}}(_0x3f67,0x1e4a5));Object['defineProperty'](exports,_0x5acbd7(0x116),{'value':!![]}),exports[_0x5acbd7(0x127)]=exports[_0x5acbd7(0x121)]=exports[_0x5acbd7(0x11f)]=void 0x0;const axios_1=require(_0x5acbd7(0x117)),tiktoken_1=require(_0x5acbd7(0xfe)),utils_1=require(_0x5acbd7(0x113)),es=require(_0x5acbd7(0x125)),tokenizer=(0x0,tiktoken_1[_0x5acbd7(0x10d)])('cl100k_base');function getFullUrl(_0x57e191){const _0x24679d=_0x5acbd7,_0x55f992=_0x57e191[_0x24679d(0xfc)]('/')?_0x57e191[_0x24679d(0xfa)](0x0,-0x1):_0x57e191,_0x21d4c5=_0x55f992||_0x24679d(0x111);return _0x21d4c5+'/v1/chat/completions';}function _0x4cc1(_0x22d984,_0x2ce6ee){const _0x3f6741=_0x3f67();return _0x4cc1=function(_0x4cc16f,_0x5e6ef2){_0x4cc16f=_0x4cc16f-0xf5;let _0x838dc0=_0x3f6741[_0x4cc16f];return _0x838dc0;},_0x4cc1(_0x22d984,_0x2ce6ee);}exports[_0x5acbd7(0x11f)]=getFullUrl;function sendMessageFromOpenAi(_0x355981,_0x3af32f){const _0x5bbf4c=_0x5acbd7;var _0xa832c2;const {onProgress:_0x490555,maxToken:_0x279918,apiKey:_0x47f646,model:_0x57f3ae,temperature:temperature=0.95,proxyUrl:_0x74843e,usingNetwork:usingNetwork=![],gptsId:_0x243100}=_0x3af32f,_0x2e1b12={'method':_0x5bbf4c(0x101),'url':getFullUrl(_0x74843e),'responseType':_0x5bbf4c(0xf6),'headers':{'Content-Type':_0x5bbf4c(0x11a),'Authorization':_0x5bbf4c(0x11e)+(0x0,utils_1[_0x5bbf4c(0xf8)])(_0x47f646)},'data':{'stream':!![],'temperature':temperature,'model':_0x57f3ae,'messages':_0x355981}};usingNetwork&&(_0x2e1b12[_0x5bbf4c(0x124)][_0x5bbf4c(0x100)]=_0x5bbf4c(0xfd)+_0x2e1b12[_0x5bbf4c(0x124)][_0x5bbf4c(0x100)]);_0x243100&&(_0x2e1b12['data'][_0x5bbf4c(0x100)]=_0x2e1b12[_0x5bbf4c(0x124)][_0x5bbf4c(0x100)]+'-'+_0x243100);const _0x5eaa85=(_0xa832c2=_0x355981[_0x355981[_0x5bbf4c(0xf5)]-0x1])===null||_0xa832c2===void 0x0?void 0x0:_0xa832c2['content'];return new Promise(async(_0x2f4faa,_0x22d60c)=>{const _0x11cbd6=_0x5bbf4c;try{const _0x51a11d=await(0x0,axios_1['default'])(_0x2e1b12),_0x180497=_0x51a11d['data'],_0x2caee3={'text':''};_0x180497[_0x11cbd6(0x110)](es['split']('\x0a'))['on']('data',_0x37d58f=>{const _0x381129=_0x11cbd6;var _0x56cc8a;let _0xac8a7f=_0x37d58f?[_0x37d58f[_0x381129(0xfb)]()]:[];if(_0xac8a7f[_0x381129(0xf5)]&&_0xac8a7f[0x0][_0x381129(0x103)]('[DONE]'))_0xac8a7f=[];for(const _0x3a2209 of _0xac8a7f){const _0x219cea=_0x3a2209[_0x381129(0x123)](_0x381129(0x128),'');let _0x407cf0=![];try{_0x407cf0=JSON[_0x381129(0x126)](_0x219cea)[_0x381129(0x108)][0x0][_0x381129(0x10c)]===_0x381129(0x11b);}catch(_0x4d733d){_0x407cf0=![];}if(_0x219cea===_0x381129(0x120)||_0x407cf0)return _0x2caee3[_0x381129(0xff)]=_0x2caee3['text'][_0x381129(0x107)](),_0x2caee3;try{const _0x17f375=JSON[_0x381129(0x126)](_0x219cea);_0x17f375['id']&&(_0x2caee3['id']=_0x17f375['id']);if((_0x56cc8a=_0x17f375['choices'])===null||_0x56cc8a===void 0x0?void 0x0:_0x56cc8a[_0x381129(0xf5)]){const _0x5b451f=_0x17f375[_0x381129(0x108)][0x0][_0x381129(0xf7)];_0x2caee3[_0x381129(0xf7)]=_0x5b451f[_0x381129(0x114)];if(_0x5b451f===null||_0x5b451f===void 0x0?void 0x0:_0x5b451f[_0x381129(0x114)])_0x2caee3[_0x381129(0xff)]+=_0x5b451f[_0x381129(0x114)];_0x5b451f['role']&&(_0x2caee3[_0x381129(0x10f)]=_0x5b451f[_0x381129(0x10f)]),_0x2caee3[_0x381129(0x112)]=_0x17f375;}_0x490555&&_0x490555({'text':_0x2caee3['text']});}catch(_0x471ed3){console[_0x381129(0x102)]('parse\x20Error',_0x219cea);}}}),_0x180497['on'](_0x11cbd6(0x115),()=>{const _0x4312f8=_0x11cbd6;if(_0x2caee3[_0x4312f8(0x112)]&&_0x2caee3[_0x4312f8(0xff)]){const _0x1f6977=getTokenCount(_0x5eaa85),_0x34b918=getTokenCount(_0x2caee3[_0x4312f8(0xff)]);_0x2caee3[_0x4312f8(0x112)][_0x4312f8(0x119)]={'prompt_tokens':_0x1f6977,'completion_tokens':_0x34b918,'total_tokens':_0x1f6977+_0x34b918,'estimated':!![]};}return _0x2f4faa(_0x2caee3);});}catch(_0x52fea1){console[_0x11cbd6(0x102)]('openai\x20---------->\x20:\x20',_0x52fea1[_0x11cbd6(0x106)][_0x11cbd6(0x124)]),_0x22d60c(_0x52fea1);}});}function _0x3f67(){const _0x394aa1=['__esModule','axios','174MrDdNv','usage','application/json','stop','6890300NzkipH','6559wpmKga','Bearer\x20','getFullUrl','[DONE]','sendMessageFromOpenAi','48AmlmBf','replace','data','event-stream','parse','getTokenCount','data:','length','stream','delta','removeSpecialCharacters','gpt-4','slice','toString','endsWith','net-','@dqbd/tiktoken','text','model','POST','log','includes','161235raLRxh','242950YzRJhX','response','trim','choices','69512wiZSNG','417392EXbfcJ','56284mEtxuW','finish_reason','get_encoding','9KHRYkO','role','pipe','https://api.openai.com','detail','../../common/utils','content','end'];_0x3f67=function(){return _0x394aa1;};return _0x3f67();}exports[_0x5acbd7(0x121)]=sendMessageFromOpenAi;function getTokenCount(_0x3c3001){const _0xdab59=_0x5acbd7;if(!_0x3c3001)return 0x0;return _0x3c3001=_0x3c3001[_0xdab59(0xfb)]()[_0xdab59(0x123)](/<\|endoftext\|>/g,''),tokenizer['encode'](_0x3c3001)[_0xdab59(0xf5)];}exports[_0x5acbd7(0x127)]=getTokenCount;function compilerToken(_0x2e42b3,_0x3eab34){const _0x42bfee=_0x5acbd7;let _0x20dead=0x0;return _0x2e42b3['includes'](3.5)&&(_0x20dead=_0x3eab34>0x1000?0x1000:_0x3eab34),_0x2e42b3['includes'](_0x42bfee(0xf9))&&(_0x20dead=_0x3eab34>0x2000?0x2000:_0x3eab34),_0x2e42b3['includes']('preview')&&(_0x20dead=_0x3eab34>0x1000?0x1000:_0x3eab34),_0x2e42b3['includes']('32k')&&(_0x20dead=_0x3eab34>0x8000?0x8000:_0x3eab34),_0x20dead;}