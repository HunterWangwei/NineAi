'use strict';const _0x11384b=_0x18da;(function(_0x40a8ef,_0x5d7e49){const _0x2e2727=_0x18da,_0x13435b=_0x40a8ef();while(!![]){try{const _0x2d9fed=-parseInt(_0x2e2727(0xf0))/0x1*(parseInt(_0x2e2727(0xf1))/0x2)+-parseInt(_0x2e2727(0xe1))/0x3+-parseInt(_0x2e2727(0xfe))/0x4+parseInt(_0x2e2727(0xeb))/0x5+parseInt(_0x2e2727(0x110))/0x6+parseInt(_0x2e2727(0x101))/0x7*(parseInt(_0x2e2727(0xe6))/0x8)+parseInt(_0x2e2727(0xff))/0x9;if(_0x2d9fed===_0x5d7e49)break;else _0x13435b['push'](_0x13435b['shift']());}catch(_0x4474f7){_0x13435b['push'](_0x13435b['shift']());}}}(_0x2b3b,0x50894));Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[_0x11384b(0xf2)]=exports[_0x11384b(0x10b)]=exports['getFullUrl']=void 0x0;const axios_1=require(_0x11384b(0xf7)),tiktoken_1=require(_0x11384b(0xf5)),utils_1=require(_0x11384b(0x109)),es=require(_0x11384b(0xfa)),tokenizer=(0x0,tiktoken_1[_0x11384b(0x111)])('cl100k_base');function _0x18da(_0x34b54e,_0x390ddd){const _0x2b3bd6=_0x2b3b();return _0x18da=function(_0x18dab0,_0x3799cd){_0x18dab0=_0x18dab0-0xde;let _0x1c2c11=_0x2b3bd6[_0x18dab0];return _0x1c2c11;},_0x18da(_0x34b54e,_0x390ddd);}function getFullUrl(_0x16535a){const _0x2efda5=_0x11384b,_0x5611ea=_0x16535a[_0x2efda5(0x100)]('/')?_0x16535a[_0x2efda5(0x10e)](0x0,-0x1):_0x16535a,_0x2232f4=_0x5611ea||_0x2efda5(0xe9);return _0x2232f4+_0x2efda5(0xee);}exports[_0x11384b(0xfd)]=getFullUrl;function _0x2b3b(){const _0x461f85=['pipe','@dqbd/tiktoken','detail','axios','[DONE]','Bearer\x20','event-stream','data:','default','getFullUrl','2012860WUhJaU','6204870MWtFKz','endsWith','4494791XXZWsc','data','role','length','stream','parse','stop','gpt-4','../../common/utils','toString','sendMessageFromOpenAi','usage','response','slice','includes','477474BnhtWj','get_encoding','text','application/json','model','835083isZisE','content','choices','removeSpecialCharacters','parse\x20Error','8MvzEnZ','log','net-','https://api.openai.com','32k','1674235PHCmxo','delta','finish_reason','/v1/chat/completions','split','1QPpwZg','1269034nEglQx','getTokenCount','encode'];_0x2b3b=function(){return _0x461f85;};return _0x2b3b();}function sendMessageFromOpenAi(_0x3e40e9,_0x369fec){const _0x257ff7=_0x11384b;var _0x15b6f4;const {onProgress:_0x31a9f6,maxToken:_0x5d7068,apiKey:_0x453009,model:_0x5a0ea0,temperature:temperature=0.95,proxyUrl:_0x5ce58a,usingNetwork:usingNetwork=![],gptsId:_0xc185d}=_0x369fec,_0x581bec={'method':'POST','url':getFullUrl(_0x5ce58a),'responseType':_0x257ff7(0x105),'headers':{'Content-Type':_0x257ff7(0xdf),'Authorization':_0x257ff7(0xf9)+(0x0,utils_1[_0x257ff7(0xe4)])(_0x453009)},'data':{'stream':!![],'temperature':temperature,'model':_0x5a0ea0,'messages':_0x3e40e9}};usingNetwork&&(_0x581bec[_0x257ff7(0x102)][_0x257ff7(0xe0)]=_0x257ff7(0xe8)+_0x581bec[_0x257ff7(0x102)][_0x257ff7(0xe0)]);_0xc185d&&(_0x581bec[_0x257ff7(0x102)][_0x257ff7(0xe0)]=_0x581bec[_0x257ff7(0x102)]['model']+'-'+_0xc185d);const _0x921582=(_0x15b6f4=_0x3e40e9[_0x3e40e9[_0x257ff7(0x104)]-0x1])===null||_0x15b6f4===void 0x0?void 0x0:_0x15b6f4[_0x257ff7(0xe2)];return new Promise(async(_0x4971a7,_0xb37baa)=>{const _0x54d664=_0x257ff7;try{const _0x5e6aca=await(0x0,axios_1[_0x54d664(0xfc)])(_0x581bec),_0x5b1be3=_0x5e6aca[_0x54d664(0x102)],_0x100108={'text':''};_0x5b1be3[_0x54d664(0xf4)](es[_0x54d664(0xef)]('\x0a'))['on'](_0x54d664(0x102),_0x77d206=>{const _0xbef889=_0x54d664;var _0xb18a83;let _0x3a703b=_0x77d206?[_0x77d206['toString']()]:[];if(_0x3a703b[_0xbef889(0x104)]&&_0x3a703b[0x0][_0xbef889(0x10f)]('[DONE]'))_0x3a703b=[];for(const _0x277abd of _0x3a703b){const _0x1ff7f0=_0x277abd['replace'](_0xbef889(0xfb),'');let _0xc4b99c=![];try{_0xc4b99c=JSON['parse'](_0x1ff7f0)[_0xbef889(0xe3)][0x0][_0xbef889(0xed)]===_0xbef889(0x107);}catch(_0x38fdcd){_0xc4b99c=![];}if(_0x1ff7f0===_0xbef889(0xf8)||_0xc4b99c)return _0x100108[_0xbef889(0xde)]=_0x100108[_0xbef889(0xde)]['trim'](),_0x100108;try{const _0x1fcfae=JSON[_0xbef889(0x106)](_0x1ff7f0);_0x1fcfae['id']&&(_0x100108['id']=_0x1fcfae['id']);if((_0xb18a83=_0x1fcfae[_0xbef889(0xe3)])===null||_0xb18a83===void 0x0?void 0x0:_0xb18a83[_0xbef889(0x104)]){const _0x281b9d=_0x1fcfae[_0xbef889(0xe3)][0x0]['delta'];_0x100108[_0xbef889(0xec)]=_0x281b9d['content'];if(_0x281b9d===null||_0x281b9d===void 0x0?void 0x0:_0x281b9d[_0xbef889(0xe2)])_0x100108[_0xbef889(0xde)]+=_0x281b9d[_0xbef889(0xe2)];_0x281b9d[_0xbef889(0x103)]&&(_0x100108[_0xbef889(0x103)]=_0x281b9d['role']),_0x100108['detail']=_0x1fcfae;}_0x31a9f6&&_0x31a9f6({'text':_0x100108['text']});}catch(_0x879e2a){console[_0xbef889(0xe7)](_0xbef889(0xe5),_0x1ff7f0);}}}),_0x5b1be3['on']('end',()=>{const _0x162d91=_0x54d664;if(_0x100108[_0x162d91(0xf6)]&&_0x100108[_0x162d91(0xde)]){const _0x1f4ae6=getTokenCount(_0x921582),_0x811610=getTokenCount(_0x100108['text']);_0x100108['detail'][_0x162d91(0x10c)]={'prompt_tokens':_0x1f4ae6,'completion_tokens':_0x811610,'total_tokens':_0x1f4ae6+_0x811610,'estimated':!![]};}return _0x4971a7(_0x100108);});}catch(_0x4eb3b0){console[_0x54d664(0xe7)]('openai\x20---------->\x20:\x20',_0x4eb3b0[_0x54d664(0x10d)][_0x54d664(0x102)]),_0xb37baa(_0x4eb3b0);}});}exports[_0x11384b(0x10b)]=sendMessageFromOpenAi;function getTokenCount(_0x1bf493){const _0x27f1ad=_0x11384b;if(!_0x1bf493)return 0x0;return _0x1bf493=_0x1bf493[_0x27f1ad(0x10a)]()['replace'](/<\|endoftext\|>/g,''),tokenizer[_0x27f1ad(0xf3)](_0x1bf493)[_0x27f1ad(0x104)];}exports['getTokenCount']=getTokenCount;function compilerToken(_0x5592ad,_0xb0f2a5){const _0x290b2d=_0x11384b;let _0x253510=0x0;return _0x5592ad['includes'](3.5)&&(_0x253510=_0xb0f2a5>0x1000?0x1000:_0xb0f2a5),_0x5592ad[_0x290b2d(0x10f)](_0x290b2d(0x108))&&(_0x253510=_0xb0f2a5>0x2000?0x2000:_0xb0f2a5),_0x5592ad[_0x290b2d(0x10f)]('preview')&&(_0x253510=_0xb0f2a5>0x1000?0x1000:_0xb0f2a5),_0x5592ad[_0x290b2d(0x10f)](_0x290b2d(0xea))&&(_0x253510=_0xb0f2a5>0x8000?0x8000:_0xb0f2a5),_0x253510;}