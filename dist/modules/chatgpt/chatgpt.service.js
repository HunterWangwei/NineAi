'use strict';const _0x2bcbba=_0x25a9;(function(_0xe4b006,_0x3b547c){const _0x1e5da3=_0x25a9,_0x211146=_0xe4b006();while(!![]){try{const _0x1bdc5d=-parseInt(_0x1e5da3(0x1d4))/0x1*(-parseInt(_0x1e5da3(0x22d))/0x2)+-parseInt(_0x1e5da3(0x1e5))/0x3+parseInt(_0x1e5da3(0x272))/0x4*(parseInt(_0x1e5da3(0x2b9))/0x5)+parseInt(_0x1e5da3(0x292))/0x6+parseInt(_0x1e5da3(0x251))/0x7+parseInt(_0x1e5da3(0x273))/0x8*(parseInt(_0x1e5da3(0x215))/0x9)+-parseInt(_0x1e5da3(0x2ca))/0xa;if(_0x1bdc5d===_0x3b547c)break;else _0x211146['push'](_0x211146['shift']());}catch(_0x5a7ceb){_0x211146['push'](_0x211146['shift']());}}}(_0x363b,0xd77bd));function _0x363b(){const _0x5d6480=['decorate','../chatGroup/chatGroup.service','tts-1','dall-e-3','user','31467430sPDNQs','Repository','REDIS_PASSWORD','../../common/utils','autoreplyService','PAYMENT_REQUIRED','openaiModel3MaxTokensRes','message','toISOString','openaiModel4MaxTokens32k','chatBoxEntity','当前分类下有未处理数据不可移除！','defineProperty',',\x20模型名称:\x20','is_end','FanyiService','../globalConfig/globalConfig.service','Bearer\x20','chatLogService','../fanyi/fanyi.service','checkBadWords','16k','chatGroupService','语音转文字内容:\x20','setChatPreType','当前配置模型可能不支持Dall-e-3模型、请检查！','fable','1106','all','modelTypeId','getConfigs','function','checkAutoReply','nineStore','HttpStatus','create','delChatPre','join','你当前使用的应用已被下架、请删除当前对话开启新的对话吧！','当前模型调用过于频繁、请重新试试吧！','__metadata','getCurrentModelKeyInfo','Logger','lockKey','application/octet-stream;\x20charset=utf-8','response','gpt-4','setData','当前模型key余额已耗尽、已冻结当前调用Key、尝试重新对话试试吧！','98001KvrLhe','ChatPreEntity','缺失必要参数！','当前流程所需要的模型已被管理员下架、请联系管理员上架此模型或更换其他模型使用！','size','userBalanceService','typeId','您的请求已被系统拒绝。您的提示可能存在一些非法的文本。','../../common/constants/errorMessage.constant','chat-error-detail\x20\x20<----------------------------------------->','HttpException','body','gptKeysEntity','__decorate','assign','usage','log','994830Owtuig','REDIS_USER','length','The\x20OpenAI\x20account\x20associated\x20with\x20this\x20API\x20key\x20has\x20been\x20deactivated.','replace','ChatgptService','Injectable','slice','removeSpecialCharacters','keyPool','../chatLog/chatLog.service','extractFilePath','../../public','This\x20request\x20has\x20been\x20blocked\x20by\x20our\x20content\x20filters','map','abort','getOwnPropertyDescriptor','onModuleInit','findOne','object','close','getTtsModelKey','chatRealTimeTextToSpeech',',\x20key\x20===>\x20','chatPreEntity','includes','uploadFile','sendMessageFromZhipu','transcriptions','./gptkeys.entity','__esModule','/dist','metadata','end','gpt-3','ConfigService','https://api.openai.com','DESC','delChatBoxType','@nestjs/common','setChatPre','proxyUrl','floor','default','statusText','axios','当前流程所需要的模型已被管理员下架、请联系管理员上架专属模型或更换模型使用！','getChatInfoFromId','234ZmzFGA','当前绘画模型暂未上架、请联系管理员上架此模型！','Please\x20check\x20the\x20back-end\x20console','AppEntity','queryUserBalance','appInfo','REDIS_HOST','语音转文字失败、请稍后试试吧！','本次调用:\x20','post','debug','prompt','gpt-4-1106','mjDraw','当前模型key已被封禁','./zhipu','./../upload/upload.service','openaiModel4MaxTokens32kRes','queryChatBoxFrontend','setChatBoxType','draw\x20paompt\x20info\x20<==**==>\x20','Billing\x20hard\x20limit\x20has\x20been\x20reached','delChatPreType','pathname','16gAdDkS','saveUseLog','../userBalance/userBalance.service','key','ConfigEntity','typeorm','modelConfig','UserBalanceService','assistant','当前模型key已被封禁、已冻结当前调用Key、尝试重新对话试试吧！','OpenAiErrorCodeMessage','UploadService','path','\x20model:\x20','update','32k','b64_json','realTimeTextToSpeechChat','systemPreMessage','statusCode','服务异常、请重新试试吧！！！','getUseDrawModelKey','save','audio','getUseToolsModelKey','getUuid','__param','ChatPreTypeEntity','提供了错误的模型秘钥','quality','error:\x20','model4','当前模型不是聊天模型','configEntity','split','GptKeysEntity','11606686cwoiBn','ModelsService','createReadStream','@nestjs/typeorm','当前语音转文字模型暂未上架、请联系管理员上架此模型！','sendMessageFromBaidu','systemMessage','maxResponseTokens','chatSpeechToText','InjectRepository','appEntity','getModelTypeDetailFromId','ChatBoxTypeEntity','uploadService','filter','pipe','./chatBox.entity','sendMessageFromOpenAi','base64','model3','badwordsService','write','当前Key余额已不足、请重新再试一次吧！','chatTextToSpeech','UserService','openaiProxyUrl','model','checkUserStatus','find','./chatPre.entity','getAllKeyList','modelsService','./openai','3225204ymkrce','75304MtPlhk','validateBalance','GlobalConfigService','maxModelTokens','prevChatId','\x20key\x20->\x20','请将语言转为中文简体','getModelTypeIdFromPluginId','绘制图片失败，请稍后试试吧！','addOneIfOdd','语音转文字识别失败、请稍后试试吧！','This\x20is\x20not\x20a\x20chat\x20model\x20and\x20thus\x20not\x20supported','openaiModel4MaxTokens','standard','userBanance','appId','importDynamic','非法操作！','ChatLogService','nineai-chatlog','BadwordsService','gpt-4-vision-preview','getUploadType','deductFromBalance','toLowerCase','count','buildMessageFromParentMessageId','status','queryChatPreList','getTokenCount','statusText:','5206974hgjXlN','uuid','weight','speech','BAD_REQUEST','stringify','CHAT_TYPE','realTimeTextToSpeech','getClientIp','chatPreTypeEntity','endsWith','DeductionKey','forEach','openaiModel3MaxTokens','chatgpt-nine-ai','text','chatProcess','whiteListUser','conversationId','abortController','setChatBox','delete','ChatGroupService','/v1','../app/app.entity','saveChatLog','result','请输入对话内容','AutoreplyService','getModelProxyUrl','typeInfo','configService','openai','../badwords/badwords.service','getMaxTokenFromModelWithOpenAi','config','/v1/images/generations','getBaseConfig','userService','5MsFZZT','nestjs-config','fanyiService','code:\x20','chatBoxTypeEntity','chatSyncFree','parse','openaiBaseUrl','env','globalConfigService','PAINT_TYPE','data'];_0x363b=function(){return _0x5d6480;};return _0x363b();}var __decorate=this&&this[_0x2bcbba(0x1e1)]||function(_0x1f2135,_0x366fd9,_0x2d5b22,_0x43ee73){const _0x5e67b7=_0x2bcbba;var _0x496f7a=arguments[_0x5e67b7(0x1e7)],_0x207c85=_0x496f7a<0x3?_0x366fd9:_0x43ee73===null?_0x43ee73=Object[_0x5e67b7(0x1f5)](_0x366fd9,_0x2d5b22):_0x43ee73,_0x1db19f;if(typeof Reflect===_0x5e67b7(0x1f8)&&typeof Reflect[_0x5e67b7(0x2c5)]===_0x5e67b7(0x2e9))_0x207c85=Reflect[_0x5e67b7(0x2c5)](_0x1f2135,_0x366fd9,_0x2d5b22,_0x43ee73);else{for(var _0x2d3672=_0x1f2135['length']-0x1;_0x2d3672>=0x0;_0x2d3672--)if(_0x1db19f=_0x1f2135[_0x2d3672])_0x207c85=(_0x496f7a<0x3?_0x1db19f(_0x207c85):_0x496f7a>0x3?_0x1db19f(_0x366fd9,_0x2d5b22,_0x207c85):_0x1db19f(_0x366fd9,_0x2d5b22))||_0x207c85;}return _0x496f7a>0x3&&_0x207c85&&Object[_0x5e67b7(0x2d6)](_0x366fd9,_0x2d5b22,_0x207c85),_0x207c85;},__metadata=this&&this[_0x2bcbba(0x2f2)]||function(_0x246adb,_0x1e8c2a){const _0x199fad=_0x2bcbba;if(typeof Reflect===_0x199fad(0x1f8)&&typeof Reflect[_0x199fad(0x205)]===_0x199fad(0x2e9))return Reflect[_0x199fad(0x205)](_0x246adb,_0x1e8c2a);},__param=this&&this[_0x2bcbba(0x247)]||function(_0x4f0bbf,_0x18cd93){return function(_0x2c8cd1,_0x1f2ff3){_0x18cd93(_0x2c8cd1,_0x1f2ff3,_0x4f0bbf);};};Object['defineProperty'](exports,_0x2bcbba(0x203),{'value':!![]}),exports[_0x2bcbba(0x1ea)]=void 0x0;const upload_service_1=require(_0x2bcbba(0x225)),user_service_1=require('./../user/user.service'),nestjs_config_1=require(_0x2bcbba(0x2ba)),common_1=require(_0x2bcbba(0x20c)),errorMessage_constant_1=require(_0x2bcbba(0x1dc)),openai_1=require(_0x2bcbba(0x2b2)),utils_1=require(_0x2bcbba(0x2cd)),axios_1=require(_0x2bcbba(0x212)),userBalance_service_1=require(_0x2bcbba(0x22f)),balance_constant_1=require('../../common/constants/balance.constant'),chatLog_service_1=require(_0x2bcbba(0x1ef)),uuid=require(_0x2bcbba(0x293)),config_entity_1=require('../globalConfig/config.entity'),typeorm_1=require(_0x2bcbba(0x232)),typeorm_2=require(_0x2bcbba(0x254)),badwords_service_1=require(_0x2bcbba(0x2b3)),autoreply_service_1=require('../autoreply/autoreply.service'),gptkeys_entity_1=require(_0x2bcbba(0x202)),globalConfig_service_1=require(_0x2bcbba(0x2da)),fanyi_service_1=require(_0x2bcbba(0x2dd)),app_entity_1=require(_0x2bcbba(0x2aa)),chatGroup_service_1=require(_0x2bcbba(0x2c6)),models_service_1=require('../models/models.service'),baidu_1=require('./baidu'),helper_1=require('./helper'),store_1=require('./store'),zhipu_1=require(_0x2bcbba(0x224)),openai_2=require(_0x2bcbba(0x271)),chatBoxType_entity_1=require('./chatBoxType.entity'),chatBox_entity_1=require(_0x2bcbba(0x261)),chatPre_entity_1=require(_0x2bcbba(0x26e)),chatPreType_entity_1=require('./chatPreType.entity'),fs=require('fs'),path_1=require(_0x2bcbba(0x239));let ChatgptService=class ChatgptService{constructor(_0x378a3e,_0x371ba4,_0x5c35d8,_0x3b82d1,_0x5237bb,_0x492cca,_0x12c948,_0x561fb9,_0x1ca7fc,_0x2700c9,_0x2722fc,_0x86627,_0x340095,_0x3dc2bb,_0x3732bb,_0x2f95ca,_0x1494fa,_0x4ca1ea){const _0x3d3bce=_0x2bcbba;this[_0x3d3bce(0x1e0)]=_0x378a3e,this[_0x3d3bce(0x24e)]=_0x371ba4,this[_0x3d3bce(0x2bd)]=_0x5c35d8,this[_0x3d3bce(0x2d4)]=_0x3b82d1,this[_0x3d3bce(0x25b)]=_0x5237bb,this[_0x3d3bce(0x29b)]=_0x492cca,this[_0x3d3bce(0x1fd)]=_0x12c948,this[_0x3d3bce(0x2b1)]=_0x561fb9,this[_0x3d3bce(0x1d9)]=_0x1ca7fc,this[_0x3d3bce(0x2dc)]=_0x2700c9,this['userService']=_0x2722fc,this[_0x3d3bce(0x25e)]=_0x86627,this[_0x3d3bce(0x265)]=_0x340095,this[_0x3d3bce(0x2ce)]=_0x3dc2bb,this['globalConfigService']=_0x3732bb,this[_0x3d3bce(0x2bb)]=_0x2f95ca,this[_0x3d3bce(0x2e0)]=_0x1494fa,this[_0x3d3bce(0x270)]=_0x4ca1ea,this[_0x3d3bce(0x2eb)]=null,this[_0x3d3bce(0x2a3)]=[],this[_0x3d3bce(0x1ee)]={'list3':[],'list4':[]};}async[_0x2bcbba(0x1f6)](){const _0x50dc78=_0x2bcbba;let _0x2632ca=await(0x0,utils_1[_0x50dc78(0x283)])(_0x50dc78(0x2a0)),_0x2b6eee=await(0x0,utils_1[_0x50dc78(0x283)])('@keyv/redis'),_0x6da733=await(0x0,utils_1[_0x50dc78(0x283)])('keyv');_0x2632ca=(_0x2632ca===null||_0x2632ca===void 0x0?void 0x0:_0x2632ca[_0x50dc78(0x210)])?_0x2632ca[_0x50dc78(0x210)]:_0x2632ca,_0x2b6eee=(_0x2b6eee===null||_0x2b6eee===void 0x0?void 0x0:_0x2b6eee[_0x50dc78(0x210)])?_0x2b6eee['default']:_0x2b6eee,_0x6da733=(_0x6da733===null||_0x6da733===void 0x0?void 0x0:_0x6da733[_0x50dc78(0x210)])?_0x6da733['default']:_0x6da733;const {ChatGPTAPI:_0xddcd9d,ChatGPTError:_0x1ed231,ChatGPTUnofficialProxyAPI:_0x22cd23}=_0x2632ca,_0x912148=+process[_0x50dc78(0x2c1)]['REDIS_PORT'],_0x319ad0=process[_0x50dc78(0x2c1)][_0x50dc78(0x21b)],_0x3ee418=process[_0x50dc78(0x2c1)][_0x50dc78(0x2cc)],_0x5f585d=process['env'][_0x50dc78(0x1e6)],_0x193f51='redis://'+(_0x5f585d||'')+':'+(_0x3ee418||'')+'@'+_0x319ad0+':'+_0x912148,_0x338a0c=new _0x2b6eee(_0x193f51),_0x970225=new _0x6da733({'store':_0x338a0c,'namespace':_0x50dc78(0x286)});this['nineStore']=new store_1['NineStore']({'store':_0x970225,'namespace':'chat'});}async[_0x2bcbba(0x2be)](_0x2614ac){const _0xdcfd05=_0x2bcbba,_0x540123=await this[_0xdcfd05(0x270)]['getDefaultModel']();if(!_0x540123)return;const {model:_0xba8206,maxTokens:_0x58ea29}=_0x540123,_0x48e505=await this['modelsService'][_0xdcfd05(0x2f3)](_0x540123['id']);if(!_0x48e505)return;const _0x26c101=await this[_0xdcfd05(0x2c2)][_0xdcfd05(0x2e8)]([_0xdcfd05(0x23f)]),{key:_0xc0cde7,proxyUrl:_0x5ee075}=_0x48e505,{context:_0x115775}=await this[_0xdcfd05(0x2eb)][_0xdcfd05(0x28d)](_0x2614ac,{'parentMessageId':'','systemMessage':_0x26c101});try{const _0x3c2f73=await(0x0,openai_2['sendMessageFromOpenAi'])(_0x115775,{'apiKey':(0x0,utils_1[_0xdcfd05(0x1ed)])(_0xc0cde7),'model':_0xba8206,'proxyUrl':_0x5ee075,'maxToken':_0x58ea29,'onProgress':null});return _0x3c2f73===null||_0x3c2f73===void 0x0?void 0x0:_0x3c2f73[_0xdcfd05(0x2a1)];}catch(_0x76533a){console[_0xdcfd05(0x1e4)](_0xdcfd05(0x24b),_0x76533a);}}['extractFilePath'](_0x253ece){const _0xdd267b=_0x2bcbba,_0x35063a=new URL(_0x253ece);return _0x35063a[_0xdd267b(0x22c)];}async[_0x2bcbba(0x259)](_0x41de6d){const _0x5af26d=_0x2bcbba,_0x1659a5=await this['modelsService']['getTtsModelKey']();if(!_0x1659a5)throw new common_1['HttpException']('当前语音转文字模型暂未上架、请联系管理员上架此模型！',common_1[_0x5af26d(0x2ec)][_0x5af26d(0x296)]);const {key:_0xb4bc32,proxyUrl:_0x322208}=_0x1659a5,_0x5333d9=_0x322208[_0x5af26d(0x29c)]('/')?_0x322208+'v1':_0x322208+_0x5af26d(0x2a9),_0x20e2f9=new openai_1[(_0x5af26d(0x210))]({'baseURL':_0x5333d9,'apiKey':_0xb4bc32}),_0xc993e6=this[_0x5af26d(0x1f0)](_0x41de6d),_0x5da6d6=(0x0,path_1[_0x5af26d(0x2ef)])(__dirname,_0x5af26d(0x1f1),_0xc993e6)[_0x5af26d(0x1e9)](_0x5af26d(0x204),''),_0xc45c9d=await _0x20e2f9[_0x5af26d(0x244)][_0x5af26d(0x201)][_0x5af26d(0x2ed)]({'model':'whisper-1','prompt':_0x5af26d(0x279),'file':fs[_0x5af26d(0x253)](_0x5da6d6)});return console['log'](_0x5af26d(0x2e1),_0xc45c9d===null||_0xc45c9d===void 0x0?void 0x0:_0xc45c9d[_0x5af26d(0x2a1)]),(_0xc45c9d===null||_0xc45c9d===void 0x0?void 0x0:_0xc45c9d[_0x5af26d(0x2a1)])||null;}async[_0x2bcbba(0x1fb)](_0x4f471e,_0x50f04e,_0x267186){const _0x140257=_0x2bcbba,{name:name=_0x140257(0x2e4),text:text=''}=_0x267186;try{const _0x515878=await this['modelsService'][_0x140257(0x1fa)]();if(!_0x515878)throw new common_1[(_0x140257(0x1de))](_0x140257(0x255),common_1[_0x140257(0x2ec)]['BAD_REQUEST']);const {key:_0x158455,proxyUrl:_0x3b4c7e}=_0x515878,_0xc848de=_0x3b4c7e[_0x140257(0x29c)]('/')?_0x3b4c7e+'v1':_0x3b4c7e+_0x140257(0x2a9),_0x5bb857=new openai_1[(_0x140257(0x210))]({'baseURL':_0xc848de,'apiKey':_0x158455}),_0x5e0a4b=await _0x5bb857[_0x140257(0x244)][_0x140257(0x295)][_0x140257(0x2ed)]({'model':_0x140257(0x2c7),'voice':name,'input':text});_0x5e0a4b[_0x140257(0x1df)][_0x140257(0x260)](_0x4f471e);}catch(_0x35a79e){console[_0x140257(0x1e4)](_0x140257(0x24b),_0x35a79e);throw new common_1[(_0x140257(0x1de))]('语音转文字失败、请稍后试试吧！',common_1[_0x140257(0x2ec)][_0x140257(0x296)]);}}async[_0x2bcbba(0x23e)](_0x5492eb,_0x49002c){const _0x5a6500=_0x2bcbba,{id:_0x4a8060,voiceType:_0x18c6b6}=_0x49002c;if(!_0x4a8060)return;const _0x578312=await this['chatLogService'][_0x5a6500(0x214)](_0x4a8060);if(!_0x578312)return;const {answer:_0xc60336,prompt:_0x46426a}=_0x578312,_0x8d953f=_0xc60336||_0x46426a;return this[_0x5a6500(0x299)](_0x5492eb,_0x8d953f,_0x18c6b6);}async[_0x2bcbba(0x299)](_0xe81ac6,_0x47da93,_0x377d91=_0x2bcbba(0x2e4)){const _0x454afc=_0x2bcbba,_0x3690a9=await this['modelsService'][_0x454afc(0x1fa)]();if(!_0x3690a9)throw new common_1[(_0x454afc(0x1de))](_0x454afc(0x255),common_1[_0x454afc(0x2ec)]['BAD_REQUEST']);const {key:_0x38fc3d,proxyUrl:_0x113a6a}=_0x3690a9,_0xf5391f=_0x113a6a[_0x454afc(0x29c)]('/')?_0x113a6a+'v1':_0x113a6a+_0x454afc(0x2a9),_0x226fd5=new openai_1['default']({'baseURL':_0xf5391f,'apiKey':_0x38fc3d}),_0x528e89=await _0x226fd5[_0x454afc(0x244)][_0x454afc(0x295)]['create']({'model':_0x454afc(0x2c7),'voice':_0x377d91,'input':_0x47da93});_0x528e89[_0x454afc(0x1df)][_0x454afc(0x260)](_0xe81ac6);}async[_0x2bcbba(0x268)](_0x30f7b){const _0xa63a7e=_0x2bcbba;try{const _0x2d3102=await this['modelsService'][_0xa63a7e(0x1fa)]();if(!_0x2d3102)throw new common_1['HttpException'](_0xa63a7e(0x255),common_1[_0xa63a7e(0x2ec)][_0xa63a7e(0x296)]);const {key:_0x14ff90,proxyUrl:_0x39d599}=_0x2d3102,_0x3919a3=_0x39d599[_0xa63a7e(0x29c)]('/')?_0x39d599+'v1':_0x39d599+_0xa63a7e(0x2a9),_0x166d39=new openai_1[(_0xa63a7e(0x210))]({'baseURL':_0x3919a3,'apiKey':_0x14ff90});}catch(_0x288ec6){console[_0xa63a7e(0x1e4)](_0xa63a7e(0x24b),_0x288ec6);throw new common_1[(_0xa63a7e(0x1de))](_0xa63a7e(0x21c),common_1[_0xa63a7e(0x2ec)]['BAD_REQUEST']);}}async[_0x2bcbba(0x2a2)](_0xbec1d2,_0x58b1da,_0x3dfcdb){const _0x298b04=_0x2bcbba;var _0x482f43,_0x5f01b9,_0x1204fc;const _0x52abf6=_0x58b1da[_0x298b04(0x2a5)],{options:options={},appId:_0xccc845,cusromPrompt:_0x414ce3,systemMessage:systemMessage='',tts:tts=''}=_0xbec1d2;let _0x2e3dd1=_0xbec1d2[_0x298b04(0x220)];const {parentMessageId:_0x208ccc,file:_0x356421,groupId:_0x1cdb1a,usingNetwork:_0x4329d0}=options;let _0x956574=systemMessage,_0x55f8e1=_0x356421;if(!tts&&!_0x2e3dd1&&!_0x356421)throw new common_1[(_0x298b04(0x1de))](_0x298b04(0x2ad),common_1['HttpStatus'][_0x298b04(0x296)]);if(tts){const _0x45040e=await this[_0x298b04(0x259)](tts);if(!_0x45040e)throw new common_1[(_0x298b04(0x1de))](_0x298b04(0x27d),common_1[_0x298b04(0x2ec)]['BAD_REQUEST']);_0x2e3dd1=_0x45040e;}const _0xd54d4a=await this['chatGroupService']['getGroupInfoFromId'](_0x1cdb1a),_0x3a8e1e=(_0xd54d4a===null||_0xd54d4a===void 0x0?void 0x0:_0xd54d4a['pluginId'])||0x0;let _0x340541=(_0xd54d4a===null||_0xd54d4a===void 0x0?void 0x0:_0xd54d4a[_0x298b04(0x2b5)])?JSON[_0x298b04(0x2bf)](_0xd54d4a[_0x298b04(0x2b5)]):null;(!_0x340541||!_0x340541[_0x298b04(0x2e7)]||!_0x340541[_0x298b04(0x233)])&&!_0x3a8e1e&&(_0x340541=await this[_0x298b04(0x270)][_0x298b04(0x2b7)]());let _0x119ab4=0x0,_0x450d48='',_0x9765df=null;_0x3a8e1e&&(_0x119ab4=await this[_0x298b04(0x270)][_0x298b04(0x27a)](_0x3a8e1e));if(_0xccc845){const _0x2dfb9a=await this['appEntity'][_0x298b04(0x1f7)]({'where':{'id':_0xccc845,'status':(0x0,typeorm_1['In'])([0x1,0x3,0x4,0x5])}});if(!_0x2dfb9a)throw new common_1[(_0x298b04(0x1de))](_0x298b04(0x2f0),common_1[_0x298b04(0x2ec)][_0x298b04(0x296)]);const {modelTypeId:_0x3f323a,isGpts:_0x38284a,preset:_0x250e13,gptsId:_0x2fba7f}=_0x2dfb9a;if(_0x38284a){_0x119ab4=await this[_0x298b04(0x270)]['getModelTypeIdFromGpts']();if(!_0x119ab4)throw new common_1[(_0x298b04(0x1de))]('当前应用使用的模型已被管理员下架、请联系管理员上架此模型！',common_1[_0x298b04(0x2ec)]['BAD_REQUEST']);_0x9765df=_0x2fba7f;}else _0x119ab4=_0x3f323a,_0x450d48=_0x250e13;}(!_0x3a8e1e&&!_0xccc845||!_0x119ab4)&&(_0x119ab4=_0x340541[_0x298b04(0x2e7)]);const _0x331757=await this['modelsService'][_0x298b04(0x25c)](_0x119ab4);if(!_0x331757)throw new common_1[(_0x298b04(0x1de))](_0x298b04(0x1d7),common_1['HttpStatus'][_0x298b04(0x296)]);const {deduct:_0xe39845,deductType:_0x2f04bf,model:_0x7b3ef6,maxTokens:_0x573859,modelType:_0x1319d1,modelName:_0x35eafb}=_0x331757,{systemMessage:_0x5b0a5a,topN:_0x5eefa1,maxResponseTokens:_0x59f4cd,rounds:_0x13672c}=_0x340541[_0x298b04(0x233)];let _0x5818af=null;!_0x414ce3?_0x5818af=await this[_0x298b04(0x270)][_0x298b04(0x2f3)](_0x119ab4):_0x5818af=await this[_0x298b04(0x270)][_0x298b04(0x245)]();if(!_0x5818af)throw new common_1[(_0x298b04(0x1de))](_0x298b04(0x213),common_1[_0x298b04(0x2ec)][_0x298b04(0x296)]);const {key:_0x10c085,secret:_0x33ef72,id:_0x390dc1,accessToken:_0x244fc4,proxyUrl:_0xbf1d7e}=_0x5818af;await this[_0x298b04(0x2b8)][_0x298b04(0x26c)](_0x58b1da[_0x298b04(0x2c9)]),await this[_0x298b04(0x1d9)][_0x298b04(0x274)](_0x58b1da,_0x2f04bf===0x1?_0x298b04(0x264):_0x298b04(0x24c),_0xe39845),_0x3dfcdb&&_0x3dfcdb['setHeader']('Content-type',_0x298b04(0x1cf)),await this[_0x298b04(0x265)][_0x298b04(0x2de)](_0x2e3dd1,_0x58b1da[_0x298b04(0x2c9)]['id']);const _0x520d8d=await this[_0x298b04(0x2ce)][_0x298b04(0x2ea)](_0x2e3dd1);if(_0x520d8d&&_0x3dfcdb){const _0x50eb7d={'message':_0x520d8d,'code':0x1f4};return _0x3dfcdb[_0x298b04(0x266)](JSON['stringify'](_0x50eb7d)),_0x3dfcdb[_0x298b04(0x206)]();}if(_0xccc845)_0x450d48&&(_0x956574=_0x450d48);else{if(_0x414ce3)_0x956574=_0xbec1d2[_0x298b04(0x257)];else{if(_0x5b0a5a)_0x956574=_0x5b0a5a;else{const _0x2774d8=new Date()[_0x298b04(0x2d2)]()['split']('T')[0x0],_0x6f8d51=await this[_0x298b04(0x2c2)]['getConfigs']([_0x298b04(0x23f)]);_0x956574=_0x6f8d51+('\x0a\x20Current\x20date:\x20'+_0x2774d8);}}}if(_0x3a8e1e){_0x956574=null;const {imgUrl:_0x15dc30,documentUrl:_0x3a3a6a}=_0xd54d4a;_0x55f8e1=_0x15dc30||_0x3a3a6a,_0x956574=(0x0,helper_1['genPluginSystemMessage'])(Object['assign'](Object['assign']({},_0xd54d4a),{'pluginId':_0x3a8e1e}));}_0x3dfcdb&&_0x3dfcdb['status'](0xc8);let _0x58b1e7=null,_0x45ddee=null;try{if(_0x3dfcdb){let _0x3fb697=null,_0x5bf7a9=![];_0x3dfcdb['on'](_0x298b04(0x1f9),async()=>{const _0x3eb817=_0x298b04;if(_0x5bf7a9)return;_0x52abf6[_0x3eb817(0x1f4)]();const _0x19325d=await(0x0,openai_2[_0x3eb817(0x290)])(_0x2e3dd1)||0x0,_0x107f17=await(0x0,openai_2[_0x3eb817(0x290)])(_0x3fb697===null||_0x3fb697===void 0x0?void 0x0:_0x3fb697['text'])||0x0,_0x432953=_0x19325d+_0x107f17,_0x25c8b8=(0x0,utils_1[_0x3eb817(0x29a)])(_0x58b1da);await this['chatLogService'][_0x3eb817(0x2ab)]({'appId':_0xccc845,'curIp':_0x25c8b8,'userId':_0x58b1da[_0x3eb817(0x2c9)]['id'],'type':balance_constant_1['DeductionKey'][_0x3eb817(0x298)],'prompt':_0x2e3dd1,'answer':'','promptTokens':_0x19325d,'completionTokens':0x0,'totalTokens':_0x19325d,'model':_0x7b3ef6,'role':'user','groupId':_0x1cdb1a,'tts':tts,'file':_0x55f8e1,'requestOptions':JSON['stringify']({'options':null,'prompt':_0x2e3dd1})}),await this[_0x3eb817(0x2dc)][_0x3eb817(0x2ab)]({'appId':_0xccc845,'curIp':_0x25c8b8,'userId':_0x58b1da[_0x3eb817(0x2c9)]['id'],'type':balance_constant_1[_0x3eb817(0x29d)]['CHAT_TYPE'],'prompt':_0x2e3dd1,'answer':_0x3fb697===null||_0x3fb697===void 0x0?void 0x0:_0x3fb697[_0x3eb817(0x2a1)],'promptTokens':_0x19325d,'completionTokens':_0x107f17,'totalTokens':_0x432953,'model':_0x7b3ef6,'role':_0x3eb817(0x235),'groupId':_0x1cdb1a,'requestOptions':JSON[_0x3eb817(0x297)]({'options':{'model':_0x7b3ef6,'temperature':_0x5eefa1},'prompt':_0x2e3dd1}),'conversationOptions':JSON[_0x3eb817(0x297)]({'conversationId':_0x3fb697===null||_0x3fb697===void 0x0?void 0x0:_0x3fb697[_0x3eb817(0x2a4)],'model':_0x7b3ef6,'parentMessageId':_0x3fb697===null||_0x3fb697===void 0x0?void 0x0:_0x3fb697['id'],'temperature':_0x5eefa1})}),await this[_0x3eb817(0x1d9)]['deductFromBalance'](_0x58b1da[_0x3eb817(0x2c9)]['id'],_0x3eb817(0x26b)+(_0x2f04bf===0x1?0x3:0x4),_0xe39845,_0x432953);});const _0x51860a=_0x2e3dd1;if(Number(_0x1319d1)===0x1){const {context:_0x23a019}=await this[_0x298b04(0x2eb)][_0x298b04(0x28d)](_0x51860a,{'parentMessageId':_0x208ccc,'systemMessage':_0x956574,'maxModelToken':_0x573859,'maxResponseTokens':_0x59f4cd,'maxRounds':(0x0,helper_1[_0x298b04(0x27c)])(_0x13672c),'file':_0x55f8e1});let _0x1b23e4=!![];_0x58b1e7=await(0x0,openai_2[_0x298b04(0x262)])(_0x23a019,{'maxToken':_0x59f4cd,'apiKey':_0x10c085,'model':_0x7b3ef6,'temperature':_0x5eefa1,'proxyUrl':_0xbf1d7e,'usingNetwork':_0x4329d0,'gptsId':_0x9765df,'onProgress':_0x1dfda8=>{const _0x57e877=_0x298b04;_0x3dfcdb['write'](_0x1b23e4?JSON[_0x57e877(0x297)](_0x1dfda8):'\x0a'+JSON[_0x57e877(0x297)](_0x1dfda8)),_0x3fb697=_0x1dfda8,_0x1b23e4=![];}}),_0x5bf7a9=!![];}if(Number(_0x1319d1)===0x2){let _0x3f345a=!![];const {context:_0x4debd2}=await this['nineStore'][_0x298b04(0x28d)](_0x2e3dd1,{'parentMessageId':_0x208ccc,'maxRounds':(0x0,helper_1[_0x298b04(0x27c)])(_0x13672c)});_0x58b1e7=await(0x0,baidu_1[_0x298b04(0x256)])(_0x4debd2,{'temperature':_0x5eefa1,'accessToken':_0x244fc4,'model':_0x7b3ef6,'onProgress':_0x471fe1=>{const _0x3c954d=_0x298b04;_0x3dfcdb[_0x3c954d(0x266)](_0x3f345a?JSON[_0x3c954d(0x297)](_0x471fe1):'\x0a'+JSON[_0x3c954d(0x297)](_0x471fe1)),_0x3f345a=![],_0x3fb697=_0x471fe1;}}),_0x5bf7a9=!![];}if(Number(_0x1319d1)===0x3){let _0x344b62=!![];const {context:_0x4f1f3c}=await this['nineStore'][_0x298b04(0x28d)](_0x2e3dd1,{'parentMessageId':_0x208ccc,'maxRounds':(0x0,helper_1[_0x298b04(0x27c)])(_0x13672c)});_0x58b1e7=await(0x0,zhipu_1[_0x298b04(0x200)])(_0x4f1f3c,{'temperature':_0x5eefa1,'key':_0x10c085,'model':_0x7b3ef6,'onProgress':_0x242002=>{const _0x3be5d4=_0x298b04;_0x3dfcdb[_0x3be5d4(0x266)](_0x344b62?JSON[_0x3be5d4(0x297)](_0x242002):'\x0a'+JSON[_0x3be5d4(0x297)](_0x242002)),_0x344b62=![],_0x3fb697=_0x242002;}}),_0x5bf7a9=!![];}const _0x39bf3d={'id':this[_0x298b04(0x2eb)][_0x298b04(0x246)](),'text':_0x2e3dd1,'file':_0x55f8e1,'role':_0x298b04(0x2c9),'name':undefined,'usage':null,'parentMessageId':_0x208ccc,'conversationId':_0x58b1e7===null||_0x58b1e7===void 0x0?void 0x0:_0x58b1e7[_0x298b04(0x2a4)]};_0x45ddee={'model':_0x7b3ef6,'parentMessageId':_0x208ccc},await this[_0x298b04(0x2eb)][_0x298b04(0x1d2)](_0x39bf3d);const _0x15e29b={'id':_0x58b1e7['id'],'text':_0x58b1e7['text'],'role':_0x298b04(0x235),'name':undefined,'usage':_0x58b1e7[_0x298b04(0x1e3)],'parentMessageId':_0x39bf3d['id'],'conversationId':_0x58b1e7===null||_0x58b1e7===void 0x0?void 0x0:_0x58b1e7['conversationId']};await this[_0x298b04(0x2eb)][_0x298b04(0x1d2)](_0x15e29b),_0x45ddee={'model':_0x7b3ef6,'parentMessageId':_0x39bf3d['id']};}else{const _0x11c9dc=_0x2e3dd1,{context:_0x2e1b29}=await this[_0x298b04(0x2eb)][_0x298b04(0x28d)](_0x11c9dc,{'parentMessageId':_0x208ccc,'systemMessage':_0x956574,'maxRounds':(0x0,helper_1['addOneIfOdd'])(_0x13672c)});_0x58b1e7=await(0x0,openai_2[_0x298b04(0x262)])(_0x2e1b29,{'apiKey':_0x10c085,'model':_0x7b3ef6,'temperature':_0x5eefa1,'proxyUrl':_0xbf1d7e,'onProgress':null});}const _0x503dd1=await(0x0,helper_1['unifiedFormattingResponse'])(_0x1319d1,_0x58b1e7,_0x45ddee),{prompt_tokens:prompt_tokens=0x0,completion_tokens:completion_tokens=0x0,total_tokens:total_tokens=0x0}=_0x503dd1[_0x298b04(0x1e3)];await this[_0x298b04(0x1d9)]['deductFromBalance'](_0x58b1da[_0x298b04(0x2c9)]['id'],_0x298b04(0x26b)+(_0x2f04bf===0x1?0x3:0x4),_0xe39845,total_tokens),await this[_0x298b04(0x270)][_0x298b04(0x22e)](_0x390dc1,_0x119ab4,total_tokens);const _0xc96ce7=(0x0,utils_1[_0x298b04(0x29a)])(_0x58b1da),_0x743462=await this['chatLogService'][_0x298b04(0x2ab)]({'appId':_0xccc845,'curIp':_0xc96ce7,'userId':_0x58b1da[_0x298b04(0x2c9)]['id'],'type':balance_constant_1['DeductionKey'][_0x298b04(0x298)],'prompt':_0x2e3dd1,'answer':'','promptTokens':prompt_tokens,'completionTokens':0x0,'totalTokens':total_tokens,'model':(_0x503dd1===null||_0x503dd1===void 0x0?void 0x0:_0x503dd1[_0x298b04(0x26b)])||_0x7b3ef6,'role':'user','groupId':_0x1cdb1a,'tts':tts,'file':_0x55f8e1,'requestOptions':JSON[_0x298b04(0x297)]({'options':null,'prompt':_0x2e3dd1})}),_0x211cc7=await this[_0x298b04(0x2dc)]['saveChatLog']({'appId':_0xccc845,'curIp':_0xc96ce7,'userId':_0x58b1da['user']['id'],'type':balance_constant_1[_0x298b04(0x29d)][_0x298b04(0x298)],'prompt':_0x2e3dd1,'answer':_0x503dd1===null||_0x503dd1===void 0x0?void 0x0:_0x503dd1[_0x298b04(0x2a1)],'promptTokens':prompt_tokens,'completionTokens':completion_tokens,'totalTokens':total_tokens,'model':(_0x503dd1===null||_0x503dd1===void 0x0?void 0x0:_0x503dd1[_0x298b04(0x26b)])||_0x7b3ef6,'role':'assistant','groupId':_0x1cdb1a,'requestOptions':JSON['stringify']({'options':{'model':_0x7b3ef6,'temperature':_0x5eefa1},'prompt':_0x2e3dd1}),'conversationOptions':JSON[_0x298b04(0x297)]({'conversationId':_0x58b1e7[_0x298b04(0x2a4)],'model':_0x7b3ef6,'parentMessageId':_0x58b1e7['id'],'temperature':_0x5eefa1})});common_1[_0x298b04(0x2f4)][_0x298b04(0x21f)](_0x298b04(0x21d)+_0x58b1da[_0x298b04(0x2c9)]['id']+_0x298b04(0x23a)+_0x7b3ef6+_0x298b04(0x278)+_0x10c085+_0x298b04(0x2d7)+_0x35eafb+',\x20最大回复token:\x20'+_0x59f4cd,_0x298b04(0x1ea));const _0x10d24d=await this[_0x298b04(0x1d9)][_0x298b04(0x219)](_0x58b1da['user']['id']);return _0x58b1e7[_0x298b04(0x281)]=Object[_0x298b04(0x1e2)]({},_0x10d24d),_0x58b1e7['chatId']=_0x211cc7['id'],_0x58b1e7[_0x298b04(0x277)]=_0x743462['id'],_0x58b1e7[_0x298b04(0x2ac)]&&(_0x58b1e7[_0x298b04(0x2ac)]=''),_0x58b1e7[_0x298b04(0x2d8)]=!![],_0x3dfcdb?_0x3dfcdb['write']('\x0a'+JSON[_0x298b04(0x297)](_0x58b1e7)):_0x58b1e7[_0x298b04(0x2a1)];}catch(_0x7c4dc5){const _0x28e25f=(_0x7c4dc5===null||_0x7c4dc5===void 0x0?void 0x0:_0x7c4dc5['statusCode'])||0x190,_0x3b8e98=((_0x482f43=_0x7c4dc5===null||_0x7c4dc5===void 0x0?void 0x0:_0x7c4dc5[_0x298b04(0x1d0)])===null||_0x482f43===void 0x0?void 0x0:_0x482f43['status'])||(_0x7c4dc5===null||_0x7c4dc5===void 0x0?void 0x0:_0x7c4dc5[_0x298b04(0x240)])||0x190;console[_0x298b04(0x1e4)](_0x10c085,_0x298b04(0x1dd),_0x298b04(0x2bc),_0x28e25f,_0x298b04(0x2d1),_0x7c4dc5===null||_0x7c4dc5===void 0x0?void 0x0:_0x7c4dc5[_0x298b04(0x2d1)],_0x298b04(0x291),(_0x5f01b9=_0x7c4dc5===null||_0x7c4dc5===void 0x0?void 0x0:_0x7c4dc5[_0x298b04(0x1d0)])===null||_0x5f01b9===void 0x0?void 0x0:_0x5f01b9[_0x298b04(0x211)],_0x298b04(0x28e),(_0x1204fc=_0x7c4dc5===null||_0x7c4dc5===void 0x0?void 0x0:_0x7c4dc5[_0x298b04(0x1d0)])===null||_0x1204fc===void 0x0?void 0x0:_0x1204fc[_0x298b04(0x28e)]);if(_0x7c4dc5[_0x298b04(0x28e)]&&_0x7c4dc5[_0x298b04(0x28e)]===0x192){const _0x3533c6={'message':'Catch\x20Error\x20'+_0x7c4dc5[_0x298b04(0x2d1)],'code':0x192};if(_0x3dfcdb)return _0x3dfcdb[_0x298b04(0x266)](JSON[_0x298b04(0x297)](_0x3533c6));else throw new common_1[(_0x298b04(0x1de))](_0x7c4dc5[_0x298b04(0x2d1)],common_1['HttpStatus'][_0x298b04(0x2cf)]);}if(!_0x3b8e98){if(_0x3dfcdb)return _0x3dfcdb[_0x298b04(0x266)](JSON[_0x298b04(0x297)]({'message':_0x7c4dc5[_0x298b04(0x2d1)],'code':0x1f4}));else throw new common_1[(_0x298b04(0x1de))](_0x7c4dc5['message'],common_1[_0x298b04(0x2ec)][_0x298b04(0x296)]);}let _0x2874f8=errorMessage_constant_1[_0x298b04(0x237)][_0x3b8e98]?errorMessage_constant_1['OpenAiErrorCodeMessage'][_0x3b8e98]:_0x298b04(0x241);(_0x7c4dc5===null||_0x7c4dc5===void 0x0?void 0x0:_0x7c4dc5[_0x298b04(0x2d1)][_0x298b04(0x1fe)](_0x298b04(0x1e8)))&&Number(_0x1319d1)===0x1&&(await this[_0x298b04(0x270)][_0x298b04(0x2f5)](_0x390dc1,_0x298b04(0x236),-0x1),_0x2874f8=_0x298b04(0x223));(_0x7c4dc5===null||_0x7c4dc5===void 0x0?void 0x0:_0x7c4dc5[_0x298b04(0x240)])===0x1ad&&_0x7c4dc5[_0x298b04(0x2d1)][_0x298b04(0x1fe)]('billing')&&Number(_0x1319d1)===0x1&&(await this[_0x298b04(0x270)][_0x298b04(0x2f5)](_0x390dc1,_0x298b04(0x1d3),-0x3),_0x2874f8='当前模型key余额已耗尽');(_0x7c4dc5===null||_0x7c4dc5===void 0x0?void 0x0:_0x7c4dc5[_0x298b04(0x240)])===0x1ad&&(_0x7c4dc5===null||_0x7c4dc5===void 0x0?void 0x0:_0x7c4dc5['statusText'])==='Too\x20Many\x20Requests'&&(_0x2874f8=_0x298b04(0x2f1));(_0x7c4dc5===null||_0x7c4dc5===void 0x0?void 0x0:_0x7c4dc5[_0x298b04(0x240)])===0x191&&_0x7c4dc5['message'][_0x298b04(0x1fe)]('Incorrect\x20API\x20key\x20provided')&&Number(_0x1319d1)===0x1&&(await this[_0x298b04(0x270)][_0x298b04(0x2f5)](_0x390dc1,_0x298b04(0x249),-0x2),_0x2874f8='提供了错误的模型秘钥、已冻结当前调用Key、请重新尝试对话！');(_0x7c4dc5===null||_0x7c4dc5===void 0x0?void 0x0:_0x7c4dc5['statusCode'])===0x194&&_0x7c4dc5[_0x298b04(0x2d1)][_0x298b04(0x1fe)](_0x298b04(0x27e))&&Number(_0x1319d1)===0x1&&(await this['modelsService'][_0x298b04(0x2f5)](_0x390dc1,_0x298b04(0x24d),-0x4),_0x2874f8='当前模型不是聊天模型、已冻结当前调用Key、请重新尝试对话！');_0x28e25f===0x190&&console[_0x298b04(0x1e4)]('400\x20error',_0x7c4dc5,_0x7c4dc5[_0x298b04(0x2d1)]);const _0x513ed1={'message':_0x2874f8||_0x298b04(0x217),'code':_0x28e25f===0x191?0x190:_0x28e25f||0x1f4};if(_0x3dfcdb)return _0x3dfcdb['write'](JSON['stringify'](_0x513ed1));else throw new common_1[(_0x298b04(0x1de))](_0x513ed1[_0x298b04(0x2d1)],common_1[_0x298b04(0x2ec)][_0x298b04(0x296)]);}finally{_0x3dfcdb&&_0x3dfcdb[_0x298b04(0x206)]();}}async['draw'](_0x563719,_0x3905a6){const _0x2a4bfc=_0x2bcbba;var _0x3d7390,_0x5d2f30,_0x14a478,_0xebe39a;await this[_0x2a4bfc(0x265)][_0x2a4bfc(0x2de)](_0x563719['prompt'],_0x3905a6[_0x2a4bfc(0x2c9)]['id']),await this[_0x2a4bfc(0x2b8)][_0x2a4bfc(0x26c)](_0x3905a6[_0x2a4bfc(0x2c9)]);const _0x52a9bd=(_0x563719===null||_0x563719===void 0x0?void 0x0:_0x563719[_0x2a4bfc(0x24a)])==='hd'?0x4:0x2;await this[_0x2a4bfc(0x1d9)][_0x2a4bfc(0x274)](_0x3905a6,_0x2a4bfc(0x222),_0x52a9bd);let _0x4993f0=[];const _0x29e495=await this['modelsService'][_0x2a4bfc(0x242)]();if(!_0x29e495)throw new common_1[(_0x2a4bfc(0x1de))](_0x2a4bfc(0x216),common_1[_0x2a4bfc(0x2ec)][_0x2a4bfc(0x296)]);const _0x3abd93=_0x29e495===null||_0x29e495===void 0x0?void 0x0:_0x29e495['id'],{key:_0x1f8088}=_0x29e495;let _0x445470=_0x29e495['proxyUrl'];common_1[_0x2a4bfc(0x2f4)]['log'](_0x2a4bfc(0x229)+_0x563719['prompt']+_0x2a4bfc(0x1fc)+_0x1f8088,'DrawService');try{_0x445470[_0x2a4bfc(0x29c)]('/')&&(_0x445470=_0x445470[_0x2a4bfc(0x1ec)](0x0,_0x445470['length']-0x1));const _0x3728c6=_0x445470+_0x2a4bfc(0x2b6),_0x8a56e4=Object['assign'](Object[_0x2a4bfc(0x1e2)]({},_0x563719),{'model':_0x2a4bfc(0x2c8)}),_0x32c7a5=await axios_1[_0x2a4bfc(0x210)][_0x2a4bfc(0x21e)](_0x3728c6,Object[_0x2a4bfc(0x1e2)](Object['assign']({},_0x8a56e4),{'response_format':'b64_json'}),{'headers':{'Authorization':_0x2a4bfc(0x2db)+_0x1f8088}});_0x4993f0=_0x32c7a5[_0x2a4bfc(0x2c4)][_0x2a4bfc(0x2c4)];const _0x36a950=[];for(const _0x2d283e of _0x4993f0){const _0x34b2ab=uuid['v4']()[_0x2a4bfc(0x1ec)](0x0,0xa)+'.png',_0x4097b3=Buffer['from'](_0x2d283e[_0x2a4bfc(0x23d)],_0x2a4bfc(0x263));_0x36a950['push'](this[_0x2a4bfc(0x25e)][_0x2a4bfc(0x1ff)]({'filename':_0x34b2ab,'buffer':_0x4097b3}));}const _0x536faa=await Promise[_0x2a4bfc(0x2e6)](_0x36a950);await this['userBalanceService'][_0x2a4bfc(0x28a)](_0x3905a6[_0x2a4bfc(0x2c9)]['id'],'mjDraw',(_0x8a56e4===null||_0x8a56e4===void 0x0?void 0x0:_0x8a56e4['quality'])===_0x2a4bfc(0x280)?0x2:0x4,_0x52a9bd);const _0x535c46=(0x0,utils_1['getClientIp'])(_0x3905a6),_0x41d4dd=[],_0x45e831=await this[_0x2a4bfc(0x25e)][_0x2a4bfc(0x289)](),[_0x31acdb,_0x291b90]=_0x563719[_0x2a4bfc(0x1d8)][_0x2a4bfc(0x24f)]('x');return _0x536faa[_0x2a4bfc(0x29e)](_0x1bdd69=>{const _0x3c5433=_0x2a4bfc;_0x41d4dd['push'](this['chatLogService'][_0x3c5433(0x2ab)]({'curIp':_0x535c46,'userId':_0x3905a6[_0x3c5433(0x2c9)]['id'],'type':balance_constant_1['DeductionKey'][_0x3c5433(0x2c3)],'prompt':_0x563719[_0x3c5433(0x220)],'answer':_0x1bdd69,'fileInfo':JSON[_0x3c5433(0x297)]({'cosType':_0x45e831,'width':_0x31acdb,'height':_0x291b90,'cosUrl':_0x1bdd69}),'promptTokens':0x0,'completionTokens':0x0,'totalTokens':0x0,'model':_0x3c5433(0x2c8)}));}),await Promise[_0x2a4bfc(0x2e6)](_0x41d4dd),_0x536faa;}catch(_0x12cae1){console[_0x2a4bfc(0x1e4)](_0x2a4bfc(0x24b),_0x12cae1);const _0x1b1a72=((_0x3d7390=_0x12cae1===null||_0x12cae1===void 0x0?void 0x0:_0x12cae1['response'])===null||_0x3d7390===void 0x0?void 0x0:_0x3d7390[_0x2a4bfc(0x28e)])||0x1f4,_0xa00357=(_0xebe39a=(_0x14a478=(_0x5d2f30=_0x12cae1===null||_0x12cae1===void 0x0?void 0x0:_0x12cae1['response'])===null||_0x5d2f30===void 0x0?void 0x0:_0x5d2f30['data'])===null||_0x14a478===void 0x0?void 0x0:_0x14a478['error'])===null||_0xebe39a===void 0x0?void 0x0:_0xebe39a[_0x2a4bfc(0x2d1)];if(_0x1b1a72===0x1ad)throw new common_1[(_0x2a4bfc(0x1de))]('当前请求已过载、请稍等会儿再试试吧！',common_1[_0x2a4bfc(0x2ec)][_0x2a4bfc(0x296)]);if(_0x1b1a72===0x190&&_0xa00357[_0x2a4bfc(0x1fe)](_0x2a4bfc(0x1f2)))throw new common_1[(_0x2a4bfc(0x1de))](_0x2a4bfc(0x1db),common_1[_0x2a4bfc(0x2ec)][_0x2a4bfc(0x296)]);if(_0x1b1a72===0x190&&_0xa00357[_0x2a4bfc(0x1fe)](_0x2a4bfc(0x22a))){await this['modelsService'][_0x2a4bfc(0x2f5)](_0x3abd93,_0x2a4bfc(0x236),-0x1);throw new common_1[(_0x2a4bfc(0x1de))](_0x2a4bfc(0x267),common_1[_0x2a4bfc(0x2ec)][_0x2a4bfc(0x296)]);}if(_0x1b1a72===0x1f4)throw new common_1[(_0x2a4bfc(0x1de))](_0x2a4bfc(0x2e3),common_1[_0x2a4bfc(0x2ec)][_0x2a4bfc(0x296)]);if(_0x1b1a72===0x191)throw new common_1[(_0x2a4bfc(0x1de))]('绘制图片失败，此次绘画被拒绝了！',common_1[_0x2a4bfc(0x2ec)][_0x2a4bfc(0x296)]);throw new common_1[(_0x2a4bfc(0x1de))](_0x2a4bfc(0x27b),common_1[_0x2a4bfc(0x2ec)][_0x2a4bfc(0x296)]);}}async[_0x2bcbba(0x26f)](){const _0x5adf39=_0x2bcbba,_0x9b8e49=await this['gptKeysEntity'][_0x5adf39(0x26d)]({'where':{'status':0x1},'select':['id',_0x5adf39(0x230),_0x5adf39(0x294),_0x5adf39(0x26b),_0x5adf39(0x276),_0x5adf39(0x258),_0x5adf39(0x26a),'openaiTimeoutMs']}),_0x278fb5=_0x9b8e49['filter'](_0x5501b5=>_0x5501b5[_0x5adf39(0x26b)][_0x5adf39(0x1fe)](_0x5adf39(0x207))),_0x1a68b8=_0x9b8e49[_0x5adf39(0x25f)](_0x48e2bd=>_0x48e2bd[_0x5adf39(0x26b)][_0x5adf39(0x1fe)](_0x5adf39(0x1d1)));this['keyPool']={'list3':_0x278fb5,'list4':_0x1a68b8};}async[_0x2bcbba(0x2af)](_0x1993ed){const _0x4bad13=_0x2bcbba,_0x3def07=await this[_0x4bad13(0x2c2)]['getConfigs'](['openaiBaseUrl']);return(_0x1993ed===null||_0x1993ed===void 0x0?void 0x0:_0x1993ed[_0x4bad13(0x20e)])||_0x3def07||_0x4bad13(0x209);}async['formatModelToken'](_0x12ceab){const _0x5100cb=_0x2bcbba,{openaiModel3MaxTokens:openaiModel3MaxTokens=0x0,openaiModel3MaxTokensRes:openaiModel3MaxTokensRes=0x0,openaiModel3MaxTokens16k:openaiModel3MaxTokens16k=0x0,openaiModel3MaxTokens16kRes:openaiModel3MaxTokens16kRes=0x0,openaiModel4MaxTokens:openaiModel4MaxTokens=0x0,openaiModel4MaxTokensRes:openaiModel4MaxTokensRes=0x0,openaiModel4MaxTokens32k:openaiModel4MaxTokens32k=0x0,openaiModel4MaxTokens32kRes:openaiModel4MaxTokens32kRes=0x0,openaiBaseUrl:openaiBaseUrl=''}=await this[_0x5100cb(0x2c2)][_0x5100cb(0x2e8)]([_0x5100cb(0x29f),_0x5100cb(0x2d0),'openaiModel3MaxTokens16k','openaiModel3MaxTokens16kRes',_0x5100cb(0x27f),'openaiModel4MaxTokensRes',_0x5100cb(0x2d3),_0x5100cb(0x226),_0x5100cb(0x2c0)]);let _0x17a26b=null,_0x551f4d=null,_0x1c79fb=null,{model:_0x350f7c,maxModelTokens:maxModelTokens=0x0,maxResponseTokens:maxResponseTokens=0x0,proxyUrl:proxyUrl='',key:_0x2205de}=_0x12ceab;return _0x350f7c['toLowerCase']()[_0x5100cb(0x1fe)](_0x5100cb(0x1d1))&&(maxModelTokens>=0x2000&&(maxModelTokens=0x2000),_0x551f4d>=0x1000&&(maxModelTokens=0x1000),_0x17a26b=maxModelTokens||openaiModel4MaxTokens||0x2000,_0x551f4d=maxResponseTokens||openaiModel4MaxTokensRes||0x1000,_0x350f7c['toLowerCase']()[_0x5100cb(0x1fe)](_0x5100cb(0x23c))&&(maxModelTokens>=0x8000&&(maxModelTokens=0x8000),_0x551f4d>=0x4000&&(maxModelTokens=0x4000),_0x17a26b=maxModelTokens||openaiModel4MaxTokens32k||0x8000,_0x551f4d=maxResponseTokens||openaiModel4MaxTokens32kRes||0x4000),_0x350f7c[_0x5100cb(0x28b)]()[_0x5100cb(0x1fe)]('1106')&&(maxModelTokens>=0x3ffc&&(maxModelTokens=0x3ffc),_0x551f4d>=0x1000&&(maxModelTokens=0x1000),_0x17a26b=maxModelTokens||0x3ffc,_0x551f4d=maxResponseTokens||0x1000)),_0x350f7c[_0x5100cb(0x28b)]()['includes'](_0x5100cb(0x207))&&(maxModelTokens>=0x1000&&(maxModelTokens=0x1000),_0x551f4d>=0x7d0&&(maxModelTokens=0x7d0),_0x17a26b=maxModelTokens||openaiModel3MaxTokens||0x1000,_0x551f4d=maxResponseTokens||openaiModel3MaxTokensRes||0x7d0,_0x350f7c[_0x5100cb(0x28b)]()['includes'](_0x5100cb(0x2df))&&(maxModelTokens>=0x4000&&(maxModelTokens=0x4000),_0x551f4d>=0x2000&&(maxModelTokens=0x2000),_0x17a26b=maxModelTokens||openaiModel3MaxTokens16k||0x4000,_0x551f4d=maxResponseTokens||openaiModel3MaxTokens16kRes||0x2000),_0x350f7c[_0x5100cb(0x28b)]()['includes'](_0x5100cb(0x2e5))&&(maxModelTokens>=0x4000&&(maxModelTokens=0x4000),_0x551f4d>=0x1000&&(maxModelTokens=0x1000),_0x17a26b=maxModelTokens||0x4000,_0x551f4d=maxResponseTokens||0x1000)),_0x1c79fb=proxyUrl||openaiBaseUrl||_0x5100cb(0x209),_0x551f4d>=_0x17a26b&&(_0x551f4d=Math[_0x5100cb(0x20f)](_0x17a26b/0x2)),{'key':_0x2205de,'maxToken':_0x17a26b,'maxTokenRes':_0x551f4d,'proxyResUrl':_0x1c79fb};}async[_0x2bcbba(0x228)](_0x285788,_0x42419e){const _0x28e57c=_0x2bcbba;try{const {name:_0x353a1a,icon:_0x411418,order:_0x59b13c,id:_0x766612,status:_0x25921e}=_0x42419e;return _0x766612?await this[_0x28e57c(0x2bd)]['update']({'id':_0x766612},{'name':_0x353a1a,'icon':_0x411418,'order':_0x59b13c,'status':_0x25921e}):await this[_0x28e57c(0x2bd)][_0x28e57c(0x243)]({'name':_0x353a1a,'icon':_0x411418,'order':_0x59b13c,'status':_0x25921e});}catch(_0xe5e184){console[_0x28e57c(0x1e4)](_0x28e57c(0x24b),_0xe5e184);}}async[_0x2bcbba(0x20b)](_0x45f036,_0x1cff89){const _0x7379ef=_0x2bcbba,{id:_0x744282}=_0x1cff89;if(!_0x744282)throw new common_1[(_0x7379ef(0x1de))](_0x7379ef(0x284),common_1[_0x7379ef(0x2ec)][_0x7379ef(0x296)]);const _0x388c64=await this[_0x7379ef(0x2d4)][_0x7379ef(0x28c)]({'where':{'typeId':_0x744282}});if(_0x388c64)throw new common_1[(_0x7379ef(0x1de))](_0x7379ef(0x2d5),common_1[_0x7379ef(0x2ec)][_0x7379ef(0x296)]);return await this[_0x7379ef(0x2bd)][_0x7379ef(0x2a7)]({'id':_0x744282});}async['queryChatBoxType'](){const _0x1481b4=_0x2bcbba;return await this[_0x1481b4(0x2bd)][_0x1481b4(0x26d)]({'order':{'order':_0x1481b4(0x20a)}});}async[_0x2bcbba(0x2a6)](_0x5d89c0,_0x296b74){const _0x1c599a=_0x2bcbba,{title:_0x26b94b,prompt:_0x12d426,appId:_0x1204b4,order:_0x56d278,status:_0x306dc,typeId:_0x4cc40f,id:_0x221f06,url:_0x4082a4}=_0x296b74;if(!_0x4cc40f)throw new common_1[(_0x1c599a(0x1de))](_0x1c599a(0x1d6),common_1[_0x1c599a(0x2ec)][_0x1c599a(0x296)]);try{const _0x2cb202={'title':_0x26b94b,'order':_0x56d278,'status':_0x306dc,'typeId':_0x4cc40f,'url':_0x4082a4};return _0x2cb202['appId']=_0x1204b4||0x0,_0x2cb202['prompt']=_0x12d426||'',_0x221f06?await this['chatBoxEntity'][_0x1c599a(0x23b)]({'id':_0x221f06},_0x2cb202):await this[_0x1c599a(0x2d4)]['save'](_0x2cb202);}catch(_0x2117ae){console['log']('error:\x20',_0x2117ae);}}async['delChatBox'](_0x586454,_0x586098){const _0x223fd8=_0x2bcbba,{id:_0x3b2ff6}=_0x586098;if(!_0x3b2ff6)throw new common_1[(_0x223fd8(0x1de))](_0x223fd8(0x284),common_1[_0x223fd8(0x2ec)]['BAD_REQUEST']);return await this['chatBoxEntity']['delete']({'id':_0x3b2ff6});}async['queryChatBox'](){const _0x12ad5e=_0x2bcbba,_0x3f631d=await this[_0x12ad5e(0x2d4)]['find']({'order':{'order':_0x12ad5e(0x20a)}}),_0x54fdce=[...new Set(_0x3f631d[_0x12ad5e(0x1f3)](_0x5ae4e5=>_0x5ae4e5['typeId']))],_0x5499d4=[...new Set(_0x3f631d['map'](_0x52d244=>_0x52d244[_0x12ad5e(0x282)]))],_0x543fd3=await this[_0x12ad5e(0x2bd)]['find']({'where':{'id':(0x0,typeorm_1['In'])(_0x54fdce)}}),_0x177482=await this[_0x12ad5e(0x25b)][_0x12ad5e(0x26d)]({'where':{'id':(0x0,typeorm_1['In'])(_0x5499d4)}});return _0x3f631d[_0x12ad5e(0x1f3)](_0x36e0e4=>{const _0x25d47f=_0x12ad5e,{typeId:_0x151677,appId:_0x20cda9}=_0x36e0e4;return _0x36e0e4[_0x25d47f(0x2b0)]=_0x543fd3[_0x25d47f(0x26d)](_0x229085=>_0x229085['id']===_0x151677),_0x36e0e4[_0x25d47f(0x21a)]=_0x177482['find'](_0x33d3a=>_0x33d3a['id']===_0x20cda9),_0x36e0e4;});}async[_0x2bcbba(0x227)](){const _0x355690=_0x2bcbba,_0x404c47=await this['chatBoxTypeEntity'][_0x355690(0x26d)]({'order':{'order':_0x355690(0x20a)},'where':{'status':!![]}}),_0x53dd58=await this[_0x355690(0x2d4)]['find']({'where':{'status':!![]}}),_0x16d256=[...new Set(_0x53dd58[_0x355690(0x1f3)](_0x57a052=>_0x57a052['appId']))],_0x5ecdf3=await this[_0x355690(0x25b)][_0x355690(0x26d)]({'where':{'id':(0x0,typeorm_1['In'])(_0x16d256)}});return _0x53dd58[_0x355690(0x29e)](_0x5972a8=>{const _0x144d9f=_0x355690,_0x242a7b=_0x5ecdf3[_0x144d9f(0x26d)](_0xe3c61f=>_0xe3c61f['id']===_0x5972a8[_0x144d9f(0x282)]);return _0x5972a8['coverImg']=_0x242a7b===null||_0x242a7b===void 0x0?void 0x0:_0x242a7b['coverImg'],_0x5972a8;}),_0x404c47[_0x355690(0x1f3)](_0x4171c0=>{const _0x2bed61=_0x355690;return _0x4171c0['childList']=_0x53dd58[_0x2bed61(0x25f)](_0xd1e940=>_0xd1e940['typeId']===_0x4171c0['id']&&_0xd1e940[_0x2bed61(0x28e)]),_0x4171c0;});}async[_0x2bcbba(0x2e2)](_0x33a1d2,_0x27de9a){const _0x1d50dd=_0x2bcbba;try{const {name:_0x2fab74,icon:_0x97a338,order:_0x5dc9df,id:_0x27d969,status:_0x411e48}=_0x27de9a;return _0x27d969?await this[_0x1d50dd(0x29b)][_0x1d50dd(0x23b)]({'id':_0x27d969},{'name':_0x2fab74,'icon':_0x97a338,'order':_0x5dc9df,'status':_0x411e48}):await this[_0x1d50dd(0x29b)][_0x1d50dd(0x243)]({'name':_0x2fab74,'icon':_0x97a338,'order':_0x5dc9df,'status':_0x411e48});}catch(_0xb53a00){console[_0x1d50dd(0x1e4)](_0x1d50dd(0x24b),_0xb53a00);}}async[_0x2bcbba(0x22b)](_0x4e2b80,_0x1ed4ea){const _0xf1e8d2=_0x2bcbba,{id:_0x5ba216}=_0x1ed4ea;if(!_0x5ba216)throw new common_1[(_0xf1e8d2(0x1de))](_0xf1e8d2(0x284),common_1[_0xf1e8d2(0x2ec)][_0xf1e8d2(0x296)]);const _0x288b1e=await this[_0xf1e8d2(0x2d4)]['count']({'where':{'typeId':_0x5ba216}});if(_0x288b1e)throw new common_1['HttpException'](_0xf1e8d2(0x2d5),common_1[_0xf1e8d2(0x2ec)][_0xf1e8d2(0x296)]);return await this[_0xf1e8d2(0x29b)][_0xf1e8d2(0x2a7)]({'id':_0x5ba216});}async['queryChatPreType'](){const _0x5b923c=_0x2bcbba;return await this[_0x5b923c(0x29b)][_0x5b923c(0x26d)]({'order':{'order':_0x5b923c(0x20a)}});}async[_0x2bcbba(0x20d)](_0x3298de,_0x5d8356){const _0x135836=_0x2bcbba,{title:_0x567bce,prompt:_0x4167c3,appId:_0x94d1a0,order:_0x4b1c82,status:_0x211192,typeId:_0x4514f5,id:_0x452a92,url:_0xa639a2}=_0x5d8356;if(!_0x4514f5)throw new common_1[(_0x135836(0x1de))](_0x135836(0x1d6),common_1[_0x135836(0x2ec)]['BAD_REQUEST']);try{const _0x51e999={'title':_0x567bce,'prompt':_0x4167c3,'order':_0x4b1c82,'status':_0x211192,'typeId':_0x4514f5,'url':_0xa639a2};return _0x452a92?await this['chatPreEntity'][_0x135836(0x23b)]({'id':_0x452a92},_0x51e999):await this['chatPreEntity'][_0x135836(0x243)](_0x51e999);}catch(_0xc1c0af){console[_0x135836(0x1e4)]('error:\x20',_0xc1c0af);}}async[_0x2bcbba(0x2ee)](_0x3edaa7,_0x52a4ce){const _0x583d64=_0x2bcbba,{id:_0x574433}=_0x52a4ce;if(!_0x574433)throw new common_1['HttpException']('非法操作！',common_1[_0x583d64(0x2ec)][_0x583d64(0x296)]);return await this[_0x583d64(0x1fd)]['delete']({'id':_0x574433});}async['queryChatPre'](){const _0x185e6b=_0x2bcbba,_0x354132=await this[_0x185e6b(0x1fd)]['find']({'order':{'order':_0x185e6b(0x20a)}}),_0x3f68e8=[...new Set(_0x354132[_0x185e6b(0x1f3)](_0x3e7a88=>_0x3e7a88[_0x185e6b(0x1da)]))],_0x437ab5=await this['chatPreTypeEntity'][_0x185e6b(0x26d)]({'where':{'id':(0x0,typeorm_1['In'])(_0x3f68e8)}});return _0x354132[_0x185e6b(0x1f3)](_0x138692=>{const _0x32bdfa=_0x185e6b,{typeId:_0x233dda,appId:_0x3726f2}=_0x138692;return _0x138692['typeInfo']=_0x437ab5[_0x32bdfa(0x26d)](_0x38fde2=>_0x38fde2['id']===_0x233dda),_0x138692;});}async[_0x2bcbba(0x28f)](){const _0x2952f1=_0x2bcbba,_0x380e57=await this[_0x2952f1(0x29b)]['find']({'order':{'order':_0x2952f1(0x20a)},'where':{'status':!![]}}),_0x574def=await this[_0x2952f1(0x1fd)][_0x2952f1(0x26d)]({'where':{'status':!![]}});return _0x380e57['map'](_0x4ae74c=>{const _0x2f1fdc=_0x2952f1;return _0x4ae74c['childList']=_0x574def[_0x2f1fdc(0x25f)](_0x447607=>_0x447607[_0x2f1fdc(0x1da)]===_0x4ae74c['id']&&_0x447607[_0x2f1fdc(0x28e)]),_0x4ae74c;});}async[_0x2bcbba(0x2b4)](_0x58ebdd,_0x26e31c,_0x134fcd){const _0x2a65e8=_0x2bcbba;let _0x5c6d44=0x1000,_0x83d7f2=0x800;return _0x58ebdd[_0x2a65e8(0x28b)]()[_0x2a65e8(0x1fe)](_0x2a65e8(0x1d1))&&(_0x5c6d44=_0x26e31c>=0x2004?0x2004:_0x26e31c,_0x83d7f2=_0x134fcd>=0x1000?0x1000:_0x134fcd,_0x58ebdd[_0x2a65e8(0x28b)]()[_0x2a65e8(0x1fe)](_0x2a65e8(0x23c))&&(_0x5c6d44=_0x26e31c>=0x8000?0x8000:_0x26e31c,_0x83d7f2=_0x134fcd>=0x3e80?0x3e80:_0x134fcd),(_0x58ebdd[_0x2a65e8(0x28b)]()[_0x2a65e8(0x1fe)](_0x2a65e8(0x221))||_0x58ebdd[_0x2a65e8(0x28b)]()['includes'](_0x2a65e8(0x288)))&&(_0x5c6d44=_0x26e31c>=0x1f400?0x1f400:_0x26e31c,_0x83d7f2=_0x134fcd>=0x1000?0x1000:_0x134fcd)),_0x58ebdd[_0x2a65e8(0x28b)]()[_0x2a65e8(0x1fe)]('gpt-3')&&(_0x5c6d44=_0x26e31c>=0x1000?0x1000:_0x26e31c,_0x83d7f2=_0x134fcd>=0x800?0x800:_0x134fcd,_0x58ebdd[_0x2a65e8(0x28b)]()['includes'](_0x2a65e8(0x2df))&&(_0x5c6d44=_0x26e31c>=0x4000?0x4000:_0x26e31c,_0x83d7f2=_0x134fcd>=0x1f40?0x1f40:_0x134fcd),_0x58ebdd['toLowerCase']()[_0x2a65e8(0x1fe)](_0x2a65e8(0x2e5))&&(_0x5c6d44=_0x26e31c>=0x4000?0x4000:_0x26e31c,_0x83d7f2=_0x134fcd>=0x1f40?0x1f40:_0x134fcd)),{'maxToken':_0x5c6d44,'maxRes':_0x83d7f2};}};function _0x25a9(_0x3d698a,_0x304406){const _0x363bdc=_0x363b();return _0x25a9=function(_0x25a9c8,_0x2b9eac){_0x25a9c8=_0x25a9c8-0x1cf;let _0x15314f=_0x363bdc[_0x25a9c8];return _0x15314f;},_0x25a9(_0x3d698a,_0x304406);}ChatgptService=__decorate([(0x0,common_1[_0x2bcbba(0x1eb)])(),__param(0x0,(0x0,typeorm_2[_0x2bcbba(0x25a)])(gptkeys_entity_1[_0x2bcbba(0x250)])),__param(0x1,(0x0,typeorm_2[_0x2bcbba(0x25a)])(config_entity_1[_0x2bcbba(0x231)])),__param(0x2,(0x0,typeorm_2[_0x2bcbba(0x25a)])(chatBoxType_entity_1[_0x2bcbba(0x25d)])),__param(0x3,(0x0,typeorm_2[_0x2bcbba(0x25a)])(chatBox_entity_1['ChatBoxEntity'])),__param(0x4,(0x0,typeorm_2[_0x2bcbba(0x25a)])(app_entity_1[_0x2bcbba(0x218)])),__param(0x5,(0x0,typeorm_2['InjectRepository'])(chatPreType_entity_1[_0x2bcbba(0x248)])),__param(0x6,(0x0,typeorm_2[_0x2bcbba(0x25a)])(chatPre_entity_1[_0x2bcbba(0x1d5)])),__metadata('design:paramtypes',[typeorm_1['Repository'],typeorm_1['Repository'],typeorm_1['Repository'],typeorm_1['Repository'],typeorm_1[_0x2bcbba(0x2cb)],typeorm_1[_0x2bcbba(0x2cb)],typeorm_1[_0x2bcbba(0x2cb)],nestjs_config_1[_0x2bcbba(0x208)],userBalance_service_1[_0x2bcbba(0x234)],chatLog_service_1[_0x2bcbba(0x285)],user_service_1[_0x2bcbba(0x269)],upload_service_1[_0x2bcbba(0x238)],badwords_service_1[_0x2bcbba(0x287)],autoreply_service_1[_0x2bcbba(0x2ae)],globalConfig_service_1[_0x2bcbba(0x275)],fanyi_service_1[_0x2bcbba(0x2d9)],chatGroup_service_1[_0x2bcbba(0x2a8)],models_service_1[_0x2bcbba(0x252)]])],ChatgptService),exports[_0x2bcbba(0x1ea)]=ChatgptService;