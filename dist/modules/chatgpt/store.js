'use strict';const _0x2b2c9a=_0x3888;(function(_0x57a82a,_0x2ab4ea){const _0x3ca1c8=_0x3888,_0x32b7bb=_0x57a82a();while(!![]){try{const _0x2e2c22=-parseInt(_0x3ca1c8(0x17f))/0x1+-parseInt(_0x3ca1c8(0x185))/0x2*(parseInt(_0x3ca1c8(0x183))/0x3)+-parseInt(_0x3ca1c8(0x177))/0x4*(parseInt(_0x3ca1c8(0x16a))/0x5)+parseInt(_0x3ca1c8(0x167))/0x6+-parseInt(_0x3ca1c8(0x170))/0x7*(parseInt(_0x3ca1c8(0x189))/0x8)+parseInt(_0x3ca1c8(0x17c))/0x9*(parseInt(_0x3ca1c8(0x171))/0xa)+parseInt(_0x3ca1c8(0x179))/0xb;if(_0x2e2c22===_0x2ab4ea)break;else _0x32b7bb['push'](_0x32b7bb['shift']());}catch(_0x641ad9){_0x32b7bb['push'](_0x32b7bb['shift']());}}}(_0x4a69,0x76f6d));Object[_0x2b2c9a(0x178)](exports,_0x2b2c9a(0x16f),{'value':!![]}),exports[_0x2b2c9a(0x169)]=void 0x0;const uuid_1=require(_0x2b2c9a(0x17e)),tiktoken_1=require('@dqbd/tiktoken'),tokenizer=(0x0,tiktoken_1[_0x2b2c9a(0x17d)])('cl100k_base');function isFileUrl(_0x273868){const _0x920c34=/\.(jpg|jpeg|png|bmp|webp)$/i;return _0x920c34['test'](_0x273868)?!![]:![];}function _0x3888(_0x140967,_0x277a52){const _0x4a6984=_0x4a69();return _0x3888=function(_0x388826,_0xdb8f9a){_0x388826=_0x388826-0x15f;let _0x1b1b12=_0x4a6984[_0x388826];return _0x1b1b12;},_0x3888(_0x140967,_0x277a52);}class NineStore{constructor(_0x434966){const _0x4eed4e=_0x2b2c9a,{store:_0x929e7c,namespace:_0x205a18,expires:_0x4b243e}=this[_0x4eed4e(0x181)](_0x434966);this[_0x4eed4e(0x16c)]=_0x929e7c,this[_0x4eed4e(0x168)]=_0x205a18,this[_0x4eed4e(0x174)]=_0x4b243e;}['formatOptions'](_0x1d4dc8){const _0x42178=_0x2b2c9a,{store:_0x259df9,expires:expires=0x3e8*0x3c*0x3c*0x18*0x3,namespace:namespace=_0x42178(0x187)}=_0x1d4dc8;return{'store':_0x259df9,'namespace':namespace,'expires':expires};}['generateKey'](_0x53eef4){const _0x7fa8ef=_0x2b2c9a;return this[_0x7fa8ef(0x168)]?this['namespace']+'-'+_0x53eef4:_0x53eef4;}async[_0x2b2c9a(0x164)](_0x4d0fb4){const _0x4e97c9=_0x2b2c9a,_0x5c89b5=await this[_0x4e97c9(0x16c)][_0x4e97c9(0x186)](_0x4d0fb4);return _0x5c89b5;}async[_0x2b2c9a(0x184)](_0xc41fb5,_0x417b51=this[_0x2b2c9a(0x174)]){const _0x4a0053=_0x2b2c9a;await this[_0x4a0053(0x16c)][_0x4a0053(0x182)](_0xc41fb5['id'],_0xc41fb5,_0x417b51);}async[_0x2b2c9a(0x172)](_0x1a40c9,_0x40f2a9){const _0x4f886a=_0x2b2c9a;_0x40f2a9[_0x4f886a(0x165)]>=_0x40f2a9[_0x4f886a(0x162)]&&(_0x40f2a9[_0x4f886a(0x165)]=Math['floor'](_0x40f2a9[_0x4f886a(0x162)]/0x2));const {maxRounds:_0x1e78d2,maxModelToken:_0x4a1cf9,maxResponseTokens:_0x34dabc,systemMessage:systemMessage='',name:_0x1a4c8e,file:_0x5949ee}=_0x40f2a9;let {parentMessageId:_0x22a023}=_0x40f2a9;const _0x292860=[];let _0x466504=0x0;systemMessage&&_0x292860[_0x4f886a(0x160)]({'role':_0x4f886a(0x176),'content':systemMessage});const _0x5a005f=_0x292860[_0x4f886a(0x173)];let _0x18d08a=0x0,_0x14283d=_0x292860;_0x1a40c9&&(_0x14283d=_0x292860[_0x4f886a(0x16b)]([{'role':_0x4f886a(0x180),'content':_0x1a40c9,'name':_0x1a4c8e}]));_0x5949ee&&isFileUrl(_0x5949ee)&&(_0x14283d=_0x292860['concat']([{'role':_0x4f886a(0x180),'content':[{'type':_0x4f886a(0x161),'text':_0x1a40c9},{'type':'image_url','image_url':_0x5949ee}],'name':_0x1a4c8e}]));_0x5949ee&&!isFileUrl(_0x5949ee)&&(_0x14283d=_0x292860[_0x4f886a(0x16b)]([{'role':_0x4f886a(0x180),'content':[{'type':_0x5949ee+_0x4f886a(0x188)}],'name':_0x1a4c8e}]));let _0x30fa1b=_0x14283d;do{if(!_0x22a023)break;const _0x35f4fa=await this['getData'](_0x22a023);if(!_0x35f4fa)break;const {text:_0x565f9e,name:_0x320329,role:_0x1f00da,file:_0x2498ac}=_0x35f4fa;let _0x228fdc={};_0x565f9e&&(_0x228fdc={'role':_0x1f00da,'content':_0x565f9e,'name':_0x320329});_0x2498ac&&(_0x228fdc={'role':_0x4f886a(0x180),'content':[{'type':_0x4f886a(0x161),'text':_0x565f9e},{'type':'image_url','image_url':_0x2498ac}],'name':_0x320329});_0x30fa1b=_0x30fa1b[_0x4f886a(0x15f)](0x0,_0x5a005f)[_0x4f886a(0x16b)]([_0x228fdc,..._0x30fa1b['slice'](_0x5a005f)]),_0x18d08a++;if(_0x1e78d2&&_0x18d08a>=_0x1e78d2)break;if(_0x4a1cf9&&_0x34dabc){const _0x4bd0c1=_0x4a1cf9-_0x34dabc;_0x466504=await this[_0x4f886a(0x166)](_0x30fa1b);const _0x199420=_0x466504+0xc8<=_0x4bd0c1;!_0x199420&&(_0x30fa1b=this[_0x4f886a(0x175)](_0x30fa1b,_0x4bd0c1,systemMessage));}_0x22a023=_0x35f4fa[_0x4f886a(0x16d)];}while(!![]);const _0x3ad337=Math['max'](0x1,Math[_0x4f886a(0x16e)](_0x4a1cf9-_0x466504,_0x34dabc));return{'context':_0x30fa1b,'round':_0x30fa1b[_0x4f886a(0x173)],'historyToken':_0x466504,'maxTokens':_0x3ad337};}['_getTokenCount'](_0x465243){const _0x890cff=_0x2b2c9a;let _0x1bbad7=_0x465243['reduce']((_0x5ed6b4,_0x52a21d)=>{return _0x5ed6b4+=_0x52a21d['content'];},'');return _0x1bbad7=_0x1bbad7[_0x890cff(0x17a)](/<\|endoftext\|>/g,''),tokenizer['encode'](_0x1bbad7)['length'];}[_0x2b2c9a(0x175)](_0x27681a,_0x4fc71a,_0x54e81e){const _0x459307=_0x2b2c9a,_0x5472b6=this[_0x459307(0x166)](_0x27681a);if(_0x5472b6<=_0x4fc71a)return _0x27681a;return _0x27681a[_0x459307(0x163)](_0x54e81e?0x1:0x0,0x1),this[_0x459307(0x175)](_0x27681a,_0x4fc71a,_0x54e81e);}[_0x2b2c9a(0x17b)](){return(0x0,uuid_1['v4'])();}}function _0x4a69(){const _0x2cf675=['NineStore','11625dWyNFr','concat','store','parentMessageId','min','__esModule','14dxqgWA','737030kbHmmX','buildMessageFromParentMessageId','length','expires','_recursivePruning','system','836CFyvrz','defineProperty','23688390cZNnfs','replace','getUuid','18bxzhUE','get_encoding','uuid','619500JbUxOi','user','formatOptions','set','12cILvWl','setData','470606SXixxl','get','chat','\x20text','1393696ybgAcX','slice','push','text','maxModelToken','splice','getData','maxResponseTokens','_getTokenCount','3488652gJaufV','namespace'];_0x4a69=function(){return _0x2cf675;};return _0x4a69();}exports[_0x2b2c9a(0x169)]=NineStore;