'use strict';const _0x3714c0=_0x1a11;(function(_0x52d525,_0x595a20){const _0x2378bd=_0x1a11,_0x4878b4=_0x52d525();while(!![]){try{const _0x36e325=-parseInt(_0x2378bd(0x1f5))/0x1*(parseInt(_0x2378bd(0x1dd))/0x2)+parseInt(_0x2378bd(0x1e8))/0x3+-parseInt(_0x2378bd(0x1d3))/0x4*(parseInt(_0x2378bd(0x1d6))/0x5)+-parseInt(_0x2378bd(0x1f3))/0x6*(parseInt(_0x2378bd(0x1f1))/0x7)+parseInt(_0x2378bd(0x1e9))/0x8*(parseInt(_0x2378bd(0x1e1))/0x9)+parseInt(_0x2378bd(0x1f6))/0xa*(-parseInt(_0x2378bd(0x1db))/0xb)+parseInt(_0x2378bd(0x1de))/0xc;if(_0x36e325===_0x595a20)break;else _0x4878b4['push'](_0x4878b4['shift']());}catch(_0x2e35f6){_0x4878b4['push'](_0x4878b4['shift']());}}}(_0x505a,0xcfaca));function _0x505a(){const _0x2370a8=['16LdkOyh','content','reduce','1540780CDZCfV','expires','store','replace','generateKey','13057fOGMhw','slice','236clkDzT','2309676BYEBfD','maxResponseTokens','image_url','4833495ghtLHd','namespace','__esModule','_recursivePruning','user','getData','splice','2161743OHVSrQ','24OfshRV','NineStore','concat','length','buildMessageFromParentMessageId','_getTokenCount','@dqbd/tiktoken','set','12971UyRyhc','chat','120zRzLop','setData','898ScqQsS','2510JoeQWM','maxModelToken','cl100k_base'];_0x505a=function(){return _0x2370a8;};return _0x505a();}Object['defineProperty'](exports,_0x3714c0(0x1e3),{'value':!![]}),exports[_0x3714c0(0x1ea)]=void 0x0;function _0x1a11(_0x4fe7c0,_0x14efac){const _0x505ab1=_0x505a();return _0x1a11=function(_0x1a1196,_0x5d5042){_0x1a1196=_0x1a1196-0x1d1;let _0x5cec66=_0x505ab1[_0x1a1196];return _0x5cec66;},_0x1a11(_0x4fe7c0,_0x14efac);}const uuid_1=require('uuid'),tiktoken_1=require(_0x3714c0(0x1ef)),tokenizer=(0x0,tiktoken_1['get_encoding'])(_0x3714c0(0x1d2));class NineStore{constructor(_0x1c06c6){const _0x579993=_0x3714c0,{store:_0x46601a,namespace:_0x3032f4,expires:_0x1c63d6}=this['formatOptions'](_0x1c06c6);this[_0x579993(0x1d8)]=_0x46601a,this[_0x579993(0x1e2)]=_0x3032f4,this['expires']=_0x1c63d6;}['formatOptions'](_0x4465a7){const _0x5aac77=_0x3714c0,{store:_0x4992db,expires:expires=0x3e8*0x3c*0x3c*0x18*0x3,namespace:namespace=_0x5aac77(0x1f2)}=_0x4465a7;return{'store':_0x4992db,'namespace':namespace,'expires':expires};}[_0x3714c0(0x1da)](_0x48b617){const _0x5a16c8=_0x3714c0;return this[_0x5a16c8(0x1e2)]?this[_0x5a16c8(0x1e2)]+'-'+_0x48b617:_0x48b617;}async[_0x3714c0(0x1e6)](_0x33149b){const _0x1c17a2=_0x3714c0,_0x55a46b=await this[_0x1c17a2(0x1d8)]['get'](_0x33149b);return _0x55a46b;}async[_0x3714c0(0x1f4)](_0xd3e067,_0x50553f=this[_0x3714c0(0x1d7)]){const _0x5216fe=_0x3714c0;await this[_0x5216fe(0x1d8)][_0x5216fe(0x1f0)](_0xd3e067['id'],_0xd3e067,_0x50553f);}async[_0x3714c0(0x1ed)](_0xc032c6,_0x3aed8e){const _0x440b22=_0x3714c0;_0x3aed8e['maxResponseTokens']>=_0x3aed8e[_0x440b22(0x1d1)]&&(_0x3aed8e[_0x440b22(0x1df)]=Math['floor'](_0x3aed8e[_0x440b22(0x1d1)]/0x2));const {maxRounds:_0x109424,maxModelToken:_0x28ba6a,maxResponseTokens:_0x3f468c,systemMessage:systemMessage='',name:_0xb1de54,file:_0x5e0d02}=_0x3aed8e;let {parentMessageId:_0x412254}=_0x3aed8e;const _0x214860=[];let _0x538dd0=0x0;systemMessage&&_0x214860['push']({'role':'system','content':systemMessage});const _0x161198=_0x214860[_0x440b22(0x1ec)];let _0x3dfc28=0x0,_0x422573=_0x214860;_0xc032c6&&(_0x422573=_0x214860['concat']([{'role':_0x440b22(0x1e5),'content':_0xc032c6,'name':_0xb1de54}]));_0x5e0d02&&(_0x422573=_0x214860[_0x440b22(0x1eb)]([{'role':_0x440b22(0x1e5),'content':[{'type':'text','text':_0xc032c6},{'type':_0x440b22(0x1e0),'image_url':_0x5e0d02}],'name':_0xb1de54}]));let _0xb62e7e=_0x422573;do{if(!_0x412254)break;const _0x1f7fd6=await this['getData'](_0x412254);if(!_0x1f7fd6)break;const {text:_0x2fbbff,name:_0x2bc20e,role:_0x1a8ca3,file:_0x310529}=_0x1f7fd6;let _0x2cb900={};_0x2fbbff&&(_0x2cb900={'role':_0x1a8ca3,'content':_0x2fbbff,'name':_0x2bc20e});_0x310529&&(_0x2cb900={'role':_0x440b22(0x1e5),'content':[{'type':'text','text':_0x2fbbff},{'type':_0x440b22(0x1e0),'image_url':_0x310529}],'name':_0x2bc20e});_0xb62e7e=_0xb62e7e[_0x440b22(0x1dc)](0x0,_0x161198)[_0x440b22(0x1eb)]([_0x2cb900,..._0xb62e7e[_0x440b22(0x1dc)](_0x161198)]),_0x3dfc28++;if(_0x109424&&_0x3dfc28>=_0x109424)break;if(_0x28ba6a&&_0x3f468c){const _0x3bea47=_0x28ba6a-_0x3f468c;_0x538dd0=await this[_0x440b22(0x1ee)](_0xb62e7e);const _0xefbee9=_0x538dd0+0xc8<=_0x3bea47;!_0xefbee9&&(_0xb62e7e=this[_0x440b22(0x1e4)](_0xb62e7e,_0x3bea47,systemMessage));}_0x412254=_0x1f7fd6['parentMessageId'];}while(!![]);const _0x2dffd5=Math['max'](0x1,Math['min'](_0x28ba6a-_0x538dd0,_0x3f468c));return{'context':_0xb62e7e,'round':_0xb62e7e[_0x440b22(0x1ec)],'historyToken':_0x538dd0};}['_getTokenCount'](_0x2f2a28){const _0x1c1a29=_0x3714c0;let _0x1c5f3b=_0x2f2a28[_0x1c1a29(0x1d5)]((_0x48526b,_0x174e72)=>{const _0x123693=_0x1c1a29;return _0x48526b+=_0x174e72[_0x123693(0x1d4)];},'');return _0x1c5f3b=_0x1c5f3b[_0x1c1a29(0x1d9)](/<\|endoftext\|>/g,''),tokenizer['encode'](_0x1c5f3b)[_0x1c1a29(0x1ec)];}['_recursivePruning'](_0x208387,_0x1ac28b,_0x2530a1){const _0x3008a6=_0x3714c0,_0x4d5b12=this[_0x3008a6(0x1ee)](_0x208387);if(_0x4d5b12<=_0x1ac28b)return _0x208387;return _0x208387[_0x3008a6(0x1e7)](_0x2530a1?0x1:0x0,0x1),this['_recursivePruning'](_0x208387,_0x1ac28b,_0x2530a1);}['getUuid'](){return(0x0,uuid_1['v4'])();}}exports[_0x3714c0(0x1ea)]=NineStore;