'use strict';const _0x20885e=_0x4741;(function(_0x424995,_0x55e630){const _0xd13214=_0x4741,_0x45c74f=_0x424995();while(!![]){try{const _0x5cae79=-parseInt(_0xd13214(0x152))/0x1+-parseInt(_0xd13214(0x15f))/0x2+parseInt(_0xd13214(0x173))/0x3+parseInt(_0xd13214(0x157))/0x4+parseInt(_0xd13214(0x162))/0x5*(parseInt(_0xd13214(0x153))/0x6)+parseInt(_0xd13214(0x16d))/0x7+-parseInt(_0xd13214(0x156))/0x8*(parseInt(_0xd13214(0x174))/0x9);if(_0x5cae79===_0x55e630)break;else _0x45c74f['push'](_0x45c74f['shift']());}catch(_0x42c910){_0x45c74f['push'](_0x45c74f['shift']());}}}(_0x1158,0x79161));function _0x1158(){const _0x513b1f=['1416668zWuFOk','set','_getTokenCount','generateKey','get','@dqbd/tiktoken','_recursivePruning','namespace','1577348bzQzXv','concat','get_encoding','977425riuzDf','defineProperty','system','buildMessageFromParentMessageId','NineStore','splice','setData','content','slice','formatOptions','length','4577118DfTmml','cl100k_base','max','push','store','floor','1097970kHzKyi','9YOJvhZ','encode','maxModelToken','parentMessageId','expires','user','112946wSIpVD','30pLqwSQ','getUuid','text','7630936KIjyBi'];_0x1158=function(){return _0x513b1f;};return _0x1158();}function _0x4741(_0x3166ec,_0x45729c){const _0x115866=_0x1158();return _0x4741=function(_0x47411c,_0x16e691){_0x47411c=_0x47411c-0x151;let _0x4eec6d=_0x115866[_0x47411c];return _0x4eec6d;},_0x4741(_0x3166ec,_0x45729c);}Object[_0x20885e(0x163)](exports,'__esModule',{'value':!![]}),exports[_0x20885e(0x166)]=void 0x0;const uuid_1=require('uuid'),tiktoken_1=require(_0x20885e(0x15c)),tokenizer=(0x0,tiktoken_1[_0x20885e(0x161)])(_0x20885e(0x16e));class NineStore{constructor(_0x163072){const _0x31c2c4=_0x20885e,{store:_0x5b6b6f,namespace:_0x3ec1b4,expires:_0x2f934a}=this[_0x31c2c4(0x16b)](_0x163072);this[_0x31c2c4(0x171)]=_0x5b6b6f,this[_0x31c2c4(0x15e)]=_0x3ec1b4,this['expires']=_0x2f934a;}[_0x20885e(0x16b)](_0x8e8d13){const {store:_0xe6d5a,expires:expires=0x3e8*0x3c*0x3c*0x18*0x3,namespace:namespace='chat'}=_0x8e8d13;return{'store':_0xe6d5a,'namespace':namespace,'expires':expires};}[_0x20885e(0x15a)](_0x4952dc){const _0x26ddfa=_0x20885e;return this[_0x26ddfa(0x15e)]?this[_0x26ddfa(0x15e)]+'-'+_0x4952dc:_0x4952dc;}async['getData'](_0x8b1c2d){const _0x1ee5ba=_0x20885e,_0x3aada6=await this[_0x1ee5ba(0x171)][_0x1ee5ba(0x15b)](_0x8b1c2d);return _0x3aada6;}async[_0x20885e(0x168)](_0x8e879,_0xc0a1f0=this[_0x20885e(0x178)]){const _0x4bcb70=_0x20885e;await this[_0x4bcb70(0x171)][_0x4bcb70(0x158)](_0x8e879['id'],_0x8e879,_0xc0a1f0);}async[_0x20885e(0x165)](_0x28bf88,_0x152bb3){const _0x25534c=_0x20885e;_0x152bb3['maxResponseTokens']>=_0x152bb3[_0x25534c(0x176)]&&(_0x152bb3['maxResponseTokens']=Math[_0x25534c(0x172)](_0x152bb3[_0x25534c(0x176)]/0x2));const {maxRounds:_0x5cfe3c,maxModelToken:_0x2e883f,maxResponseTokens:_0x11b91e,systemMessage:systemMessage='',name:_0x3e3113,file:_0x4ad526}=_0x152bb3;let {parentMessageId:_0x199176}=_0x152bb3;const _0x344f7b=[];let _0x568e32=0x0;systemMessage&&_0x344f7b[_0x25534c(0x170)]({'role':_0x25534c(0x164),'content':systemMessage});const _0x5bc610=_0x344f7b[_0x25534c(0x16c)];let _0x130c72=0x0,_0x129a9e=_0x344f7b;_0x28bf88&&(_0x129a9e=_0x344f7b[_0x25534c(0x160)]([{'role':_0x25534c(0x151),'content':_0x28bf88,'name':_0x3e3113}]));_0x4ad526&&(_0x129a9e=_0x344f7b[_0x25534c(0x160)]([{'role':_0x25534c(0x151),'content':[{'type':_0x25534c(0x155),'text':_0x28bf88},{'type':'image_url','image_url':_0x4ad526}],'name':_0x3e3113}]));let _0x14846d=_0x129a9e;do{if(!_0x199176)break;const _0x3f3003=await this['getData'](_0x199176);if(!_0x3f3003)break;const {text:_0x38980e,name:_0x2d6629,role:_0x10dccf,file:_0x4dec6e}=_0x3f3003;let _0x5dfc2f={};_0x38980e&&(_0x5dfc2f={'role':_0x10dccf,'content':_0x38980e,'name':_0x2d6629});_0x4dec6e&&(_0x5dfc2f={'role':_0x25534c(0x151),'content':[{'type':_0x25534c(0x155),'text':_0x38980e},{'type':'image_url','image_url':_0x4dec6e}],'name':_0x2d6629});_0x14846d=_0x14846d[_0x25534c(0x16a)](0x0,_0x5bc610)[_0x25534c(0x160)]([_0x5dfc2f,..._0x14846d[_0x25534c(0x16a)](_0x5bc610)]),_0x130c72++;if(_0x5cfe3c&&_0x130c72>=_0x5cfe3c)break;if(_0x2e883f&&_0x11b91e){const _0x36dfdc=_0x2e883f-_0x11b91e;_0x568e32=await this[_0x25534c(0x159)](_0x14846d);const _0x192ae5=_0x568e32+0xc8<=_0x36dfdc;!_0x192ae5&&(_0x14846d=this[_0x25534c(0x15d)](_0x14846d,_0x36dfdc,systemMessage));}_0x199176=_0x3f3003[_0x25534c(0x177)];}while(!![]);const _0x58ae7f=Math[_0x25534c(0x16f)](0x1,Math['min'](_0x2e883f-_0x568e32,_0x11b91e));return{'context':_0x14846d,'round':_0x14846d[_0x25534c(0x16c)],'historyToken':_0x568e32};}[_0x20885e(0x159)](_0x563755){const _0x331ebd=_0x20885e;let _0x4e7bd2=_0x563755['reduce']((_0x191acc,_0xa9fe33)=>{const _0x119147=_0x4741;return _0x191acc+=_0xa9fe33[_0x119147(0x169)];},'');return _0x4e7bd2=_0x4e7bd2['replace'](/<\|endoftext\|>/g,''),tokenizer[_0x331ebd(0x175)](_0x4e7bd2)[_0x331ebd(0x16c)];}[_0x20885e(0x15d)](_0x503907,_0x158df3,_0x48b9c2){const _0x1ff9ef=_0x20885e,_0x2433fb=this[_0x1ff9ef(0x159)](_0x503907);if(_0x2433fb<=_0x158df3)return _0x503907;return _0x503907[_0x1ff9ef(0x167)](_0x48b9c2?0x1:0x0,0x1),this[_0x1ff9ef(0x15d)](_0x503907,_0x158df3,_0x48b9c2);}[_0x20885e(0x154)](){return(0x0,uuid_1['v4'])();}}exports[_0x20885e(0x166)]=NineStore;