'use strict';const _0xa3c030=_0x1fa5;(function(_0x3a47b0,_0x2ca8a6){const _0x2c1d96=_0x1fa5,_0x37a0a0=_0x3a47b0();while(!![]){try{const _0x45561f=-parseInt(_0x2c1d96(0x10c))/0x1+parseInt(_0x2c1d96(0x114))/0x2+parseInt(_0x2c1d96(0x101))/0x3*(parseInt(_0x2c1d96(0x102))/0x4)+-parseInt(_0x2c1d96(0x108))/0x5*(parseInt(_0x2c1d96(0xf4))/0x6)+-parseInt(_0x2c1d96(0xf0))/0x7+-parseInt(_0x2c1d96(0x10b))/0x8+parseInt(_0x2c1d96(0xfa))/0x9*(parseInt(_0x2c1d96(0xf5))/0xa);if(_0x45561f===_0x2ca8a6)break;else _0x37a0a0['push'](_0x37a0a0['shift']());}catch(_0x4c8ebe){_0x37a0a0['push'](_0x37a0a0['shift']());}}}(_0x3eec,0xb73e8));Object[_0xa3c030(0xfe)](exports,_0xa3c030(0xff),{'value':!![]}),exports[_0xa3c030(0xf7)]=exports[_0xa3c030(0xf2)]=exports[_0xa3c030(0x103)]=exports[_0xa3c030(0x115)]=void 0x0;function _0x3eec(){const _0x55b826=['event:','data','8674351hXrquV','HS256','compilerStream','SIGN','1180650bCWGEw','10MerZcx','trim','sendMessageFromZhipu','meta:','log','15546915YTkHhA','https://open.bigmodel.cn/api/paas/v3/model-api/','id:','then','defineProperty','__esModule','replace','1228191ZLRLuT','8QoMtSi','compilerMetaJsonStr','error','data:','round','split','15dhRmTP','sign','jsonwebtoken','2512776qiQgkP','25997lfpMpf','json\x20parse\x20error\x20from\x20zhipu!','application/json','filter','toString','/sse-invoke','length','axios','747902tJlwUs','generateToken','now','catch'];_0x3eec=function(){return _0x55b826;};return _0x3eec();}const axios=require(_0xa3c030(0x113)),jwt=require(_0xa3c030(0x10a));function generateToken(_0x5d220f,_0x9237e9=0x3e8*0x3c*0x3c*0x18*0x168){const _0x118572=_0xa3c030,[_0x499ae3,_0x469f01]=_0x5d220f[_0x118572(0x107)]('.'),_0x1646aa={'api_key':_0x499ae3,'exp':Math[_0x118572(0x106)](Date[_0x118572(0x116)]())+_0x9237e9*0x3e8,'timestamp':Math[_0x118572(0x106)](Date[_0x118572(0x116)]())};return jwt[_0x118572(0x109)](_0x1646aa,_0x469f01,{'algorithm':_0x118572(0xf1),'header':{'alg':_0x118572(0xf1),'sign_type':_0x118572(0xf3)}});}exports[_0xa3c030(0x115)]=generateToken;function compilerMetaJsonStr(_0x4701ee){const _0x25ab48=_0xa3c030;let _0x427139={};try{_0x427139=JSON['parse'](_0x4701ee);}catch(_0x142b00){_0x427139={'usage':{'completion_tokens':0x31,'prompt_tokens':0x14d,'total_tokens':0x18f}},console[_0x25ab48(0x104)](_0x25ab48(0x10d),_0x4701ee);}return _0x427139;}exports['compilerMetaJsonStr']=compilerMetaJsonStr;function _0x1fa5(_0x1acde4,_0x4dca9c){const _0x3eec7a=_0x3eec();return _0x1fa5=function(_0x1fa5ff,_0x3e507a){_0x1fa5ff=_0x1fa5ff-0xee;let _0x452c1b=_0x3eec7a[_0x1fa5ff];return _0x452c1b;},_0x1fa5(_0x1acde4,_0x4dca9c);}function compilerStream(_0x4bf7f2){const _0x1e8f1f=_0xa3c030;var _0x570dd4;if(_0x4bf7f2[_0x1e8f1f(0x112)]===0x3)return{'event':_0x4bf7f2[0x0][_0x1e8f1f(0x100)](_0x1e8f1f(0xee),''),'id':_0x4bf7f2[0x1][_0x1e8f1f(0x100)](_0x1e8f1f(0xfc),''),'is_end':![],'result':_0x4bf7f2[0x2][_0x1e8f1f(0x100)](_0x1e8f1f(0x105),'')['trim']()};if(_0x4bf7f2[_0x1e8f1f(0x112)]===0x4)return{'event':_0x4bf7f2[0x0]['replace'](_0x1e8f1f(0xee),''),'id':_0x4bf7f2[0x1][_0x1e8f1f(0x100)](_0x1e8f1f(0xfc),''),'result':_0x4bf7f2[0x2][_0x1e8f1f(0x100)](_0x1e8f1f(0x105),'')[_0x1e8f1f(0xf6)](),'is_end':!![],'usage':(_0x570dd4=compilerMetaJsonStr(_0x4bf7f2[0x3][_0x1e8f1f(0x100)](_0x1e8f1f(0xf8),'')))===null||_0x570dd4===void 0x0?void 0x0:_0x570dd4['usage']};}exports[_0xa3c030(0xf2)]=compilerStream;async function sendMessageFromZhipu(_0xd4c2d5,{onProgress:_0x4cc9ed,key:_0xe0309f,model:_0x3ed0b6,temperature:temperature=0.95}){const _0x332473=await generateToken(_0xe0309f);return new Promise((_0x27639a,_0x3b4f39)=>{const _0x4599ce=_0x1fa5,_0x968a10=_0x4599ce(0xfb)+_0x3ed0b6+_0x4599ce(0x111),_0x5801b1={'method':'POST','url':_0x968a10,'responseType':'stream','headers':{'Content-Type':_0x4599ce(0x10e),'Authorization':_0x332473},'data':{'prompt':_0xd4c2d5,'temperature':temperature}};axios(_0x5801b1)[_0x4599ce(0xfd)](_0x14b5bb=>{const _0x39d11d=_0x4599ce,_0x574098=_0x14b5bb[_0x39d11d(0xef)];let _0x51ab2c,_0xe7d857='';_0x574098['on']('data',_0x2a90ed=>{const _0x218eb0=_0x39d11d,_0x224d5f=_0x2a90ed[_0x218eb0(0x110)]()[_0x218eb0(0x107)]('\x0a')[_0x218eb0(0x10f)](_0x5165dc=>_0x5165dc['trim']()!==''),_0x4071d1=compilerStream(_0x224d5f);if(!_0x4071d1)return;const {id:_0x56c82f,result:_0xc08911,is_end:_0x3acb3d}=_0x4071d1;_0xc08911&&(_0xe7d857+=_0xc08911[_0x218eb0(0xf6)]()),_0x3acb3d&&(_0x4071d1['is_end']=![],_0x51ab2c=_0x4071d1,_0x51ab2c['text']=_0xe7d857),_0x4cc9ed(_0x4071d1);}),_0x574098['on']('end',()=>{_0x27639a(_0x51ab2c),_0xe7d857='';});})[_0x4599ce(0x117)](_0x37605c=>{const _0x5e5f90=_0x4599ce;console[_0x5e5f90(0xf9)]('error:\x20',_0x37605c);});});}exports[_0xa3c030(0xf7)]=sendMessageFromZhipu;