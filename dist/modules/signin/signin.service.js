'use strict';function _0x58ee(_0x18a03c,_0x5e7585){const _0x10ec89=_0x10ec();return _0x58ee=function(_0x58ee34,_0x2367c9){_0x58ee34=_0x58ee34-0xbe;let _0x57cd6d=_0x10ec89[_0x58ee34];return _0x57cd6d;},_0x58ee(_0x18a03c,_0x5e7585);}const _0x226054=_0x58ee;(function(_0x180ec6,_0x3b1925){const _0x437fa2=_0x58ee,_0x398f44=_0x180ec6();while(!![]){try{const _0x3bf12a=-parseInt(_0x437fa2(0xc9))/0x1+parseInt(_0x437fa2(0xbf))/0x2+-parseInt(_0x437fa2(0xe4))/0x3*(-parseInt(_0x437fa2(0xf0))/0x4)+-parseInt(_0x437fa2(0xdd))/0x5+-parseInt(_0x437fa2(0xd2))/0x6+-parseInt(_0x437fa2(0xe2))/0x7*(parseInt(_0x437fa2(0x100))/0x8)+parseInt(_0x437fa2(0xfb))/0x9*(parseInt(_0x437fa2(0xe6))/0xa);if(_0x3bf12a===_0x3b1925)break;else _0x398f44['push'](_0x398f44['shift']());}catch(_0x415082){_0x398f44['push'](_0x398f44['shift']());}}}(_0x10ec,0x1920c));var __decorate=this&&this[_0x226054(0xe9)]||function(_0x50a1e4,_0x1b1816,_0x269fb2,_0x461c24){const _0x3de4df=_0x226054;var _0x5bc9ba=arguments[_0x3de4df(0xff)],_0x543ec7=_0x5bc9ba<0x3?_0x1b1816:_0x461c24===null?_0x461c24=Object[_0x3de4df(0xf4)](_0x1b1816,_0x269fb2):_0x461c24,_0x55d0c3;if(typeof Reflect===_0x3de4df(0x105)&&typeof Reflect[_0x3de4df(0x107)]===_0x3de4df(0xf1))_0x543ec7=Reflect[_0x3de4df(0x107)](_0x50a1e4,_0x1b1816,_0x269fb2,_0x461c24);else{for(var _0xc1397e=_0x50a1e4[_0x3de4df(0xff)]-0x1;_0xc1397e>=0x0;_0xc1397e--)if(_0x55d0c3=_0x50a1e4[_0xc1397e])_0x543ec7=(_0x5bc9ba<0x3?_0x55d0c3(_0x543ec7):_0x5bc9ba>0x3?_0x55d0c3(_0x1b1816,_0x269fb2,_0x543ec7):_0x55d0c3(_0x1b1816,_0x269fb2))||_0x543ec7;}return _0x5bc9ba>0x3&&_0x543ec7&&Object[_0x3de4df(0xd7)](_0x1b1816,_0x269fb2,_0x543ec7),_0x543ec7;},__metadata=this&&this['__metadata']||function(_0x42959f,_0x54e0fd){const _0x5c774f=_0x226054;if(typeof Reflect===_0x5c774f(0x105)&&typeof Reflect[_0x5c774f(0xe5)]===_0x5c774f(0xf1))return Reflect[_0x5c774f(0xe5)](_0x42959f,_0x54e0fd);},__param=this&&this[_0x226054(0xe0)]||function(_0x392447,_0x4f8ee3){return function(_0xcae4ce,_0x511c94){_0x4f8ee3(_0xcae4ce,_0x511c94,_0x392447);};};Object[_0x226054(0xd7)](exports,_0x226054(0xee),{'value':!![]}),exports[_0x226054(0xc4)]=void 0x0;function _0x10ec(){const _0x27e2c7=['今日已签到、改天再来吧!.','143548tKTzZO','signin','../user/user.entity','userEntity','signin.signInTime\x20>=\x20:firstDay','SigninService','design:paramtypes','findOne','../../common/utils/date','signInDate','55537pJmFwI','day','format','select','获取签到数据失败！','SigninEntity','./../userBalance/userBalance.service','isSigned','log','604224osRqdX','UserEntity','用户不存在','getRawMany','Repository','defineProperty','createQueryBuilder','find','push','@nestjs/common','endOf','974715msrQGP','Logger','saveRecordRechargeLog','__param','InjectRepository','85589IwslLu','../../common/constants/balance.constant','108657aOIMpa','metadata','1678680QKFDhA','昨天签到了、今天是连续签到！','SIGN_IN','__decorate','globalConfigService','HttpException','default','signin.signInTime\x20<=\x20:lastDay','__esModule','getSignatureGiftConfig','20oHkfdG','function','RechargeType','./../globalConfig/globalConfig.service','getOwnPropertyDescriptor','update','getDate','userBalanceService','month','YYYY-MM-DD','setDate','18cAruxy','addBalanceToUser','getSigninLog','UserBalanceService','length','88EMatxT','sign','andWhere','BAD_REQUEST','save','object','GlobalConfigService','decorate','user','subtract','signinEntity','Injectable','HttpStatus'];_0x10ec=function(){return _0x27e2c7;};return _0x10ec();}const globalConfig_service_1=require(_0x226054(0xf3)),userBalance_service_1=require(_0x226054(0xcf)),common_1=require(_0x226054(0xdb)),signIn_entity_1=require('./signIn.entity'),typeorm_1=require('@nestjs/typeorm'),typeorm_2=require('typeorm'),date_1=require(_0x226054(0xc7)),user_entity_1=require(_0x226054(0xc1)),balance_constant_1=require(_0x226054(0xe3));let SigninService=class SigninService{constructor(_0x594cea,_0x264c74,_0x1bc58f,_0x129d3a){const _0x1a57f2=_0x226054;this[_0x1a57f2(0x10a)]=_0x594cea,this[_0x1a57f2(0xc2)]=_0x264c74,this[_0x1a57f2(0xf7)]=_0x1bc58f,this['globalConfigService']=_0x129d3a;}async[_0x226054(0x101)](_0x2afc5f){const _0x2ca0a4=_0x226054,{id:_0x15979e}=_0x2afc5f[_0x2ca0a4(0x108)],_0x3d179e=(0x0,date_1[_0x2ca0a4(0xec)])(new Date())[_0x2ca0a4(0xcb)]('YYYY-MM-DD'),_0x266e01=await this[_0x2ca0a4(0x10a)][_0x2ca0a4(0xc6)]({'where':{'userId':_0x15979e,'signInDate':_0x3d179e}});if(_0x266e01)throw new common_1[(_0x2ca0a4(0xeb))](_0x2ca0a4(0xbe),common_1[_0x2ca0a4(0x10c)][_0x2ca0a4(0x103)]);const {model3Count:_0x2f32a3,model4Count:_0x464c5b,drawMjCount:_0x3c5722}=await this[_0x2ca0a4(0xea)][_0x2ca0a4(0xef)]();await this['signinEntity'][_0x2ca0a4(0x104)]({'userId':_0x15979e,'signInTime':new Date(),'signInDate':_0x3d179e,'isSigned':!![]}),await this['userBalanceService'][_0x2ca0a4(0xfc)](_0x15979e,{'model3Count':_0x2f32a3,'model4Count':_0x464c5b,'drawMjCount':_0x3c5722}),await this[_0x2ca0a4(0xf7)][_0x2ca0a4(0xdf)]({'userId':_0x15979e,'rechargeType':balance_constant_1[_0x2ca0a4(0xf2)][_0x2ca0a4(0xe8)],'model3Count':_0x2f32a3,'model4Count':_0x464c5b,'drawMjCount':_0x3c5722});const _0x58251c=(0x0,date_1[_0x2ca0a4(0xec)])(new Date())[_0x2ca0a4(0x109)](0x1,_0x2ca0a4(0xca))['format'](_0x2ca0a4(0xf9)),_0x1e46ce=await this['signinEntity'][_0x2ca0a4(0xc6)]({'where':{'userId':_0x15979e,'signInDate':_0x58251c}});if(_0x1e46ce){common_1[_0x2ca0a4(0xde)]['debug']('用户'+_0x15979e+_0x2ca0a4(0xe7),'SigninService');const _0xb85d8d=await this[_0x2ca0a4(0xc2)][_0x2ca0a4(0xc6)]({'where':{'id':_0x15979e}});if(!_0xb85d8d)throw new common_1[(_0x2ca0a4(0xeb))](_0x2ca0a4(0xd4),common_1[_0x2ca0a4(0x10c)][_0x2ca0a4(0x103)]);const {consecutiveDays:consecutiveDays=0x0}=_0xb85d8d;await this[_0x2ca0a4(0xc2)][_0x2ca0a4(0xf5)]({'id':_0x15979e},{'consecutiveDays':consecutiveDays+0x1});}else common_1[_0x2ca0a4(0xde)]['debug']('用户'+_0x15979e+'昨天没签到、今天重置天数！','SigninService'),await this[_0x2ca0a4(0xc2)][_0x2ca0a4(0xf5)]({'id':_0x15979e},{'consecutiveDays':0x1});return'Sign\x20in\x20successful.';}async[_0x226054(0xfd)](_0x33b64c){const _0x3525eb=_0x226054;try{const {id:_0x3ac802}=_0x33b64c[_0x3525eb(0x108)],_0x561246=(0x0,date_1[_0x3525eb(0xec)])()['startOf'](_0x3525eb(0xf8))['format']('YYYY-MM-DD\x20HH:mm:ss'),_0x4dae96=(0x0,date_1['default'])()[_0x3525eb(0xdc)](_0x3525eb(0xf8))[_0x3525eb(0xcb)]('YYYY-MM-DD\x20HH:mm:ss'),_0x3d6b38=this[_0x3525eb(0x10a)][_0x3525eb(0xd8)](_0x3525eb(0xc0)),_0xe005be=await _0x3d6b38[_0x3525eb(0xcc)]('signin.signInDate\x20as\x20signInDate,\x20signin.isSigned\x20as\x20isSigned')[_0x3525eb(0x102)]('signin.userId\x20=\x20:userId',{'userId':_0x33b64c['user']['id']})['andWhere'](_0x3525eb(0xc3),{'firstDay':_0x561246})[_0x3525eb(0x102)](_0x3525eb(0xed),{'lastDay':_0x4dae96})[_0x3525eb(0xd5)](),_0x583b58=new Date(_0x561246),_0x406028=new Date(_0x4dae96),_0x424b38=[],_0x17afac=new Date(_0x583b58);while(_0x17afac<=_0x406028){_0x424b38[_0x3525eb(0xda)]((0x0,date_1[_0x3525eb(0xec)])(new Date(_0x17afac))[_0x3525eb(0xcb)](_0x3525eb(0xf9))),_0x17afac[_0x3525eb(0xfa)](_0x17afac[_0x3525eb(0xf6)]()+0x1);}const _0x53feae=[];for(const _0x1fb674 of _0x424b38){const _0x5dae19=_0xe005be[_0x3525eb(0xd9)](_0xc5b6a9=>_0xc5b6a9[_0x3525eb(0xc8)]===_0x1fb674);!_0x5dae19?_0x53feae['push']({'signInDate':_0x1fb674,'isSigned':![]}):(_0x5dae19[_0x3525eb(0xd0)]=!![],_0x53feae[_0x3525eb(0xda)](_0x5dae19));}return _0x53feae;}catch(_0x379dd8){console[_0x3525eb(0xd1)]('error:\x20',_0x379dd8);throw new common_1[(_0x3525eb(0xeb))](_0x3525eb(0xcd),common_1['HttpStatus'][_0x3525eb(0x103)]);}}};SigninService=__decorate([(0x0,common_1[_0x226054(0x10b)])(),__param(0x0,(0x0,typeorm_1[_0x226054(0xe1)])(signIn_entity_1[_0x226054(0xce)])),__param(0x1,(0x0,typeorm_1[_0x226054(0xe1)])(user_entity_1[_0x226054(0xd3)])),__metadata(_0x226054(0xc5),[typeorm_2[_0x226054(0xd6)],typeorm_2['Repository'],userBalance_service_1[_0x226054(0xfe)],globalConfig_service_1[_0x226054(0x106)]])],SigninService),exports[_0x226054(0xc4)]=SigninService;