'use strict';const _0x2a6405=_0x4308;(function(_0x462fee,_0x28d57f){const _0x425049=_0x4308,_0x3bb964=_0x462fee();while(!![]){try{const _0x5ad1f1=parseInt(_0x425049(0x1a4))/0x1+-parseInt(_0x425049(0x1ac))/0x2+parseInt(_0x425049(0x1c0))/0x3+-parseInt(_0x425049(0x1cf))/0x4+parseInt(_0x425049(0x1a3))/0x5+parseInt(_0x425049(0x1aa))/0x6+-parseInt(_0x425049(0x1a9))/0x7*(-parseInt(_0x425049(0x1b9))/0x8);if(_0x5ad1f1===_0x28d57f)break;else _0x3bb964['push'](_0x3bb964['shift']());}catch(_0x44a08e){_0x3bb964['push'](_0x3bb964['shift']());}}}(_0x3ea1,0x49d77));var __decorate=this&&this[_0x2a6405(0x1bc)]||function(_0x5449f6,_0x5a1936,_0xe48cb4,_0xb87e12){const _0x15768d=_0x2a6405;var _0x1f4b3f=arguments['length'],_0x1ef8d9=_0x1f4b3f<0x3?_0x5a1936:_0xb87e12===null?_0xb87e12=Object[_0x15768d(0x1a2)](_0x5a1936,_0xe48cb4):_0xb87e12,_0x5c08dc;if(typeof Reflect===_0x15768d(0x1b6)&&typeof Reflect[_0x15768d(0x1d7)]===_0x15768d(0x1ad))_0x1ef8d9=Reflect[_0x15768d(0x1d7)](_0x5449f6,_0x5a1936,_0xe48cb4,_0xb87e12);else{for(var _0x416ca3=_0x5449f6[_0x15768d(0x1db)]-0x1;_0x416ca3>=0x0;_0x416ca3--)if(_0x5c08dc=_0x5449f6[_0x416ca3])_0x1ef8d9=(_0x1f4b3f<0x3?_0x5c08dc(_0x1ef8d9):_0x1f4b3f>0x3?_0x5c08dc(_0x5a1936,_0xe48cb4,_0x1ef8d9):_0x5c08dc(_0x5a1936,_0xe48cb4))||_0x1ef8d9;}return _0x1f4b3f>0x3&&_0x1ef8d9&&Object[_0x15768d(0x199)](_0x5a1936,_0xe48cb4,_0x1ef8d9),_0x1ef8d9;},__metadata=this&&this['__metadata']||function(_0x252d9d,_0x1c817e){const _0x4d999b=_0x2a6405;if(typeof Reflect==='object'&&typeof Reflect[_0x4d999b(0x1b2)]===_0x4d999b(0x1ad))return Reflect[_0x4d999b(0x1b2)](_0x252d9d,_0x1c817e);},__param=this&&this[_0x2a6405(0x1c9)]||function(_0x45e92d,_0x5a3102){return function(_0x49c832,_0x5c789e){_0x5a3102(_0x49c832,_0x5c789e,_0x45e92d);};};function _0x3ea1(){const _0x1d7059=['185800EgopZf','343643ejcFwB','InjectRepository','getDate','log','UserBalanceService','238PUVMSj','139434cLYOol','@nestjs/typeorm','1201746qmNchz','function','用户不存在','format','update','isSigned','metadata','RechargeType','error:\x20','./signIn.entity','object','signin','userBalanceService','13664CSnMlD','debug','save','__decorate','getSigninLog','YYYY-MM-DD','getRawMany','1677081JLEJSE','./../userBalance/userBalance.service','HttpException','saveRecordRechargeLog','signin.signInTime\x20<=\x20:lastDay','signinEntity','Logger','SigninService','sign','__param','findOne','userEntity','month','@nestjs/common','setDate','471252YMgcHL','../user/user.entity','./../globalConfig/globalConfig.service','typeorm','Repository','获取签到数据失败！','andWhere','select','decorate','../../common/constants/balance.constant','signin.signInTime\x20>=\x20:firstDay','subtract','length','UserEntity','昨天签到了、今天是连续签到！','find','design:paramtypes','globalConfigService','createQueryBuilder','user','defineProperty','今日已签到、改天再来吧!.','push','signInDate','YYYY-MM-DD\x20HH:mm:ss','SigninEntity','default','endOf','BAD_REQUEST','getOwnPropertyDescriptor'];_0x3ea1=function(){return _0x1d7059;};return _0x3ea1();}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[_0x2a6405(0x1c7)]=void 0x0;const globalConfig_service_1=require(_0x2a6405(0x1d1)),userBalance_service_1=require(_0x2a6405(0x1c1)),common_1=require(_0x2a6405(0x1cd)),signIn_entity_1=require(_0x2a6405(0x1b5)),typeorm_1=require(_0x2a6405(0x1ab)),typeorm_2=require(_0x2a6405(0x1d2)),date_1=require('../../common/utils/date'),user_entity_1=require(_0x2a6405(0x1d0)),balance_constant_1=require(_0x2a6405(0x1d8));function _0x4308(_0x387f23,_0x5020b6){const _0x3ea1d1=_0x3ea1();return _0x4308=function(_0x430802,_0x54173c){_0x430802=_0x430802-0x193;let _0x4f3cc9=_0x3ea1d1[_0x430802];return _0x4f3cc9;},_0x4308(_0x387f23,_0x5020b6);}let SigninService=class SigninService{constructor(_0x375bc1,_0x41bedd,_0x5a1b15,_0x596e27){const _0xb0318e=_0x2a6405;this[_0xb0318e(0x1c5)]=_0x375bc1,this[_0xb0318e(0x1cb)]=_0x41bedd,this[_0xb0318e(0x1b8)]=_0x5a1b15,this[_0xb0318e(0x196)]=_0x596e27;}async[_0x2a6405(0x1c8)](_0x3c6781){const _0x59c604=_0x2a6405,{id:_0x2eacde}=_0x3c6781[_0x59c604(0x198)],_0x3559af=(0x0,date_1[_0x59c604(0x19f)])(new Date())[_0x59c604(0x1af)](_0x59c604(0x1be)),_0x3035fb=await this[_0x59c604(0x1c5)][_0x59c604(0x1ca)]({'where':{'userId':_0x2eacde,'signInDate':_0x3559af}});if(_0x3035fb)throw new common_1['HttpException'](_0x59c604(0x19a),common_1['HttpStatus'][_0x59c604(0x1a1)]);const {model3Count:_0x57dcb6,model4Count:_0x1eb4d8,drawMjCount:_0x34c43b}=await this[_0x59c604(0x196)]['getSignatureGiftConfig']();await this[_0x59c604(0x1c5)][_0x59c604(0x1bb)]({'userId':_0x2eacde,'signInTime':new Date(),'signInDate':_0x3559af,'isSigned':!![]}),await this[_0x59c604(0x1b8)]['addBalanceToUser'](_0x2eacde,{'model3Count':_0x57dcb6,'model4Count':_0x1eb4d8,'drawMjCount':_0x34c43b}),await this['userBalanceService'][_0x59c604(0x1c3)]({'userId':_0x2eacde,'rechargeType':balance_constant_1[_0x59c604(0x1b3)]['SIGN_IN'],'model3Count':_0x57dcb6,'model4Count':_0x1eb4d8,'drawMjCount':_0x34c43b});const _0x47cb2d=(0x0,date_1['default'])(new Date())[_0x59c604(0x1da)](0x1,'day')[_0x59c604(0x1af)]('YYYY-MM-DD'),_0x4c44f1=await this[_0x59c604(0x1c5)][_0x59c604(0x1ca)]({'where':{'userId':_0x2eacde,'signInDate':_0x47cb2d}});if(_0x4c44f1){common_1[_0x59c604(0x1c6)][_0x59c604(0x1ba)]('用户'+_0x2eacde+_0x59c604(0x193),_0x59c604(0x1c7));const _0x5f052c=await this[_0x59c604(0x1cb)][_0x59c604(0x1ca)]({'where':{'id':_0x2eacde}});if(!_0x5f052c)throw new common_1[(_0x59c604(0x1c2))](_0x59c604(0x1ae),common_1['HttpStatus'][_0x59c604(0x1a1)]);const {consecutiveDays:consecutiveDays=0x0}=_0x5f052c;await this[_0x59c604(0x1cb)][_0x59c604(0x1b0)]({'id':_0x2eacde},{'consecutiveDays':consecutiveDays+0x1});}else common_1[_0x59c604(0x1c6)][_0x59c604(0x1ba)]('用户'+_0x2eacde+'昨天没签到、今天重置天数！',_0x59c604(0x1c7)),await this[_0x59c604(0x1cb)][_0x59c604(0x1b0)]({'id':_0x2eacde},{'consecutiveDays':0x1});return'Sign\x20in\x20successful.';}async[_0x2a6405(0x1bd)](_0x153199){const _0x359ab9=_0x2a6405;try{const {id:_0x28c76b}=_0x153199[_0x359ab9(0x198)],_0x4908c1=(0x0,date_1[_0x359ab9(0x19f)])()['startOf'](_0x359ab9(0x1cc))[_0x359ab9(0x1af)]('YYYY-MM-DD\x20HH:mm:ss'),_0x3823ec=(0x0,date_1['default'])()[_0x359ab9(0x1a0)](_0x359ab9(0x1cc))[_0x359ab9(0x1af)](_0x359ab9(0x19d)),_0x41a7bb=this[_0x359ab9(0x1c5)][_0x359ab9(0x197)](_0x359ab9(0x1b7)),_0xb123aa=await _0x41a7bb[_0x359ab9(0x1d6)]('signin.signInDate\x20as\x20signInDate,\x20signin.isSigned\x20as\x20isSigned')[_0x359ab9(0x1d5)]('signin.userId\x20=\x20:userId',{'userId':_0x153199[_0x359ab9(0x198)]['id']})[_0x359ab9(0x1d5)](_0x359ab9(0x1d9),{'firstDay':_0x4908c1})[_0x359ab9(0x1d5)](_0x359ab9(0x1c4),{'lastDay':_0x3823ec})[_0x359ab9(0x1bf)](),_0x1d7a2c=new Date(_0x4908c1),_0x177e16=new Date(_0x3823ec),_0x4d322a=[],_0x311029=new Date(_0x1d7a2c);while(_0x311029<=_0x177e16){_0x4d322a['push']((0x0,date_1['default'])(new Date(_0x311029))[_0x359ab9(0x1af)]('YYYY-MM-DD')),_0x311029[_0x359ab9(0x1ce)](_0x311029[_0x359ab9(0x1a6)]()+0x1);}const _0x23e447=[];for(const _0x29281e of _0x4d322a){const _0xe6c8fb=_0xb123aa[_0x359ab9(0x194)](_0x5c6d54=>_0x5c6d54[_0x359ab9(0x19c)]===_0x29281e);!_0xe6c8fb?_0x23e447[_0x359ab9(0x19b)]({'signInDate':_0x29281e,'isSigned':![]}):(_0xe6c8fb[_0x359ab9(0x1b1)]=!![],_0x23e447[_0x359ab9(0x19b)](_0xe6c8fb));}return _0x23e447;}catch(_0x4317c6){console[_0x359ab9(0x1a7)](_0x359ab9(0x1b4),_0x4317c6);throw new common_1[(_0x359ab9(0x1c2))](_0x359ab9(0x1d4),common_1['HttpStatus']['BAD_REQUEST']);}}};SigninService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1[_0x2a6405(0x1a5)])(signIn_entity_1[_0x2a6405(0x19e)])),__param(0x1,(0x0,typeorm_1[_0x2a6405(0x1a5)])(user_entity_1[_0x2a6405(0x1dc)])),__metadata(_0x2a6405(0x195),[typeorm_2[_0x2a6405(0x1d3)],typeorm_2[_0x2a6405(0x1d3)],userBalance_service_1[_0x2a6405(0x1a8)],globalConfig_service_1['GlobalConfigService']])],SigninService),exports[_0x2a6405(0x1c7)]=SigninService;