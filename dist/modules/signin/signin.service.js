'use strict';function _0x1def(_0x1a72c7,_0x3bbe74){const _0x32e44=_0x32e4();return _0x1def=function(_0x1def47,_0x41c6d2){_0x1def47=_0x1def47-0x14c;let _0x1a2e10=_0x32e44[_0x1def47];return _0x1a2e10;},_0x1def(_0x1a72c7,_0x3bbe74);}const _0x125920=_0x1def;(function(_0x2fb679,_0x394ee1){const _0x460baf=_0x1def,_0x96af6d=_0x2fb679();while(!![]){try{const _0x220af4=-parseInt(_0x460baf(0x15e))/0x1*(-parseInt(_0x460baf(0x17e))/0x2)+-parseInt(_0x460baf(0x162))/0x3+parseInt(_0x460baf(0x14c))/0x4*(-parseInt(_0x460baf(0x17d))/0x5)+-parseInt(_0x460baf(0x14d))/0x6*(-parseInt(_0x460baf(0x199))/0x7)+parseInt(_0x460baf(0x16a))/0x8*(parseInt(_0x460baf(0x181))/0x9)+parseInt(_0x460baf(0x176))/0xa*(-parseInt(_0x460baf(0x14e))/0xb)+-parseInt(_0x460baf(0x192))/0xc*(-parseInt(_0x460baf(0x167))/0xd);if(_0x220af4===_0x394ee1)break;else _0x96af6d['push'](_0x96af6d['shift']());}catch(_0x2802ef){_0x96af6d['push'](_0x96af6d['shift']());}}}(_0x32e4,0x3cb9d));var __decorate=this&&this[_0x125920(0x183)]||function(_0x35c34c,_0x502c80,_0x4ad9c3,_0x1c4327){const _0x46a4be=_0x125920;var _0x32bd02=arguments[_0x46a4be(0x16b)],_0xfc261d=_0x32bd02<0x3?_0x502c80:_0x1c4327===null?_0x1c4327=Object[_0x46a4be(0x158)](_0x502c80,_0x4ad9c3):_0x1c4327,_0x3dd0e5;if(typeof Reflect===_0x46a4be(0x150)&&typeof Reflect[_0x46a4be(0x157)]===_0x46a4be(0x169))_0xfc261d=Reflect[_0x46a4be(0x157)](_0x35c34c,_0x502c80,_0x4ad9c3,_0x1c4327);else{for(var _0x4d9f48=_0x35c34c[_0x46a4be(0x16b)]-0x1;_0x4d9f48>=0x0;_0x4d9f48--)if(_0x3dd0e5=_0x35c34c[_0x4d9f48])_0xfc261d=(_0x32bd02<0x3?_0x3dd0e5(_0xfc261d):_0x32bd02>0x3?_0x3dd0e5(_0x502c80,_0x4ad9c3,_0xfc261d):_0x3dd0e5(_0x502c80,_0x4ad9c3))||_0xfc261d;}return _0x32bd02>0x3&&_0xfc261d&&Object[_0x46a4be(0x19c)](_0x502c80,_0x4ad9c3,_0xfc261d),_0xfc261d;},__metadata=this&&this[_0x125920(0x189)]||function(_0x276ff6,_0x20680a){const _0xf13914=_0x125920;if(typeof Reflect==='object'&&typeof Reflect[_0xf13914(0x160)]===_0xf13914(0x169))return Reflect[_0xf13914(0x160)](_0x276ff6,_0x20680a);},__param=this&&this['__param']||function(_0x50f5e4,_0x474cab){return function(_0x375e05,_0x345ed7){_0x474cab(_0x375e05,_0x345ed7,_0x50f5e4);};};Object[_0x125920(0x19c)](exports,_0x125920(0x18a),{'value':!![]}),exports[_0x125920(0x156)]=void 0x0;const globalConfig_service_1=require('./../globalConfig/globalConfig.service'),userBalance_service_1=require(_0x125920(0x14f)),common_1=require(_0x125920(0x16d)),signIn_entity_1=require(_0x125920(0x15c)),typeorm_1=require(_0x125920(0x18c)),typeorm_2=require('typeorm'),date_1=require('../../common/utils/date'),user_entity_1=require(_0x125920(0x197)),balance_constant_1=require(_0x125920(0x193));let SigninService=class SigninService{constructor(_0x40ba19,_0xc49cf7,_0x10974e,_0x3fded3){const _0x2bc02b=_0x125920;this[_0x2bc02b(0x191)]=_0x40ba19,this[_0x2bc02b(0x182)]=_0xc49cf7,this[_0x2bc02b(0x151)]=_0x10974e,this[_0x2bc02b(0x179)]=_0x3fded3;}async[_0x125920(0x161)](_0x5604ed){const _0x198ab0=_0x125920,{id:_0x5072d7}=_0x5604ed[_0x198ab0(0x16f)],_0x3e476=(0x0,date_1[_0x198ab0(0x18f)])(new Date())[_0x198ab0(0x163)]('YYYY-MM-DD'),_0x3a7bd5=await this[_0x198ab0(0x191)][_0x198ab0(0x188)]({'where':{'userId':_0x5072d7,'signInDate':_0x3e476}});if(_0x3a7bd5)throw new common_1[(_0x198ab0(0x195))](_0x198ab0(0x177),common_1[_0x198ab0(0x16c)][_0x198ab0(0x175)]);const {model3Count:_0x220448,model4Count:_0x5a4dc1,drawMjCount:_0x111f1e}=await this[_0x198ab0(0x179)][_0x198ab0(0x180)]();await this[_0x198ab0(0x191)][_0x198ab0(0x159)]({'userId':_0x5072d7,'signInTime':new Date(),'signInDate':_0x3e476,'isSigned':!![]}),await this[_0x198ab0(0x151)]['addBalanceToUser'](_0x5072d7,{'model3Count':_0x220448,'model4Count':_0x5a4dc1,'drawMjCount':_0x111f1e}),await this[_0x198ab0(0x151)][_0x198ab0(0x15d)]({'userId':_0x5072d7,'rechargeType':balance_constant_1[_0x198ab0(0x171)][_0x198ab0(0x174)],'model3Count':_0x220448,'model4Count':_0x5a4dc1,'drawMjCount':_0x111f1e});const _0x518430=(0x0,date_1[_0x198ab0(0x18f)])(new Date())[_0x198ab0(0x18d)](0x1,_0x198ab0(0x178))[_0x198ab0(0x163)](_0x198ab0(0x172)),_0x28e9c1=await this['signinEntity'][_0x198ab0(0x188)]({'where':{'userId':_0x5072d7,'signInDate':_0x518430}});if(_0x28e9c1){common_1[_0x198ab0(0x17b)]['debug']('用户'+_0x5072d7+_0x198ab0(0x184),_0x198ab0(0x156));const _0x1faf24=await this[_0x198ab0(0x182)][_0x198ab0(0x188)]({'where':{'id':_0x5072d7}});if(!_0x1faf24)throw new common_1['HttpException'](_0x198ab0(0x166),common_1[_0x198ab0(0x16c)][_0x198ab0(0x175)]);const {consecutiveDays:consecutiveDays=0x0}=_0x1faf24;await this[_0x198ab0(0x182)]['update']({'id':_0x5072d7},{'consecutiveDays':consecutiveDays+0x1});}else common_1[_0x198ab0(0x17b)]['debug']('用户'+_0x5072d7+_0x198ab0(0x165),_0x198ab0(0x156)),await this['userEntity']['update']({'id':_0x5072d7},{'consecutiveDays':0x1});return _0x198ab0(0x18e);}async[_0x125920(0x168)](_0x4980c7){const _0xf0ad1a=_0x125920;try{const {id:_0x39cdf3}=_0x4980c7[_0xf0ad1a(0x16f)],_0x5a122e=(0x0,date_1[_0xf0ad1a(0x18f)])()[_0xf0ad1a(0x185)](_0xf0ad1a(0x19d))['format'](_0xf0ad1a(0x15a)),_0x5ce9a4=(0x0,date_1[_0xf0ad1a(0x18f)])()[_0xf0ad1a(0x190)](_0xf0ad1a(0x19d))[_0xf0ad1a(0x163)]('YYYY-MM-DD\x20HH:mm:ss'),_0x45733d=this[_0xf0ad1a(0x191)][_0xf0ad1a(0x18b)](_0xf0ad1a(0x170)),_0x2d013d=await _0x45733d[_0xf0ad1a(0x17c)]('signin.signInDate\x20as\x20signInDate,\x20signin.isSigned\x20as\x20isSigned')[_0xf0ad1a(0x19f)](_0xf0ad1a(0x15b),{'userId':_0x4980c7['user']['id']})[_0xf0ad1a(0x19f)](_0xf0ad1a(0x17f),{'firstDay':_0x5a122e})[_0xf0ad1a(0x19f)](_0xf0ad1a(0x153),{'lastDay':_0x5ce9a4})[_0xf0ad1a(0x198)](),_0x2e1f46=new Date(_0x5a122e),_0x4b79ad=new Date(_0x5ce9a4),_0x1940f6=[],_0x5be896=new Date(_0x2e1f46);while(_0x5be896<=_0x4b79ad){_0x1940f6[_0xf0ad1a(0x15f)]((0x0,date_1[_0xf0ad1a(0x18f)])(new Date(_0x5be896))[_0xf0ad1a(0x163)](_0xf0ad1a(0x172))),_0x5be896[_0xf0ad1a(0x187)](_0x5be896[_0xf0ad1a(0x155)]()+0x1);}const _0x500205=[];for(const _0x4fba18 of _0x1940f6){const _0x9ccdd8=_0x2d013d['find'](_0x570890=>_0x570890[_0xf0ad1a(0x19b)]===_0x4fba18);!_0x9ccdd8?_0x500205['push']({'signInDate':_0x4fba18,'isSigned':![]}):(_0x9ccdd8['isSigned']=!![],_0x500205[_0xf0ad1a(0x15f)](_0x9ccdd8));}return _0x500205;}catch(_0x27a2fd){console[_0xf0ad1a(0x17a)](_0xf0ad1a(0x16e),_0x27a2fd);throw new common_1['HttpException'](_0xf0ad1a(0x164),common_1['HttpStatus'][_0xf0ad1a(0x175)]);}}};function _0x32e4(){const _0x469c8b=['23292wqzgZY','66bXpNon','./../userBalance/userBalance.service','object','userBalanceService','SigninEntity','signin.signInTime\x20<=\x20:lastDay','design:paramtypes','getDate','SigninService','decorate','getOwnPropertyDescriptor','save','YYYY-MM-DD\x20HH:mm:ss','signin.userId\x20=\x20:userId','./signIn.entity','saveRecordRechargeLog','3NjwPpg','push','metadata','sign','45921KhurlM','format','获取签到数据失败！','昨天没签到、今天重置天数！','用户不存在','838630xnxYBh','getSigninLog','function','436048zdrpSa','length','HttpStatus','@nestjs/common','error:\x20','user','signin','RechargeType','YYYY-MM-DD','InjectRepository','SIGN_IN','BAD_REQUEST','810630UiTIxr','今日已签到、改天再来吧!.','day','globalConfigService','log','Logger','select','15355kZvzJa','117762lHtqLD','signin.signInTime\x20>=\x20:firstDay','getSignatureGiftConfig','72tSXVnT','userEntity','__decorate','昨天签到了、今天是连续签到！','startOf','UserBalanceService','setDate','findOne','__metadata','__esModule','createQueryBuilder','@nestjs/typeorm','subtract','Sign\x20in\x20successful.','default','endOf','signinEntity','12czSmSf','../../common/constants/balance.constant','Injectable','HttpException','UserEntity','../user/user.entity','getRawMany','791mBIpIm','Repository','signInDate','defineProperty','month','GlobalConfigService','andWhere','476VOFnUh'];_0x32e4=function(){return _0x469c8b;};return _0x32e4();}SigninService=__decorate([(0x0,common_1[_0x125920(0x194)])(),__param(0x0,(0x0,typeorm_1[_0x125920(0x173)])(signIn_entity_1[_0x125920(0x152)])),__param(0x1,(0x0,typeorm_1[_0x125920(0x173)])(user_entity_1[_0x125920(0x196)])),__metadata(_0x125920(0x154),[typeorm_2[_0x125920(0x19a)],typeorm_2[_0x125920(0x19a)],userBalance_service_1[_0x125920(0x186)],globalConfig_service_1[_0x125920(0x19e)]])],SigninService),exports[_0x125920(0x156)]=SigninService;