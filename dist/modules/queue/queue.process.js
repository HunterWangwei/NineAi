'use strict';function _0x3831(){var _0x55f224=['design:paramtypes','onQueueCleaned','10462aZmfYX','OnQueueCleaned','onQueueError','logger','Queue\x20failed:\x20','design:returntype','OnQueueError','1555434BdwUns','\x20jobs\x20of\x20type\x20','defineProperty','175287UsBNfU','Queue\x20cleaned:\x20','design:type','data','../midjourney/midjourney.service','OnQueueDrained','__metadata','onQueueActive','@nestjs/bull','metadata','onQueuePaused','object','Process','onQueueProgress','QueueProcessor','CONCURRENCY','mjDraw','队列恢复的时候调用','drawFailed','onQueueResumed','OnQueueResumed','onQueueDrained','Logger','11907288oKNJqd','decorate','function','onQueueFailed','8oRBXQA','log','__decorate','MJDRAW','1343655fdFYih','midjourneyService','队列发生错误','2402564NrSlfS','handleJob','onQueueCompleted','6623939gQFttK','message','OnQueueActive','prototype','OnQueuePaused','13hoIGNa'];_0x3831=function(){return _0x55f224;};return _0x3831();}var _0x478fd7=_0x2ac0;(function(_0x25cee4,_0x4870cd){var _0x46b93b=_0x2ac0,_0x2d5a5b=_0x25cee4();while(!![]){try{var _0x19396e=-parseInt(_0x46b93b(0xb8))/0x1*(-parseInt(_0x46b93b(0xbb))/0x2)+parseInt(_0x46b93b(0xc5))/0x3+parseInt(_0x46b93b(0xb0))/0x4+-parseInt(_0x46b93b(0xad))/0x5+-parseInt(_0x46b93b(0xc2))/0x6+-parseInt(_0x46b93b(0xb3))/0x7*(parseInt(_0x46b93b(0xa9))/0x8)+parseInt(_0x46b93b(0xa5))/0x9;if(_0x19396e===_0x4870cd)break;else _0x2d5a5b['push'](_0x2d5a5b['shift']());}catch(_0x17ee83){_0x2d5a5b['push'](_0x2d5a5b['shift']());}}}(_0x3831,0x8c972));var __decorate=this&&this[_0x478fd7(0xab)]||function(_0xfa637,_0x20d69b,_0x4e900a,_0x38e616){var _0x11be20=_0x478fd7,_0x180202=arguments['length'],_0x11afdf=_0x180202<0x3?_0x20d69b:_0x38e616===null?_0x38e616=Object['getOwnPropertyDescriptor'](_0x20d69b,_0x4e900a):_0x38e616,_0x3f7fc1;if(typeof Reflect===_0x11be20(0xd0)&&typeof Reflect[_0x11be20(0xa6)]===_0x11be20(0xa7))_0x11afdf=Reflect['decorate'](_0xfa637,_0x20d69b,_0x4e900a,_0x38e616);else{for(var _0x18f483=_0xfa637['length']-0x1;_0x18f483>=0x0;_0x18f483--)if(_0x3f7fc1=_0xfa637[_0x18f483])_0x11afdf=(_0x180202<0x3?_0x3f7fc1(_0x11afdf):_0x180202>0x3?_0x3f7fc1(_0x20d69b,_0x4e900a,_0x11afdf):_0x3f7fc1(_0x20d69b,_0x4e900a))||_0x11afdf;}return _0x180202>0x3&&_0x11afdf&&Object[_0x11be20(0xc4)](_0x20d69b,_0x4e900a,_0x11afdf),_0x11afdf;},__metadata=this&&this[_0x478fd7(0xcb)]||function(_0x1a92a6,_0x5905a9){var _0x2cb1fe=_0x478fd7;if(typeof Reflect===_0x2cb1fe(0xd0)&&typeof Reflect[_0x2cb1fe(0xce)]===_0x2cb1fe(0xa7))return Reflect[_0x2cb1fe(0xce)](_0x1a92a6,_0x5905a9);},QueueProcessor_1;Object[_0x478fd7(0xc4)](exports,'__esModule',{'value':!![]}),exports[_0x478fd7(0xd3)]=void 0x0;const bull_1=require(_0x478fd7(0xcd)),common_1=require('@nestjs/common'),midjourney_service_1=require(_0x478fd7(0xc9));let QueueProcessor=QueueProcessor_1=class QueueProcessor{constructor(_0x2fb284){var _0x4be986=_0x478fd7;this['midjourneyService']=_0x2fb284,this[_0x4be986(0xbe)]=new common_1['Logger'](QueueProcessor_1['name']);}async['handleJob'](_0x259e22){var _0x333c34=_0x478fd7;const _0x915271=await this[_0x333c34(0xae)]['draw'](_0x259e22[_0x333c34(0xc8)],_0x259e22['id']);return _0x915271;}[_0x478fd7(0xcc)](_0x31446a){}['onQueueError'](_0x345e0d){var _0x595c70=_0x478fd7;console['log'](_0x595c70(0xaf),_0x345e0d);}[_0x478fd7(0xd2)](_0x4070af,_0x1a6422){var _0x238832=_0x478fd7;console[_0x238832(0xaa)]('队列任务的一个回调用于通知当前进度',_0x4070af['id'],_0x1a6422);}[_0x478fd7(0xb2)](_0x32626b,_0x46e8cd){}[_0x478fd7(0xa8)](_0x40ba7d,_0x3351b4){var _0x525f34=_0x478fd7;common_1[_0x525f34(0xa4)]['error'](_0x525f34(0xbf)+_0x3351b4[_0x525f34(0xb4)]+':\x20绘画失败\x20'+_0x40ba7d['id'],_0x525f34(0xd3)),this['midjourneyService'][_0x525f34(0xd7)](_0x40ba7d[_0x525f34(0xc8)]);}[_0x478fd7(0xcf)](){var _0x227f76=_0x478fd7;console[_0x227f76(0xaa)]('队列暂停的时候调用');}[_0x478fd7(0xd8)](){var _0x3e1ceb=_0x478fd7;console[_0x3e1ceb(0xaa)](_0x3e1ceb(0xd6));}['onQueueCleaned'](_0x58670d,_0xf7d76c){var _0x45e6a1=_0x478fd7;common_1[_0x45e6a1(0xa4)][_0x45e6a1(0xaa)](_0x45e6a1(0xc6)+_0x58670d['length']+_0x45e6a1(0xc3)+_0xf7d76c+'\x20were\x20cleaned.',_0x45e6a1(0xd3));}['onQueueDrained'](){}};function _0x2ac0(_0x1c9bfe,_0xe4ed63){var _0x38314f=_0x3831();return _0x2ac0=function(_0x2ac058,_0x58ecaa){_0x2ac058=_0x2ac058-0xa4;var _0x25849b=_0x38314f[_0x2ac058];return _0x25849b;},_0x2ac0(_0x1c9bfe,_0xe4ed63);}__decorate([(0x0,bull_1[_0x478fd7(0xd1)])({'name':_0x478fd7(0xd5),'concurrency':process['env']['CONCURRENCY']?+process['env'][_0x478fd7(0xd4)]:0x3}),__metadata('design:type',Function),__metadata(_0x478fd7(0xb9),[Object]),__metadata('design:returntype',Promise)],QueueProcessor['prototype'],_0x478fd7(0xb1),null),__decorate([(0x0,bull_1[_0x478fd7(0xb5)])(),__metadata('design:type',Function),__metadata(_0x478fd7(0xb9),[Object]),__metadata('design:returntype',void 0x0)],QueueProcessor[_0x478fd7(0xb6)],_0x478fd7(0xcc),null),__decorate([(0x0,bull_1[_0x478fd7(0xc1)])(),__metadata(_0x478fd7(0xc7),Function),__metadata(_0x478fd7(0xb9),[Error]),__metadata(_0x478fd7(0xc0),void 0x0)],QueueProcessor[_0x478fd7(0xb6)],_0x478fd7(0xbd),null),__decorate([(0x0,bull_1['OnQueueProgress'])(),__metadata(_0x478fd7(0xc7),Function),__metadata(_0x478fd7(0xb9),[Object,Number]),__metadata(_0x478fd7(0xc0),void 0x0)],QueueProcessor[_0x478fd7(0xb6)],_0x478fd7(0xd2),null),__decorate([(0x0,bull_1['OnQueueCompleted'])(),__metadata(_0x478fd7(0xc7),Function),__metadata(_0x478fd7(0xb9),[Object,Object]),__metadata(_0x478fd7(0xc0),void 0x0)],QueueProcessor[_0x478fd7(0xb6)],'onQueueCompleted',null),__decorate([(0x0,bull_1['OnQueueFailed'])(),__metadata(_0x478fd7(0xc7),Function),__metadata(_0x478fd7(0xb9),[Object,Error]),__metadata(_0x478fd7(0xc0),void 0x0)],QueueProcessor[_0x478fd7(0xb6)],_0x478fd7(0xa8),null),__decorate([(0x0,bull_1[_0x478fd7(0xb7)])(),__metadata('design:type',Function),__metadata(_0x478fd7(0xb9),[]),__metadata(_0x478fd7(0xc0),void 0x0)],QueueProcessor['prototype'],_0x478fd7(0xcf),null),__decorate([(0x0,bull_1[_0x478fd7(0xd9)])(),__metadata(_0x478fd7(0xc7),Function),__metadata(_0x478fd7(0xb9),[]),__metadata(_0x478fd7(0xc0),void 0x0)],QueueProcessor[_0x478fd7(0xb6)],_0x478fd7(0xd8),null),__decorate([(0x0,bull_1[_0x478fd7(0xbc)])(),__metadata('design:type',Function),__metadata('design:paramtypes',[Array,String]),__metadata(_0x478fd7(0xc0),void 0x0)],QueueProcessor['prototype'],_0x478fd7(0xba),null),__decorate([(0x0,bull_1[_0x478fd7(0xca)])(),__metadata(_0x478fd7(0xc7),Function),__metadata(_0x478fd7(0xb9),[]),__metadata(_0x478fd7(0xc0),void 0x0)],QueueProcessor[_0x478fd7(0xb6)],_0x478fd7(0xda),null),QueueProcessor=QueueProcessor_1=__decorate([(0x0,bull_1['Processor'])(_0x478fd7(0xac)),__metadata(_0x478fd7(0xb9),[midjourney_service_1['MidjourneyService']])],QueueProcessor),exports[_0x478fd7(0xd3)]=QueueProcessor;