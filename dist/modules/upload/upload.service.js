'use strict';function _0x5fd3(_0x3b53e5,_0x45daae){const _0x4cf1d8=_0x4cf1();return _0x5fd3=function(_0x5fd3e3,_0x3a7647){_0x5fd3e3=_0x5fd3e3-0xf9;let _0x44fbc8=_0x4cf1d8[_0x5fd3e3];return _0x44fbc8;},_0x5fd3(_0x3b53e5,_0x45daae);}const _0x11f25a=_0x5fd3;(function(_0x119e26,_0x135455){const _0x17965f=_0x5fd3,_0x4e64e4=_0x119e26();while(!![]){try{const _0x24641d=parseInt(_0x17965f(0x10c))/0x1+parseInt(_0x17965f(0x181))/0x2+parseInt(_0x17965f(0x168))/0x3*(-parseInt(_0x17965f(0x115))/0x4)+-parseInt(_0x17965f(0x15a))/0x5*(parseInt(_0x17965f(0x136))/0x6)+-parseInt(_0x17965f(0x160))/0x7*(-parseInt(_0x17965f(0x16b))/0x8)+-parseInt(_0x17965f(0xfe))/0x9+-parseInt(_0x17965f(0x11c))/0xa;if(_0x24641d===_0x135455)break;else _0x4e64e4['push'](_0x4e64e4['shift']());}catch(_0x36ebd4){_0x4e64e4['push'](_0x4e64e4['shift']());}}}(_0x4cf1,0xddea8));var __decorate=this&&this[_0x11f25a(0x120)]||function(_0x119d6d,_0x598b2d,_0x5371ca,_0x298d84){const _0x37fb08=_0x11f25a;var _0x2c1a2e=arguments['length'],_0x193377=_0x2c1a2e<0x3?_0x598b2d:_0x298d84===null?_0x298d84=Object[_0x37fb08(0x132)](_0x598b2d,_0x5371ca):_0x298d84,_0x15ca7c;if(typeof Reflect===_0x37fb08(0x12d)&&typeof Reflect['decorate']===_0x37fb08(0xf9))_0x193377=Reflect[_0x37fb08(0x16f)](_0x119d6d,_0x598b2d,_0x5371ca,_0x298d84);else{for(var _0x18b548=_0x119d6d[_0x37fb08(0x14f)]-0x1;_0x18b548>=0x0;_0x18b548--)if(_0x15ca7c=_0x119d6d[_0x18b548])_0x193377=(_0x2c1a2e<0x3?_0x15ca7c(_0x193377):_0x2c1a2e>0x3?_0x15ca7c(_0x598b2d,_0x5371ca,_0x193377):_0x15ca7c(_0x598b2d,_0x5371ca))||_0x193377;}return _0x2c1a2e>0x3&&_0x193377&&Object['defineProperty'](_0x598b2d,_0x5371ca,_0x193377),_0x193377;},__metadata=this&&this[_0x11f25a(0x173)]||function(_0x4e4034,_0x3092ef){const _0x215818=_0x11f25a;if(typeof Reflect===_0x215818(0x12d)&&typeof Reflect[_0x215818(0x139)]===_0x215818(0xf9))return Reflect[_0x215818(0x139)](_0x4e4034,_0x3092ef);};Object[_0x11f25a(0x100)](exports,'__esModule',{'value':!![]}),exports[_0x11f25a(0x18a)]=void 0x0;const common_1=require('@nestjs/common'),TENCENTCOS=require('cos-nodejs-sdk-v5'),ALIOSS=require(_0x11f25a(0x124)),axios_1=require(_0x11f25a(0x172)),streamToBuffer=require('stream-to-buffer'),utils_1=require(_0x11f25a(0x15b)),globalConfig_service_1=require(_0x11f25a(0x164)),FormData=require(_0x11f25a(0x189)),fs=require('fs'),uuid=require(_0x11f25a(0x156)),path=require('path'),path_1=require(_0x11f25a(0x182)),iconv=require(_0x11f25a(0x143)),publicFolderPath='public';let UploadService=class UploadService{constructor(_0x5ce70d){const _0x4748b4=_0x11f25a;this[_0x4748b4(0x133)]=_0x5ce70d;}[_0x11f25a(0x140)](){this['initializeFolders']();}async[_0x11f25a(0x190)](){const _0x5176d0=_0x11f25a;!fs['existsSync'](publicFolderPath)&&fs['mkdirSync'](publicFolderPath);const _0x17e764=(0x0,path_1[_0x5176d0(0x15f)])(publicFolderPath,'files');!fs[_0x5176d0(0x145)](_0x17e764)&&fs[_0x5176d0(0x13f)](_0x17e764);const _0x4898f4=(0x0,path_1[_0x5176d0(0x15f)])(_0x17e764,'images');!fs[_0x5176d0(0x145)](_0x4898f4)&&fs[_0x5176d0(0x13f)](_0x4898f4);const _0x1b17c4=(0x0,path_1['join'])(_0x17e764,_0x5176d0(0x170));!fs['existsSync'](_0x1b17c4)&&fs[_0x5176d0(0x13f)](_0x1b17c4);const _0x44cde8=(0x0,path_1['join'])(_0x17e764,'media');!fs[_0x5176d0(0x145)](_0x44cde8)&&fs[_0x5176d0(0x13f)](_0x44cde8);const _0x5a5417=(0x0,path_1['join'])(_0x17e764,_0x5176d0(0x18f));!fs[_0x5176d0(0x145)](_0x5a5417)&&fs[_0x5176d0(0x13f)](_0x5a5417);const _0xebd691=(0x0,path_1[_0x5176d0(0x15f)])(publicFolderPath,'tem');!fs[_0x5176d0(0x145)](_0xebd691)&&fs[_0x5176d0(0x13f)](_0xebd691);const _0x36de41=(0x0,path_1['join'])(publicFolderPath,_0x5176d0(0x114));!fs[_0x5176d0(0x145)](_0x36de41)&&fs['mkdirSync'](_0x36de41);const _0x4a742c=(0x0,path_1[_0x5176d0(0x15f)])(_0x36de41,'images');!fs[_0x5176d0(0x145)](_0x4a742c)&&fs[_0x5176d0(0x13f)](_0x4a742c);const _0x520c0d=(0x0,path_1[_0x5176d0(0x15f)])(_0x36de41,_0x5176d0(0x170));!fs[_0x5176d0(0x145)](_0x520c0d)&&fs[_0x5176d0(0x13f)](_0x520c0d);const _0x12b053=(0x0,path_1[_0x5176d0(0x15f)])(_0x36de41,_0x5176d0(0x107));!fs['existsSync'](_0x12b053)&&fs[_0x5176d0(0x13f)](_0x12b053);}async[_0x11f25a(0x191)](_0x3f20db){const _0x26b71d=_0x11f25a;return await this[_0x26b71d(0xfa)](_0x3f20db,_0x26b71d(0x137));}async['uploadFileForCore'](_0x151a22){const _0xacee4a=_0x11f25a;return await this[_0xacee4a(0xfa)](_0x151a22,_0xacee4a(0x114));}async[_0x11f25a(0x14e)](_0x647e18){const _0x587206=_0x11f25a,{filename:_0x4b6b81,originalname:_0x5b58de,buffer:_0x489008,dir:dir='ai',mimetype:_0xb87e55,base64:_0x30056b}=_0x647e18,_0x2917bf=_0xb87e55?_0xb87e55[_0x587206(0x17b)]('/')[0x1]:'',_0x43eb03=_0x5b58de||_0x4b6b81,{tencentCosStatus:tencentCosStatus=0x0,aliOssStatus:aliOssStatus=0x0,cheveretoStatus:cheveretoStatus=0x0}=await this[_0x587206(0x133)][_0x587206(0x187)](['tencentCosStatus',_0x587206(0x130),_0x587206(0x15e)]);if(!Number(tencentCosStatus)&&!Number(aliOssStatus)&&!Number(cheveretoStatus))return this[_0x587206(0x191)](_0x647e18);if(Number(tencentCosStatus))return this[_0x587206(0x135)]({'filename':_0x43eb03,'buffer':_0x489008,'dir':dir,'fileTyle':_0x2917bf});if(Number(aliOssStatus))return await this[_0x587206(0x104)]({'filename':_0x43eb03,'buffer':_0x489008,'dir':dir,'fileTyle':_0x2917bf});if(Number(cheveretoStatus)){const {filename:_0x908c19,buffer:_0xaed8d2,dir:_0x2cd3a7}=_0x647e18;return await this[_0x587206(0x13d)]({'filename':_0x908c19,'buffer':_0x30056b||_0xaed8d2[_0x587206(0x147)]('base64'),'dir':_0x2cd3a7,'fileTyle':_0x2917bf});}}[_0x11f25a(0x122)](_0x198a42){const _0x486583=_0x11f25a,_0x3232bf=[_0x486583(0x12b),_0x486583(0x178),_0x486583(0x17a),_0x486583(0x17c)],_0x1705cf=[_0x486583(0x125),_0x486583(0x11d),_0x486583(0xfb),'audio/wav',_0x486583(0x154)],_0x41e96c=[_0x486583(0x14a),_0x486583(0x166),_0x486583(0x12a)];if(_0x3232bf[_0x486583(0x146)](_0x198a42[_0x486583(0x174)]))return _0x486583(0x18c);else{if(_0x1705cf['includes'](_0x198a42['mimetype']))return _0x486583(0x107);else return _0x41e96c['includes'](_0x198a42[_0x486583(0x174)])?_0x486583(0x170):_0x486583(0x18c);}}['decodeFileName'](_0xf174d5){const _0x271a23=_0x11f25a,_0x4918bf=iconv[_0x271a23(0x185)](Buffer[_0x271a23(0x16d)](_0xf174d5,_0x271a23(0x102)),_0x271a23(0x134));return _0x4918bf;}[_0x11f25a(0x159)](_0x5d0d40){const _0x21a159=_0x11f25a,_0xb4a726=this[_0x21a159(0x103)](_0x5d0d40),_0x338d0c=_0xb4a726[_0x21a159(0x17b)]('.')[_0x21a159(0x10b)](),_0xd33d8a=_0xb4a726['split']('.')[_0x21a159(0x193)](0x0,-0x1)[_0x21a159(0x15f)]('.'),_0x593fa5=new Date()[_0x21a159(0x16c)](),_0x316b60=(0x0,utils_1[_0x21a159(0x18b)])();return _0xd33d8a+'-nine-'+_0x593fa5+_0x21a159(0x177)+_0x316b60+'.'+_0x338d0c;}async['saveFileToLocal'](_0x1e5230,_0x17dcfa){const _0x3161b0=_0x11f25a,_0x7c04c=(_0x1e5230===null||_0x1e5230===void 0x0?void 0x0:_0x1e5230[_0x3161b0(0x129)])?'images':this[_0x3161b0(0x122)](_0x1e5230);if(!_0x7c04c)throw new common_1[(_0x3161b0(0x161))](_0x3161b0(0x15c),common_1[_0x3161b0(0x183)][_0x3161b0(0x163)]);const _0x43af6c=await this[_0x3161b0(0x133)][_0x3161b0(0x187)](['registerBaseUrl']);if(!_0x43af6c)throw new common_1['HttpException']('请先前往后台管理设置base地址！',common_1[_0x3161b0(0x183)][_0x3161b0(0x163)]);const _0x122d19=_0x43af6c[_0x3161b0(0x11a)]('/')?_0x43af6c[_0x3161b0(0x193)](0x0,-0x1):_0x43af6c;if(!![]){const _0x3901fe=publicFolderPath+'/'+_0x17dcfa+'/'+_0x7c04c;let _0x559ff5=_0x1e5230[_0x3161b0(0x176)]||_0x1e5230[_0x3161b0(0x162)];!_0x559ff5&&(_0x559ff5=_0x3161b0(0x123)+uuid['v4']()[_0x3161b0(0x193)](0x0,0xa)+_0x3161b0(0x11e));const _0x963bdd=this['genFileName'](_0x559ff5),_0x54920b=path['join'](_0x3901fe,_0x963bdd);return fs[_0x3161b0(0x119)](_0x54920b,_0x1e5230[_0x3161b0(0x11b)]),''+_0x122d19+_0x54920b['substring'](0x6);}}async[_0x11f25a(0x13b)](_0x3a65f3){const _0xc20b2d=_0x11f25a,_0x2271d7=this[_0xc20b2d(0x122)](_0x3a65f3);if(!_0x2271d7)throw new common_1[(_0xc20b2d(0x161))]('不支持当前文件类型！',common_1[_0xc20b2d(0x183)]['BAD_REQUEST']);const _0xcd62d4=publicFolderPath+_0xc20b2d(0x14d)+_0x2271d7,_0x321991=this[_0xc20b2d(0x159)](_0x3a65f3[_0xc20b2d(0x176)]),_0x5bcd5=path[_0xc20b2d(0x15f)](_0xcd62d4,_0x321991);fs[_0xc20b2d(0x119)](_0x5bcd5,_0x3a65f3[_0xc20b2d(0x11b)]);const _0x3f3016=await this['globalConfigService']['getConfigs'](['registerBaseUrl']);if(!_0x3f3016)throw new common_1[(_0xc20b2d(0x161))](_0xc20b2d(0x131),common_1['HttpStatus'][_0xc20b2d(0x163)]);return''+_0x3f3016+_0x5bcd5[_0xc20b2d(0x157)](0x6);}async[_0x11f25a(0x138)](){const _0xfadf3e=_0x11f25a,{tencentCosStatus:tencentCosStatus=0x0,aliOssStatus:aliOssStatus=0x0,cheveretoStatus:cheveretoStatus=0x0}=await this['globalConfigService'][_0xfadf3e(0x187)]([_0xfadf3e(0x150),_0xfadf3e(0x130),_0xfadf3e(0x15e)]);if(Number(tencentCosStatus))return'tencent';if(Number(aliOssStatus))return'ali';if(Number(cheveretoStatus))return'chevereto';}async[_0x11f25a(0x151)]({filename:_0x3687cb,url:_0x52c507,dir:dir='mj'}){const _0x207ce7=_0x11f25a;dir=process['env'][_0x207ce7(0xfc)]?'mjdev':dir;const {tencentCosStatus:tencentCosStatus=0x0,aliOssStatus:aliOssStatus=0x0,cheveretoStatus:cheveretoStatus=0x0}=await this['globalConfigService'][_0x207ce7(0x187)]([_0x207ce7(0x150),_0x207ce7(0x130),_0x207ce7(0x15e)]);if(!Number(tencentCosStatus)&&!Number(aliOssStatus)&&!Number(cheveretoStatus))throw new common_1[(_0x207ce7(0x161))](_0x207ce7(0x141),common_1[_0x207ce7(0x183)][_0x207ce7(0x163)]);if(Number(tencentCosStatus))return this['uploadFileByTencentCosFromUrl']({'filename':_0x3687cb,'url':_0x52c507,'dir':dir});if(Number(aliOssStatus)){const _0x57e4d9=await this['uploadFileByAliOssFromUrl']({'filename':_0x3687cb,'url':_0x52c507,'dir':dir});return _0x57e4d9;}if(Number(cheveretoStatus))return await this[_0x207ce7(0x184)]({'filename':_0x3687cb,'url':_0x52c507,'dir':dir});}async[_0x11f25a(0x135)]({filename:_0x1cb197,buffer:_0x4b33ba,dir:_0x36fe3f,fileTyle:_0xde24a0}){const _0xc5ace=_0x11f25a,{Bucket:_0xf93020,Region:_0x7a806d,SecretId:_0x439233,SecretKey:_0x154054}=await this[_0xc5ace(0x111)]('tencent');this[_0xc5ace(0x179)]=new TENCENTCOS({'SecretId':_0x439233,'SecretKey':_0x154054,'FileParallelLimit':0xa});try{return new Promise(async(_0x47c6c7,_0x1d33be)=>{const _0x3d26c4=_0xc5ace,_0x3c2dbc=_0xde24a0||_0x3d26c4(0x10a);this[_0x3d26c4(0x179)][_0x3d26c4(0x118)]({'Bucket':(0x0,utils_1[_0x3d26c4(0x116)])(_0xf93020),'Region':(0x0,utils_1[_0x3d26c4(0x116)])(_0x7a806d),'Key':_0x36fe3f+'/'+(_0x1cb197||(0x0,utils_1[_0x3d26c4(0x18b)])()+'.'+_0xde24a0),'StorageClass':_0x3d26c4(0x10e),'Body':_0x4b33ba},async(_0x5ee698,_0xd7e48a)=>{const _0x28abeb=_0x3d26c4;if(_0x5ee698)return _0x1d33be(_0x5ee698);let _0x4c742a=_0xd7e48a[_0x28abeb(0x167)][_0x28abeb(0x101)](/^(http:\/\/|https:\/\/|\/\/|)(.*)/,'https://$2');const {acceleratedDomain:_0x491d83}=await this[_0x28abeb(0x111)](_0x28abeb(0x175));return _0x491d83&&(_0x4c742a=_0x4c742a['replace'](/^(https:\/\/[^/]+)(\/.*)$/,_0x28abeb(0x106)+_0x491d83+'$2')),_0x47c6c7(_0x4c742a);});});}catch(_0x5b49ea){throw new common_1[(_0xc5ace(0x161))](_0xc5ace(0x128),common_1[_0xc5ace(0x183)]['BAD_REQUEST']);}}async[_0x11f25a(0xfd)]({filename:_0x3500bc,url:_0x55adb1,dir:_0x36d7d3}){const _0x360019=_0x11f25a,{Bucket:_0x279d98,Region:_0x46f5f7,SecretId:_0x322f02,SecretKey:_0x4f7f54}=await this[_0x360019(0x111)](_0x360019(0x175));this[_0x360019(0x179)]=new TENCENTCOS({'SecretId':_0x322f02,'SecretKey':_0x4f7f54,'FileParallelLimit':0xa});try{const _0x5c96b9=await this[_0x360019(0x133)][_0x360019(0x187)](['mjProxy'])||0x0;if(Number(_0x5c96b9)===0x1){const _0x307a42={'cosType':_0x360019(0x175),'url':_0x55adb1,'cosParams':{'Bucket':_0x279d98,'Region':_0x46f5f7,'SecretId':_0x322f02,'SecretKey':_0x4f7f54}},_0x131853=await this[_0x360019(0x133)][_0x360019(0x187)](['mjProxyUrl'])||_0x360019(0xff),_0x2e0d37=await axios_1['default'][_0x360019(0x16e)](_0x131853+_0x360019(0x152),_0x307a42);if(!_0x2e0d37[_0x360019(0x18d)])throw new common_1[(_0x360019(0x161))]('上传图片失败[ten][url]',common_1[_0x360019(0x183)]['BAD_REQUEST']);let _0x85518c=_0x2e0d37[_0x360019(0x18d)]['replace'](/^(http:\/\/|https:\/\/|\/\/|)(.*)/,'https://$2');const {acceleratedDomain:_0x446f87}=await this['getUploadConfig'](_0x360019(0x175));return _0x446f87&&(_0x85518c=_0x85518c[_0x360019(0x101)](/^(https:\/\/[^/]+)(\/.*)$/,'https://'+_0x446f87+'$2')),_0x85518c;}else{const _0x2acd07=await this[_0x360019(0x13c)](_0x55adb1);return await this[_0x360019(0x135)]({'filename':_0x3500bc,'buffer':_0x2acd07,'dir':_0x36d7d3,'fileTyle':''});}}catch(_0x25913e){throw new common_1[(_0x360019(0x161))](_0x360019(0x126),common_1[_0x360019(0x183)][_0x360019(0x163)]);}}async[_0x11f25a(0x104)]({filename:_0x24cf1b,buffer:_0x25ecc6,dir:_0x53be31,fileTyle:fileTyle=_0x11f25a(0x10a)}){const _0x4cbf1d=_0x11f25a,{region:_0x3ac3bf,bucket:_0x4b4df3,accessKeyId:_0x2908af,accessKeySecret:_0x58dfbd}=await this['getUploadConfig']('ali'),_0x281ec6=new ALIOSS({'region':(0x0,utils_1[_0x4cbf1d(0x116)])(_0x3ac3bf),'accessKeyId':_0x2908af,'accessKeySecret':_0x58dfbd,'bucket':(0x0,utils_1[_0x4cbf1d(0x116)])(_0x4b4df3)});try{return new Promise((_0x31cf94,_0x187cd6)=>{const _0x21ad1c=_0x4cbf1d;_0x281ec6[_0x21ad1c(0x113)](_0x53be31+'/'+(_0x24cf1b||(0x0,utils_1[_0x21ad1c(0x18b)])()+'.'+fileTyle),_0x25ecc6)['then'](_0xabf649=>{const _0x60a089=_0x21ad1c;_0x31cf94(_0xabf649[_0x60a089(0x12f)]);})[_0x21ad1c(0x169)](_0x45aa8b=>{_0x187cd6(_0x45aa8b);});});}catch(_0x570cad){throw new common_1['HttpException'](_0x4cbf1d(0x15d),common_1[_0x4cbf1d(0x183)][_0x4cbf1d(0x163)]);}}async[_0x11f25a(0x155)]({filename:_0x14414e,url:_0x5f3048,dir:_0x49a468}){const _0x4c91b0=_0x11f25a,{region:_0x36f3ad,bucket:_0x58d515,accessKeyId:_0x418c5b,accessKeySecret:_0x3d1d74}=await this[_0x4c91b0(0x111)](_0x4c91b0(0x14c)),_0x27c261=new ALIOSS({'region':_0x36f3ad,'accessKeyId':_0x418c5b,'accessKeySecret':_0x3d1d74,'bucket':_0x58d515});try{const _0x4111ef=await this[_0x4c91b0(0x133)][_0x4c91b0(0x187)](['mjProxy'])||0x0;if(Number(_0x4111ef)===0x1){const _0x53f50c={'url':_0x5f3048,'cosParams':{'region':_0x36f3ad,'bucket':_0x58d515,'accessKeyId':_0x418c5b,'accessKeySecret':_0x3d1d74},'cosType':_0x4c91b0(0x188)},_0x38b77b=await this['globalConfigService']['getConfigs']([_0x4c91b0(0x186)])||_0x4c91b0(0xff),_0x3446cf=await axios_1[_0x4c91b0(0x17d)][_0x4c91b0(0x16e)](_0x38b77b+'/mj/replaceUpload',_0x53f50c);if(!(_0x3446cf===null||_0x3446cf===void 0x0?void 0x0:_0x3446cf[_0x4c91b0(0x18d)]))throw new common_1[(_0x4c91b0(0x161))](_0x4c91b0(0x10f),common_1['HttpStatus'][_0x4c91b0(0x163)]);return _0x3446cf[_0x4c91b0(0x18d)];}else{const _0x545e4c=await this[_0x4c91b0(0x13c)](_0x5f3048);return await this[_0x4c91b0(0x104)]({'filename':_0x14414e,'buffer':_0x545e4c,'dir':_0x49a468});}}catch(_0xa537b2){throw new common_1[(_0x4c91b0(0x161))]('上传图片失败[ALI][url]',common_1[_0x4c91b0(0x183)][_0x4c91b0(0x163)]);}}async[_0x11f25a(0x13d)]({filename:filename='',buffer:_0xda781b,dir:dir='ai',fileTyle:fileTyle='png'}){const _0x503534=_0x11f25a;var _0x50d0a5;const {key:_0x8f2d7a,uploadPath:_0x2dbdb0}=await this[_0x503534(0x111)](_0x503534(0x10d)),_0x224816=_0x2dbdb0[_0x503534(0x11a)]('/')?_0x2dbdb0[_0x503534(0x193)](0x0,-0x1):_0x2dbdb0,_0x5e8282=new FormData();_0x5e8282['append'](_0x503534(0x144),_0xda781b),_0x5e8282[_0x503534(0x142)]('key',_0x8f2d7a);try{const _0x4f2157=await axios_1[_0x503534(0x17d)][_0x503534(0x16e)](_0x224816,_0x5e8282,{'headers':{'X-API-Key':_0x8f2d7a}});if((_0x4f2157===null||_0x4f2157===void 0x0?void 0x0:_0x4f2157[_0x503534(0x171)])===0xc8)return _0x4f2157['data'][_0x503534(0x12e)][_0x503534(0x12f)];else common_1[_0x503534(0x14b)][_0x503534(0x11f)](_0x503534(0x12c),JSON[_0x503534(0x165)](_0x4f2157[_0x503534(0x18d)]));}catch(_0x4551f7){throw new common_1[(_0x503534(0x161))](_0x503534(0x149)+((_0x50d0a5=_0x4551f7['response'])===null||_0x50d0a5===void 0x0?void 0x0:_0x50d0a5[_0x503534(0x18d)]['error'][_0x503534(0x108)]),common_1[_0x503534(0x183)][_0x503534(0x163)]);}}async[_0x11f25a(0x184)]({filename:_0x4b578d,url:_0x2b3795,dir:_0x220b79}){const _0x5d5785=_0x11f25a;try{const _0x427f35=await this[_0x5d5785(0x133)][_0x5d5785(0x187)]([_0x5d5785(0x110)])||0x0;if(Number(_0x427f35)===0x1){const {key:_0x4e863c,uploadPath:_0x38dd7d}=await this[_0x5d5785(0x111)](_0x5d5785(0x10d)),_0x24a633=_0x38dd7d[_0x5d5785(0x11a)]('/')?_0x38dd7d[_0x5d5785(0x193)](0x0,-0x1):_0x38dd7d,_0x493e60={'cosType':_0x5d5785(0x10d),'url':_0x2b3795,'cosParams':{'key':_0x4e863c,'uploadPath':_0x24a633}},_0x431c68=await this['globalConfigService']['getConfigs']([_0x5d5785(0x186)])||_0x5d5785(0xff),_0x437d75=await axios_1[_0x5d5785(0x17d)]['post'](_0x431c68+'/mj/replaceUpload',_0x493e60);if(!_0x437d75[_0x5d5785(0x18d)])throw new common_1[(_0x5d5785(0x161))](_0x5d5785(0x148),common_1[_0x5d5785(0x183)][_0x5d5785(0x163)]);return _0x437d75[_0x5d5785(0x18d)];}else{const _0x232dfb=await this[_0x5d5785(0x13c)](_0x2b3795);return await this['uploadFileByChevereto']({'filename':_0x4b578d,'buffer':_0x232dfb,'dir':_0x220b79});}}catch(_0x1a697d){throw new common_1[(_0x5d5785(0x161))](_0x1a697d[_0x5d5785(0x16a)],common_1[_0x5d5785(0x183)][_0x5d5785(0x163)]);}}async[_0x11f25a(0x111)](_0x568ab8){const _0x314641=_0x11f25a;if(_0x568ab8==='ali'){const {aliOssRegion:_0x4764c9,aliOssBucket:_0x4af99c,aliOssAccessKeyId:_0x216b1a,aliOssAccessKeySecret:_0x295331}=await this[_0x314641(0x133)][_0x314641(0x187)]([_0x314641(0x158),_0x314641(0x17e),_0x314641(0x13e),'aliOssAccessKeySecret']);return{'region':_0x4764c9,'bucket':_0x4af99c,'accessKeyId':_0x216b1a,'accessKeySecret':_0x295331};}if(_0x568ab8===_0x314641(0x175)){const {cosBucket:_0x19c075,cosRegion:_0x12939b,cosSecretId:_0x12477a,cosSecretKey:_0x1d3e06,tencentCosAcceleratedDomain:_0x32bf08}=await this['globalConfigService'][_0x314641(0x187)]([_0x314641(0x109),_0x314641(0x18e),_0x314641(0x153),_0x314641(0x17f),'tencentCosAcceleratedDomain']);return{'Bucket':_0x19c075,'Region':_0x12939b,'SecretId':_0x12477a,'SecretKey':_0x1d3e06,'acceleratedDomain':_0x32bf08};}if(_0x568ab8==='chevereto'){const {cheveretoKey:_0x14677e,cheveretoUploadPath:_0x4a768f}=await this[_0x314641(0x133)]['getConfigs']([_0x314641(0x13a),'cheveretoUploadPath']);return{'key':_0x14677e,'uploadPath':_0x4a768f};}}async[_0x11f25a(0x192)](){const _0x5e65fc=_0x11f25a,_0x38e1c1={'filename':_0x5e65fc(0x121),'dir':'mj','url':'https://cdn.discordapp.com/attachments/1097409128491651135/1169910551275638855/snine_60b5c001b_A_young_girl_smiles_brightly_in_the_pure_blue_f_8a41fe5f-5101-4c1e-b948-a748a0583577.png?ex=65571f1b&is=6544aa1b&hm=b82f2d88224eb7942e24c63a8e519c7693de12a2b96daa0f327dfb8f691b1480&'},_0x4b4764=await this[_0x5e65fc(0x151)](_0x38e1c1);return _0x4b4764;}async[_0x11f25a(0x13c)](_0x1feb0a){const _0x451319=_0x11f25a,_0x541cc0=await this[_0x451319(0x133)][_0x451319(0x187)]([_0x451319(0x110)])||0x0,_0x1e26d1=await axios_1['default'][_0x451319(0x105)](_0x1feb0a,{'responseType':_0x451319(0x127)});return new Promise((_0x33bd90,_0x204521)=>{const _0x5c3189=_0x451319;streamToBuffer(_0x1e26d1[_0x5c3189(0x18d)],(_0x2ea08a,_0xa05a82)=>{const _0x4c093d=_0x5c3189;if(_0x2ea08a)throw new common_1[(_0x4c093d(0x161))](_0x4c093d(0x117),common_1[_0x4c093d(0x183)][_0x4c093d(0x163)]);else _0x33bd90(_0xa05a82);});});}};function _0x4cf1(){const _0x39d200=['tencentCos','image/webp','split','image/jpg','default','aliOssBucket','cosSecretKey','GlobalConfigService','3030496SlyQdI','path','HttpStatus','uploadFileByCheveretoFromUrl','decode','mjProxyUrl','getConfigs','aliyun','form-data','UploadService','createRandomUid','images','data','cosRegion','tem','initializeFolders','uploadFileForLocal','test','slice','function','saveFileToLocal','audio/webm','ISDEV','uploadFileByTencentCosFromUrl','895995YCTFxJ','http://172.247.48.137:8000','defineProperty','replace','binary','decodeFileName','uploadFileByAliOss','get','https://','media','message','cosBucket','png','pop','1250230JvuUcG','chevereto','STANDARD','上传图片失败[ALI][url]','mjProxy','getUploadConfig','Injectable','put','core','1912SyIdYo','removeSpecialCharacters','获取图片资源失败、请重新试试吧！','putObject','writeFileSync','endsWith','buffer','260950ybpWZN','audio/mp4','.png','error','__decorate','mjtest.png','getFileTypeWithDir','random-','ali-oss','audio/mp3','上传图片失败[ten][url]','stream','上传图片失败[ten]','base64','application/vnd.openxmlformats-officedocument.wordprocessingml.document','image/jpeg','上传图片失败[Chevereto]','object','image','url','aliOssStatus','请先前往后台管理设置base地址！','getOwnPropertyDescriptor','globalConfigService','UTF-8','uploadFileByTencentCos','1283424XBGtZf','files','getUploadType','metadata','cheveretoKey','saveCoreFile','getBufferFromUrl','uploadFileByChevereto','aliOssAccessKeyId','mkdirSync','onModuleInit','请先前往后台配置上传图片的方式','append','iconv-lite','source','existsSync','includes','toString','上传图片失败[Chevereto][url]','上传图片失败[Chevereto|buffer]\x20-->\x20','application/pdf','Logger','ali','/core/','uploadFile','length','tencentCosStatus','uploadFileFromUrl','/mj/replaceUpload','cosSecretId','audio/ogg','uploadFileByAliOssFromUrl','uuid','substring','aliOssRegion','genFileName','35KykakP','../../common/utils','不支持当前文件类型！','上传图片失败[ali]','cheveretoStatus','join','1550402avKCRQ','HttpException','filename','BAD_REQUEST','../globalConfig/globalConfig.service','stringify','application/msword','Location','7026prihLc','catch','response','32viWjGv','getTime','from','post','decorate','document','status','axios','__metadata','mimetype','tencent','originalname','-nine-','image/png'];_0x4cf1=function(){return _0x39d200;};return _0x4cf1();}UploadService=__decorate([(0x0,common_1[_0x11f25a(0x112)])(),__metadata('design:paramtypes',[globalConfig_service_1[_0x11f25a(0x180)]])],UploadService),exports['UploadService']=UploadService;