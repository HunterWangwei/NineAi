'use strict';const _0x3cc3fa=_0x17e8;function _0x17e8(_0x340183,_0x3471c9){const _0x326d60=_0x326d();return _0x17e8=function(_0x17e8d5,_0x6f6d4b){_0x17e8d5=_0x17e8d5-0x171;let _0x3d2ec9=_0x326d60[_0x17e8d5];return _0x3d2ec9;},_0x17e8(_0x340183,_0x3471c9);}(function(_0x1e518d,_0x2d7507){const _0x73a990=_0x17e8,_0x1da824=_0x1e518d();while(!![]){try{const _0x6d09cd=-parseInt(_0x73a990(0x1cf))/0x1*(-parseInt(_0x73a990(0x1d8))/0x2)+parseInt(_0x73a990(0x1bc))/0x3*(-parseInt(_0x73a990(0x1cd))/0x4)+parseInt(_0x73a990(0x1a2))/0x5+-parseInt(_0x73a990(0x1a4))/0x6*(parseInt(_0x73a990(0x179))/0x7)+parseInt(_0x73a990(0x17e))/0x8*(-parseInt(_0x73a990(0x1c7))/0x9)+-parseInt(_0x73a990(0x1ad))/0xa+parseInt(_0x73a990(0x1dc))/0xb;if(_0x6d09cd===_0x2d7507)break;else _0x1da824['push'](_0x1da824['shift']());}catch(_0x583f88){_0x1da824['push'](_0x1da824['shift']());}}}(_0x326d,0x2c9e1));var __decorate=this&&this['__decorate']||function(_0x1ba670,_0x2bc59a,_0x57ce80,_0x2bec0b){const _0x290c89=_0x17e8;var _0xf08ff7=arguments[_0x290c89(0x1d0)],_0x24441e=_0xf08ff7<0x3?_0x2bc59a:_0x2bec0b===null?_0x2bec0b=Object[_0x290c89(0x1a9)](_0x2bc59a,_0x57ce80):_0x2bec0b,_0x227b3e;if(typeof Reflect===_0x290c89(0x1d1)&&typeof Reflect['decorate']===_0x290c89(0x1cb))_0x24441e=Reflect[_0x290c89(0x201)](_0x1ba670,_0x2bc59a,_0x57ce80,_0x2bec0b);else{for(var _0x1304ff=_0x1ba670[_0x290c89(0x1d0)]-0x1;_0x1304ff>=0x0;_0x1304ff--)if(_0x227b3e=_0x1ba670[_0x1304ff])_0x24441e=(_0xf08ff7<0x3?_0x227b3e(_0x24441e):_0xf08ff7>0x3?_0x227b3e(_0x2bc59a,_0x57ce80,_0x24441e):_0x227b3e(_0x2bc59a,_0x57ce80))||_0x24441e;}return _0xf08ff7>0x3&&_0x24441e&&Object['defineProperty'](_0x2bc59a,_0x57ce80,_0x24441e),_0x24441e;},__metadata=this&&this[_0x3cc3fa(0x1af)]||function(_0x49bc0f,_0x13777c){const _0x5719a4=_0x3cc3fa;if(typeof Reflect===_0x5719a4(0x1d1)&&typeof Reflect['metadata']==='function')return Reflect[_0x5719a4(0x17c)](_0x49bc0f,_0x13777c);};Object[_0x3cc3fa(0x1c8)](exports,_0x3cc3fa(0x1ea),{'value':!![]}),exports['UploadService']=void 0x0;const common_1=require(_0x3cc3fa(0x1ed)),TENCENTCOS=require(_0x3cc3fa(0x1b8)),ALIOSS=require(_0x3cc3fa(0x1f8)),axios_1=require(_0x3cc3fa(0x196)),streamToBuffer=require(_0x3cc3fa(0x18a)),utils_1=require(_0x3cc3fa(0x19a)),globalConfig_service_1=require(_0x3cc3fa(0x204)),FormData=require(_0x3cc3fa(0x19d)),fs=require('fs'),uuid=require(_0x3cc3fa(0x17f)),path=require(_0x3cc3fa(0x1e6)),path_1=require('path'),iconv=require(_0x3cc3fa(0x1fd)),publicFolderPath=_0x3cc3fa(0x1f4);let UploadService=class UploadService{constructor(_0x4a3e6d){const _0xe1094=_0x3cc3fa;this[_0xe1094(0x186)]=_0x4a3e6d;}[_0x3cc3fa(0x1f0)](){const _0x391909=_0x3cc3fa;this[_0x391909(0x1fe)]();}async[_0x3cc3fa(0x1fe)](){const _0x4deec6=_0x3cc3fa;!fs[_0x4deec6(0x1e1)](publicFolderPath)&&fs['mkdirSync'](publicFolderPath);const _0x3199a0=(0x0,path_1[_0x4deec6(0x1de)])(publicFolderPath,_0x4deec6(0x17d));!fs[_0x4deec6(0x1e1)](_0x3199a0)&&fs['mkdirSync'](_0x3199a0);const _0x44360d=(0x0,path_1[_0x4deec6(0x1de)])(_0x3199a0,_0x4deec6(0x1e3));!fs[_0x4deec6(0x1e1)](_0x44360d)&&fs[_0x4deec6(0x18e)](_0x44360d);const _0x2845af=(0x0,path_1[_0x4deec6(0x1de)])(_0x3199a0,'document');!fs['existsSync'](_0x2845af)&&fs[_0x4deec6(0x18e)](_0x2845af);const _0x214f3b=(0x0,path_1['join'])(_0x3199a0,_0x4deec6(0x1f2));!fs[_0x4deec6(0x1e1)](_0x214f3b)&&fs[_0x4deec6(0x18e)](_0x214f3b);const _0x35e464=(0x0,path_1[_0x4deec6(0x1de)])(_0x3199a0,'tem');!fs[_0x4deec6(0x1e1)](_0x35e464)&&fs[_0x4deec6(0x18e)](_0x35e464);const _0xc1dcb3=(0x0,path_1['join'])(publicFolderPath,_0x4deec6(0x208));!fs[_0x4deec6(0x1e1)](_0xc1dcb3)&&fs[_0x4deec6(0x18e)](_0xc1dcb3);const _0x523629=(0x0,path_1[_0x4deec6(0x1de)])(publicFolderPath,'core');!fs[_0x4deec6(0x1e1)](_0x523629)&&fs[_0x4deec6(0x18e)](_0x523629);const _0x5cdfcc=(0x0,path_1[_0x4deec6(0x1de)])(_0x523629,'images');!fs['existsSync'](_0x5cdfcc)&&fs[_0x4deec6(0x18e)](_0x5cdfcc);const _0xc37ae2=(0x0,path_1[_0x4deec6(0x1de)])(_0x523629,_0x4deec6(0x1c6));!fs[_0x4deec6(0x1e1)](_0xc37ae2)&&fs[_0x4deec6(0x18e)](_0xc37ae2);const _0x5de5b3=(0x0,path_1[_0x4deec6(0x1de)])(_0x523629,'media');!fs[_0x4deec6(0x1e1)](_0x5de5b3)&&fs[_0x4deec6(0x18e)](_0x5de5b3);}async['uploadFileForLocal'](_0x4d0318){const _0x45abc2=_0x3cc3fa;return await this[_0x45abc2(0x1dd)](_0x4d0318,_0x45abc2(0x17d));}async[_0x3cc3fa(0x1d3)](_0x419dc5){const _0x492def=_0x3cc3fa;return await this[_0x492def(0x1dd)](_0x419dc5,_0x492def(0x177));}async['uploadFile'](_0x42da57){const _0x28bfc9=_0x3cc3fa,{filename:_0x44262a,originalname:_0x2348de,buffer:_0x3ba1ad,dir:dir='ai',mimetype:_0x433ea2,base64:_0x31a7a5}=_0x42da57,_0x30755c=_0x433ea2?_0x433ea2[_0x28bfc9(0x18f)]('/')[0x1]:'',_0x18ff41=_0x2348de||_0x44262a,{tencentCosStatus:tencentCosStatus=0x0,aliOssStatus:aliOssStatus=0x0,cheveretoStatus:cheveretoStatus=0x0}=await this['globalConfigService'][_0x28bfc9(0x185)](['tencentCosStatus',_0x28bfc9(0x1e2),_0x28bfc9(0x187)]);if(!Number(tencentCosStatus)&&!Number(aliOssStatus)&&!Number(cheveretoStatus))return this[_0x28bfc9(0x188)](_0x42da57);if(Number(tencentCosStatus))return this[_0x28bfc9(0x19e)]({'filename':_0x18ff41,'buffer':_0x3ba1ad,'dir':dir,'fileTyle':_0x30755c});if(Number(aliOssStatus))return await this[_0x28bfc9(0x1a3)]({'filename':_0x18ff41,'buffer':_0x3ba1ad,'dir':dir,'fileTyle':_0x30755c});if(Number(cheveretoStatus)){const {filename:_0x5b5da0,buffer:_0x9e15fd,dir:_0x49f93b}=_0x42da57;return await this['uploadFileByChevereto']({'filename':_0x5b5da0,'buffer':_0x31a7a5||_0x9e15fd['toString'](_0x28bfc9(0x1d7)),'dir':_0x49f93b,'fileTyle':_0x30755c});}}[_0x3cc3fa(0x1e5)](_0x2f65ff){const _0x59e0a1=_0x3cc3fa,_0x1dcc05=['image/jpeg',_0x59e0a1(0x198),_0x59e0a1(0x1f3),_0x59e0a1(0x1e7)],_0x5907b9=[_0x59e0a1(0x1eb),_0x59e0a1(0x1ae),_0x59e0a1(0x1bd),_0x59e0a1(0x1e0),_0x59e0a1(0x182)],_0x1f9577=[_0x59e0a1(0x203),_0x59e0a1(0x181),_0x59e0a1(0x18d)];if(_0x1dcc05[_0x59e0a1(0x1a0)](_0x2f65ff[_0x59e0a1(0x172)]))return _0x59e0a1(0x1e3);else{if(_0x5907b9['includes'](_0x2f65ff['mimetype']))return _0x59e0a1(0x1f2);else return _0x1f9577[_0x59e0a1(0x1a0)](_0x2f65ff[_0x59e0a1(0x172)])?_0x59e0a1(0x1c6):_0x59e0a1(0x1e3);}}[_0x3cc3fa(0x207)](_0x138e95){const _0x267326=_0x3cc3fa,_0x80a4b2=iconv[_0x267326(0x1e8)](Buffer[_0x267326(0x1f6)](_0x138e95,_0x267326(0x1a8)),_0x267326(0x1b4));return _0x80a4b2;}[_0x3cc3fa(0x1c4)](_0x412214){const _0x464a63=_0x3cc3fa,_0x1faafc=this[_0x464a63(0x207)](_0x412214),_0xaa3ae4=_0x1faafc[_0x464a63(0x18f)]('.')[_0x464a63(0x1d2)](),_0x181f67=_0x1faafc[_0x464a63(0x18f)]('.')[_0x464a63(0x1f5)](0x0,-0x1)[_0x464a63(0x1de)]('.'),_0x478411=new Date()[_0x464a63(0x18c)](),_0xe6b097=(0x0,utils_1['createRandomUid'])();return _0x181f67+_0x464a63(0x1ff)+_0x478411+'-nine-'+_0xe6b097+'.'+_0xaa3ae4;}async[_0x3cc3fa(0x1dd)](_0x4522a6,_0x448b2e){const _0x179c8d=_0x3cc3fa,_0x2ef51e=(_0x4522a6===null||_0x4522a6===void 0x0?void 0x0:_0x4522a6[_0x179c8d(0x1d7)])?'images':this[_0x179c8d(0x1e5)](_0x4522a6);if(!_0x2ef51e)throw new common_1[(_0x179c8d(0x189))](_0x179c8d(0x1d9),common_1['HttpStatus'][_0x179c8d(0x1c9)]);const _0x1c4cf4=await this['globalConfigService'][_0x179c8d(0x185)]([_0x179c8d(0x202)]);if(!_0x1c4cf4)throw new common_1[(_0x179c8d(0x189))](_0x179c8d(0x1b6),common_1[_0x179c8d(0x1da)][_0x179c8d(0x1c9)]);const _0x4652a6=_0x1c4cf4[_0x179c8d(0x17a)]('/')?_0x1c4cf4[_0x179c8d(0x1f5)](0x0,-0x1):_0x1c4cf4;if(!![]){const _0x5163c0=publicFolderPath+'/'+_0x448b2e+'/'+_0x2ef51e;let _0x496bd1=_0x4522a6[_0x179c8d(0x1fc)]||_0x4522a6[_0x179c8d(0x1b0)];!_0x496bd1&&(_0x496bd1=_0x179c8d(0x1bf)+uuid['v4']()[_0x179c8d(0x1f5)](0x0,0xa)+_0x179c8d(0x195));const _0xeed2e9=this[_0x179c8d(0x1c4)](_0x496bd1),_0x209ef3=path[_0x179c8d(0x1de)](_0x5163c0,_0xeed2e9);return fs['writeFileSync'](_0x209ef3,_0x4522a6[_0x179c8d(0x19b)]),''+_0x4652a6+_0x209ef3['substring'](0x6);}}async['saveCoreFile'](_0x55054b){const _0xadc6d=_0x3cc3fa,_0x49d103=this[_0xadc6d(0x1e5)](_0x55054b);if(!_0x49d103)throw new common_1[(_0xadc6d(0x189))](_0xadc6d(0x1d9),common_1[_0xadc6d(0x1da)][_0xadc6d(0x1c9)]);const _0x5c0f90=publicFolderPath+_0xadc6d(0x1db)+_0x49d103,_0x4a251c=this[_0xadc6d(0x1c4)](_0x55054b[_0xadc6d(0x1fc)]),_0x5b0a76=path['join'](_0x5c0f90,_0x4a251c);fs['writeFileSync'](_0x5b0a76,_0x55054b[_0xadc6d(0x19b)]);const _0x42bcde=await this[_0xadc6d(0x186)]['getConfigs']([_0xadc6d(0x202)]);if(!_0x42bcde)throw new common_1['HttpException'](_0xadc6d(0x1b6),common_1[_0xadc6d(0x1da)]['BAD_REQUEST']);return''+_0x42bcde+_0x5b0a76[_0xadc6d(0x1fb)](0x6);}async[_0x3cc3fa(0x1b1)](){const _0x85eb56=_0x3cc3fa,{tencentCosStatus:tencentCosStatus=0x0,aliOssStatus:aliOssStatus=0x0,cheveretoStatus:cheveretoStatus=0x0}=await this[_0x85eb56(0x186)][_0x85eb56(0x185)]([_0x85eb56(0x1a6),_0x85eb56(0x1e2),_0x85eb56(0x187)]);if(Number(tencentCosStatus))return _0x85eb56(0x1fa);if(Number(aliOssStatus))return'ali';if(Number(cheveretoStatus))return _0x85eb56(0x199);}async['uploadFileFromUrl']({filename:_0x139fcd,url:_0x12cfde,dir:dir='mj'}){const _0x14b8b5=_0x3cc3fa;dir=process[_0x14b8b5(0x171)][_0x14b8b5(0x19f)]?_0x14b8b5(0x1cc):dir;const {tencentCosStatus:tencentCosStatus=0x0,aliOssStatus:aliOssStatus=0x0,cheveretoStatus:cheveretoStatus=0x0}=await this['globalConfigService']['getConfigs']([_0x14b8b5(0x1a6),_0x14b8b5(0x1e2),'cheveretoStatus']);if(!Number(tencentCosStatus)&&!Number(aliOssStatus)&&!Number(cheveretoStatus))throw new common_1[(_0x14b8b5(0x189))]('请先前往后台配置上传图片的方式',common_1['HttpStatus'][_0x14b8b5(0x1c9)]);if(Number(tencentCosStatus))return this[_0x14b8b5(0x1f1)]({'filename':_0x139fcd,'url':_0x12cfde,'dir':dir});if(Number(aliOssStatus)){const _0x28f631=await this['uploadFileByAliOssFromUrl']({'filename':_0x139fcd,'url':_0x12cfde,'dir':dir});return _0x28f631;}if(Number(cheveretoStatus))return await this[_0x14b8b5(0x205)]({'filename':_0x139fcd,'url':_0x12cfde,'dir':dir});}async[_0x3cc3fa(0x19e)]({filename:_0x4598b7,buffer:_0x4ca601,dir:_0x26c059,fileTyle:_0x54bb7e}){const _0x17189e=_0x3cc3fa,{Bucket:_0x13e687,Region:_0x4de059,SecretId:_0x1e231d,SecretKey:_0x3aaafe}=await this[_0x17189e(0x1ec)](_0x17189e(0x1fa));this[_0x17189e(0x1a1)]=new TENCENTCOS({'SecretId':_0x1e231d,'SecretKey':_0x3aaafe,'FileParallelLimit':0xa});try{return new Promise(async(_0x5848f4,_0x4f1cc3)=>{const _0x3e9940=_0x17189e,_0x428c92=_0x54bb7e||_0x3e9940(0x1d4);this['tencentCos']['putObject']({'Bucket':(0x0,utils_1['removeSpecialCharacters'])(_0x13e687),'Region':(0x0,utils_1['removeSpecialCharacters'])(_0x4de059),'Key':_0x26c059+'/'+(_0x4598b7||(0x0,utils_1[_0x3e9940(0x1ef)])()+'.'+_0x54bb7e),'StorageClass':_0x3e9940(0x1b5),'Body':_0x4ca601},async(_0x44595f,_0x1233c7)=>{const _0x170aeb=_0x3e9940;if(_0x44595f)return _0x4f1cc3(_0x44595f);let _0x3e96fe=_0x1233c7[_0x170aeb(0x194)][_0x170aeb(0x183)](/^(http:\/\/|https:\/\/|\/\/|)(.*)/,_0x170aeb(0x1b7));const {acceleratedDomain:_0x2a4410}=await this['getUploadConfig'](_0x170aeb(0x1fa));return _0x2a4410&&(_0x3e96fe=_0x3e96fe[_0x170aeb(0x183)](/^(https:\/\/[^/]+)(\/.*)$/,'https://'+_0x2a4410+'$2')),_0x5848f4(_0x3e96fe);});});}catch(_0x36a6de){throw new common_1[(_0x17189e(0x189))](_0x17189e(0x1a5),common_1[_0x17189e(0x1da)][_0x17189e(0x1c9)]);}}async['uploadFileByTencentCosFromUrl']({filename:_0x40e9f8,url:_0x4c0000,dir:_0x5ace9c}){const _0x298fe5=_0x3cc3fa,{Bucket:_0x4ba6b3,Region:_0x24ee94,SecretId:_0x52f4b4,SecretKey:_0x6e271d}=await this[_0x298fe5(0x1ec)](_0x298fe5(0x1fa));this['tencentCos']=new TENCENTCOS({'SecretId':_0x52f4b4,'SecretKey':_0x6e271d,'FileParallelLimit':0xa});try{const _0x585500=await this[_0x298fe5(0x186)][_0x298fe5(0x185)](['mjProxy'])||0x0;if(Number(_0x585500)===0x1){const _0x3c0243={'cosType':_0x298fe5(0x1fa),'url':_0x4c0000,'cosParams':{'Bucket':_0x4ba6b3,'Region':_0x24ee94,'SecretId':_0x52f4b4,'SecretKey':_0x6e271d}},_0x43a970=await this['globalConfigService'][_0x298fe5(0x185)]([_0x298fe5(0x1b3)])||_0x298fe5(0x17b),_0x328aea=await axios_1[_0x298fe5(0x1f7)]['post'](_0x43a970+_0x298fe5(0x197),_0x3c0243);if(!_0x328aea[_0x298fe5(0x175)])throw new common_1[(_0x298fe5(0x189))]('上传图片失败[ten][url]',common_1[_0x298fe5(0x1da)]['BAD_REQUEST']);let _0x5330b9=_0x328aea['data'][_0x298fe5(0x183)](/^(http:\/\/|https:\/\/|\/\/|)(.*)/,_0x298fe5(0x1b7));const {acceleratedDomain:_0x324d0a}=await this[_0x298fe5(0x1ec)]('tencent');return _0x324d0a&&(_0x5330b9=_0x5330b9[_0x298fe5(0x183)](/^(https:\/\/[^/]+)(\/.*)$/,_0x298fe5(0x193)+_0x324d0a+'$2')),_0x5330b9;}else{const _0x38503a=await this[_0x298fe5(0x1ba)](_0x4c0000);return await this[_0x298fe5(0x19e)]({'filename':_0x40e9f8,'buffer':_0x38503a,'dir':_0x5ace9c,'fileTyle':''});}}catch(_0x3cafa6){throw new common_1['HttpException'](_0x298fe5(0x1df),common_1[_0x298fe5(0x1da)][_0x298fe5(0x1c9)]);}}async[_0x3cc3fa(0x1a3)]({filename:_0x2ec59e,buffer:_0xe7f6f3,dir:_0x5b1f7d,fileTyle:fileTyle=_0x3cc3fa(0x1d4)}){const _0x1921d2=_0x3cc3fa,{region:_0x585991,bucket:_0x55d1b9,accessKeyId:_0x3175fb,accessKeySecret:_0x528244}=await this[_0x1921d2(0x1ec)](_0x1921d2(0x1d6)),_0xd4567=new ALIOSS({'region':(0x0,utils_1['removeSpecialCharacters'])(_0x585991),'accessKeyId':_0x3175fb,'accessKeySecret':_0x528244,'bucket':(0x0,utils_1[_0x1921d2(0x1ac)])(_0x55d1b9)});try{return new Promise((_0x312290,_0x17e07b)=>{const _0x41e11e=_0x1921d2;_0xd4567['put'](_0x5b1f7d+'/'+(_0x2ec59e||(0x0,utils_1[_0x41e11e(0x1ef)])()+'.'+fileTyle),_0xe7f6f3)['then'](_0x3d67f5=>{const _0x252a1d=_0x41e11e;_0x312290(_0x3d67f5[_0x252a1d(0x1ce)]);})[_0x41e11e(0x178)](_0x569f49=>{_0x17e07b(_0x569f49);});});}catch(_0xb2e50c){throw new common_1['HttpException'](_0x1921d2(0x1e9),common_1[_0x1921d2(0x1da)][_0x1921d2(0x1c9)]);}}async[_0x3cc3fa(0x1ab)]({filename:_0x4d49b6,url:_0x447468,dir:_0x13a8b5}){const _0x1ccfd4=_0x3cc3fa,{region:_0x5d3ec7,bucket:_0x471ab7,accessKeyId:_0xb95854,accessKeySecret:_0x45b07c}=await this[_0x1ccfd4(0x1ec)](_0x1ccfd4(0x1d6)),_0x1ecbc2=new ALIOSS({'region':_0x5d3ec7,'accessKeyId':_0xb95854,'accessKeySecret':_0x45b07c,'bucket':_0x471ab7});try{const _0x3ff0ec=await this['globalConfigService'][_0x1ccfd4(0x185)]([_0x1ccfd4(0x19c)])||0x0;if(Number(_0x3ff0ec)===0x1){const _0x4d01a2={'url':_0x447468,'cosParams':{'region':_0x5d3ec7,'bucket':_0x471ab7,'accessKeyId':_0xb95854,'accessKeySecret':_0x45b07c},'cosType':'aliyun'},_0x272cc3=await this[_0x1ccfd4(0x186)]['getConfigs']([_0x1ccfd4(0x1b3)])||_0x1ccfd4(0x17b),_0x4b92c3=await axios_1['default'][_0x1ccfd4(0x1ee)](_0x272cc3+'/mj/replaceUpload',_0x4d01a2);if(!(_0x4b92c3===null||_0x4b92c3===void 0x0?void 0x0:_0x4b92c3[_0x1ccfd4(0x175)]))throw new common_1[(_0x1ccfd4(0x189))](_0x1ccfd4(0x1aa),common_1[_0x1ccfd4(0x1da)]['BAD_REQUEST']);return _0x4b92c3[_0x1ccfd4(0x175)];}else{const _0x11cd40=await this[_0x1ccfd4(0x1ba)](_0x447468);return await this['uploadFileByAliOss']({'filename':_0x4d49b6,'buffer':_0x11cd40,'dir':_0x13a8b5});}}catch(_0x4d5509){throw new common_1[(_0x1ccfd4(0x189))](_0x1ccfd4(0x1aa),common_1[_0x1ccfd4(0x1da)][_0x1ccfd4(0x1c9)]);}}async[_0x3cc3fa(0x1c5)]({filename:filename='',buffer:_0x124e83,dir:dir='ai',fileTyle:fileTyle=_0x3cc3fa(0x1d4)}){const _0x39a265=_0x3cc3fa;var _0x38aa6b;const {key:_0x5a0ee3,uploadPath:_0x208798}=await this[_0x39a265(0x1ec)](_0x39a265(0x199)),_0x52b654=_0x208798[_0x39a265(0x17a)]('/')?_0x208798[_0x39a265(0x1f5)](0x0,-0x1):_0x208798,_0x586dbb=new FormData();_0x586dbb[_0x39a265(0x1f9)](_0x39a265(0x176),_0x124e83),_0x586dbb[_0x39a265(0x1f9)](_0x39a265(0x1c3),_0x5a0ee3);try{const _0x43596d=await axios_1[_0x39a265(0x1f7)][_0x39a265(0x1ee)](_0x52b654,_0x586dbb,{'headers':{'X-API-Key':_0x5a0ee3}});if((_0x43596d===null||_0x43596d===void 0x0?void 0x0:_0x43596d[_0x39a265(0x1b2)])===0xc8)return _0x43596d[_0x39a265(0x175)]['image'][_0x39a265(0x1ce)];else common_1[_0x39a265(0x1c0)][_0x39a265(0x184)](_0x39a265(0x200),JSON['stringify'](_0x43596d[_0x39a265(0x175)]));}catch(_0x244aef){throw new common_1['HttpException']('上传图片失败[Chevereto|buffer]\x20-->\x20'+((_0x38aa6b=_0x244aef[_0x39a265(0x1c2)])===null||_0x38aa6b===void 0x0?void 0x0:_0x38aa6b[_0x39a265(0x175)]['error'][_0x39a265(0x191)]),common_1[_0x39a265(0x1da)][_0x39a265(0x1c9)]);}}async[_0x3cc3fa(0x205)]({filename:_0x380b05,url:_0x56d7f3,dir:_0x3b2056}){const _0x11de97=_0x3cc3fa;try{const _0x12f6ed=await this[_0x11de97(0x186)][_0x11de97(0x185)](['mjProxy'])||0x0;if(Number(_0x12f6ed)===0x1){const {key:_0x3d3778,uploadPath:_0x3b97d0}=await this[_0x11de97(0x1ec)]('chevereto'),_0x31c0a8=_0x3b97d0['endsWith']('/')?_0x3b97d0[_0x11de97(0x1f5)](0x0,-0x1):_0x3b97d0,_0x57c108={'cosType':_0x11de97(0x199),'url':_0x56d7f3,'cosParams':{'key':_0x3d3778,'uploadPath':_0x31c0a8}},_0x23966c=await this[_0x11de97(0x186)]['getConfigs']([_0x11de97(0x1b3)])||_0x11de97(0x17b),_0x3a2574=await axios_1[_0x11de97(0x1f7)][_0x11de97(0x1ee)](_0x23966c+'/mj/replaceUpload',_0x57c108);if(!_0x3a2574['data'])throw new common_1[(_0x11de97(0x189))](_0x11de97(0x190),common_1['HttpStatus'][_0x11de97(0x1c9)]);return _0x3a2574[_0x11de97(0x175)];}else{const _0x36ef93=await this['getBufferFromUrl'](_0x56d7f3);return await this[_0x11de97(0x1c5)]({'filename':_0x380b05,'buffer':_0x36ef93,'dir':_0x3b2056});}}catch(_0x2769ba){throw new common_1[(_0x11de97(0x189))](_0x2769ba['response'],common_1[_0x11de97(0x1da)][_0x11de97(0x1c9)]);}}async[_0x3cc3fa(0x1ec)](_0x281fa9){const _0x36523f=_0x3cc3fa;if(_0x281fa9===_0x36523f(0x1d6)){const {aliOssRegion:_0x264b0b,aliOssBucket:_0x11bec3,aliOssAccessKeyId:_0x4bc4a5,aliOssAccessKeySecret:_0x1f130d}=await this[_0x36523f(0x186)]['getConfigs'](['aliOssRegion',_0x36523f(0x206),_0x36523f(0x18b),_0x36523f(0x1a7)]);return{'region':_0x264b0b,'bucket':_0x11bec3,'accessKeyId':_0x4bc4a5,'accessKeySecret':_0x1f130d};}if(_0x281fa9==='tencent'){const {cosBucket:_0x49d65f,cosRegion:_0x407821,cosSecretId:_0x41d80d,cosSecretKey:_0x55b59a,tencentCosAcceleratedDomain:_0x26c31b}=await this[_0x36523f(0x186)][_0x36523f(0x185)](['cosBucket',_0x36523f(0x1b9),_0x36523f(0x1ca),'cosSecretKey','tencentCosAcceleratedDomain']);return{'Bucket':_0x49d65f,'Region':_0x407821,'SecretId':_0x41d80d,'SecretKey':_0x55b59a,'acceleratedDomain':_0x26c31b};}if(_0x281fa9==='chevereto'){const {cheveretoKey:_0x403b8b,cheveretoUploadPath:_0x454d1e}=await this['globalConfigService'][_0x36523f(0x185)]([_0x36523f(0x1e4),_0x36523f(0x1bb)]);return{'key':_0x403b8b,'uploadPath':_0x454d1e};}}async[_0x3cc3fa(0x173)](){const _0x3a7123=_0x3cc3fa,_0xce3a55={'filename':_0x3a7123(0x1d5),'dir':'mj','url':_0x3a7123(0x174)},_0x579454=await this[_0x3a7123(0x192)](_0xce3a55);return _0x579454;}async[_0x3cc3fa(0x1ba)](_0x3a6e5b){const _0x1b7c17=_0x3cc3fa,_0x1a08b7=await this[_0x1b7c17(0x186)]['getConfigs']([_0x1b7c17(0x19c)])||0x0,_0x535d0c=await axios_1[_0x1b7c17(0x1f7)][_0x1b7c17(0x180)](_0x3a6e5b,{'responseType':_0x1b7c17(0x1c1)});return new Promise((_0xc0070c,_0x4516ef)=>{streamToBuffer(_0x535d0c['data'],(_0x39954c,_0x351ceb)=>{const _0x2ab747=_0x17e8;if(_0x39954c)throw new common_1[(_0x2ab747(0x189))]('获取图片资源失败、请重新试试吧！',common_1[_0x2ab747(0x1da)][_0x2ab747(0x1c9)]);else _0xc0070c(_0x351ceb);});});}};UploadService=__decorate([(0x0,common_1['Injectable'])(),__metadata(_0x3cc3fa(0x1be),[globalConfig_service_1['GlobalConfigService']])],UploadService),exports['UploadService']=UploadService;function _0x326d(){const _0x456563=['audio/mp4','__metadata','filename','getUploadType','status','mjProxyUrl','UTF-8','STANDARD','请先前往后台管理设置base地址！','https://$2','cos-nodejs-sdk-v5','cosRegion','getBufferFromUrl','cheveretoUploadPath','3XsNOnp','audio/webm','design:paramtypes','random-','Logger','stream','response','key','genFileName','uploadFileByChevereto','document','2295jnCMoz','defineProperty','BAD_REQUEST','cosSecretId','function','mjdev','137588MXZawU','url','73cuLZJM','length','object','pop','uploadFileForCore','png','mjtest.png','ali','base64','6406VhqmBw','不支持当前文件类型！','HttpStatus','/core/','2643817bZCKIu','saveFileToLocal','join','上传图片失败[ten][url]','audio/wav','existsSync','aliOssStatus','images','cheveretoKey','getFileTypeWithDir','path','image/jpg','decode','上传图片失败[ali]','__esModule','audio/mp3','getUploadConfig','@nestjs/common','post','createRandomUid','onModuleInit','uploadFileByTencentCosFromUrl','media','image/webp','public','slice','from','default','ali-oss','append','tencent','substring','originalname','iconv-lite','initializeFolders','-nine-','上传图片失败[Chevereto]','decorate','registerBaseUrl','application/pdf','../globalConfig/globalConfig.service','uploadFileByCheveretoFromUrl','aliOssBucket','decodeFileName','tem','env','mimetype','test','https://cdn.discordapp.com/attachments/1097409128491651135/1169910551275638855/snine_60b5c001b_A_young_girl_smiles_brightly_in_the_pure_blue_f_8a41fe5f-5101-4c1e-b948-a748a0583577.png?ex=65571f1b&is=6544aa1b&hm=b82f2d88224eb7942e24c63a8e519c7693de12a2b96daa0f327dfb8f691b1480&','data','source','core','catch','35XtoEPG','endsWith','http://172.247.48.137:8000','metadata','files','6128tFwJIM','uuid','get','application/msword','audio/ogg','replace','error','getConfigs','globalConfigService','cheveretoStatus','uploadFileForLocal','HttpException','stream-to-buffer','aliOssAccessKeyId','getTime','application/vnd.openxmlformats-officedocument.wordprocessingml.document','mkdirSync','split','上传图片失败[Chevereto][url]','message','uploadFileFromUrl','https://','Location','.png','axios','/mj/replaceUpload','image/png','chevereto','../../common/utils','buffer','mjProxy','form-data','uploadFileByTencentCos','ISDEV','includes','tencentCos','1029275AKIRmD','uploadFileByAliOss','84114lzXjIw','上传图片失败[ten]','tencentCosStatus','aliOssAccessKeySecret','binary','getOwnPropertyDescriptor','上传图片失败[ALI][url]','uploadFileByAliOssFromUrl','removeSpecialCharacters','1974460UNgmei'];_0x326d=function(){return _0x456563;};return _0x326d();}