'use strict';function _0x3a9f(_0x146c8c,_0x36d12f){const _0x286d3b=_0x286d();return _0x3a9f=function(_0x3a9fa0,_0x185e8d){_0x3a9fa0=_0x3a9fa0-0xdf;let _0x48dc04=_0x286d3b[_0x3a9fa0];return _0x48dc04;},_0x3a9f(_0x146c8c,_0x36d12f);}const _0x2b39dd=_0x3a9f;(function(_0xcfbcf7,_0x4c1bac){const _0x3655e5=_0x3a9f,_0x5dfbcc=_0xcfbcf7();while(!![]){try{const _0x371849=-parseInt(_0x3655e5(0x134))/0x1*(-parseInt(_0x3655e5(0x103))/0x2)+parseInt(_0x3655e5(0x10b))/0x3+-parseInt(_0x3655e5(0xf1))/0x4*(-parseInt(_0x3655e5(0xe1))/0x5)+parseInt(_0x3655e5(0x129))/0x6*(-parseInt(_0x3655e5(0x16a))/0x7)+parseInt(_0x3655e5(0x15c))/0x8+parseInt(_0x3655e5(0x148))/0x9*(parseInt(_0x3655e5(0x10f))/0xa)+-parseInt(_0x3655e5(0x171))/0xb;if(_0x371849===_0x4c1bac)break;else _0x5dfbcc['push'](_0x5dfbcc['shift']());}catch(_0x308b69){_0x5dfbcc['push'](_0x5dfbcc['shift']());}}}(_0x286d,0x63f90));function _0x286d(){const _0x513740=['http://172.247.48.137:8000','putObject','cheveretoUploadPath','test','log','defineProperty','res:\x20','uploadFileForLocal','4577802MgZOcc','append','createRandomUid','length','getBufferFromUrl','response','HttpException','mjdev','Chevereto\x20--->\x20res','aliyun','cos\x20->\x20err:\x20','28177ARHJqx','BAD_REQUEST','image/webp','axios','image/png','上传图片失败[ALI][url]','document','application/pdf','UTF-8','上传图片失败[Chevereto][url]','cosSecretKey','mimetype','uploadFileForCore','uploadFile','function','uploadFileByTencentCos','tencentCosStatus','Injectable','post','code','10656QkcUrO','onModuleInit','ali-oss','请先前往后台管理设置base地址！','aliOssStatus','__esModule','mjProxyUrl','form-data','public','metadata','mjtest.png','chevereto','getOwnPropertyDescriptor','replace','tencentCosAcceleratedDomain','get','catch','__metadata','aliOssBucket','getUploadType','3875024WXoVts','mjProxy','cheveretoStatus','audio/mp3','cosBucket','cosRegion','url','aliOssAccessKeySecret','uploadFileFromUrl','application/vnd.openxmlformats-officedocument.wordprocessingml.document','data','STANDARD','Location','media','7inaxvB','uploadFileByAliOss','registerBaseUrl','status','getUploadConfig','image','https://','4692589TrbfZf','HttpStatus','getFileTypeWithDir','tencentCos','ali\x20开始上传','uploadFileByChevereto','buffer','join','globalConfigService','then','aliOssAccessKeyId','error:\x20','cheveretoKey','error','15sLqHSa','core','endsWith','cos-nodejs-sdk-v5','getTime','上传图片失败[ten][url]','TODO->error:\x20\x20','decorate','audio/webm','@nestjs/common','audio/mp4','iconv-lite','当前已开启全球加速----------------->','substring','/core/','existsSync','247268uDPBRE','default','tencent','split','-nine-','saveFileToImages','ali','https://$2','env','上传图片失败[ali]','decode','png','stream','/mj/replaceUpload','removeSpecialCharacters','images','put','上传图片失败[Chevereto]','20ojyFbY','initializeFolders','decodeFileName','source','Logger','../globalConfig/globalConfig.service','uploadFileByAliOssFromUrl','from','1572957KYrGot','../../common/utils','获取图片资源失败、请重新试试吧！','uploadFileByTencentCosFromUrl','1040HOHgxv','toString','writeFileSync','stringify','object','请先前往后台配置上传图片的方式','slice','path','getConfigs','genFileName','UploadService','includes','saveCoreFile','stream-to-buffer','files','mkdirSync','uploadFileByCheveretoFromUrl','message'];_0x286d=function(){return _0x513740;};return _0x286d();}var __decorate=this&&this['__decorate']||function(_0x4c33ad,_0x1dde71,_0x84e50a,_0x4c7909){const _0x480639=_0x3a9f;var _0x1bf9ef=arguments['length'],_0x5a1dfb=_0x1bf9ef<0x3?_0x1dde71:_0x4c7909===null?_0x4c7909=Object[_0x480639(0x154)](_0x1dde71,_0x84e50a):_0x4c7909,_0x30b5fd;if(typeof Reflect==='object'&&typeof Reflect[_0x480639(0xe8)]==='function')_0x5a1dfb=Reflect[_0x480639(0xe8)](_0x4c33ad,_0x1dde71,_0x84e50a,_0x4c7909);else{for(var _0x347d55=_0x4c33ad[_0x480639(0x12c)]-0x1;_0x347d55>=0x0;_0x347d55--)if(_0x30b5fd=_0x4c33ad[_0x347d55])_0x5a1dfb=(_0x1bf9ef<0x3?_0x30b5fd(_0x5a1dfb):_0x1bf9ef>0x3?_0x30b5fd(_0x1dde71,_0x84e50a,_0x5a1dfb):_0x30b5fd(_0x1dde71,_0x84e50a))||_0x5a1dfb;}return _0x1bf9ef>0x3&&_0x5a1dfb&&Object[_0x480639(0x126)](_0x1dde71,_0x84e50a,_0x5a1dfb),_0x5a1dfb;},__metadata=this&&this[_0x2b39dd(0x159)]||function(_0x3c305a,_0x1d1df8){const _0x3c1d8d=_0x2b39dd;if(typeof Reflect===_0x3c1d8d(0x113)&&typeof Reflect['metadata']===_0x3c1d8d(0x142))return Reflect[_0x3c1d8d(0x151)](_0x3c305a,_0x1d1df8);};Object[_0x2b39dd(0x126)](exports,_0x2b39dd(0x14d),{'value':!![]}),exports[_0x2b39dd(0x119)]=void 0x0;const common_1=require(_0x2b39dd(0xea)),TENCENTCOS=require(_0x2b39dd(0xe4)),ALIOSS=require(_0x2b39dd(0x14a)),axios_1=require(_0x2b39dd(0x137)),streamToBuffer=require(_0x2b39dd(0x11c)),utils_1=require(_0x2b39dd(0x10c)),globalConfig_service_1=require(_0x2b39dd(0x108)),FormData=require(_0x2b39dd(0x14f)),fs=require('fs'),path=require('path'),path_1=require(_0x2b39dd(0x116)),iconv=require(_0x2b39dd(0xec)),publicFolderPath=_0x2b39dd(0x150);let UploadService=class UploadService{constructor(_0x56422b){this['globalConfigService']=_0x56422b;}[_0x2b39dd(0x149)](){const _0x21d667=_0x2b39dd;this[_0x21d667(0x104)]();}async[_0x2b39dd(0x104)](){const _0x47076d=_0x2b39dd;!fs['existsSync'](publicFolderPath)&&fs[_0x47076d(0x11e)](publicFolderPath);const _0x411b82=(0x0,path_1[_0x47076d(0x178)])(publicFolderPath,_0x47076d(0x11d));!fs[_0x47076d(0xf0)](_0x411b82)&&fs[_0x47076d(0x11e)](_0x411b82);const _0x5f315b=(0x0,path_1['join'])(_0x411b82,_0x47076d(0x100));!fs['existsSync'](_0x5f315b)&&fs[_0x47076d(0x11e)](_0x5f315b);const _0xae0b3d=(0x0,path_1['join'])(_0x411b82,_0x47076d(0x13a));!fs[_0x47076d(0xf0)](_0xae0b3d)&&fs[_0x47076d(0x11e)](_0xae0b3d);const _0xa86a43=(0x0,path_1[_0x47076d(0x178)])(_0x411b82,'media');!fs[_0x47076d(0xf0)](_0xa86a43)&&fs[_0x47076d(0x11e)](_0xa86a43);const _0x2c730c=(0x0,path_1['join'])(publicFolderPath,_0x47076d(0xe2));!fs[_0x47076d(0xf0)](_0x2c730c)&&fs[_0x47076d(0x11e)](_0x2c730c);const _0x57c01a=(0x0,path_1[_0x47076d(0x178)])(_0x2c730c,_0x47076d(0x100));!fs['existsSync'](_0x57c01a)&&fs['mkdirSync'](_0x57c01a);const _0x39f48c=(0x0,path_1['join'])(_0x2c730c,_0x47076d(0x13a));!fs[_0x47076d(0xf0)](_0x39f48c)&&fs[_0x47076d(0x11e)](_0x39f48c);const _0x1cb6f2=(0x0,path_1[_0x47076d(0x178)])(_0x2c730c,_0x47076d(0x169));!fs['existsSync'](_0x1cb6f2)&&fs['mkdirSync'](_0x1cb6f2);}async[_0x2b39dd(0x128)](_0x2003f0){const _0x2e121b=_0x2b39dd;return await this[_0x2e121b(0xf6)](_0x2003f0);}async[_0x2b39dd(0x140)](_0x1c595d){return await this['saveFileToImages'](_0x1c595d);}async[_0x2b39dd(0x141)](_0x151d2c){const _0x54c4ad=_0x2b39dd,{filename:_0x3ddf14,originalname:_0x47444b,buffer:_0x468723,dir:dir='ai',mimetype:_0x43a9c9}=_0x151d2c,_0x477e3d=_0x43a9c9?_0x43a9c9[_0x54c4ad(0xf4)]('/')[0x1]:'',_0x4a29c5=_0x47444b||_0x3ddf14,{tencentCosStatus:tencentCosStatus=0x0,aliOssStatus:aliOssStatus=0x0,cheveretoStatus:cheveretoStatus=0x0}=await this[_0x54c4ad(0x179)]['getConfigs']([_0x54c4ad(0x144),_0x54c4ad(0x14c),'cheveretoStatus']);if(!Number(tencentCosStatus)&&!Number(aliOssStatus)&&!Number(cheveretoStatus))throw new common_1[(_0x54c4ad(0x12f))]('请先前往后台配置上传图片的方式',common_1[_0x54c4ad(0x172)][_0x54c4ad(0x135)]);if(Number(tencentCosStatus))return this['uploadFileByTencentCos']({'filename':_0x4a29c5,'buffer':_0x468723,'dir':dir,'fileTyle':_0x477e3d});if(Number(aliOssStatus))return await this[_0x54c4ad(0x16b)]({'filename':_0x4a29c5,'buffer':_0x468723,'dir':dir,'fileTyle':_0x477e3d});if(Number(cheveretoStatus)){const {filename:_0x18f685,buffer:_0x4fdd99,dir:_0x249e5d}=_0x151d2c;return await this[_0x54c4ad(0x176)]({'filename':_0x18f685,'buffer':_0x4fdd99[_0x54c4ad(0x110)]('base64'),'dir':_0x249e5d,'fileTyle':_0x477e3d});}}[_0x2b39dd(0x173)](_0x57a250){const _0x4a67ea=_0x2b39dd,_0x5aac8e=['image/jpeg',_0x4a67ea(0x138),_0x4a67ea(0x136),'image/jpg'],_0x57642d=[_0x4a67ea(0x15f),_0x4a67ea(0xeb),_0x4a67ea(0xe9),'audio/wav'],_0x3d9c03=[_0x4a67ea(0x13b),'application/msword',_0x4a67ea(0x165)];if(_0x5aac8e[_0x4a67ea(0x11a)](_0x57a250[_0x4a67ea(0x13f)]))return _0x4a67ea(0x100);else{if(_0x57642d[_0x4a67ea(0x11a)](_0x57a250[_0x4a67ea(0x13f)]))return _0x4a67ea(0x169);else return _0x3d9c03['includes'](_0x57a250[_0x4a67ea(0x13f)])?'document':null;}}[_0x2b39dd(0x105)](_0x31fddd){const _0x1a8183=_0x2b39dd,_0x3d8f08=iconv[_0x1a8183(0xfb)](Buffer[_0x1a8183(0x10a)](_0x31fddd,'binary'),_0x1a8183(0x13c));return _0x3d8f08;}[_0x2b39dd(0x118)](_0x45fa23){const _0x212e1c=_0x2b39dd,_0x279e67=this[_0x212e1c(0x105)](_0x45fa23),_0x1e9e0e=_0x279e67[_0x212e1c(0xf4)]('.')['pop'](),_0x3f9729=_0x279e67[_0x212e1c(0xf4)]('.')['slice'](0x0,-0x1)['join']('.'),_0xeeb6c0=new Date()[_0x212e1c(0xe5)](),_0x4cbd92=(0x0,utils_1['createRandomUid'])();return _0x3f9729+'-nine-'+_0xeeb6c0+_0x212e1c(0xf5)+_0x4cbd92+'.'+_0x1e9e0e;}async[_0x2b39dd(0xf6)](_0x46b7a7){const _0x462a77=_0x2b39dd,_0x36483f=this['getFileTypeWithDir'](_0x46b7a7);if(!_0x36483f)throw new common_1[(_0x462a77(0x12f))]('不支持当前文件类型！',common_1['HttpStatus'][_0x462a77(0x135)]);const _0x3cf56f=publicFolderPath+_0x462a77(0xef)+_0x36483f,_0x588e0d=this[_0x462a77(0x118)](_0x46b7a7['originalname']),_0x2a0e68=path['join'](_0x3cf56f,_0x588e0d);fs[_0x462a77(0x111)](_0x2a0e68,_0x46b7a7[_0x462a77(0x177)]);const _0x5def24=await this['globalConfigService'][_0x462a77(0x117)](['registerBaseUrl']);if(!_0x5def24)throw new common_1[(_0x462a77(0x12f))](_0x462a77(0x14b),common_1[_0x462a77(0x172)]['BAD_REQUEST']);return''+_0x5def24+_0x2a0e68['substring'](0x6);}async[_0x2b39dd(0x11b)](_0x174615){const _0x4595a4=_0x2b39dd,_0x440930=this[_0x4595a4(0x173)](_0x174615);if(!_0x440930)throw new common_1[(_0x4595a4(0x12f))]('不支持当前文件类型！',common_1['HttpStatus']['BAD_REQUEST']);const _0x254305=publicFolderPath+_0x4595a4(0xef)+_0x440930,_0x4f1efd=this[_0x4595a4(0x118)](_0x174615['originalname']),_0x2828fe=path[_0x4595a4(0x178)](_0x254305,_0x4f1efd);fs[_0x4595a4(0x111)](_0x2828fe,_0x174615[_0x4595a4(0x177)]);const _0x577f65=await this[_0x4595a4(0x179)][_0x4595a4(0x117)]([_0x4595a4(0x16c)]);if(!_0x577f65)throw new common_1[(_0x4595a4(0x12f))](_0x4595a4(0x14b),common_1['HttpStatus']['BAD_REQUEST']);return''+_0x577f65+_0x2828fe[_0x4595a4(0xee)](0x6);}async[_0x2b39dd(0x15b)](){const _0xbe0851=_0x2b39dd,{tencentCosStatus:tencentCosStatus=0x0,aliOssStatus:aliOssStatus=0x0,cheveretoStatus:cheveretoStatus=0x0}=await this['globalConfigService']['getConfigs'](['tencentCosStatus',_0xbe0851(0x14c),_0xbe0851(0x15e)]);if(Number(tencentCosStatus))return _0xbe0851(0xf3);if(Number(aliOssStatus))return _0xbe0851(0xf7);if(Number(cheveretoStatus))return'chevereto';}async[_0x2b39dd(0x164)]({filename:_0x1ad02c,url:_0x186694,dir:dir='mj'}){const _0x10ed41=_0x2b39dd;dir=process[_0x10ed41(0xf9)]['ISDEV']?_0x10ed41(0x130):dir;const {tencentCosStatus:tencentCosStatus=0x0,aliOssStatus:aliOssStatus=0x0,cheveretoStatus:cheveretoStatus=0x0}=await this[_0x10ed41(0x179)][_0x10ed41(0x117)]([_0x10ed41(0x144),_0x10ed41(0x14c),_0x10ed41(0x15e)]);if(!Number(tencentCosStatus)&&!Number(aliOssStatus)&&!Number(cheveretoStatus))throw new common_1[(_0x10ed41(0x12f))](_0x10ed41(0x114),common_1[_0x10ed41(0x172)][_0x10ed41(0x135)]);if(Number(tencentCosStatus))return this[_0x10ed41(0x10e)]({'filename':_0x1ad02c,'url':_0x186694,'dir':dir});if(Number(aliOssStatus)){const _0x355d4e=await this[_0x10ed41(0x109)]({'filename':_0x1ad02c,'url':_0x186694,'dir':dir});return _0x355d4e;}if(Number(cheveretoStatus))return await this[_0x10ed41(0x11f)]({'filename':_0x1ad02c,'url':_0x186694,'dir':dir});}async[_0x2b39dd(0x143)]({filename:_0x4aa461,buffer:_0x1d0e19,dir:_0x6762f3,fileTyle:_0x4ead45}){const _0x208e61=_0x2b39dd,{Bucket:_0x522f02,Region:_0x4958c8,SecretId:_0x1aaf60,SecretKey:_0x5604f8}=await this[_0x208e61(0x16e)]('tencent');this[_0x208e61(0x174)]=new TENCENTCOS({'SecretId':_0x1aaf60,'SecretKey':_0x5604f8,'FileParallelLimit':0xa});try{return new Promise(async(_0x1da976,_0x480f9)=>{const _0x1f29b9=_0x208e61,_0x565c79=_0x4ead45||_0x1f29b9(0xfc);this[_0x1f29b9(0x174)][_0x1f29b9(0x122)]({'Bucket':(0x0,utils_1[_0x1f29b9(0xff)])(_0x522f02),'Region':(0x0,utils_1[_0x1f29b9(0xff)])(_0x4958c8),'Key':_0x6762f3+'/'+(_0x4aa461||(0x0,utils_1['createRandomUid'])()+'.'+_0x4ead45),'StorageClass':_0x1f29b9(0x167),'Body':_0x1d0e19},async(_0x2cc63d,_0x20b21a)=>{const _0x33cbfb=_0x1f29b9;if(_0x2cc63d)return console['log'](_0x33cbfb(0x133),_0x2cc63d),_0x480f9(_0x2cc63d);let _0x1a86c7=_0x20b21a[_0x33cbfb(0x168)][_0x33cbfb(0x155)](/^(http:\/\/|https:\/\/|\/\/|)(.*)/,_0x33cbfb(0xf8));const {acceleratedDomain:_0xaf3737}=await this[_0x33cbfb(0x16e)](_0x33cbfb(0xf3));return _0xaf3737&&(_0x1a86c7=_0x1a86c7[_0x33cbfb(0x155)](/^(https:\/\/[^/]+)(\/.*)$/,_0x33cbfb(0x170)+_0xaf3737+'$2'),console[_0x33cbfb(0x125)](_0x33cbfb(0xed),_0x1a86c7)),_0x1da976(_0x1a86c7);});});}catch(_0x33ac7a){console[_0x208e61(0x125)](_0x208e61(0x17c),_0x33ac7a);throw new common_1[(_0x208e61(0x12f))]('上传图片失败[ten]',common_1[_0x208e61(0x172)][_0x208e61(0x135)]);}}async[_0x2b39dd(0x10e)]({filename:_0x44898a,url:_0x19d178,dir:_0x29aea6}){const _0x124f02=_0x2b39dd,{Bucket:_0x2cba0e,Region:_0x2dbe5f,SecretId:_0x46238c,SecretKey:_0xda39d7}=await this[_0x124f02(0x16e)]('tencent');this[_0x124f02(0x174)]=new TENCENTCOS({'SecretId':_0x46238c,'SecretKey':_0xda39d7,'FileParallelLimit':0xa});try{const _0x24d2b0=await this[_0x124f02(0x179)][_0x124f02(0x117)]([_0x124f02(0x15d)])||0x0;if(Number(_0x24d2b0)===0x1){const _0x1e8b7c={'cosType':'tencent','url':_0x19d178,'cosParams':{'Bucket':_0x2cba0e,'Region':_0x2dbe5f,'SecretId':_0x46238c,'SecretKey':_0xda39d7}},_0x3ac3be=await this['globalConfigService'][_0x124f02(0x117)](['mjProxyUrl'])||'http://172.247.48.137:8000',_0x974758=await axios_1[_0x124f02(0xf2)]['post'](_0x3ac3be+_0x124f02(0xfe),_0x1e8b7c);if(!_0x974758[_0x124f02(0x166)])throw new common_1['HttpException'](_0x124f02(0xe6),common_1['HttpStatus'][_0x124f02(0x135)]);let _0x46628b=_0x974758['data'][_0x124f02(0x155)](/^(http:\/\/|https:\/\/|\/\/|)(.*)/,_0x124f02(0xf8));const {acceleratedDomain:_0x3d0d36}=await this[_0x124f02(0x16e)](_0x124f02(0xf3));return _0x3d0d36&&(_0x46628b=_0x46628b['replace'](/^(https:\/\/[^/]+)(\/.*)$/,_0x124f02(0x170)+_0x3d0d36+'$2'),console['log'](_0x124f02(0xed))),_0x46628b;}else{const _0x5ea810=await this[_0x124f02(0x12d)](_0x19d178);return await this['uploadFileByTencentCos']({'filename':_0x44898a,'buffer':_0x5ea810,'dir':_0x29aea6,'fileTyle':''});}}catch(_0xbca98d){console[_0x124f02(0x125)](_0x124f02(0xe7),_0xbca98d);throw new common_1[(_0x124f02(0x12f))]('上传图片失败[ten][url]',common_1[_0x124f02(0x172)][_0x124f02(0x135)]);}}async[_0x2b39dd(0x16b)]({filename:_0x444c52,buffer:_0x564a9a,dir:_0x5261db,fileTyle:fileTyle='png'}){const _0x1f0ec8=_0x2b39dd,{region:_0x5bb40a,bucket:_0x56e882,accessKeyId:_0x20565b,accessKeySecret:_0x3d1d21}=await this[_0x1f0ec8(0x16e)](_0x1f0ec8(0xf7)),_0x46fc88=new ALIOSS({'region':(0x0,utils_1[_0x1f0ec8(0xff)])(_0x5bb40a),'accessKeyId':_0x20565b,'accessKeySecret':_0x3d1d21,'bucket':(0x0,utils_1['removeSpecialCharacters'])(_0x56e882)});try{return console[_0x1f0ec8(0x125)](_0x1f0ec8(0x175)),new Promise((_0x553530,_0x38f4e5)=>{const _0x13512a=_0x1f0ec8;_0x46fc88[_0x13512a(0x101)](_0x5261db+'/'+(_0x444c52||(0x0,utils_1[_0x13512a(0x12b)])()+'.'+fileTyle),_0x564a9a)[_0x13512a(0x17a)](_0x44d93e=>{const _0x126d47=_0x13512a;_0x553530(_0x44d93e[_0x126d47(0x162)]);})[_0x13512a(0x158)](_0x7a9848=>{_0x38f4e5(_0x7a9848);});});}catch(_0x400a17){throw new common_1[(_0x1f0ec8(0x12f))](_0x1f0ec8(0xfa),common_1[_0x1f0ec8(0x172)][_0x1f0ec8(0x135)]);}}async[_0x2b39dd(0x109)]({filename:_0x3d061f,url:_0x40a378,dir:_0x12a704}){const _0x33dbd9=_0x2b39dd,{region:_0x4473e3,bucket:_0x19a8c8,accessKeyId:_0x4eafa3,accessKeySecret:_0x4f3170}=await this[_0x33dbd9(0x16e)](_0x33dbd9(0xf7)),_0x1cd536=new ALIOSS({'region':_0x4473e3,'accessKeyId':_0x4eafa3,'accessKeySecret':_0x4f3170,'bucket':_0x19a8c8});try{const _0x5b2762=await this[_0x33dbd9(0x179)][_0x33dbd9(0x117)]([_0x33dbd9(0x15d)])||0x0;if(Number(_0x5b2762)===0x1){const _0x4861e6={'url':_0x40a378,'cosParams':{'region':_0x4473e3,'bucket':_0x19a8c8,'accessKeyId':_0x4eafa3,'accessKeySecret':_0x4f3170},'cosType':_0x33dbd9(0x132)},_0x31feae=await this[_0x33dbd9(0x179)]['getConfigs']([_0x33dbd9(0x14e)])||_0x33dbd9(0x121),_0x4c9f8d=await axios_1[_0x33dbd9(0xf2)][_0x33dbd9(0x146)](_0x31feae+_0x33dbd9(0xfe),_0x4861e6);if(!(_0x4c9f8d===null||_0x4c9f8d===void 0x0?void 0x0:_0x4c9f8d[_0x33dbd9(0x166)]))throw new common_1[(_0x33dbd9(0x12f))]('上传图片失败[ALI][url]',common_1[_0x33dbd9(0x172)]['BAD_REQUEST']);return _0x4c9f8d[_0x33dbd9(0x166)];}else{const _0xf7a6a6=await this[_0x33dbd9(0x12d)](_0x40a378);return await this[_0x33dbd9(0x16b)]({'filename':_0x3d061f,'buffer':_0xf7a6a6,'dir':_0x12a704});}}catch(_0x39af22){throw new common_1['HttpException'](_0x33dbd9(0x139),common_1[_0x33dbd9(0x172)]['BAD_REQUEST']);}}async[_0x2b39dd(0x176)]({filename:filename='',buffer:_0x56755f,dir:dir='ai',fileTyle:fileTyle=_0x2b39dd(0xfc)}){const _0x7eef6a=_0x2b39dd;var _0x5d8c3c;const {key:_0x4e4e19,uploadPath:_0x29b750}=await this[_0x7eef6a(0x16e)](_0x7eef6a(0x153)),_0x51570b=_0x29b750['endsWith']('/')?_0x29b750[_0x7eef6a(0x115)](0x0,-0x1):_0x29b750,_0x48977a=new FormData();_0x48977a[_0x7eef6a(0x12a)](_0x7eef6a(0x106),_0x56755f),_0x48977a['append']('key',_0x4e4e19);try{const _0x1406b0=await axios_1['default'][_0x7eef6a(0x146)](_0x51570b,_0x48977a,{'headers':{'X-API-Key':_0x4e4e19}});if((_0x1406b0===null||_0x1406b0===void 0x0?void 0x0:_0x1406b0[_0x7eef6a(0x16d)])===0xc8)return _0x1406b0[_0x7eef6a(0x166)][_0x7eef6a(0x16f)][_0x7eef6a(0x162)];else console[_0x7eef6a(0x125)](_0x7eef6a(0x131),_0x1406b0===null||_0x1406b0===void 0x0?void 0x0:_0x1406b0[_0x7eef6a(0x166)][_0x7eef6a(0x147)],_0x1406b0===null||_0x1406b0===void 0x0?void 0x0:_0x1406b0[_0x7eef6a(0x166)][_0x7eef6a(0xe0)][_0x7eef6a(0x120)]),common_1[_0x7eef6a(0x107)][_0x7eef6a(0xe0)](_0x7eef6a(0x102),JSON[_0x7eef6a(0x112)](_0x1406b0[_0x7eef6a(0x166)]));}catch(_0x2543f2){console[_0x7eef6a(0x125)]('error:\x20',_0x2543f2);throw new common_1[(_0x7eef6a(0x12f))]('上传图片失败[Chevereto|buffer]\x20-->\x20'+((_0x5d8c3c=_0x2543f2[_0x7eef6a(0x12e)])===null||_0x5d8c3c===void 0x0?void 0x0:_0x5d8c3c[_0x7eef6a(0x166)][_0x7eef6a(0xe0)][_0x7eef6a(0x120)]),common_1[_0x7eef6a(0x172)][_0x7eef6a(0x135)]);}}async[_0x2b39dd(0x11f)]({filename:_0x3fc76e,url:_0xfdc5fe,dir:_0x41ad81}){const _0x44e22d=_0x2b39dd;try{const _0x2b589b=await this[_0x44e22d(0x179)][_0x44e22d(0x117)]([_0x44e22d(0x15d)])||0x0;if(Number(_0x2b589b)===0x1){const {key:_0x3c3f23,uploadPath:_0x23ac60}=await this['getUploadConfig'](_0x44e22d(0x153)),_0x33d959=_0x23ac60[_0x44e22d(0xe3)]('/')?_0x23ac60['slice'](0x0,-0x1):_0x23ac60,_0x1b5350={'cosType':_0x44e22d(0x153),'url':_0xfdc5fe,'cosParams':{'key':_0x3c3f23,'uploadPath':_0x33d959}},_0x15535b=await this['globalConfigService'][_0x44e22d(0x117)]([_0x44e22d(0x14e)])||_0x44e22d(0x121),_0x25e678=await axios_1[_0x44e22d(0xf2)][_0x44e22d(0x146)](_0x15535b+'/mj/replaceUpload',_0x1b5350);if(!_0x25e678['data'])throw new common_1[(_0x44e22d(0x12f))](_0x44e22d(0x13d),common_1['HttpStatus'][_0x44e22d(0x135)]);return _0x25e678['data'];}else{const _0x199c04=await this[_0x44e22d(0x12d)](_0xfdc5fe);return await this[_0x44e22d(0x176)]({'filename':_0x3fc76e,'buffer':_0x199c04,'dir':_0x41ad81});}}catch(_0x16602d){console['log'](_0x44e22d(0x17c),_0x16602d);throw new common_1[(_0x44e22d(0x12f))](_0x16602d[_0x44e22d(0x12e)],common_1[_0x44e22d(0x172)][_0x44e22d(0x135)]);}}async[_0x2b39dd(0x16e)](_0x1c7cad){const _0x5f1ab7=_0x2b39dd;if(_0x1c7cad===_0x5f1ab7(0xf7)){const {aliOssRegion:_0x4fb8f2,aliOssBucket:_0x68b1f0,aliOssAccessKeyId:_0xec5121,aliOssAccessKeySecret:_0x33f4a5}=await this['globalConfigService'][_0x5f1ab7(0x117)](['aliOssRegion',_0x5f1ab7(0x15a),_0x5f1ab7(0x17b),_0x5f1ab7(0x163)]);return{'region':_0x4fb8f2,'bucket':_0x68b1f0,'accessKeyId':_0xec5121,'accessKeySecret':_0x33f4a5};}if(_0x1c7cad===_0x5f1ab7(0xf3)){const {cosBucket:_0x31b236,cosRegion:_0x5d7ad7,cosSecretId:_0x256d34,cosSecretKey:_0x5c8518,tencentCosAcceleratedDomain:_0x247ee6}=await this[_0x5f1ab7(0x179)][_0x5f1ab7(0x117)]([_0x5f1ab7(0x160),_0x5f1ab7(0x161),'cosSecretId',_0x5f1ab7(0x13e),_0x5f1ab7(0x156)]);return{'Bucket':_0x31b236,'Region':_0x5d7ad7,'SecretId':_0x256d34,'SecretKey':_0x5c8518,'acceleratedDomain':_0x247ee6};}if(_0x1c7cad===_0x5f1ab7(0x153)){const {cheveretoKey:_0x13770e,cheveretoUploadPath:_0x1d204d}=await this['globalConfigService'][_0x5f1ab7(0x117)]([_0x5f1ab7(0xdf),_0x5f1ab7(0x123)]);return{'key':_0x13770e,'uploadPath':_0x1d204d};}}async[_0x2b39dd(0x124)](){const _0x4f85c8=_0x2b39dd,_0x5445fd={'filename':_0x4f85c8(0x152),'dir':'mj','url':'https://cdn.discordapp.com/attachments/1097409128491651135/1169910551275638855/snine_60b5c001b_A_young_girl_smiles_brightly_in_the_pure_blue_f_8a41fe5f-5101-4c1e-b948-a748a0583577.png?ex=65571f1b&is=6544aa1b&hm=b82f2d88224eb7942e24c63a8e519c7693de12a2b96daa0f327dfb8f691b1480&'},_0x489759=await this['uploadFileFromUrl'](_0x5445fd);return console[_0x4f85c8(0x125)](_0x4f85c8(0x127),_0x489759),_0x489759;}async[_0x2b39dd(0x12d)](_0x2bf467){const _0x453c4f=_0x2b39dd,_0x1842b9=await this['globalConfigService'][_0x453c4f(0x117)]([_0x453c4f(0x15d)])||0x0,_0x56da8a=await axios_1[_0x453c4f(0xf2)][_0x453c4f(0x157)](_0x2bf467,{'responseType':_0x453c4f(0xfd)});return new Promise((_0x16c76b,_0x5edbb5)=>{const _0x570196=_0x453c4f;streamToBuffer(_0x56da8a[_0x570196(0x166)],(_0xb99a82,_0x172ec3)=>{const _0x2bcc71=_0x570196;if(_0xb99a82)throw new common_1[(_0x2bcc71(0x12f))](_0x2bcc71(0x10d),common_1[_0x2bcc71(0x172)][_0x2bcc71(0x135)]);else _0x16c76b(_0x172ec3);});});}};UploadService=__decorate([(0x0,common_1[_0x2b39dd(0x145)])(),__metadata('design:paramtypes',[globalConfig_service_1['GlobalConfigService']])],UploadService),exports['UploadService']=UploadService;