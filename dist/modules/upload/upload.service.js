'use strict';const _0xf1a42=_0x55d3;(function(_0x2375f4,_0x483186){const _0x1e7c2f=_0x55d3,_0xc4c44e=_0x2375f4();while(!![]){try{const _0x40d39b=-parseInt(_0x1e7c2f(0x1eb))/0x1+-parseInt(_0x1e7c2f(0x1a9))/0x2*(-parseInt(_0x1e7c2f(0x1c8))/0x3)+parseInt(_0x1e7c2f(0x231))/0x4*(-parseInt(_0x1e7c2f(0x1c6))/0x5)+parseInt(_0x1e7c2f(0x1fa))/0x6+parseInt(_0x1e7c2f(0x221))/0x7+-parseInt(_0x1e7c2f(0x1ec))/0x8*(-parseInt(_0x1e7c2f(0x1a6))/0x9)+-parseInt(_0x1e7c2f(0x1bc))/0xa;if(_0x40d39b===_0x483186)break;else _0xc4c44e['push'](_0xc4c44e['shift']());}catch(_0x32b609){_0xc4c44e['push'](_0xc4c44e['shift']());}}}(_0xea64,0x7e67d));function _0xea64(){const _0x2e1950=['audio/wav','key','http://172.247.48.137:8000','status','error','https://$2','application/pdf','endsWith','获取图片资源失败、请重新试试吧！','getOwnPropertyDescriptor','uploadFileByTencentCos','-nine-','uploadFileByAliOss','data','aliOssAccessKeyId','uuid','from','tencentCosStatus','HttpStatus','createRandomUid','includes','mjProxy','上传图片失败[Chevereto]','1781129DrtqDP','catch','aliyun','请先前往后台管理设置base地址！','getConfigs','split','.png','decorate','length','putObject','uploadFile','media','ali','url','post','document','1589116vFzvCv','getTime','defineProperty','请先前往后台配置上传图片的方式','uploadFileByAliOssFromUrl','tencentCos','cheveretoKey','object','source','125046OzjisU','default','buffer','176PfYjEr','decode','test','cosBucket','base64','uploadFileForLocal','../globalConfig/globalConfig.service','上传图片失败[Chevereto][url]','uploadFileByTencentCosFromUrl','mimetype','uploadFileByCheveretoFromUrl','cosSecretKey','saveCoreFile','image/webp','audio/webm','上传图片失败[Chevereto|buffer]\x20-->\x20','response','genFileName','image/png','8270000GufTFc','uploadFileByChevereto','audio/mp3','binary','registerBaseUrl','globalConfigService','tencentCosAcceleratedDomain','existsSync','mkdirSync','files','5AyJSDI','ali-oss','11418EYzuWz','mjProxyUrl','slice','audio/mp4','__metadata','writeFileSync','../../common/utils','initializeFolders','tencent','form-data','application/vnd.openxmlformats-officedocument.wordprocessingml.document','aliOssStatus','core','cos-nodejs-sdk-v5','metadata','function','originalname','saveFileToLocal','aliOssAccessKeySecret','BAD_REQUEST','stringify','iconv-lite','UTF-8','ISDEV','application/msword','png','上传图片失败[ali]','append','不支持当前文件类型！','design:paramtypes','https://','join','cheveretoStatus','path','toString','170630nScSTc','256YqhBwN','chevereto','/mj/replaceUpload','__decorate','images','getFileTypeWithDir','get','filename','stream-to-buffer','getBufferFromUrl','HttpException','/core/','aliOssBucket','Logger','5272098asNOen','上传图片失败[ALI][url]','上传图片失败[ten][url]','substring','tem','replace','audio/ogg','mjdev','UploadService','decodeFileName','removeSpecialCharacters','@nestjs/common','cosRegion','stream','getUploadConfig','uploadFileFromUrl'];_0xea64=function(){return _0x2e1950;};return _0xea64();}function _0x55d3(_0x44a896,_0x49ea88){const _0xea6490=_0xea64();return _0x55d3=function(_0x55d306,_0x8f590c){_0x55d306=_0x55d306-0x1a0;let _0x4f7a03=_0xea6490[_0x55d306];return _0x4f7a03;},_0x55d3(_0x44a896,_0x49ea88);}var __decorate=this&&this[_0xf1a42(0x1ef)]||function(_0x3f9d71,_0x145e0c,_0x360164,_0x1143bc){const _0x4c39c5=_0xf1a42;var _0x249920=arguments[_0x4c39c5(0x229)],_0x1f8c1c=_0x249920<0x3?_0x145e0c:_0x1143bc===null?_0x1143bc=Object[_0x4c39c5(0x213)](_0x145e0c,_0x360164):_0x1143bc,_0x65631a;if(typeof Reflect==='object'&&typeof Reflect['decorate']==='function')_0x1f8c1c=Reflect[_0x4c39c5(0x228)](_0x3f9d71,_0x145e0c,_0x360164,_0x1143bc);else{for(var _0x47c76f=_0x3f9d71[_0x4c39c5(0x229)]-0x1;_0x47c76f>=0x0;_0x47c76f--)if(_0x65631a=_0x3f9d71[_0x47c76f])_0x1f8c1c=(_0x249920<0x3?_0x65631a(_0x1f8c1c):_0x249920>0x3?_0x65631a(_0x145e0c,_0x360164,_0x1f8c1c):_0x65631a(_0x145e0c,_0x360164))||_0x1f8c1c;}return _0x249920>0x3&&_0x1f8c1c&&Object[_0x4c39c5(0x233)](_0x145e0c,_0x360164,_0x1f8c1c),_0x1f8c1c;},__metadata=this&&this[_0xf1a42(0x1cc)]||function(_0x517aa1,_0x45aafa){const _0x396e6c=_0xf1a42;if(typeof Reflect===_0x396e6c(0x1a4)&&typeof Reflect[_0x396e6c(0x1d6)]===_0x396e6c(0x1d7))return Reflect[_0x396e6c(0x1d6)](_0x517aa1,_0x45aafa);};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[_0xf1a42(0x202)]=void 0x0;const common_1=require(_0xf1a42(0x205)),TENCENTCOS=require(_0xf1a42(0x1d5)),ALIOSS=require(_0xf1a42(0x1c7)),axios_1=require('axios'),streamToBuffer=require(_0xf1a42(0x1f4)),utils_1=require(_0xf1a42(0x1ce)),globalConfig_service_1=require(_0xf1a42(0x1af)),FormData=require(_0xf1a42(0x1d1)),fs=require('fs'),uuid=require(_0xf1a42(0x219)),path=require('path'),path_1=require(_0xf1a42(0x1e9)),iconv=require(_0xf1a42(0x1dd)),publicFolderPath='public';let UploadService=class UploadService{constructor(_0x45b9b3){const _0x3890bb=_0xf1a42;this[_0x3890bb(0x1c1)]=_0x45b9b3;}['onModuleInit'](){const _0x45cab7=_0xf1a42;this[_0x45cab7(0x1cf)]();}async[_0xf1a42(0x1cf)](){const _0x5b34ed=_0xf1a42;!fs[_0x5b34ed(0x1c3)](publicFolderPath)&&fs[_0x5b34ed(0x1c4)](publicFolderPath);const _0x325abc=(0x0,path_1[_0x5b34ed(0x1e7)])(publicFolderPath,'files');!fs[_0x5b34ed(0x1c3)](_0x325abc)&&fs[_0x5b34ed(0x1c4)](_0x325abc);const _0xe0dfdb=(0x0,path_1[_0x5b34ed(0x1e7)])(_0x325abc,_0x5b34ed(0x1f0));!fs['existsSync'](_0xe0dfdb)&&fs[_0x5b34ed(0x1c4)](_0xe0dfdb);const _0x16ad9e=(0x0,path_1[_0x5b34ed(0x1e7)])(_0x325abc,'document');!fs[_0x5b34ed(0x1c3)](_0x16ad9e)&&fs[_0x5b34ed(0x1c4)](_0x16ad9e);const _0x159fb1=(0x0,path_1[_0x5b34ed(0x1e7)])(_0x325abc,_0x5b34ed(0x22c));!fs['existsSync'](_0x159fb1)&&fs[_0x5b34ed(0x1c4)](_0x159fb1);const _0x1a50c5=(0x0,path_1[_0x5b34ed(0x1e7)])(_0x325abc,_0x5b34ed(0x1fe));!fs[_0x5b34ed(0x1c3)](_0x1a50c5)&&fs['mkdirSync'](_0x1a50c5);const _0x23caff=(0x0,path_1[_0x5b34ed(0x1e7)])(publicFolderPath,_0x5b34ed(0x1fe));!fs[_0x5b34ed(0x1c3)](_0x23caff)&&fs['mkdirSync'](_0x23caff);const _0x3a9b54=(0x0,path_1[_0x5b34ed(0x1e7)])(publicFolderPath,_0x5b34ed(0x1d4));!fs[_0x5b34ed(0x1c3)](_0x3a9b54)&&fs['mkdirSync'](_0x3a9b54);const _0x2bddaf=(0x0,path_1[_0x5b34ed(0x1e7)])(_0x3a9b54,_0x5b34ed(0x1f0));!fs[_0x5b34ed(0x1c3)](_0x2bddaf)&&fs['mkdirSync'](_0x2bddaf);const _0x5645e8=(0x0,path_1[_0x5b34ed(0x1e7)])(_0x3a9b54,_0x5b34ed(0x230));!fs[_0x5b34ed(0x1c3)](_0x5645e8)&&fs[_0x5b34ed(0x1c4)](_0x5645e8);const _0x204aa7=(0x0,path_1['join'])(_0x3a9b54,_0x5b34ed(0x22c));!fs[_0x5b34ed(0x1c3)](_0x204aa7)&&fs[_0x5b34ed(0x1c4)](_0x204aa7);}async['uploadFileForLocal'](_0x4ac0be){const _0x1432b7=_0xf1a42;return await this[_0x1432b7(0x1d9)](_0x4ac0be,_0x1432b7(0x1c5));}async['uploadFileForCore'](_0x18e0cd){const _0x3f1d3d=_0xf1a42;return await this['saveFileToLocal'](_0x18e0cd,_0x3f1d3d(0x1d4));}async[_0xf1a42(0x22b)](_0x59404c){const _0x4e14a4=_0xf1a42,{filename:_0x5f5ae4,originalname:_0x5c216e,buffer:_0x1cae53,dir:dir='ai',mimetype:_0x254f06,base64:_0x271bbf}=_0x59404c,_0x23f9d7=_0x254f06?_0x254f06['split']('/')[0x1]:'',_0x53baa0=_0x5c216e||_0x5f5ae4,{tencentCosStatus:tencentCosStatus=0x0,aliOssStatus:aliOssStatus=0x0,cheveretoStatus:cheveretoStatus=0x0}=await this['globalConfigService'][_0x4e14a4(0x225)](['tencentCosStatus',_0x4e14a4(0x1d3),_0x4e14a4(0x1e8)]);if(!Number(tencentCosStatus)&&!Number(aliOssStatus)&&!Number(cheveretoStatus))return this[_0x4e14a4(0x1ae)](_0x59404c);if(Number(tencentCosStatus))return this[_0x4e14a4(0x214)]({'filename':_0x53baa0,'buffer':_0x1cae53,'dir':dir,'fileTyle':_0x23f9d7});if(Number(aliOssStatus))return await this[_0x4e14a4(0x216)]({'filename':_0x53baa0,'buffer':_0x1cae53,'dir':dir,'fileTyle':_0x23f9d7});if(Number(cheveretoStatus)){const {filename:_0x591d7b,buffer:_0xce33bb,dir:_0x2b5fd5}=_0x59404c;return await this[_0x4e14a4(0x1bd)]({'filename':_0x591d7b,'buffer':_0x271bbf||_0xce33bb[_0x4e14a4(0x1ea)]('base64'),'dir':_0x2b5fd5,'fileTyle':_0x23f9d7});}}[_0xf1a42(0x1f1)](_0x219e8b){const _0x5f0050=_0xf1a42,_0x518928=['image/jpeg',_0x5f0050(0x1bb),_0x5f0050(0x1b6),'image/jpg'],_0x2371d8=[_0x5f0050(0x1be),_0x5f0050(0x1cb),_0x5f0050(0x1b7),_0x5f0050(0x20a),_0x5f0050(0x200)],_0x177768=[_0x5f0050(0x210),_0x5f0050(0x1e0),_0x5f0050(0x1d2)];if(_0x518928[_0x5f0050(0x21e)](_0x219e8b[_0x5f0050(0x1b2)]))return _0x5f0050(0x1f0);else{if(_0x2371d8[_0x5f0050(0x21e)](_0x219e8b[_0x5f0050(0x1b2)]))return _0x5f0050(0x22c);else return _0x177768[_0x5f0050(0x21e)](_0x219e8b[_0x5f0050(0x1b2)])?'document':_0x5f0050(0x1f0);}}['decodeFileName'](_0x63c392){const _0x583c7d=_0xf1a42,_0x4964ae=iconv[_0x583c7d(0x1aa)](Buffer[_0x583c7d(0x21a)](_0x63c392,_0x583c7d(0x1bf)),_0x583c7d(0x1de));return _0x4964ae;}['genFileName'](_0x197f8b){const _0x22a49c=_0xf1a42,_0x28c3d4=this[_0x22a49c(0x203)](_0x197f8b),_0x24cc65=_0x28c3d4[_0x22a49c(0x226)]('.')['pop'](),_0x530b63=_0x28c3d4[_0x22a49c(0x226)]('.')[_0x22a49c(0x1ca)](0x0,-0x1)[_0x22a49c(0x1e7)]('.'),_0x32d6bd=new Date()[_0x22a49c(0x232)](),_0x5d6b47=(0x0,utils_1[_0x22a49c(0x21d)])();return _0x530b63+_0x22a49c(0x215)+_0x32d6bd+'-nine-'+_0x5d6b47+'.'+_0x24cc65;}async['saveFileToLocal'](_0x439f8c,_0x17494f){const _0x2a79c9=_0xf1a42,_0x2b4f36=(_0x439f8c===null||_0x439f8c===void 0x0?void 0x0:_0x439f8c[_0x2a79c9(0x1ad)])?_0x2a79c9(0x1f0):this[_0x2a79c9(0x1f1)](_0x439f8c);if(!_0x2b4f36)throw new common_1[(_0x2a79c9(0x1f6))](_0x2a79c9(0x1e4),common_1['HttpStatus'][_0x2a79c9(0x1db)]);const _0x2205ed=await this[_0x2a79c9(0x1c1)][_0x2a79c9(0x225)](['registerBaseUrl']);if(!_0x2205ed)throw new common_1[(_0x2a79c9(0x1f6))](_0x2a79c9(0x224),common_1[_0x2a79c9(0x21c)]['BAD_REQUEST']);const _0x18147a=_0x2205ed[_0x2a79c9(0x211)]('/')?_0x2205ed[_0x2a79c9(0x1ca)](0x0,-0x1):_0x2205ed;if(!![]){const _0x194771=publicFolderPath+'/'+_0x17494f+'/'+_0x2b4f36;let _0x146c75=_0x439f8c[_0x2a79c9(0x1d8)]||_0x439f8c[_0x2a79c9(0x1f3)];!_0x146c75&&(_0x146c75='random-'+uuid['v4']()[_0x2a79c9(0x1ca)](0x0,0xa)+_0x2a79c9(0x227));const _0x10e84b=this[_0x2a79c9(0x1ba)](_0x146c75),_0x39664d=path[_0x2a79c9(0x1e7)](_0x194771,_0x10e84b);return fs[_0x2a79c9(0x1cd)](_0x39664d,_0x439f8c[_0x2a79c9(0x1a8)]),''+_0x18147a+_0x39664d['substring'](0x6);}}async[_0xf1a42(0x1b5)](_0x21f589){const _0x215612=_0xf1a42,_0x4fa86a=this[_0x215612(0x1f1)](_0x21f589);if(!_0x4fa86a)throw new common_1['HttpException'](_0x215612(0x1e4),common_1[_0x215612(0x21c)][_0x215612(0x1db)]);const _0x7fbd68=publicFolderPath+_0x215612(0x1f7)+_0x4fa86a,_0x5e4c48=this[_0x215612(0x1ba)](_0x21f589[_0x215612(0x1d8)]),_0x57b622=path[_0x215612(0x1e7)](_0x7fbd68,_0x5e4c48);fs[_0x215612(0x1cd)](_0x57b622,_0x21f589[_0x215612(0x1a8)]);const _0x2b5c9d=await this[_0x215612(0x1c1)]['getConfigs']([_0x215612(0x1c0)]);if(!_0x2b5c9d)throw new common_1[(_0x215612(0x1f6))](_0x215612(0x224),common_1[_0x215612(0x21c)][_0x215612(0x1db)]);return''+_0x2b5c9d+_0x57b622[_0x215612(0x1fd)](0x6);}async['getUploadType'](){const _0x215550=_0xf1a42,{tencentCosStatus:tencentCosStatus=0x0,aliOssStatus:aliOssStatus=0x0,cheveretoStatus:cheveretoStatus=0x0}=await this[_0x215550(0x1c1)][_0x215550(0x225)]([_0x215550(0x21b),_0x215550(0x1d3),_0x215550(0x1e8)]);if(Number(tencentCosStatus))return _0x215550(0x1d0);if(Number(aliOssStatus))return _0x215550(0x22d);if(Number(cheveretoStatus))return'chevereto';}async[_0xf1a42(0x209)]({filename:_0x2e4a3a,url:_0x36393e,dir:dir='mj'}){const _0x12a256=_0xf1a42;dir=process['env'][_0x12a256(0x1df)]?_0x12a256(0x201):dir;const {tencentCosStatus:tencentCosStatus=0x0,aliOssStatus:aliOssStatus=0x0,cheveretoStatus:cheveretoStatus=0x0}=await this[_0x12a256(0x1c1)][_0x12a256(0x225)](['tencentCosStatus',_0x12a256(0x1d3),'cheveretoStatus']);if(!Number(tencentCosStatus)&&!Number(aliOssStatus)&&!Number(cheveretoStatus))throw new common_1[(_0x12a256(0x1f6))](_0x12a256(0x1a0),common_1[_0x12a256(0x21c)][_0x12a256(0x1db)]);if(Number(tencentCosStatus))return this[_0x12a256(0x1b1)]({'filename':_0x2e4a3a,'url':_0x36393e,'dir':dir});if(Number(aliOssStatus)){const _0x2d3787=await this[_0x12a256(0x1a1)]({'filename':_0x2e4a3a,'url':_0x36393e,'dir':dir});return _0x2d3787;}if(Number(cheveretoStatus))return await this[_0x12a256(0x1b3)]({'filename':_0x2e4a3a,'url':_0x36393e,'dir':dir});}async[_0xf1a42(0x214)]({filename:_0x363f62,buffer:_0x488606,dir:_0x2b807d,fileTyle:_0x3ada88}){const _0x569f4c=_0xf1a42,{Bucket:_0x44e6b7,Region:_0x5942e3,SecretId:_0x49c323,SecretKey:_0x5d7faa}=await this[_0x569f4c(0x208)]('tencent');this['tencentCos']=new TENCENTCOS({'SecretId':_0x49c323,'SecretKey':_0x5d7faa,'FileParallelLimit':0xa});try{return new Promise(async(_0x517630,_0x408542)=>{const _0x15e3dc=_0x569f4c,_0x246727=_0x3ada88||'png';this[_0x15e3dc(0x1a2)][_0x15e3dc(0x22a)]({'Bucket':(0x0,utils_1[_0x15e3dc(0x204)])(_0x44e6b7),'Region':(0x0,utils_1[_0x15e3dc(0x204)])(_0x5942e3),'Key':_0x2b807d+'/'+(_0x363f62||(0x0,utils_1[_0x15e3dc(0x21d)])()+'.'+_0x3ada88),'StorageClass':'STANDARD','Body':_0x488606},async(_0x3f41c9,_0x37fe86)=>{const _0x3a6c5e=_0x15e3dc;if(_0x3f41c9)return _0x408542(_0x3f41c9);let _0x339a57=_0x37fe86['Location'][_0x3a6c5e(0x1ff)](/^(http:\/\/|https:\/\/|\/\/|)(.*)/,_0x3a6c5e(0x20f));const {acceleratedDomain:_0x153bd5}=await this[_0x3a6c5e(0x208)](_0x3a6c5e(0x1d0));return _0x153bd5&&(_0x339a57=_0x339a57[_0x3a6c5e(0x1ff)](/^(https:\/\/[^/]+)(\/.*)$/,_0x3a6c5e(0x1e6)+_0x153bd5+'$2')),_0x517630(_0x339a57);});});}catch(_0x4146fc){throw new common_1[(_0x569f4c(0x1f6))]('上传图片失败[ten]',common_1[_0x569f4c(0x21c)][_0x569f4c(0x1db)]);}}async[_0xf1a42(0x1b1)]({filename:_0x4bfde6,url:_0x56e581,dir:_0x17c889}){const _0x1c807f=_0xf1a42,{Bucket:_0x2ad3a9,Region:_0x3e82c,SecretId:_0x3ce47b,SecretKey:_0x1f0422}=await this[_0x1c807f(0x208)]('tencent');this[_0x1c807f(0x1a2)]=new TENCENTCOS({'SecretId':_0x3ce47b,'SecretKey':_0x1f0422,'FileParallelLimit':0xa});try{const _0x26a9f3=await this[_0x1c807f(0x1c1)][_0x1c807f(0x225)]([_0x1c807f(0x21f)])||0x0;if(Number(_0x26a9f3)===0x1){const _0x58e36f={'cosType':_0x1c807f(0x1d0),'url':_0x56e581,'cosParams':{'Bucket':_0x2ad3a9,'Region':_0x3e82c,'SecretId':_0x3ce47b,'SecretKey':_0x1f0422}},_0x190057=await this[_0x1c807f(0x1c1)]['getConfigs']([_0x1c807f(0x1c9)])||_0x1c807f(0x20c),_0x6bd513=await axios_1[_0x1c807f(0x1a7)][_0x1c807f(0x22f)](_0x190057+'/mj/replaceUpload',_0x58e36f);if(!_0x6bd513[_0x1c807f(0x217)])throw new common_1[(_0x1c807f(0x1f6))](_0x1c807f(0x1fc),common_1['HttpStatus']['BAD_REQUEST']);let _0x238ea0=_0x6bd513[_0x1c807f(0x217)][_0x1c807f(0x1ff)](/^(http:\/\/|https:\/\/|\/\/|)(.*)/,_0x1c807f(0x20f));const {acceleratedDomain:_0x8b38f3}=await this['getUploadConfig'](_0x1c807f(0x1d0));return _0x8b38f3&&(_0x238ea0=_0x238ea0['replace'](/^(https:\/\/[^/]+)(\/.*)$/,_0x1c807f(0x1e6)+_0x8b38f3+'$2')),_0x238ea0;}else{const _0x278747=await this[_0x1c807f(0x1f5)](_0x56e581);return await this[_0x1c807f(0x214)]({'filename':_0x4bfde6,'buffer':_0x278747,'dir':_0x17c889,'fileTyle':''});}}catch(_0x17d5a8){throw new common_1[(_0x1c807f(0x1f6))]('上传图片失败[ten][url]',common_1[_0x1c807f(0x21c)]['BAD_REQUEST']);}}async[_0xf1a42(0x216)]({filename:_0xaba735,buffer:_0x374f09,dir:_0x239c49,fileTyle:fileTyle=_0xf1a42(0x1e1)}){const _0xe7c99e=_0xf1a42,{region:_0x4b1958,bucket:_0x5a0cbb,accessKeyId:_0x32b48a,accessKeySecret:_0xea1f96}=await this[_0xe7c99e(0x208)](_0xe7c99e(0x22d)),_0xf5aa78=new ALIOSS({'region':(0x0,utils_1[_0xe7c99e(0x204)])(_0x4b1958),'accessKeyId':_0x32b48a,'accessKeySecret':_0xea1f96,'bucket':(0x0,utils_1[_0xe7c99e(0x204)])(_0x5a0cbb)});try{return new Promise((_0x204346,_0x5d092f)=>{const _0x3c8561=_0xe7c99e;_0xf5aa78['put'](_0x239c49+'/'+(_0xaba735||(0x0,utils_1[_0x3c8561(0x21d)])()+'.'+fileTyle),_0x374f09)['then'](_0x18e73a=>{const _0x3b24f6=_0x3c8561;_0x204346(_0x18e73a[_0x3b24f6(0x22e)]);})[_0x3c8561(0x222)](_0x1e0054=>{_0x5d092f(_0x1e0054);});});}catch(_0x44bd8d){throw new common_1[(_0xe7c99e(0x1f6))](_0xe7c99e(0x1e2),common_1[_0xe7c99e(0x21c)]['BAD_REQUEST']);}}async[_0xf1a42(0x1a1)]({filename:_0x10998c,url:_0x5320da,dir:_0x17dba9}){const _0x5a6e95=_0xf1a42,{region:_0x42c756,bucket:_0x28d3b4,accessKeyId:_0x500156,accessKeySecret:_0x26a9e5}=await this['getUploadConfig'](_0x5a6e95(0x22d)),_0x11aafb=new ALIOSS({'region':_0x42c756,'accessKeyId':_0x500156,'accessKeySecret':_0x26a9e5,'bucket':_0x28d3b4});try{const _0x2947e6=await this['globalConfigService'][_0x5a6e95(0x225)]([_0x5a6e95(0x21f)])||0x0;if(Number(_0x2947e6)===0x1){const _0x47e181={'url':_0x5320da,'cosParams':{'region':_0x42c756,'bucket':_0x28d3b4,'accessKeyId':_0x500156,'accessKeySecret':_0x26a9e5},'cosType':_0x5a6e95(0x223)},_0x3a60d6=await this['globalConfigService'][_0x5a6e95(0x225)]([_0x5a6e95(0x1c9)])||_0x5a6e95(0x20c),_0x5a1137=await axios_1[_0x5a6e95(0x1a7)][_0x5a6e95(0x22f)](_0x3a60d6+_0x5a6e95(0x1ee),_0x47e181);if(!(_0x5a1137===null||_0x5a1137===void 0x0?void 0x0:_0x5a1137[_0x5a6e95(0x217)]))throw new common_1[(_0x5a6e95(0x1f6))](_0x5a6e95(0x1fb),common_1['HttpStatus'][_0x5a6e95(0x1db)]);return _0x5a1137[_0x5a6e95(0x217)];}else{const _0x48eb4f=await this[_0x5a6e95(0x1f5)](_0x5320da);return await this[_0x5a6e95(0x216)]({'filename':_0x10998c,'buffer':_0x48eb4f,'dir':_0x17dba9});}}catch(_0x25f72f){throw new common_1[(_0x5a6e95(0x1f6))](_0x5a6e95(0x1fb),common_1[_0x5a6e95(0x21c)][_0x5a6e95(0x1db)]);}}async[_0xf1a42(0x1bd)]({filename:filename='',buffer:_0x1367e5,dir:dir='ai',fileTyle:fileTyle='png'}){const _0xa1c092=_0xf1a42;var _0x2a1424;const {key:_0x456701,uploadPath:_0x16a1c8}=await this[_0xa1c092(0x208)](_0xa1c092(0x1ed)),_0xd182e1=_0x16a1c8['endsWith']('/')?_0x16a1c8[_0xa1c092(0x1ca)](0x0,-0x1):_0x16a1c8,_0x2d9170=new FormData();_0x2d9170[_0xa1c092(0x1e3)](_0xa1c092(0x1a5),_0x1367e5),_0x2d9170['append'](_0xa1c092(0x20b),_0x456701);try{const _0x28bd75=await axios_1['default'][_0xa1c092(0x22f)](_0xd182e1,_0x2d9170,{'headers':{'X-API-Key':_0x456701}});if((_0x28bd75===null||_0x28bd75===void 0x0?void 0x0:_0x28bd75[_0xa1c092(0x20d)])===0xc8)return _0x28bd75[_0xa1c092(0x217)]['image'][_0xa1c092(0x22e)];else common_1[_0xa1c092(0x1f9)][_0xa1c092(0x20e)](_0xa1c092(0x220),JSON[_0xa1c092(0x1dc)](_0x28bd75[_0xa1c092(0x217)]));}catch(_0x141682){throw new common_1[(_0xa1c092(0x1f6))](_0xa1c092(0x1b8)+((_0x2a1424=_0x141682[_0xa1c092(0x1b9)])===null||_0x2a1424===void 0x0?void 0x0:_0x2a1424['data']['error']['message']),common_1[_0xa1c092(0x21c)][_0xa1c092(0x1db)]);}}async[_0xf1a42(0x1b3)]({filename:_0xbd2adb,url:_0x33c307,dir:_0x774e14}){const _0x1fbd3d=_0xf1a42;try{const _0x57af78=await this[_0x1fbd3d(0x1c1)][_0x1fbd3d(0x225)](['mjProxy'])||0x0;if(Number(_0x57af78)===0x1){const {key:_0x3d86cc,uploadPath:_0x24676c}=await this[_0x1fbd3d(0x208)](_0x1fbd3d(0x1ed)),_0x5241ba=_0x24676c[_0x1fbd3d(0x211)]('/')?_0x24676c[_0x1fbd3d(0x1ca)](0x0,-0x1):_0x24676c,_0x4295b7={'cosType':_0x1fbd3d(0x1ed),'url':_0x33c307,'cosParams':{'key':_0x3d86cc,'uploadPath':_0x5241ba}},_0x41104a=await this[_0x1fbd3d(0x1c1)][_0x1fbd3d(0x225)]([_0x1fbd3d(0x1c9)])||_0x1fbd3d(0x20c),_0x2f29f2=await axios_1[_0x1fbd3d(0x1a7)]['post'](_0x41104a+'/mj/replaceUpload',_0x4295b7);if(!_0x2f29f2[_0x1fbd3d(0x217)])throw new common_1[(_0x1fbd3d(0x1f6))](_0x1fbd3d(0x1b0),common_1[_0x1fbd3d(0x21c)]['BAD_REQUEST']);return _0x2f29f2[_0x1fbd3d(0x217)];}else{const _0x294490=await this['getBufferFromUrl'](_0x33c307);return await this[_0x1fbd3d(0x1bd)]({'filename':_0xbd2adb,'buffer':_0x294490,'dir':_0x774e14});}}catch(_0x42c5b2){throw new common_1[(_0x1fbd3d(0x1f6))](_0x42c5b2[_0x1fbd3d(0x1b9)],common_1['HttpStatus']['BAD_REQUEST']);}}async[_0xf1a42(0x208)](_0x4494c7){const _0x3de856=_0xf1a42;if(_0x4494c7===_0x3de856(0x22d)){const {aliOssRegion:_0x5494ab,aliOssBucket:_0x1dd26b,aliOssAccessKeyId:_0x5a1297,aliOssAccessKeySecret:_0x37a9a3}=await this[_0x3de856(0x1c1)][_0x3de856(0x225)](['aliOssRegion',_0x3de856(0x1f8),_0x3de856(0x218),_0x3de856(0x1da)]);return{'region':_0x5494ab,'bucket':_0x1dd26b,'accessKeyId':_0x5a1297,'accessKeySecret':_0x37a9a3};}if(_0x4494c7===_0x3de856(0x1d0)){const {cosBucket:_0x4f4f95,cosRegion:_0x2d8fa2,cosSecretId:_0x270bf4,cosSecretKey:_0x3cb547,tencentCosAcceleratedDomain:_0x31d38a}=await this[_0x3de856(0x1c1)][_0x3de856(0x225)]([_0x3de856(0x1ac),_0x3de856(0x206),'cosSecretId',_0x3de856(0x1b4),_0x3de856(0x1c2)]);return{'Bucket':_0x4f4f95,'Region':_0x2d8fa2,'SecretId':_0x270bf4,'SecretKey':_0x3cb547,'acceleratedDomain':_0x31d38a};}if(_0x4494c7===_0x3de856(0x1ed)){const {cheveretoKey:_0x56a512,cheveretoUploadPath:_0xd4d608}=await this[_0x3de856(0x1c1)][_0x3de856(0x225)]([_0x3de856(0x1a3),'cheveretoUploadPath']);return{'key':_0x56a512,'uploadPath':_0xd4d608};}}async[_0xf1a42(0x1ab)](){const _0x388084={'filename':'mjtest.png','dir':'mj','url':'https://cdn.discordapp.com/attachments/1097409128491651135/1169910551275638855/snine_60b5c001b_A_young_girl_smiles_brightly_in_the_pure_blue_f_8a41fe5f-5101-4c1e-b948-a748a0583577.png?ex=65571f1b&is=6544aa1b&hm=b82f2d88224eb7942e24c63a8e519c7693de12a2b96daa0f327dfb8f691b1480&'},_0x5a67bb=await this['uploadFileFromUrl'](_0x388084);return _0x5a67bb;}async[_0xf1a42(0x1f5)](_0x2d564d){const _0x7f3664=_0xf1a42,_0x42397c=await this[_0x7f3664(0x1c1)]['getConfigs']([_0x7f3664(0x21f)])||0x0,_0x72b840=await axios_1[_0x7f3664(0x1a7)][_0x7f3664(0x1f2)](_0x2d564d,{'responseType':_0x7f3664(0x207)});return new Promise((_0x326a4a,_0x352e30)=>{const _0x1b36d4=_0x7f3664;streamToBuffer(_0x72b840[_0x1b36d4(0x217)],(_0x2f18fb,_0x5e95be)=>{const _0x23a164=_0x1b36d4;if(_0x2f18fb)throw new common_1[(_0x23a164(0x1f6))](_0x23a164(0x212),common_1[_0x23a164(0x21c)][_0x23a164(0x1db)]);else _0x326a4a(_0x5e95be);});});}};UploadService=__decorate([(0x0,common_1['Injectable'])(),__metadata(_0xf1a42(0x1e5),[globalConfig_service_1['GlobalConfigService']])],UploadService),exports[_0xf1a42(0x202)]=UploadService;