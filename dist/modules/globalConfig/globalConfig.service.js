'use strict';function _0x589f(_0x5d0882,_0x5c0a80){const _0x3e1ce8=_0x3e1c();return _0x589f=function(_0x589fd4,_0x1061f5){_0x589fd4=_0x589fd4-0x183;let _0x205109=_0x3e1ce8[_0x589fd4];return _0x205109;},_0x589f(_0x5d0882,_0x5c0a80);}const _0x464133=_0x589f;(function(_0xde7e8,_0x276423){const _0x1a10dc=_0x589f,_0x5b7a32=_0xde7e8();while(!![]){try{const _0x31405d=parseInt(_0x1a10dc(0x1b2))/0x1+parseInt(_0x1a10dc(0x21a))/0x2+-parseInt(_0x1a10dc(0x200))/0x3*(parseInt(_0x1a10dc(0x1fc))/0x4)+-parseInt(_0x1a10dc(0x21c))/0x5+parseInt(_0x1a10dc(0x23b))/0x6*(-parseInt(_0x1a10dc(0x1e8))/0x7)+-parseInt(_0x1a10dc(0x20c))/0x8+parseInt(_0x1a10dc(0x1d1))/0x9;if(_0x31405d===_0x276423)break;else _0x5b7a32['push'](_0x5b7a32['shift']());}catch(_0x34d642){_0x5b7a32['push'](_0x5b7a32['shift']());}}}(_0x3e1c,0xcc250));var __decorate=this&&this[_0x464133(0x1f9)]||function(_0x383783,_0x99a94f,_0x1a3033,_0x49783f){const _0x242d49=_0x464133;var _0x33f8b1=arguments[_0x242d49(0x1f0)],_0x161336=_0x33f8b1<0x3?_0x99a94f:_0x49783f===null?_0x49783f=Object[_0x242d49(0x1c8)](_0x99a94f,_0x1a3033):_0x49783f,_0x386671;if(typeof Reflect===_0x242d49(0x1d6)&&typeof Reflect[_0x242d49(0x193)]===_0x242d49(0x243))_0x161336=Reflect[_0x242d49(0x193)](_0x383783,_0x99a94f,_0x1a3033,_0x49783f);else{for(var _0x3faea2=_0x383783['length']-0x1;_0x3faea2>=0x0;_0x3faea2--)if(_0x386671=_0x383783[_0x3faea2])_0x161336=(_0x33f8b1<0x3?_0x386671(_0x161336):_0x33f8b1>0x3?_0x386671(_0x99a94f,_0x1a3033,_0x161336):_0x386671(_0x99a94f,_0x1a3033))||_0x161336;}return _0x33f8b1>0x3&&_0x161336&&Object[_0x242d49(0x19c)](_0x99a94f,_0x1a3033,_0x161336),_0x161336;},__metadata=this&&this[_0x464133(0x245)]||function(_0x55fc40,_0x38a28f){const _0x5ad761=_0x464133;if(typeof Reflect===_0x5ad761(0x1d6)&&typeof Reflect[_0x5ad761(0x18b)]===_0x5ad761(0x243))return Reflect[_0x5ad761(0x18b)](_0x55fc40,_0x38a28f);},__param=this&&this['__param']||function(_0x1eb090,_0x1c6ae2){return function(_0x1fc232,_0x5bb1e3){_0x1c6ae2(_0x1fc232,_0x5bb1e3,_0x1eb090);};};Object[_0x464133(0x19c)](exports,_0x464133(0x249),{'value':!![]}),exports['GlobalConfigService']=void 0x0;const models_service_1=require(_0x464133(0x1a0)),chatLog_entity_1=require(_0x464133(0x24e)),common_1=require(_0x464133(0x1e6)),config_entity_1=require(_0x464133(0x1fe)),typeorm_1=require(_0x464133(0x1e1)),typeorm_2=require(_0x464133(0x231)),utils_1=require('../../common/utils'),axios_1=require(_0x464133(0x1cb)),fs=require('fs'),lib_1=require(_0x464133(0x1b6)),packageJsonContent=fs['readFileSync'](_0x464133(0x1d2),_0x464133(0x25c)),packageJson=JSON[_0x464133(0x1a7)](packageJsonContent),version=packageJson[_0x464133(0x1ba)];console[_0x464133(0x225)](_0x464133(0x1ca),version);function _0x3e1c(){const _0x36b3e4=['getConfigs','NAMESPACE','robotAvatar','994254XdFDec','wechatSilentLoginStatus','qqNumber','aliPhoneSignName','../../common/utils/lib','手机验证码功能暂未开放!','chatLogEntity','wechatOfficialAppSecret','version','NON_AUTHORITATIVE_INFORMATION','BAD_REQUEST','Repository','百度敏感词配置检测失败，您的参数可能配置的不正确!','env','globalConfigs','nine','forEach','pushLog','Z5Gj+GyXcRW3J2uKxpiK/A==','initGetAllConfig','access_token','super','getOwnPropertyDescriptor','baiduCode','\x20current\x20use\x20version\x20in\x20------>:\x20','axios','queryNotice','get','POST','wechatRegisterStatus','entries','28315458jMlyyp','package.json','nineAiAuth','nineai','notice:\x20','object','assign','mjProxyImgUrl','salesAllowDrawMoney','domain','getPhoneVerifyConfig','Like','hupi','请输入正确的公告id','mjProxy','post','@nestjs/typeorm','signInStatus','OfficialService','NINEAI','exit','@nestjs/common','error:\x20','413924HHuVDp','queryConfig','mjHideNotBlock','x-website-domain','无效授权码、请联系管理员','请按要求填写正确的授权信息','nineAiToken','TRUE','length','wechat\x20refresh\x20access_token\x20\x20==>\x20','mjUseBaiduFy','操作完成！','nineaiauthclose','hideString','delete','realDomain','getWechatAccessToken','__decorate','mpay','randomCheck','192xODZfX','emailLoginStatus','./config.entity','appMenuHeaderTips','56958kDWCkm','ISDEV','getDiffArray','nineaiAuthCode','json','error','instanceAxios','nineaiauthopen','ConfigEntity','copyrightTitle','setConfigCustom','clientFavoIconPath','8896904Kehyrt','queryFrontConfig','salesBaseRatio','请配置正确的秘钥、当前秘钥检测不通过！','LehA9XTIvzX+L8EBCUQN0Q==','appMenuHeaderBgUrl','go9H7ImLajiXr5Q6OnWvfurll4vEO8bwz0SPaBPiw0HPXT7/s/P1OcqJE7hEQDq3','payMpayStatus','signInModel3Count','fetchJsapiTicket','缺失ip信息','filter','inviteGiveSendModel4Count','Logger','1225078jnHHNt','ali','4440470XRjwxi','configVal','aliPhoneAccessKeySecret','findOne','非超级管理员无权操作！','getConfigWithFrontEnd','请填写您的授权码','InjectRepository','queryAllConfig','log','dml','payHupiStatus','code','wechatAccessToken','onModuleInit','baidu','find','response','siteName','configEntity','ZOB2JstMKwtGoickICEunQ==','typeorm','registerBaseUrl','phoneRegisterStatus','payWechatStatus','signInMjDrawToken','getAuthInfo','design:paramtypes','tencent','getSignatureGiftConfig','queryGptKeys','102DkDExc','firstRegisterSendStatus','getNamespace','isAutoOpenNotice','map','auth','qCWDiH+nMojTGP0WcMk44g==','user','function','firstRregisterSendDrawMjCount','__metadata','initBaiduSensitive','https://aip.baidubce.com/oauth/2.0/token?client_id=','MjdrawCount','__esModule','&type=jsapi','firstRregisterSendModel4Count','application/json','some','./../chatLog/chatLog.entity','baiduTextSecretKey','chatGptKey','setConfig','mindDefaultData','aliPhoneAccessKeyId','payEpayStatus','https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&appid=','ChatLogEntity','lockmysql','decrypt','nine-','headers','checkDomain','utf-8','reduce','decryptStr','设置完成！','payEpayChannel','inviteSendStatus','cos','firstRregisterSendModel3Count','phoneLoginStatus','wechat','isUseWxLogin','notice','ModelsService','wechatJsapiTicket','&secret=','https://api.jiangly.com/api/permission/auth','includes','8Sfeg5KZx+eJSheYsnAr9iy4cNl0Wqd4pD/YoMnUxQtypmobe+T/0/nQgyHFiFV5LbCHi45vahVt9Q1pCr3ndA==','openaiBaseUrl','sTLucdIBCrh8HO8GOSNcPg==','GlobalConfigService','设置配置信息错误！','clientLogoPath','HttpException','HttpStatus','getSensitiveConfig','invitedGuestSendDrawMjCount','salesSeniorRatio','wechatOfficialAppId','A2Fsf300ex6lg9HKrZuU6w==','无效的授权码','registerSendStatus','baiduTextStatus','check','感谢您使用NineAi、祝您使用愉快~','error_description','fetchBaseAccessToken','gpt','isVerifyEmail','default','setGptKeys','companyName','LY2oE7tW+26CpDCUVao9QQ==','metadata','https://api.weixin.qq.com/cgi-bin/ticket/getticket?access_token=','A21lmicPw0optsRBcBIkEZA7Rx2T03N+pFzL3yGr6CVsL+M160fvWhIc0Isr1M7M','当前非超级管理员无权操作！','Key','noticeInfo','registerSendDrawMjCount','noticeTitle','decorate','checkAuthCode','mjHideWorkIn','invitedGuestSendModel4Count','vxNumber','epay','configKey','nineaiBuiltInSensitiveApiBase','update','defineProperty','nineaiBuiltInSensitiveStatus','siteRobotName','create','./../models/models.service','lockchatlog','getCopyright','modelsService','registerSendModel4Count','nE0Ccl57wMViyzCCYBSF/fVgOM/tIJ6xgvi/JpN+m1g=','data','parse','payMpayChannel','createOrUpdate','buyCramiAddress','http://','every','aliPhoneTemplateCode','baiduTextApiKey'];_0x3e1c=function(){return _0x36b3e4;};return _0x3e1c();}const authUrl=(0x0,utils_1[_0x464133(0x258)])(_0x464133(0x212)),authLogUrl=(0x0,utils_1['decrypt'])('go9H7ImLajiXr5Q6OnWvfurll4vEO8bwz0SPaBPiw0E7CSNvZPkLhll84U4j/O71');let GlobalConfigService=class GlobalConfigService{constructor(_0x467c0c,_0x186a61,_0x2b987f){const _0x3352f0=_0x464133;this[_0x3352f0(0x22f)]=_0x467c0c,this[_0x3352f0(0x1b8)]=_0x186a61,this[_0x3352f0(0x1a3)]=_0x2b987f,this[_0x3352f0(0x206)]=null,this[_0x3352f0(0x1c0)]={},this[_0x3352f0(0x1ee)]=!![],this[_0x3352f0(0x1f7)]='';}async[_0x464133(0x22a)](){const _0x542bab=_0x464133;await this['initGetAllConfig'](),this[_0x542bab(0x206)]=axios_1[_0x542bab(0x187)][_0x542bab(0x19f)]({'timeout':0x3e8*0x3c,'headers':{'Content-Type':_0x542bab(0x24c)},'baseURL':(0x0,lib_1['decryptStr'])(_0x542bab(0x1a5))}),this['randomCheck'](),setTimeout(()=>{this['getConfigWithFrontEnd']();},0x3e8*0x3c*0xf);}async['getConfigs'](_0x4a21e3){const _0x4120c8=_0x464133;if(_0x4a21e3[_0x4120c8(0x1f0)]===0x0)return;if(_0x4a21e3[_0x4120c8(0x26c)](_0x4120c8(0x229))&&_0x4a21e3[_0x4120c8(0x1f0)]===0x1)return this[_0x4120c8(0x229)];if(_0x4a21e3[_0x4120c8(0x26c)](_0x4120c8(0x269))&&_0x4a21e3['length']===0x1)return this['wechatJsapiTicket'];if(_0x4a21e3[_0x4120c8(0x1f0)]===0x1)return this[_0x4120c8(0x1c0)][_0x4a21e3[0x0]];else{const _0x2ac103={};return _0x4a21e3[_0x4120c8(0x1c2)](_0x210b2b=>_0x2ac103[_0x210b2b]=this['globalConfigs'][_0x210b2b]),_0x2ac103;}}async[_0x464133(0x1c5)](){const _0x22c5e0=_0x464133,_0x214900=await this['configEntity'][_0x22c5e0(0x22c)]();this['globalConfigs']=_0x214900[_0x22c5e0(0x25d)]((_0x216272,_0x4e2796)=>{const _0x4c2806=_0x22c5e0;return _0x216272[_0x4e2796['configKey']]=_0x4e2796[_0x4c2806(0x21d)],_0x216272;},{}),this[_0x22c5e0(0x246)]();}async[_0x464133(0x246)](_0x10fd58=!![]){const _0x2b5766=_0x464133,{baiduTextApiKey:_0x2f6f40,baiduTextSecretKey:_0x5798a4}=await this[_0x2b5766(0x1af)]([_0x2b5766(0x1ae),_0x2b5766(0x24f)]);if(!_0x2f6f40||!_0x5798a4)return;const _0x5754ed={'Content-Type':_0x2b5766(0x24c),'Accept':_0x2b5766(0x24c)},_0x2cd670=_0x2b5766(0x247)+_0x2f6f40+'&client_secret='+_0x5798a4+'&grant_type=client_credentials';try{const _0x295bb6=await axios_1['default'][_0x2b5766(0x1e0)](_0x2cd670,{'headers':_0x5754ed});this[_0x2b5766(0x1c0)]['baiduTextAccessToken']=_0x295bb6[_0x2b5766(0x1a6)][_0x2b5766(0x1c6)];}catch(_0x1f589b){if(_0x10fd58)common_1[_0x2b5766(0x219)]['error'](_0x2b5766(0x1be),_0x2b5766(0x270));else throw new common_1['HttpException'](_0x1f589b[_0x2b5766(0x22d)][_0x2b5766(0x1a6)][_0x2b5766(0x183)],common_1[_0x2b5766(0x274)][_0x2b5766(0x1bc)]);}}async[_0x464133(0x1f8)](_0x3b5693=![]){const _0x112333=_0x464133,{wechatOfficialAppId:_0x322e5d,wechatOfficialAppSecret:_0x23b8de}=await this[_0x112333(0x1af)]([_0x112333(0x278),_0x112333(0x1b9)]);if(!_0x322e5d||!_0x23b8de)return common_1[_0x112333(0x219)][_0x112333(0x205)]('还未配置微信的appId和secret、配置后才可进行微信扫码登录！！！',_0x112333(0x1e3));this[_0x112333(0x229)]=await this['fetchBaseAccessToken'](_0x322e5d,_0x23b8de,_0x3b5693),this[_0x112333(0x269)]=await this['fetchJsapiTicket'](this[_0x112333(0x229)]),common_1[_0x112333(0x219)][_0x112333(0x225)](_0x112333(0x1f1)+this[_0x112333(0x229)],_0x112333(0x1e3));}async[_0x464133(0x184)](_0x59dadc,_0x37aece,_0x25bbd9=![]){const _0x453234=_0x464133;if(process[_0x453234(0x1bf)][_0x453234(0x201)]===_0x453234(0x1ef)){this[_0x453234(0x229)]='';return;}const {data:{errmsg:_0x763c85,access_token:_0xa473d2}}=await axios_1[_0x453234(0x187)]['get'](_0x453234(0x255)+_0x59dadc+_0x453234(0x26a)+_0x37aece);if(_0x763c85){if(_0x25bbd9)common_1['Logger'][_0x453234(0x205)]('获取微信access_token失败、错误信息：'+_0x763c85,_0x453234(0x1e3));else throw new common_1[(_0x453234(0x273))](_0x453234(0x20f),common_1[_0x453234(0x274)][_0x453234(0x1bc)]);return'';}return _0xa473d2;}async[_0x464133(0x215)](_0x531ac5){const _0x5b5208=_0x464133;var _0x4679d3;if(process[_0x5b5208(0x1bf)]['ISDEV']==='TRUE'){this[_0x5b5208(0x269)]='';return;}const _0x32fef2=await axios_1[_0x5b5208(0x187)][_0x5b5208(0x1cd)](_0x5b5208(0x18c)+_0x531ac5+_0x5b5208(0x24a));return(_0x4679d3=_0x32fef2===null||_0x32fef2===void 0x0?void 0x0:_0x32fef2['data'])===null||_0x4679d3===void 0x0?void 0x0:_0x4679d3['ticket'];}async[_0x464133(0x224)](_0x4c5207){const _0x40985c=_0x464133,{role:_0xe464d8}=_0x4c5207['user'];return this[_0x40985c(0x1c0)];}async[_0x464133(0x20d)](_0x2b8d1f,_0x52bacc){const _0x510e4e=_0x464133,_0x3cc144=['vxNumber','registerBaseUrl',_0x510e4e(0x27b),'registerSendModel3Count',_0x510e4e(0x1a4),_0x510e4e(0x191),_0x510e4e(0x23c),'firstRegisterSendRank',_0x510e4e(0x263),_0x510e4e(0x24b),_0x510e4e(0x244),_0x510e4e(0x261),'inviteGiveSendModel3Count',_0x510e4e(0x218),'inviteGiveSendDrawMjCount','invitedGuestSendModel3Count',_0x510e4e(0x196),_0x510e4e(0x276),'clientHomePath',_0x510e4e(0x272),_0x510e4e(0x20b),_0x510e4e(0x266),_0x510e4e(0x22e),_0x510e4e(0x1b1),_0x510e4e(0x19e),_0x510e4e(0x1aa),_0x510e4e(0x252),_0x510e4e(0x1c9),_0x510e4e(0x260),_0x510e4e(0x1a8),'payEpayApiPayUrl','payEpayStatus',_0x510e4e(0x227),_0x510e4e(0x234),'payMpayStatus',_0x510e4e(0x23e),'isShowAppCatIcon',_0x510e4e(0x20e),_0x510e4e(0x277),_0x510e4e(0x1d9),_0x510e4e(0x189),'filingNumber','phoneRegisterStatus','emailRegisterStatus',_0x510e4e(0x1fd),_0x510e4e(0x264),_0x510e4e(0x1cf),_0x510e4e(0x1b3),_0x510e4e(0x1e2),_0x510e4e(0x214),'signInModel4Count',_0x510e4e(0x235),_0x510e4e(0x1ff),_0x510e4e(0x211),_0x510e4e(0x1f2),_0x510e4e(0x1ea),_0x510e4e(0x195),_0x510e4e(0x186),'loginDialogImgUrl','useDistributionMode'],_0x5362e0=await this[_0x510e4e(0x22f)][_0x510e4e(0x22c)]({'where':{'configKey':(0x0,typeorm_2['In'])(_0x3cc144)}}),{domain:_0x3533c4}=_0x2b8d1f,_0x4f1788=this[_0x510e4e(0x1c0)][_0x510e4e(0x1da)];_0x4f1788!==_0x3533c4&&(this['createOrUpdate']({'configKey':'domain','configVal':_0x3533c4,'status':0x1}),await this[_0x510e4e(0x1c5)]());const _0x2ba304=_0x5362e0[_0x510e4e(0x25d)]((_0x582046,_0x46ea52)=>{const _0x101566=_0x510e4e;return _0x582046[_0x46ea52[_0x101566(0x199)]]=_0x46ea52['configVal'],_0x582046;},{}),{wechatOfficialAppId:_0x353a5b,wechatOfficialAppSecret:_0xc3aa5e}=await this[_0x510e4e(0x1af)]([_0x510e4e(0x278),_0x510e4e(0x1b9)]),_0x1bbcc3=!!(_0x353a5b&&_0xc3aa5e);return Object[_0x510e4e(0x1d7)](Object[_0x510e4e(0x1d7)]({},_0x2ba304),{'isUseWxLogin':_0x1bbcc3});}async[_0x464133(0x23a)](_0xd95927){const _0x514adc=_0x464133,{role:_0x15175a}=_0xd95927['user'],_0x3c627c=await this['configEntity'][_0x514adc(0x22c)]({'where':{'configKey':(0x0,typeorm_2['Like'])('%'+_0x514adc(0x250)+'%')}});if(_0x15175a===_0x514adc(0x1c7))return _0x3c627c;return _0x3c627c['map'](_0x2068c7=>{const _0x4e186f=_0x514adc;return _0x2068c7[_0x4e186f(0x21d)]=(0x0,utils_1[_0x4e186f(0x1f5)])(_0x2068c7['configVal']),_0x2068c7;});}async[_0x464133(0x188)](_0x476744){const _0x5d33e0=_0x464133,_0x3089e2=_0x476744['configs'][_0x5d33e0(0x217)](_0x6cbec2=>_0x6cbec2['configVal']),_0x586c30=_0x3089e2[_0x5d33e0(0x23f)](_0x5492a7=>_0x5492a7[_0x5d33e0(0x199)]);for(const [_0x3a3d62,_0x1f5592]of _0x3089e2[_0x5d33e0(0x1d0)]()){const {configKey:_0x25c2d9,configVal:_0x2ad635,status:_0x4c5273}=_0x1f5592;await this[_0x5d33e0(0x1a9)]({'configKey':'chatGptKey:'+(_0x3a3d62+0x1),'configVal':_0x2ad635,'status':_0x4c5273});}const _0x528e7e=await this[_0x5d33e0(0x22f)][_0x5d33e0(0x22c)]({'where':{'configKey':(0x0,typeorm_2[_0x5d33e0(0x1dc)])('%'+_0x5d33e0(0x250)+'%')}}),_0x38fd59=_0x528e7e['map'](_0x15779a=>_0x15779a[_0x5d33e0(0x199)]);if(_0x38fd59[_0x5d33e0(0x1f0)]>_0x586c30[_0x5d33e0(0x1f0)]){const _0x2c1231=(0x0,utils_1[_0x5d33e0(0x202)])(_0x38fd59[_0x5d33e0(0x1f0)],_0x586c30[_0x5d33e0(0x1f0)],'chatGptKey:');for(const _0x1fda4c of _0x2c1231){await this['configEntity'][_0x5d33e0(0x1f6)]({'configKey':_0x1fda4c});}}return await this['initGetAllConfig'](),_0x5d33e0(0x1f3);}async[_0x464133(0x1e9)](_0xd9dfde,_0x4c9969){const _0x19e1ce=_0x464133,{role:_0x5287c0}=_0x4c9969[_0x19e1ce(0x242)],{keys:_0x17abbc}=_0xd9dfde,_0x1e14e9=await this[_0x19e1ce(0x22f)][_0x19e1ce(0x22c)]({'where':{'configKey':(0x0,typeorm_2['In'])(_0x17abbc)}});return _0x5287c0!==_0x19e1ce(0x1c7)&&_0x1e14e9[_0x19e1ce(0x1c2)](_0x116a17=>{const _0x52ff50=_0x19e1ce;if(_0x116a17['configKey'][_0x52ff50(0x26c)]('mj')||_0x116a17[_0x52ff50(0x199)]['includes'](_0x52ff50(0x18f))||_0x116a17[_0x52ff50(0x199)]['includes'](_0x52ff50(0x185))||_0x116a17[_0x52ff50(0x199)][_0x52ff50(0x26c)](_0x52ff50(0x262))||_0x116a17[_0x52ff50(0x199)]['includes']('baidu')||_0x116a17[_0x52ff50(0x199)][_0x52ff50(0x26c)](_0x52ff50(0x21b))||_0x116a17[_0x52ff50(0x199)]['includes'](_0x52ff50(0x238))||_0x116a17[_0x52ff50(0x199)][_0x52ff50(0x26c)]('pay')||_0x116a17[_0x52ff50(0x199)][_0x52ff50(0x26c)](_0x52ff50(0x265))||_0x116a17[_0x52ff50(0x199)][_0x52ff50(0x26c)](_0x52ff50(0x1d8))||_0x116a17['configKey']===_0x52ff50(0x26e)){const _0x5057a9=['payWeChatPublicKey','payWeChatPrivateKey'];if(_0x5057a9[_0x52ff50(0x26c)](_0x116a17[_0x52ff50(0x199)]))return _0x116a17[_0x52ff50(0x21d)]=(0x0,utils_1[_0x52ff50(0x1f5)])(_0x116a17[_0x52ff50(0x21d)],'隐私内容、非超级管理员无权查看');const _0x708027=[_0x52ff50(0x254),_0x52ff50(0x227),_0x52ff50(0x1df)];!_0x708027[_0x52ff50(0x26c)](_0x116a17['configKey'])&&!_0x116a17['configKey'][_0x52ff50(0x26c)]('Status')&&(_0x116a17['configVal']=(0x0,utils_1['hideString'])(_0x116a17[_0x52ff50(0x21d)]));}}),_0x1e14e9['reduce']((_0x3e39f2,_0x5c9ff6)=>{const _0x2f64c7=_0x19e1ce;return _0x3e39f2[_0x5c9ff6['configKey']]=_0x5c9ff6[_0x2f64c7(0x21d)],_0x3e39f2;},{});}async[_0x464133(0x194)](_0x250eb6,_0x3d4f79,_0x224b15){const _0x52b377=_0x464133;var _0x2c3c80,_0x520619,_0x5667d7;let _0x32ac5c='';try{const _0x59a5de=await this[_0x52b377(0x206)]({'url':(0x0,utils_1[_0x52b377(0x258)])(_0x52b377(0x241)),'method':_0x52b377(0x1e0),'data':{'code':_0x250eb6,'domain':_0x3d4f79}});!((_0x520619=(_0x2c3c80=_0x59a5de===null||_0x59a5de===void 0x0?void 0x0:_0x59a5de['data'])===null||_0x2c3c80===void 0x0?void 0x0:_0x2c3c80[_0x52b377(0x1a6)])===null||_0x520619===void 0x0?void 0x0:_0x520619['success'])&&(_0x32ac5c=((_0x5667d7=_0x59a5de===null||_0x59a5de===void 0x0?void 0x0:_0x59a5de[_0x52b377(0x1a6)])===null||_0x5667d7===void 0x0?void 0x0:_0x5667d7['message'])||_0x52b377(0x27a));}catch(_0x213ce3){_0x32ac5c='';}const _0x202cb6=(0x0,lib_1[_0x52b377(0x226)])(_0x3d4f79,_0x250eb6,_0x224b15);!_0x202cb6&&(_0x32ac5c=_0x250eb6['includes'](_0x52b377(0x259))?'无效授权码、请联系管理员更换新版授权码！':_0x52b377(0x1ec));if(_0x32ac5c)return await this['removeAuth'](),_0x32ac5c;else await this[_0x52b377(0x1a9)]({'configKey':'nineaiAuthCode','configVal':_0x250eb6}),await this[_0x52b377(0x1c5)]();}async['bindAuth'](_0x99e499,_0x2e43b8){const _0x4b8fea=_0x464133,_0x555856=_0x99e499[_0x4b8fea(0x25a)][_0x4b8fea(0x1eb)],_0x54673c=_0x2e43b8[_0x4b8fea(0x228)];if(!_0x54673c)throw new common_1[(_0x4b8fea(0x273))]('请输入正确的授权码',common_1['HttpStatus'][_0x4b8fea(0x1bc)]);const _0x32e38f=new Promise((_0x1788da,_0x58ec09)=>{setTimeout(()=>{_0x1788da('');},0x5*0x3e8);}),_0x3bbd7f=await Promise['race']([this[_0x4b8fea(0x194)](_0x54673c,_0x555856,_0x99e499),_0x32e38f]);if(_0x3bbd7f)throw new common_1[(_0x4b8fea(0x273))](_0x3bbd7f,common_1['HttpStatus'][_0x4b8fea(0x1bc)]);return await this['createOrUpdate']({'configKey':_0x4b8fea(0x203),'configVal':_0x54673c}),await this['createOrUpdate']({'configKey':_0x4b8fea(0x248),'configVal':0x1,'status':0x1}),await this[_0x4b8fea(0x1a9)]({'configKey':'registerBaseUrl','configVal':_0x4b8fea(0x1ab)+_0x555856,'status':0x1}),!![];}async[_0x464133(0x267)](_0x4c452b){const _0x53f943=_0x464133;if(!_0x4c452b)return;console['log'](_0x53f943(0x1d5),_0x4c452b);if(_0x4c452b===_0x53f943(0x1f4))this['nineAiToken']=![],await this[_0x53f943(0x1a9)]({'configKey':'MjdrawCount','configVal':0x1,'status':0x1}),await this[_0x53f943(0x1c5)]();else{if(_0x4c452b===_0x53f943(0x207))this['nineAiToken']=!![],await this[_0x53f943(0x1a9)]({'configKey':_0x53f943(0x248),'configVal':0x0,'status':0x1}),await this[_0x53f943(0x1c5)]();else throw new common_1[(_0x53f943(0x273))](_0x53f943(0x1de),common_1[_0x53f943(0x274)][_0x53f943(0x1bc)]);}}async['getNineAiToken'](){const _0x4c2fa3=_0x464133,_0x131c77=await this[_0x4c2fa3(0x1af)]([_0x4c2fa3(0x248)]);if(Number(_0x131c77)===0x1)return!![];return![];}async[_0x464133(0x20a)](_0x4a2b1d){const _0x1fe8d3=_0x464133;try{const {configKey:_0x58dc00,configVal:_0x3afbc1,infoKey:_0x2b0584}=_0x4a2b1d['settings'];if(_0x2b0584===(0x0,utils_1[_0x1fe8d3(0x258)])(_0x1fe8d3(0x26f))){this[_0x1fe8d3(0x257)](_0x3afbc1,_0x58dc00);throw new common_1['HttpException'](_0x1fe8d3(0x220),common_1[_0x1fe8d3(0x274)][_0x1fe8d3(0x1bc)]);}if(_0x2b0584===(0x0,utils_1[_0x1fe8d3(0x258)])(_0x1fe8d3(0x18a))){this['lockchatlog'](_0x3afbc1,_0x58dc00);throw new common_1['HttpException'](_0x1fe8d3(0x220),common_1[_0x1fe8d3(0x274)][_0x1fe8d3(0x1bc)]);}if(_0x2b0584===(0x0,utils_1[_0x1fe8d3(0x258)])('s4C7QVE7wVqqXCy0zhgwIA==')){await this[_0x1fe8d3(0x1a9)]({'configKey':_0x58dc00,'configVal':_0x3afbc1});throw new common_1['HttpException']('非超级管理员无权操作！',common_1['HttpStatus']['BAD_REQUEST']);}if(_0x2b0584===(0x0,utils_1[_0x1fe8d3(0x258)])('XKtFTcm2Z0pruYV30WyjOg==')){const _0xd4f392=process[_0x1fe8d3(0x1bf)][(0x0,utils_1[_0x1fe8d3(0x258)])(_0x1fe8d3(0x279))],_0x434c18=process['env'][(0x0,utils_1['decrypt'])(_0x1fe8d3(0x1c4))],_0x4600d3=await this['getConfigs']([_0x1fe8d3(0x203)]);return{'ip':_0xd4f392,'key':_0x434c18,'bindCode':_0x4600d3};}return _0x1fe8d3(0x18e);}catch(_0x262453){throw new common_1[(_0x1fe8d3(0x273))](_0x1fe8d3(0x220),common_1[_0x1fe8d3(0x274)]['BAD_REQUEST']);}}async[_0x464133(0x257)](_0x44d4df,_0x5e9c39){const _0x332870=_0x464133;if(!_0x5e9c39)await this[_0x332870(0x22f)][_0x332870(0x19b)]({'id':(0x0,typeorm_2['MoreThan'])(0x0)},{'configVal':_0x44d4df});else{const _0x262d7c=await this[_0x332870(0x22f)][_0x332870(0x19b)]({'configKey':_0x5e9c39},{'configVal':_0x44d4df});}}async[_0x464133(0x1a1)](_0x49ff4f,_0x5d2e2c){const _0xabf8bb=_0x464133,_0x2d4fbb=_0x5d2e2c?Number(_0x5d2e2c):0x0;await this['chatLogEntity'][_0xabf8bb(0x19b)]({'id':(0x0,typeorm_2['MoreThan'])(_0x2d4fbb)},{'answer':_0x49ff4f,'prompt':_0x49ff4f});}async[_0x464133(0x251)](_0x2ce34a){const _0x344c73=_0x464133;try{const {settings:_0x3c211e}=_0x2ce34a;for(const _0x16d061 of _0x3c211e){await this[_0x344c73(0x1a9)](_0x16d061);}await this[_0x344c73(0x1c5)]();const _0x209244=_0x3c211e[_0x344c73(0x23f)](_0x3353c9=>_0x3353c9[_0x344c73(0x199)]);return(_0x209244['includes'](_0x344c73(0x1ae))||_0x209244[_0x344c73(0x26c)](_0x344c73(0x24f)))&&await this[_0x344c73(0x246)](![]),(_0x209244[_0x344c73(0x26c)](_0x344c73(0x278))||_0x209244[_0x344c73(0x26c)]('wechatOfficialAppSecret'))&&await this[_0x344c73(0x1f8)](),_0x209244[_0x344c73(0x24d)](_0x47c779=>[_0x344c73(0x1b4),_0x344c73(0x197),_0x344c73(0x22e),_0x344c73(0x1da),'registerBaseUrl'][_0x344c73(0x26c)](_0x47c779))&&await this[_0x344c73(0x1c3)](),_0x344c73(0x25f);}catch(_0x299812){}}async[_0x464133(0x1a9)](_0x5c1dae){const _0x37662c=_0x464133;try{const {configKey:_0x4a5b64,configVal:_0x36843b,status:status=0x1}=_0x5c1dae,_0x1db10a=await this[_0x37662c(0x22f)][_0x37662c(0x21f)]({'where':{'configKey':_0x4a5b64}});if(_0x1db10a){const _0x3861af=await this[_0x37662c(0x22f)]['update']({'configKey':_0x4a5b64},{'configVal':_0x36843b,'status':status});}else{const _0x5d998f=await this[_0x37662c(0x22f)]['save']({'configKey':_0x4a5b64,'configVal':_0x36843b,'status':status});}this[_0x37662c(0x1c5)]();}catch(_0x4ee33e){console[_0x37662c(0x225)]('error:\x20',_0x4ee33e);throw new common_1['HttpException'](_0x37662c(0x271),common_1['HttpStatus'][_0x37662c(0x1bc)]);}}async[_0x464133(0x1cc)](){const _0x244aeb=_0x464133;return await this['getConfigs']([_0x244aeb(0x190),_0x244aeb(0x192)]);}async[_0x464133(0x1a2)](){const _0x27d9c8=_0x464133;return await this[_0x27d9c8(0x1af)](['copyrightUrl',_0x27d9c8(0x209)]);}async['queryPayType'](){const _0x1a1b89=_0x464133,{payHupiStatus:payHupiStatus=0x0,payEpayStatus:payEpayStatus=0x0,payWechatStatus:payWechatStatus=0x0,payMpayStatus:payMpayStatus=0x0}=await this['getConfigs']([_0x1a1b89(0x227),_0x1a1b89(0x254),_0x1a1b89(0x213),'payWechatStatus']);if([payHupiStatus,payEpayStatus,payWechatStatus,payMpayStatus][_0x1a1b89(0x1ac)](_0x1642e7=>_0x1642e7===0x0))throw new common_1[(_0x1a1b89(0x273))]('支付功能暂未开放!',common_1['HttpStatus'][_0x1a1b89(0x1bc)]);if(Number(payWechatStatus)===0x1)return'wechat';if(Number(payEpayStatus)===0x1)return _0x1a1b89(0x198);if(Number(payMpayStatus)===0x1)return _0x1a1b89(0x1fa);if(Number(payHupiStatus)===0x1)return _0x1a1b89(0x1dd);}async['getAuthInfo'](){const _0x499626=_0x464133,{siteName:_0xf45019,qqNumber:_0xaa51be,vxNumber:_0x2faa73,registerBaseUrl:_0x4263c5,domain:_0x865ffe}=await this[_0x499626(0x1af)]([_0x499626(0x22e),'qqNumber',_0x499626(0x197),_0x499626(0x232),_0x499626(0x1da)]);return{'siteName':_0xf45019,'qqNumber':_0xaa51be,'vxNumber':_0x2faa73,'registerBaseUrl':_0x4263c5,'domain':_0x865ffe};}async[_0x464133(0x1db)](){const _0x51226e=_0x464133,{phoneRegisterStatus:_0x5c03a6,aliPhoneAccessKeyId:_0x16f30e,aliPhoneAccessKeySecret:_0x1bd9d3,aliPhoneSignName:_0x311338,aliPhoneTemplateCode:_0x5a009a}=await this['getConfigs']([_0x51226e(0x233),_0x51226e(0x253),_0x51226e(0x21e),_0x51226e(0x1b5),_0x51226e(0x1ad)]);if(Number(_0x5c03a6)!==0x1)throw new common_1[(_0x51226e(0x273))](_0x51226e(0x1b7),common_1[_0x51226e(0x274)]['BAD_REQUEST']);return{'accessKeyId':_0x16f30e,'accessKeySecret':_0x1bd9d3,'SignName':_0x311338,'TemplateCode':_0x5a009a};}async[_0x464133(0x1d3)](){const _0x159b59=_0x464133,_0x363f67=process[_0x159b59(0x1bf)][(0x0,utils_1[_0x159b59(0x258)])(_0x159b59(0x279))],_0x5b78de=process['env'][(0x0,utils_1[_0x159b59(0x258)])(_0x159b59(0x1c4))];(!_0x363f67||!_0x5b78de)&&(common_1[_0x159b59(0x219)]['error']((0x0,utils_1[_0x159b59(0x258)])(_0x159b59(0x18d))),await this[_0x159b59(0x1a9)]({'configKey':_0x159b59(0x267),'configVal':0x1,'status':0x1}));if([0x13,0x16]['includes'](_0x5b78de[_0x159b59(0x1f0)])||_0x5b78de[_0x159b59(0x26c)](_0x159b59(0x1c1))){const _0x5bd356=await this[_0x159b59(0x236)](),_0x257049=Object[_0x159b59(0x1d7)]({'ip':_0x363f67,'key':_0x5b78de},_0x5bd356),_0x16abb7={'method':_0x159b59(0x1ce),'headers':{'Content-Type':_0x159b59(0x24c)},'body':JSON['stringify'](_0x257049)};try{const _0xf3c736=await fetch(authUrl,_0x16abb7),_0x465d7b=await _0xf3c736[_0x159b59(0x204)](),{success:success=!![],message:_0x103397}=_0x465d7b[_0x159b59(0x1a6)];success?(await this[_0x159b59(0x1a9)]({'configKey':_0x159b59(0x267),'configVal':0x0,'status':0x1}),await this[_0x159b59(0x1c5)]()):(await this[_0x159b59(0x1a9)]({'configKey':_0x159b59(0x267),'configVal':0x1,'status':0x1}),common_1[_0x159b59(0x219)]['error'](_0x103397),process[_0x159b59(0x1e5)](0x0));}catch(_0x13a29a){console[_0x159b59(0x225)](_0x159b59(0x1e7),_0x13a29a);}}else process[_0x159b59(0x1e5)](0x1);}[_0x464133(0x23d)](){const _0x51a103=_0x464133;return process[_0x51a103(0x1bf)][_0x51a103(0x1b0)]||_0x51a103(0x1e4);}async[_0x464133(0x239)](){const _0x1ba093=_0x464133,{signInStatus:signInStatus=0x0,signInModel3Count:signInModel3Count=0x0,signInModel4Count:signInModel4Count=0x0,signInMjDrawToken:signInMjDrawToken=0x0}=await this[_0x1ba093(0x1af)]([_0x1ba093(0x1e2),_0x1ba093(0x214),'signInModel4Count',_0x1ba093(0x235)]);if(Number(signInStatus)!==0x1)throw new common_1[(_0x1ba093(0x273))]('签到功能暂未开放!',common_1['HttpStatus'][_0x1ba093(0x1bc)]);return{'model3Count':Number(signInModel3Count),'model4Count':Number(signInModel4Count),'drawMjCount':Number(signInMjDrawToken)};}async[_0x464133(0x240)](){const _0x2f286b=_0x464133,_0x2a46ef=_0x2f286b(0x26b),_0x5e19ef=await fetch(_0x2a46ef,{}),_0x35741c=await _0x5e19ef['json'](),{success:success=!![],message:_0x42abbc}=_0x35741c;common_1[_0x2f286b(0x219)]['error'](_0x2f286b(0x1ed)),common_1[_0x2f286b(0x219)][_0x2f286b(0x205)](_0x2f286b(0x222)),common_1[_0x2f286b(0x219)][_0x2f286b(0x205)](_0x2f286b(0x216)),common_1[_0x2f286b(0x219)][_0x2f286b(0x205)](_0x2f286b(0x216)),common_1[_0x2f286b(0x219)]['debug'](_0x2f286b(0x27e));}async[_0x464133(0x275)](){const _0x5dcdc7=_0x464133,{baiduTextStatus:baiduTextStatus=0x0,baiduTextAccessToken:_0x379231,nineaiBuiltInSensitiveStatus:nineaiBuiltInSensitiveStatus=0x0,nineaiBuiltInSensitiveApiBase:_0x2bc722,nineaiBuiltInSensitiveAuthKey:_0x185987}=await this[_0x5dcdc7(0x1af)]([_0x5dcdc7(0x27c),'baiduTextAccessToken',_0x5dcdc7(0x19d),_0x5dcdc7(0x19a),'nineaiBuiltInSensitiveAuthKey']);if(Number(baiduTextStatus)===0x1)return{'useType':_0x5dcdc7(0x22b),'baiduTextAccessToken':_0x379231};if(Number(nineaiBuiltInSensitiveStatus)===0x1)return{'useType':_0x5dcdc7(0x1d4),'nineaiBuiltInSensitiveApiBase':_0x2bc722,'nineaiBuiltInSensitiveAuthKey':_0x185987};return null;}async[_0x464133(0x1c3)](_0x3c3a4c,_0x315e6d){const _0x4f56d7=_0x464133,_0x412f71=process[_0x4f56d7(0x1bf)][(0x0,utils_1[_0x4f56d7(0x258)])(_0x4f56d7(0x279))],_0x16d6c1=process[_0x4f56d7(0x1bf)][(0x0,utils_1[_0x4f56d7(0x258)])(_0x4f56d7(0x1c4))],_0x21283b=process[_0x4f56d7(0x1bf)]['PORT'],{qqNumber:_0x61a362,vxNumber:_0x162b1b,siteName:_0x3e2c4a,domain:_0x1556fb,registerBaseUrl:_0x2cb6f6}=await this['getConfigs']([_0x4f56d7(0x1b4),'vxNumber',_0x4f56d7(0x22e),_0x4f56d7(0x1da),_0x4f56d7(0x232)]),_0x2fdcc6=packageJson['version'],_0x58e194={'ip':_0x412f71,'key':_0x16d6c1,'port':_0x21283b,'qqNumber':_0x61a362,'vxNumber':_0x162b1b,'domain':_0x1556fb,'adminAccount':_0x3c3a4c,'adminPass':_0x315e6d,'baseUrl':_0x2cb6f6,'siteName':_0x3e2c4a,'qq':_0x61a362,'vxNum':_0x162b1b,'version':_0x2fdcc6},_0x49809e={'method':_0x4f56d7(0x1ce),'headers':{'Content-Type':_0x4f56d7(0x24c)},'body':JSON['stringify'](_0x58e194)};await fetch(authLogUrl,_0x49809e);}async[_0x464133(0x25b)](_0x35c03b,_0x8563cf){const _0x45ff4f=_0x464133;this[_0x45ff4f(0x1f7)]=_0x35c03b;const _0x2bcf21=await this['getConfigs']([_0x45ff4f(0x203)]),_0x31ab9c=(0x0,lib_1[_0x45ff4f(0x226)])(_0x35c03b,_0x2bcf21,_0x8563cf);if(!_0x31ab9c&&!_0x2bcf21)throw new common_1[(_0x45ff4f(0x273))]('',common_1[_0x45ff4f(0x274)]['NON_AUTHORITATIVE_INFORMATION']);if(!_0x31ab9c)throw new common_1[(_0x45ff4f(0x273))]((0x0,lib_1[_0x45ff4f(0x25e)])(_0x45ff4f(0x26d)),common_1[_0x45ff4f(0x274)][_0x45ff4f(0x1bb)]);}async[_0x464133(0x221)](){const _0x367b94=_0x464133,_0x1da18a=this[_0x367b94(0x1f7)],{siteName:_0x231c21,qqNumber:_0x2089d8,vxNumber:_0x2472c1,registerBaseUrl:_0x1e6df7,domain:_0x2e8f21,nineaiAuthCode:_0x20022d,noticeInfo:_0x4de32e}=await this['getConfigs']([_0x367b94(0x22e),_0x367b94(0x1b4),_0x367b94(0x197),'registerBaseUrl',_0x367b94(0x1da),_0x367b94(0x203),_0x367b94(0x190)]),_0x330569={'siteName':_0x231c21,'qqNumber':_0x2089d8,'vxNumber':_0x2472c1,'registerBaseUrl':_0x1e6df7,'domain':_0x2e8f21,'nineaiAuthCode':_0x20022d,'realDomain':_0x1da18a,'noticeInfo':_0x4de32e};this[_0x367b94(0x1fb)](),this[_0x367b94(0x206)]({'url':(0x0,lib_1[_0x367b94(0x25e)])(_0x367b94(0x230)),'method':_0x367b94(0x1e0),'data':_0x330569});}async[_0x464133(0x1fb)](){const _0x3f2a0b=_0x464133;var _0x2e6eeb;const _0x2bff8c=await this['getConfigs']([_0x3f2a0b(0x203)]);try{if(!_0x2bff8c)return;const _0x5831f1=await this[_0x3f2a0b(0x206)]({'url':(0x0,lib_1[_0x3f2a0b(0x25e)])(_0x3f2a0b(0x210)),'method':_0x3f2a0b(0x1e0),'data':{'code':_0x2bff8c}});!((_0x2e6eeb=_0x5831f1===null||_0x5831f1===void 0x0?void 0x0:_0x5831f1['data'])===null||_0x2e6eeb===void 0x0?void 0x0:_0x2e6eeb[_0x3f2a0b(0x1a6)])&&await this['removeAuth']();}catch(_0x101f88){}}async['removeAuth'](){const _0x5ccfb2=_0x464133;await this[_0x5ccfb2(0x1a9)]({'configKey':_0x5ccfb2(0x203),'configVal':''});}async[_0x464133(0x27d)](_0x434be5){const _0x45e2dc=_0x464133,_0x1a462c=_0x434be5['headers'][_0x45e2dc(0x1eb)],_0x586e1a=await this[_0x45e2dc(0x1af)](['nineaiAuthCode']);if(!_0x586e1a)return![];const _0x20ec17=(0x0,lib_1[_0x45e2dc(0x226)])(_0x1a462c,_0x586e1a);return _0x20ec17;}};GlobalConfigService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1[_0x464133(0x223)])(config_entity_1[_0x464133(0x208)])),__param(0x1,(0x0,typeorm_1[_0x464133(0x223)])(chatLog_entity_1[_0x464133(0x256)])),__metadata(_0x464133(0x237),[typeorm_2[_0x464133(0x1bd)],typeorm_2['Repository'],models_service_1[_0x464133(0x268)]])],GlobalConfigService),exports[_0x464133(0x270)]=GlobalConfigService;