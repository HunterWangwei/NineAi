'use strict';const _0x189858=_0x29e5;function _0x129e(){const _0x41b1aa=['aaa','object','__metadata','getOwnPropertyDescriptor','30wPUmrZ','1uPaycA','metadata','length','super','__param','del','expire','Inject','onModuleInit','__esModule','BAD_REQUEST','467815gTOIPs','checkTokenAuth','saveToken','function','user','Injectable','forEach','RedisCacheService','redisClient','2766Slrpgw','2256ETNcwX','invalidateTokens','4144820WRqEnQ','UNAUTHORIZED','@nestjs/common','4169192hQpWiG','defineProperty','HttpException','admin','7msommH','HttpStatus','set','5320881uNDXQQ','193514VNgqyr','__decorate','ttl','get','token:','decorate','design:paramtypes','10169445EOUnYa'];_0x129e=function(){return _0x41b1aa;};return _0x129e();}function _0x29e5(_0xac161a,_0x29d2df){const _0x129efa=_0x129e();return _0x29e5=function(_0x29e5a2,_0x35de42){_0x29e5a2=_0x29e5a2-0x7a;let _0xb45ee0=_0x129efa[_0x29e5a2];return _0xb45ee0;},_0x29e5(_0xac161a,_0x29d2df);}(function(_0x526d59,_0x582e9a){const _0x2cf3f0=_0x29e5,_0x4b4947=_0x526d59();while(!![]){try{const _0x3daa4b=-parseInt(_0x2cf3f0(0x83))/0x1*(-parseInt(_0x2cf3f0(0xa5))/0x2)+parseInt(_0x2cf3f0(0x97))/0x3*(parseInt(_0x2cf3f0(0x98))/0x4)+-parseInt(_0x2cf3f0(0x8e))/0x5*(parseInt(_0x2cf3f0(0x82))/0x6)+parseInt(_0x2cf3f0(0xa1))/0x7*(-parseInt(_0x2cf3f0(0x9d))/0x8)+-parseInt(_0x2cf3f0(0xa4))/0x9+parseInt(_0x2cf3f0(0x9a))/0xa+parseInt(_0x2cf3f0(0x7d))/0xb;if(_0x3daa4b===_0x582e9a)break;else _0x4b4947['push'](_0x4b4947['shift']());}catch(_0x45fd75){_0x4b4947['push'](_0x4b4947['shift']());}}}(_0x129e,0x5bb11));var __decorate=this&&this[_0x189858(0xa6)]||function(_0x582285,_0x40ded1,_0x289eda,_0x114013){const _0x174006=_0x189858;var _0x393450=arguments[_0x174006(0x85)],_0x2a8d16=_0x393450<0x3?_0x40ded1:_0x114013===null?_0x114013=Object[_0x174006(0x81)](_0x40ded1,_0x289eda):_0x114013,_0x5f8b9f;if(typeof Reflect===_0x174006(0x7f)&&typeof Reflect[_0x174006(0x7b)]===_0x174006(0x91))_0x2a8d16=Reflect[_0x174006(0x7b)](_0x582285,_0x40ded1,_0x289eda,_0x114013);else{for(var _0x22420c=_0x582285[_0x174006(0x85)]-0x1;_0x22420c>=0x0;_0x22420c--)if(_0x5f8b9f=_0x582285[_0x22420c])_0x2a8d16=(_0x393450<0x3?_0x5f8b9f(_0x2a8d16):_0x393450>0x3?_0x5f8b9f(_0x40ded1,_0x289eda,_0x2a8d16):_0x5f8b9f(_0x40ded1,_0x289eda))||_0x2a8d16;}return _0x393450>0x3&&_0x2a8d16&&Object['defineProperty'](_0x40ded1,_0x289eda,_0x2a8d16),_0x2a8d16;},__metadata=this&&this[_0x189858(0x80)]||function(_0x242d9b,_0x1c003b){const _0x439522=_0x189858;if(typeof Reflect===_0x439522(0x7f)&&typeof Reflect[_0x439522(0x84)]===_0x439522(0x91))return Reflect['metadata'](_0x242d9b,_0x1c003b);},__param=this&&this[_0x189858(0x87)]||function(_0x72c6d8,_0x655741){return function(_0x5d1137,_0x3c6f9a){_0x655741(_0x5d1137,_0x3c6f9a,_0x72c6d8);};};Object[_0x189858(0x9e)](exports,_0x189858(0x8c),{'value':!![]}),exports['RedisCacheService']=void 0x0;const common_1=require(_0x189858(0x9c));let RedisCacheService=class RedisCacheService{constructor(_0x24ebf0){this['redisClient']=_0x24ebf0;}async[_0x189858(0x8b)](){}['test'](){const _0x4b1552=_0x189858;return this['redisClient'][_0x4b1552(0xa3)](_0x4b1552(0x7e),0x6f),0x1;}async[_0x189858(0xa8)](_0xed5eb4){const _0x3dda21=_0x189858,{key:_0x16038b}=_0xed5eb4,_0x3ad3d8=await this['redisClient'][_0x3dda21(0xa8)](_0x16038b);return await this[_0x3dda21(0x96)][_0x3dda21(0xa8)](_0x16038b);}async[_0x189858(0xa3)](_0x2ee013,_0x15e70d){const _0xa102aa=_0x189858;try{const {key:_0x3f9374,val:_0x1d8973}=_0x2ee013;await this[_0xa102aa(0x96)]['set'](_0x3f9374,_0x1d8973),_0x15e70d&&await this[_0xa102aa(0x96)][_0xa102aa(0x89)](_0x3f9374,_0x15e70d);return;}catch(_0x804767){throw new common_1[(_0xa102aa(0x9f))](_0x804767,common_1[_0xa102aa(0xa2)][_0xa102aa(0x8d)]);}}async[_0x189858(0xa7)](_0x2a8b0a){const _0x38c8d4=_0x189858;return await this[_0x38c8d4(0x96)][_0x38c8d4(0xa7)](_0x2a8b0a);}async[_0x189858(0x88)](_0x510f26){const _0x443de7=_0x189858,{key:_0x5f37cf}=_0x510f26;await this[_0x443de7(0x96)][_0x443de7(0x88)](_0x5f37cf);return;}async[_0x189858(0x90)](_0x4bb533,_0x383daa){const _0x2fcae6=_0x189858,_0x16f62e=await this['redisClient']['zRange']('tokens:'+_0x4bb533,0x0,-0x1);await this[_0x2fcae6(0x99)](_0x4bb533,_0x16f62e),this[_0x2fcae6(0x96)][_0x2fcae6(0xa3)](_0x2fcae6(0x7a)+_0x4bb533,_0x383daa);}async[_0x189858(0x99)](_0x400e06,_0x2513d){const _0xb533e2=_0x189858;_0x2513d[_0xb533e2(0x94)](_0x991ff3=>{const _0x5dbd94=_0xb533e2;this[_0x5dbd94(0x96)][_0x5dbd94(0x88)](_0x5dbd94(0x7a)+_0x400e06+':'+_0x991ff3);});}async[_0x189858(0x8f)](_0x10965e,_0x3632f2){const _0x55891d=_0x189858,{id:_0x274c73,role:_0x1fb74b}=_0x3632f2[_0x55891d(0x92)];if(_0x1fb74b==='visitor')return!![];const _0x5b68b2=await this[_0x55891d(0x96)]['get'](_0x55891d(0x7a)+_0x274c73);if(_0x5b68b2===null)return await this[_0x55891d(0x96)][_0x55891d(0xa3)](_0x55891d(0x7a)+_0x274c73,_0x10965e),!![];if(_0x5b68b2!==_0x10965e){if([_0x55891d(0x86),_0x55891d(0xa0)]['includes'](_0x1fb74b))return!![];throw new common_1['HttpException']('您已在其他设备覆盖登录、请您重新登录！',common_1[_0x55891d(0xa2)][_0x55891d(0x9b)]);}}};RedisCacheService=__decorate([(0x0,common_1[_0x189858(0x93)])(),__param(0x0,(0x0,common_1[_0x189858(0x8a)])('REDIS_CLIENT')),__metadata(_0x189858(0x7c),[Object])],RedisCacheService),exports[_0x189858(0x95)]=RedisCacheService;