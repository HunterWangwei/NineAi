import{d as se,k as ne,H as re,n as ae,r as c,b as I,p as O,e as ie,I as le,o as u,c as m,a as s,J as _,F as ce,s as ue,f as x,w as d,u as i,T as de,t as pe,C as L,K as $,_ as P,M as B,v as w,O as he,P as fe}from"./index-8f9df034.js";import{c as ve}from"./index-c94da121.js";function ge(a,f){let r,h;return function(...y){h=y,r||(r=setTimeout(()=>{a.apply(this,h),r=null},f))}}const me={class:"min-h-full overflow-hidden flex flex-col"},_e={class:"flex-1 min-h-full p-4 relative"},xe=["id"],we=["id","src","onLoad","onError","onClick"],ye={class:"menu p-2 text-[#cbd5e1]"},be={class:"prompt"},ke={class:"flex justify-end items-end space-x-2"},Ce=["onClick"],Ie={class:"text-sm dark:text-slate-400"},Le=s("span",null,"画同款",-1),$e=["onClick"],Pe={class:"text-sm dark:text-slate-400"},Be=s("span",null,"使用当前画同款",-1),Me=["onClick"],Ee={class:"text-sm dark:text-slate-400"},We=s("span",null,"复制提示词",-1),De=s("div",{id:"footer",class:"w-full absolute bottom-[350px]"},null,-1),Ne=se({__name:"index",props:{dataList:null,scaleWidth:null,isDrawLike:{type:Boolean},usePropmpt:{type:Boolean},copyPropmpt:{type:Boolean},gap:{default:5},preOrigin:{type:Boolean}},emits:["loadMore","usePropmptDraw"],setup(a,{emit:f}){var N;const r=a,h=ne(),M=(N=re())==null?void 0:N.appContext.config.globalProperties.$viewerApi,y=ae(),E=c({}),W=c(0),l=c(160),p=c(0),b=c([]),k=c(null),D=c(0),S=I(()=>h.isLogin),H=I(()=>r.scaleWidth?Number(r.scaleWidth)*2+r.gap+150:150),A=he();function U(){F(),J();const t=p.value,o=l.value,e=[];r.dataList.forEach((n,C)=>{const{width:Z,height:ee}=n.fileInfo,te=o/Z,R=ee*te+r.gap+W.value,g=E.value[n.id];if(e.length<t)g.style.top="0px",g.style.left=`${(o+r.gap)*C}px`,e.push(R);else{const T=Math.min.apply(null,e),z=e.findIndex(oe=>oe===T);g.style.top=`${T+0}px`,g.style.left=`${z*(l.value+r.gap)}px`,e[z]+=R}}),D.value=Math.max(...e)+100}function V(t,o){t&&o&&(E.value[o.id]=t)}function F(){const{showName:t=0,showOther:o=0}={};W.value=[t,o].filter(e=>e).length*15}O(()=>r.scaleWidth,t=>{v()}),O(()=>r.dataList,t=>{t&&fe(()=>{v()})},{immediate:!0});function J(){if(!k.value)return;const t=k.value.clientWidth;p.value=Math.floor(t/H.value);const o=t-p.value*H.value,e=(p.value-1)*r.gap;o-e<0&&(p.value-=1),l.value=Math.floor((t-e)/p.value)}function K(t,o){b.value.push(o.id)}function q(t,o){b.value.push(o.id)}function G(t){if(!S.value)return h.setLoginDialog(!0);const{prompt:o}=t;ve({text:o}),y.success("复制prompt成功")}function Q(t){A.push(`/midjourney?mjId=${t.id}`)}function X(t){const{prompt:o}=t;f("usePropmptDraw",o)}function Y(t){const{fileInfo:o}=t,{cosUrl:e}=o;M({options:{},images:[e]})}const j=I(()=>t=>{const{fileInfo:o}=t,{width:e,height:n}=o;return n/(e/l.value)}),v=ge(function(){U()},200);return ie(async()=>{window.addEventListener("resize",v);const t=document.getElementById("footer");new IntersectionObserver((e,n)=>{e.forEach(C=>{C.isIntersecting&&f("loadMore")})}).observe(t)}),le(()=>{window.removeEventListener("resize",v)}),(t,o)=>(u(),m("div",me,[s("div",_e,[s("div",{id:"wapper",ref_key:"wapperRef",ref:k,class:"wapper",style:_({height:`${D.value}px`})},[(u(!0),m(ce,null,ue(a.dataList,e=>(u(),m("div",{id:e.id,key:e.prompt,ref_for:!0,ref:n=>V(n,e),class:"wapper-item",style:_({width:`${l.value}px`})},[x(de,{name:"img",css:!0},{default:d(()=>[s("img",{id:e.id,class:"item-file rounded-sm",style:_({width:`${l.value}px`,height:`${i(j)(e)}px`}),src:a.preOrigin?e.fileInfo.cosUrl:e.fileInfo.thumbImg,loading:"lazy",onLoad:n=>K(n,e),onError:n=>q(n,e),onClick:n=>Y(e)},null,44,we)]),_:2},1024),s("div",ye,[s("div",be,pe(e.fullPrompt),1),s("div",ke,[a.isDrawLike?(u(),L(i(B),{key:0,trigger:"hover"},{trigger:d(()=>[s("button",{class:"flex h-5 w-8 items-center justify-center rounded border transition hover:bg-[#666161] dark:border-neutral-700 dark:hover:bg-[#33373c]",onClick:$(n=>Q(e),["stop"])},[s("span",Ie,[x(i(P),{icon:"fluent:draw-image-24-regular",class:"text-sm"})])],8,Ce)]),default:d(()=>[Le]),_:2},1024)):w("",!0),a.usePropmpt?(u(),L(i(B),{key:1,trigger:"hover"},{trigger:d(()=>[s("button",{class:"flex h-5 w-8 items-center justify-center rounded border transition hover:bg-[#666161] dark:border-neutral-700 dark:hover:bg-[#33373c]",onClick:$(n=>X(e),["stop"])},[s("span",Pe,[x(i(P),{icon:"fluent:draw-image-24-regular",class:"text-sm"})])],8,$e)]),default:d(()=>[Be]),_:2},1024)):w("",!0),a.copyPropmpt?(u(),L(i(B),{key:2,trigger:"hover"},{trigger:d(()=>[s("button",{class:"flex h-5 w-8 items-center justify-center rounded border transition hover:bg-[#666161] dark:border-neutral-700 dark:hover:bg-[#33373c]",onClick:$(n=>G(e),["stop"])},[s("span",Ee,[x(i(P),{icon:"tabler:copy",class:"text-sm"})])],8,Me)]),default:d(()=>[We]),_:2},1024)):w("",!0)])]),b.value.includes(e.id)?w("",!0):(u(),m("div",{key:0,class:"item-loading",style:_({width:`${l.value}px`,height:`${i(j)(e)}px`})},null,4))],12,xe))),128)),De],4)])]))}});export{Ne as _};
