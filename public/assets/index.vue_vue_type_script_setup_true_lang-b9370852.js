import{d as W,n as ce,ad as ee,a6 as O,b as x,o as l,c as d,s as te,a as f,f as a,u as e,_ as C,C as A,i as se,t as P,w as S,v,q as J,F as j,ab as ue,A as K,R as re,l as ae,Q as le,m as oe,r as G,e as de,p as q,ak as F,U as pe,B as Q,E as fe,D as X,a4 as Y,z as V,O as ne,a2 as he,k as ye,J as Z,al as _e,am as ve,P as ke}from"./index-8f9df034.js";import{N as xe}from"./Dropdown-d04ea5d0.js";import{N as ge}from"./Popconfirm-35eeee8d.js";import{N as me}from"./LayoutSider-38ac4d8d.js";function ie(B,g){let h;return(...I)=>{const b=()=>{clearTimeout(h),B(...I)};clearTimeout(h),h=setTimeout(b,g)}}const be=["onClick"],Se={class:"relative flex-1 overflow-hidden break-all text-ellipsis whitespace-nowrap font-bold"},we={key:1,class:"text-[14px]"},Ce={key:0,class:"absolute z-10 flex visible right-1"},Ie=["onClick"],$e={key:1},H=W({__name:"ListItem",props:{dataSources:null,title:null},emits:["update","delete","sticky","select"],setup(B,{emit:g}){const h=B,I=ce(),b=ee(),N=h.dataSources,n=O(),_=x(()=>n.groupList.find(s=>s.uuid===n.active));async function m(s){n.loadingGetChatList||g("select",s)}function z(s,o,r){b.openChatGroupModelDialog()}async function $(s,o){o==null||o.stopPropagation(),await n.updateGroupInfo({isSticky:!s.isSticky,groupId:s.uuid}),I.success(s.isSticky?"取消置顶对话完成":"置顶对话完成"),await n.queryMyGroup()}async function k(s,o){o==null||o.stopPropagation(),g("delete",s)}const u=ie(k,600);async function i(s){const{uuid:o,title:r}=s;s.isEdit=!1,await n.updateGroupInfo({groupId:o,title:r}),await n.queryMyGroup()}async function c(s,o){o==null||o.stopPropagation(),o.key==="Enter"&&i(s)}function p(s,o){o==null||o.stopPropagation(),i(s)}function w(s){return n.active===s}const D=x(()=>{const{isSticky:s}=_.value;return[{label:"编辑对话",key:"edit"},{label:s?"取消置顶":"置顶对话",key:"sticky"},{label:"删除对话",key:"del"}]});function T(s,o){s==="edit"&&z(),s==="sticky"&&$(o),s==="del"&&u(o)}function L(s){return s.isSticky?"ri:pushpin-2-line":s.appId?"icon-park-outline:application-one":s.pluginId?"clarity:plugin-outline-badged":"ri:message-3-line"}const R=s=>{const{isSticky:o}=_.value,{key:r}=s;let t="";return r==="edit"&&(t="bxs:edit"),r==="sticky"&&(t=o?"ri:unpin-line":"ri:pushpin-line"),r==="del"&&(t="material-symbols:delete-outline"),ue(C,{icon:t})};return(s,o)=>(l(!0),d(j,null,te(e(N),r=>(l(),d("div",{key:`${r.uuid}`,class:"wapper"},[f("a",{class:J(["relative flex items-center gap-3 px-3 py-[14px] break-all rounded-md cursor-pointer hover:bg-neutral-100 group dark:hover:bg-[#24272e]",w(r.uuid)&&["","bg-neutral-100","text-[#3076FD]","dark:bg-[#24272e]","pr-20"]]),onClick:t=>m(r)},[f("span",null,[a(e(C),{icon:L(r)},null,8,["icon"])]),f("div",Se,[r.isEdit?(l(),A(e(se),{key:0,value:r.title,"onUpdate:value":t=>r.title=t,size:"tiny",onKeypress:t=>c(r,t)},null,8,["value","onUpdate:value","onKeypress"])):(l(),d("span",we,P(r.title),1))]),w(r.uuid)?(l(),d("div",Ce,[r.isEdit?(l(),d("button",{key:0,class:"p-1",onClick:t=>p(r,t)},[a(e(C),{icon:"ri:save-line"})],8,Ie)):(l(),d("div",$e,[a(e(xe),{options:e(D),"render-icon":R,onSelect:t=>T(t,r)},{default:S(()=>[a(e(C),{icon:"iconamoon:menu-kebab-vertical-bold",class:"text-xl"})]),_:2},1032,["options","onSelect"])]))])):v("",!0)],10,be)]))),128))}});const Ge=["onClick"],De={class:"mr-[12px]"},Te=["src"],Me={class:"relative flex-1 overflow-hidden break-all text-ellipsis whitespace-nowrap flex flex-col"},Ne={class:"font-bold text-[14px] flex"},Le={class:"mr-2"},Ae={class:"text-[12px] mt-[6px] flex-1 overflow-hidden break-all text-ellipsis whitespace-nowrap"},Pe={key:0,class:"absolute z-10 flex visible right-1"},Be=["onClick"],ze={class:"p-1"},Ee={class:"p-1"},Ue=W({__name:"AppListItem",props:{dataSources:null,title:null},emits:["update","delete","sticky","select"],setup(B,{emit:g}){const h=B;ee();const I=h.dataSources,b=O();async function N(u){b.loadingGetChatList||g("select",u)}async function n(u,i){i==null||i.stopPropagation(),await b.updateGroupInfo({isSticky:!u.isSticky,groupId:u.uuid}),await b.queryMyGroup()}async function _(u,i){i==null||i.stopPropagation(),g("delete",u)}const m=ie(_,600);async function z(u){const{uuid:i,title:c}=u;u.isEdit=!1,await b.updateGroupInfo({groupId:i,title:c}),await b.queryMyGroup()}function $(u,i){i==null||i.stopPropagation(),z(u)}function k(u){return b.active===u}return(u,i)=>(l(!0),d(j,null,te(e(I),c=>(l(),d("div",{key:`${c.uuid}`},[f("a",{class:J(["relative flex items-center px-[10px] py-[10px] break-all rounded-md cursor-pointer hover:bg-[#1c1c230a] group dark:hover:bg-[#24272e]",k(c.uuid)&&["","bg-neutral-100","text-[#3388FF]","dark:bg-[#24272e]","","pr-20"]]),onClick:p=>N(c)},[f("span",De,[f("img",{src:c.appLogo,class:"w-[40px]"},null,8,Te)]),f("div",Me,[f("span",Ne,[f("span",Le,P(c.title),1),c.isGpts?(l(),A(e(re),{key:0,type:"success",size:"small",round:""},{default:S(()=>[K(" GPTS ")]),_:1})):v("",!0)]),f("span",Ae,P(c.des),1)]),k(c.uuid)?(l(),d("div",Pe,[c.isEdit?(l(),d("button",{key:0,class:"p-1",onClick:p=>$(c,p)},[a(e(C),{icon:"ri:save-line"})],8,Be)):(l(),d(j,{key:1},[f("button",ze,[a(e(C),{icon:c.isSticky?"ri:unpin-line":"ri:pushpin-line",onClick:p=>n(c,p)},null,8,["icon","onClick"])]),a(e(ge),{placement:"bottom",onPositiveClick:p=>e(m)(c,p)},{trigger:S(()=>[f("button",Ee,[a(e(C),{icon:"ri:delete-bin-line"})])]),default:S(()=>[K(" "+P(u.$t("chat.deleteHistoryConfirm")),1)]),_:2},1032,["onPositiveClick"])],64))])):v("",!0)],10,Ge)]))),128))}}),Ke={class:"flex h-full flex-col gap-3 text-sm"},qe={key:0,class:"flex flex-col items-center mt-4 text-center text-neutral-300 w-full"},Re={key:1,class:"h-[calc(100%-105px)]"},Ve={class:"space-y-0"},Fe={key:3,class:"mt-5"},We={class:"space-y-0"},Oe={key:1,class:"mt-5"},He={class:"w-full flex flex-col flex-shrink-0 p-[10px]"},je=f("span",{class:"mr-3"},"清空非置顶内容",-1),Je=W({__name:"List",setup(B){const{isMobile:g}=ae(),h=le(),I=ne(),b=he(),N=oe(),n=O(),_=G("chat"),m=G(100),z=x(()=>n.groupList.find(t=>t.uuid===n.active)),$=x(()=>n.groupList),k=x(()=>n.groupKeyWord),u=new Date().setHours(0,0,0,0),i=x(()=>$.value.filter(t=>k.value?t.title.includes(k.value)&&t.isSticky:t.isSticky)),c=x(()=>$.value.filter(t=>k.value?t.title.includes(k.value)&&!t.isSticky&&t.appId:!t.isSticky&&t.appId)),p=x(()=>$.value.filter(t=>k.value?t.title.includes(k.value)&&!t.isSticky&&!t.appId&&D(t.createdAt)>=u:!t.isSticky&&!t.appId&&D(t.createdAt)>=u)),w=x(()=>$.value.filter(t=>k.value?t.title.includes(k.value)&&!t.isSticky&&!t.appId&&D(t.createdAt)<u:!t.isSticky&&!t.appId&&D(t.createdAt)<u));function D(t){const y=new Date(t).getTime()+8*60*60*1e3;return new Date(y).getTime()}async function T(t){const{uuid:M,appId:y=0}=t;R(M)||(n.setSelectAppId(y),await n.setActiveGroup(M),await n.queryActiveChatLogList(),b.name!=="Chat"&&I.push("/chat"),g.value&&N.setSiderCollapsed(!0))}async function L(t){event==null||event.stopPropagation(),await n.deleteGroup(t),await n.queryMyGroup(),g.value&&N.setSiderCollapsed(!0)}function R(t){return n.active===t}function s(){I.push("/role")}async function o(){h.warning({title:"清空分组",content:"是否删除所有非置顶的对话组？",positiveText:"确认删除",negativeText:"再想想",onPositiveClick:async()=>{await n.delAllGroup(_.value)}})}const r=x(()=>_.value==="chat"?w.value.length||i.value.length||p.value.length:_.value==="app"?c.value.length:!1);return de(()=>{n.queryMyGroup()}),q($,()=>m.value=m.value+1),q(k,()=>m.value=m.value+1),q(z,t=>{if(!t)return;const{appId:M}=t;_.value=M?"app":"chat"}),(t,M)=>(l(),d("div",Ke,[!e($).length&&e(n).loadingGetChatGroup?(l(),d("div",qe,[a(e(pe),{vertical:"",class:"flex-1 ml-3 w-full"},{default:S(()=>[a(e(F),{text:"",height:"20px",style:{width:"100%"}}),a(e(F),{text:"",height:"20px",style:{width:"100%"}}),a(e(F),{text:"",height:"20px",style:{width:"100%"}}),a(e(F),{text:"",height:"20px",style:{width:"100%"}})]),_:1})])):(l(),d("div",Re,[a(e(fe),{value:_.value,"onUpdate:value":M[0]||(M[0]=y=>_.value=y),type:"line",animated:"",class:"mt-0","justify-content":"space-evenly"},{default:S(()=>[a(e(Q),{name:"chat",tab:"对话历史"}),a(e(Q),{name:"app",tab:"助手列表"})]),_:1},8,["value"]),_.value==="chat"?(l(),A(e(Y),{key:0,class:"px-2"},{default:S(()=>[f("div",Ve,[e(i).length?(l(),A(H,{key:1e3+m.value,title:"置顶","data-sources":e(i),onSelect:T,onDelete:L},null,8,["data-sources"])):v("",!0),e(p).length?(l(),A(H,{key:3e3+m.value,title:"今天","data-sources":e(p),onSelect:T,onDelete:L},null,8,["data-sources"])):v("",!0),e(w).length?(l(),A(H,{key:4e3+m.value,title:"其他","data-sources":e(w),onSelect:T,onDelete:L},null,8,["data-sources"])):v("",!0),!e(i).length&&!e(p).length&&!e(w).length?(l(),d("div",Fe,[a(e(X),{description:"当前列表空空如也"})])):v("",!0)])]),_:1})):v("",!0),_.value==="app"?(l(),A(e(Y),{key:1,class:"px-2"},{default:S(()=>[f("div",We,[e(c).length?(l(),A(Ue,{key:2e3+m.value,title:"应用分类组","data-sources":e(c),onSelect:T,onDelete:L},null,8,["data-sources"])):v("",!0),e(c).length?v("",!0):(l(),d("div",Oe,[a(e(X),{description:"当前助手空空如也"})]))])]),_:1})):v("",!0),f("div",He,[a(e(V),{type:"primary",text:"",class:"!mb-[8px]",onClick:s},{default:S(()=>[K(" 前往工作台 > ")]),_:1}),a(e(V),{disabled:!e(r),type:"tertiary",size:"small",class:"mt-2",onClick:o},{default:S(()=>[a(e(C),{icon:"fluent-mdl2:delete",class:"ml-2 mr-1 text-sm"}),je]),_:1},8,["disabled"])])]))]))}}),Qe={key:0,class:"flex h-14 items-center bg-white space-x-2 px-4 rounded-t-md"},Xe={class:"flex-1"},Ye={key:1,class:"flex h-14 items-center space-x-2 px-4 rounded-t-md bg-white dark:bg-[#18181c]"},Ze={class:"flex-1"},et={class:"px-3 py-3 mt-[12px] bg-white rounded-md border-t dark:border-t-neutral-800 flex flex-col"},tt={key:0,class:"my-1 w-full flex items-center select-none"},st={key:0,class:"ml-2 text-primary"},at={key:1,class:"my-1 w-full flex items-center select-none"},lt={key:0,class:"ml-2 text-primary"},ut=W({__name:"index",setup(B){ne();const g=oe(),h=O(),I=ye(),b=G(null),N=G(null),n=x(()=>I.userBalance);le();const _=x(()=>h==null?void 0:h.activeModelKeyDeductType),m=x(()=>h==null?void 0:h.activeModelKeyPrice),z=G(0),$=G(0),k=G(0),u=G(0),i=G(!1),c=G(null);q(()=>I.userBalance.useModel3Token,(y,E)=>{var U;z.value=E||0,$.value=y||0,(U=b.value)==null||U.play()},{immediate:!0,flush:"post"}),q(()=>I.userBalance.useModel4Token,(y,E)=>{var U;k.value=E||0,u.value=y||0,(U=N.value)==null||U.play()},{immediate:!0,flush:"post"});const{isMobile:p}=ae(),w=G(!1),D=x(()=>g.siderCollapsed),T=G("");function L(y){T.value=y,h.setGroupKeyWord(y)}function R(){i.value=!1}async function s(){try{w.value=!0,await h.addNewChatGroup(),await h.queryMyGroup(),w.value=!1,p.value&&g.setSiderCollapsed(!0)}catch{w.value=!1}}function o(){g.setSiderCollapsed(!D.value)}function r(){i.value=!0,ke(()=>{var y;(y=c.value)==null||y.focus()})}const t=x(()=>p.value?{position:"fixed",zIndex:50}:{}),M=x(()=>p.value?{paddingBottom:"env(safe-area-inset-bottom)"}:{});return q(p,y=>{g.setSiderCollapsed(y)},{immediate:!0,flush:"post"}),(y,E)=>(l(),d("div",null,[a(e(me),{collapsed:e(D),"collapsed-width":0,width:300,"show-trigger":e(p)?!1:"arrow-circle","collapse-mode":"transform",position:"absolute",bordered:"",style:Z(e(t)),"content-style":{backgroundColor:"#edeff5"},onUpdateCollapsed:o},{default:S(()=>[f("div",{class:"flex flex-col h-full dark:bg-[#18181c]",style:Z(e(M))},[f("main",{class:J(["flex flex-col h-full flex-1 min-h-0 rounded-tr-md",e(p)?"pt-[45px] pb-[58px]":""])},[i.value?(l(),d("div",Qe,[a(e(V),{type:"primary",loading:w.value,size:"small",onClick:s},{default:S(()=>[a(e(C),{icon:"ion:add-outline",class:"text-xl"})]),_:1},8,["loading"]),f("div",Xe,[a(e(se),{ref_key:"searchRef",ref:c,modelValue:T.value,"onUpdate:modelValue":E[0]||(E[0]=U=>T.value=U),size:"small",style:{width:"100%"},type:"text",placeholder:"对话历史查找",clearable:"",onBlur:R,onInput:L},null,8,["modelValue"])])])):v("",!0),i.value?v("",!0):(l(),d("div",Ye,[f("div",Ze,[a(e(V),{type:"primary",size:"small",style:{width:"100%"},loading:w.value,onClick:s},{default:S(()=>[K(" 新对话 "),a(e(C),{icon:"ion:add-outline",class:"text-xl"})]),_:1},8,["loading"])]),a(e(V),{size:"small",onClick:r},{default:S(()=>[a(e(C),{icon:"icon-park-outline:search",class:"text-xl"})]),_:1})])),a(Je,{class:"flex-1 pb-4 bg-white overflow-hidden rounded-b-md"}),f("div",et,[e(_)?(l(),d("div",tt,[a(e(C),{icon:"icon-park-solid:vip-one",class:"ml-2 mr-2 text-base text-[#f4a629]"}),K("普通额度 "+P(`${e(n).sumModel3Count||0} 积分`)+" ",1),e(_)===1?(l(),d("span",st,P(e(m)?"(当前使用)":"(免费使用)"),1)):v("",!0)])):v("",!0),e(_)?(l(),d("div",at,[a(e(C),{icon:"icon-park-solid:vip-one",class:"ml-2 mr-2 text-base text-[#c81021]"}),K("高级额度 "+P(`${e(n).sumModel4Count||0} 积分`)+" ",1),e(_)===2?(l(),d("span",lt,P(e(m)?"(当前使用)":"(免费使用)"),1)):v("",!0)])):v("",!0)])],2)],4)]),_:1},8,["collapsed","show-trigger","style"]),e(p)?_e((l(),d("div",{key:0,class:"fixed inset-0 z-40 bg-black/40",onClick:o},null,512)),[[ve,!e(D)]]):v("",!0)]))}});export{ut as _};
