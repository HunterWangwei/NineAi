
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{_ as fe}from"./index-ebfdc92e.js";import{A as q}from"./models-8f9a8bbb.js";import{u as ye}from"./utcformatTime-e76e5157.js";import{b as _e}from"./index-867b894d.js";import{d as ge,r as b,Q as R,B as J,x as be,o as w,c as z,e,f as t,R as $,S as L,b as u,k as m,a as U,w as Q,I as K,t as v,U as we,E as X,W as ke,h as n,X as ve,q as G}from"./index-4432f6f4.js";const he={style:{float:"right"}},Te=U("div",{style:{width:"250px"}}," 账号启用状态、一旦锁定当前key将停止工作！ ",-1),Ie=U("div",{style:{width:"250px"}}," 请填写你的模型秘钥、可以一次设置给多个模型使用。 ",-1),Ve=U("div",{style:{width:"250px"}}," 当前轮询是根据模型下的列表按顺序调用、如果权重为2则表示轮到此key的时候会调用两次之后再轮询下一个key 保证每个key的调用顺序以及限制每次调用的准确次数 ",-1),xe=U("div",{style:{width:"250px"}}," 填写的排序值最大当前key的排序越靠前 ",-1),Ue={class:"flex justify-end mr-5"},Ce=ge({__name:"modelKeys",setup(Ke){const P=b(),B=b(0),h=b(!1),C=b(!1),H=b(!1),N=b([]),_=R({modelTypeId:[],model:"",status:"",page:1,size:10}),A=b(),k=b(0),d=R({modelTypeId:[],key:"",secret:"",status:!0,order:"",keyWeight:1,proxyUrl:""}),Z=R({modelTypeId:[{required:!0,message:"请填写您的调用模型类型",trigger:"blur"}],modelName:[{required:!0,message:"请填写您的模型名称",trigger:"blur"}],status:[{required:!0,message:"请选择key的启用状态",trigger:"change"}],model:[{required:!0,message:"请选择当前key需要绑定的模型",trigger:"change"}],deductType:[{required:!0,message:"请选择当前模型扣费类型",trigger:"change"}],deduct:[{required:!0,message:"请填写当前模型扣费金额（需要是正整数）",trigger:"blur"}],maxTokens:[{required:!0,message:"请填写模型允许的最大token数",trigger:"blur"}],maxRounds:[{required:!0,message:"请填写允许用户选择的最大上下文轮次",trigger:"blur"}]});function E(a){k.value=0,a==null||a.resetFields()}const ee=J(()=>k.value?"更新KEY":"新增KEY"),le=J(()=>k.value?"确认更新":"确认新增"),W=b([]);async function T(){try{C.value=!0;const a=await q.queryModelKey(_);C.value=!1;const{rows:o,count:y}=a.data;B.value=y,W.value=o}catch{C.value=!1}}async function te(){try{const a=await q.queryModelType({size:1e3}),{rows:o}=a.data;N.value=o}catch{C.value=!1}}async function oe(a){const{id:o}=a;await q.delModelKey({id:o}),X({type:"success",message:"操作完成！"}),T()}function ae(a){k.value=a.id;const{modelTypeId:o,key:y,secret:V,status:f,order:g,keyWeight:Y,proxyUrl:I}=a;ke(()=>{Object.assign(d,{modelTypeId:o,key:y,secret:V,status:f,order:g,keyWeight:Y,proxyUrl:I}),Array.isArray(o)?d.modelTypeId=o:d.modelTypeId=[o]}),h.value=!0}function ne(a){a==null||a.resetFields(),T()}async function de(a){a==null||a.validate(async o=>{if(o){const y=JSON.parse(JSON.stringify(d));delete y.id,k.value&&(y.id=k.value);const f=JSON.parse(JSON.stringify(d.key)).split(`
`);y.key=f,await q.setModelKey(y),X({type:"success",message:"操作成功！"}),k.value=0,h.value=!1,T()}})}return be(()=>{T(),te()}),(a,o)=>{const y=n("el-option"),V=n("el-select"),f=n("el-form-item"),g=n("el-button"),Y=n("Plus"),I=n("el-icon"),F=n("el-form"),O=fe,re=n("el-alert"),s=n("el-table-column"),x=n("el-tag"),se=n("el-popconfirm"),ue=n("el-table"),ie=n("el-pagination"),pe=n("el-row"),ce=n("el-switch"),D=n("QuestionFilled"),M=n("el-tooltip"),S=n("el-input"),me=n("el-dialog"),j=ve("loading");return w(),z("div",null,[e(O,null,{default:t(()=>[e(F,{ref_key:"formRef",ref:P,inline:!0,model:_},{default:t(()=>[e(f,{label:"模型类别",prop:"model"},{default:t(()=>[e(V,{modelValue:_.modelTypeId,"onUpdate:modelValue":o[0]||(o[0]=l=>_.modelTypeId=l),filterable:"","allow-create":"",placeholder:"请选择或填写绑定的模型",clearable:""},{default:t(()=>[(w(!0),z($,null,L(u(N),l=>(w(),K(y,{key:l.id,label:l.modelName,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(f,{label:"启用状态",prop:"status"},{default:t(()=>[e(V,{modelValue:_.status,"onUpdate:modelValue":o[1]||(o[1]=l=>_.status=l),placeholder:"请选择模型启用状态",clearable:""},{default:t(()=>[(w(!0),z($,null,L(u(_e),l=>(w(),K(y,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(f,null,{default:t(()=>[e(g,{type:"primary",onClick:T},{default:t(()=>[m(" 查询 ")]),_:1}),e(g,{onClick:o[2]||(o[2]=l=>ne(u(P)))},{default:t(()=>[m(" 重置 ")]),_:1})]),_:1}),U("span",he,[e(g,{type:"success",onClick:o[3]||(o[3]=l=>h.value=!0)},{default:t(()=>[m(" 添加KEY "),e(I,{class:"ml-3"},{default:t(()=>[e(Y)]),_:1})]),_:1})])]),_:1},8,["model"])]),_:1}),e(O,null,{default:t(()=>[e(re,{"show-icon":"",title:"模型说明",description:"启动的key就会调用、不启动则会关闭、一个keykey同时添加到多个模型！",type:"success"})]),_:1}),e(O,{style:{width:"100%"}},{default:t(()=>[Q((w(),K(ue,{border:"",data:u(W),style:{width:"100%"},size:"large"},{default:t(()=>[e(s,{prop:"id",label:"ID",width:"50"}),e(s,{prop:"modelInfo.modelName",label:"自定义模型名称",width:"200"}),e(s,{prop:"status",align:"center",label:"启用Key",width:"90"},{default:t(l=>[e(x,{type:l.row.status?"success":"danger"},{default:t(()=>[m(v(l.row.status?"启用":"不启用"),1)]),_:2},1032,["type"])]),_:1}),e(s,{prop:"model",align:"center",label:"指定模型",width:"150"},{default:t(l=>{var r,i;return[e(x,{type:(i=(r=l.row)==null?void 0:r.modelInfo)!=null&&i.model.includes("gpt-4")?"success":""},{default:t(()=>{var p,c;return[m(v((c=(p=l.row)==null?void 0:p.modelInfo)==null?void 0:c.model),1)]}),_:2},1032,["type"])]}),_:1}),e(s,{prop:"key",align:"center",label:"Key",width:"450"}),e(s,{prop:"proxyUrl",align:"center",label:"代理地址",width:"250"}),e(s,{prop:"isDallDraw",align:"center",label:"支持DALL",width:"120"},{default:t(l=>{var r,i;return[e(x,{type:(i=(r=l.row)==null?void 0:r.modelInfo)!=null&&i.isDallDraw?"success":"danger"},{default:t(()=>{var p,c;return[m(v((c=(p=l.row)==null?void 0:p.modelInfo)!=null&&c.isDallDraw?"是":"否"),1)]}),_:2},1032,["type"])]}),_:1}),e(s,{prop:"isUseTool",align:"center",label:"绑定工具专用",width:"120"},{default:t(l=>{var r,i;return[e(x,{type:(i=(r=l.row)==null?void 0:r.modelInfo)!=null&&i.isUseTool?"success":"danger"},{default:t(()=>{var p,c;return[m(v((c=(p=l.row)==null?void 0:p.modelInfo)!=null&&c.isUseTool?"是":"否"),1)]}),_:2},1032,["type"])]}),_:1}),e(s,{prop:"deductType",align:"center",label:"扣费类型",width:"120"},{default:t(l=>{var r,i;return[e(x,{type:((i=(r=l.row)==null?void 0:r.modelInfo)==null?void 0:i.deductType)===1?"info":"danger"},{default:t(()=>{var p,c;return[m(v(((c=(p=l.row)==null?void 0:p.modelInfo)==null?void 0:c.deductType)===1?"普通余额":"高级余额"),1)]}),_:2},1032,["type"])]}),_:1}),e(s,{prop:"deduct",align:"center",label:"单次扣除",width:"100"},{default:t(l=>{var r,i;return[e(x,{type:((i=(r=l.row)==null?void 0:r.modelInfo)==null?void 0:i.deductType)===1?"success":"warning"},{default:t(()=>{var p,c;return[m(v(`${(c=(p=l.row)==null?void 0:p.modelInfo)==null?void 0:c.deduct} 积分`),1)]}),_:2},1032,["type"])]}),_:1}),e(s,{prop:"order",align:"center",label:"排序ID",width:"90"}),e(s,{prop:"modelInfo.useCount",align:"center",label:"调用次数",width:"90"}),e(s,{prop:"modelInfo.useToken",align:"center",label:"调用Token",width:"120"}),e(s,{prop:"createdAt",align:"center",label:"添加时间",width:"120"},{default:t(l=>[m(v(u(ye)(l.row.createdAt,"YYYY-MM-DD")),1)]),_:1}),e(s,{fixed:"right",label:"操作",width:"200"},{default:t(l=>[e(g,{link:"",type:"primary",size:"small",onClick:r=>ae(l.row)},{default:t(()=>[m(" 变更 ")]),_:2},1032,["onClick"]),e(se,{title:"确认删除此模型么?",width:"180","icon-color":"red",onConfirm:r=>oe(l.row)},{reference:t(()=>[e(g,{link:"",type:"danger",size:"small"},{default:t(()=>[m(" 删除KEY ")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[j,u(C)]]),e(pe,{class:"flex justify-end mt-5"},{default:t(()=>[e(ie,{"current-page":_.page,"onUpdate:currentPage":o[4]||(o[4]=l=>_.page=l),"page-size":_.size,"onUpdate:pageSize":o[5]||(o[5]=l=>_.size=l),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:u(B),onSizeChange:T,onCurrentChange:T},null,8,["current-page","page-size","total"])]),_:1})]),_:1}),e(me,{modelValue:u(h),"onUpdate:modelValue":o[14]||(o[14]=l=>we(h)?h.value=l:null),"close-on-click-modal":!1,title:u(ee),width:"770",onClose:o[15]||(o[15]=l=>E(u(A)))},{footer:t(()=>[U("span",Ue,[e(g,{onClick:o[12]||(o[12]=l=>h.value=!1)},{default:t(()=>[m("取消")]),_:1}),e(g,{type:"primary",onClick:o[13]||(o[13]=l=>de(u(A)))},{default:t(()=>[m(v(u(le)),1)]),_:1})])]),default:t(()=>[Q((w(),K(F,{ref_key:"formPackageRef",ref:A,"label-position":"right","label-width":"120px",model:d,rules:Z},{default:t(()=>[e(f,{label:"模型选择",prop:"modelTypeId"},{default:t(()=>[e(V,{modelValue:d.modelTypeId,"onUpdate:modelValue":o[6]||(o[6]=l=>d.modelTypeId=l),disabled:u(k),multiple:"",placeholder:"请选择模型类型",style:{width:"100%"}},{default:t(()=>[(w(!0),z($,null,L(u(N),l=>(w(),K(y,{key:l.id,label:l.modelName,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),e(f,{label:"Key启用状态",prop:"status"},{default:t(()=>[e(ce,{modelValue:d.status,"onUpdate:modelValue":o[7]||(o[7]=l=>d.status=l)},null,8,["modelValue"]),e(M,{class:"box-item",effect:"dark",placement:"right"},{content:t(()=>[Te]),default:t(()=>[e(I,{class:"ml-3 cursor-pointer"},{default:t(()=>[e(D)]),_:1})]),_:1})]),_:1}),e(f,{label:"KEY秘钥",prop:"key"},{default:t(()=>[e(S,{modelValue:d.key,"onUpdate:modelValue":o[8]||(o[8]=l=>d.key=l),type:"textarea",rows:5,placeholder:"请填写模型Key|clientId|AppId",style:{width:"95%"}},null,8,["modelValue"]),e(M,{class:"box-item",effect:"dark",placement:"right"},{content:t(()=>[Ie]),default:t(()=>[e(I,{class:"ml-3 cursor-pointer"},{default:t(()=>[e(D)]),_:1})]),_:1})]),_:1}),e(f,{label:"调用轮询权重",prop:"keyWeight"},{default:t(()=>[e(S,{modelValue:d.keyWeight,"onUpdate:modelValue":o[9]||(o[9]=l=>d.keyWeight=l),modelModifiers:{number:!0},placeholder:"请填写key的权重、数字越大使用评率越高！",style:{width:"80%"}},null,8,["modelValue"]),e(M,{class:"box-item",effect:"dark",placement:"right"},{content:t(()=>[Ve]),default:t(()=>[e(I,{class:"ml-3 cursor-pointer"},{default:t(()=>[e(D)]),_:1})]),_:1})]),_:1}),e(f,{label:"自定义排序",prop:"order"},{default:t(()=>[e(S,{modelValue:d.order,"onUpdate:modelValue":o[10]||(o[10]=l=>d.order=l),modelModifiers:{number:!0},placeholder:"请填写order排序值！",style:{width:"80%"}},null,8,["modelValue"]),e(M,{class:"box-item",effect:"dark",placement:"right"},{content:t(()=>[xe]),default:t(()=>[e(I,{class:"ml-3 cursor-pointer"},{default:t(()=>[e(D)]),_:1})]),_:1})]),_:1}),e(f,{label:"指定代理地址",prop:"proxyUrl"},{default:t(()=>[e(S,{modelValue:d.proxyUrl,"onUpdate:modelValue":o[11]||(o[11]=l=>d.proxyUrl=l),modelModifiers:{number:!0},placeholder:"如需使用代理请填写、不填写默认使用全局配置！"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[j,u(H)]])]),_:1},8,["modelValue","title"])])}}});typeof G=="function"&&G(Ce);export{Ce as default};
