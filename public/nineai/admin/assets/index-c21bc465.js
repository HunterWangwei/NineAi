
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{_ as se}from"./index-fedba61f.js";import{d as de,r as _,Q as U,x as ie,o as v,c as S,e as l,f as t,R as F,S as L,b as C,k as s,w as pe,I as T,t as g,a as me,P as h,E as D,h as d,X as fe,q as O}from"./index-93f15e37.js";import{r as Q,U as ce,q as be}from"./index-867b894d.js";import{u as X}from"./utcformatTime-e76e5157.js";const _e={class:"flex justify-end"},we=de({__name:"index",setup(ge){const j=_(),$=_(0),V=_(!1),k=_(!1),y=_(!1),M=_(0),x=_(),p=U({status:0,remark:"",isDistribution:!1,id:0}),f=U({model3Count:0,model4Count:0,drawMjCount:0}),u=U({username:"",email:"",status:"",phone:"",remark:"",page:1,size:15}),G=U({model3Count:[{required:!0,message:"请填写赠送基础模型额度",trigger:"blur"}],model4Count:[{required:!0,message:"请填写赠送高级模型额度",trigger:"blur"}],drawMjCount:[{required:!0,message:"请填写赠绘画积分额度",trigger:"blur"}]}),z=_([]);async function w(){try{k.value=!0;const o=await h.queryAllUser(u),{rows:a,count:m}=o.data;k.value=!1,$.value=m,z.value=a}catch{k.value=!1}}function H(o){V.value=!0,p.status=o.status,p.remark=o.remark,p.isDistribution=o.isDistribution,p.id=o.id}function J(o){y.value=!0,M.value=o.id}async function K(){(await h.updateUserStatus(p)).success&&D({type:"success",message:"变更用户状态成功！"}),V.value=!1,w()}function W(o){o==null||o.resetFields(),w()}async function Z(o){const{id:a,email:m}=o;(await h.resetUserPassword({id:a})).success&&D({type:"success",message:`重置用户[${m}密码为初始密码为[123456]完成！`})}function E(o){M.value=0,o==null||o.resetFields()}async function ee(o){o==null||o.validate(async a=>{a&&(await h.sendUserCrami({...f,userId:M.value}),D.success("赠送用户成功！"),y.value=!1,w())})}return ie(()=>w()),(o,a)=>{const m=d("el-input"),i=d("el-form-item"),A=d("el-option"),R=d("el-select"),c=d("el-button"),I=d("el-form"),P=se,le=d("el-avatar"),n=d("el-table-column"),q=d("el-tag"),ae=d("el-popconfirm"),te=d("el-table"),oe=d("el-pagination"),ne=d("el-row"),re=d("el-switch"),Y=d("el-dialog"),ue=fe("loading");return v(),S("div",null,[l(P,null,{default:t(()=>[l(I,{ref_key:"formRef",ref:j,inline:!0,model:u},{default:t(()=>[l(i,{label:"用户名称",prop:"username"},{default:t(()=>[l(m,{modelValue:u.username,"onUpdate:modelValue":a[0]||(a[0]=e=>u.username=e),placeholder:"用户姓名[模糊搜索]",clearable:""},null,8,["modelValue"])]),_:1}),l(i,{label:"用户邮箱",prop:"email"},{default:t(()=>[l(m,{modelValue:u.email,"onUpdate:modelValue":a[1]||(a[1]=e=>u.email=e),placeholder:"用户邮箱[模糊搜索]",clearable:""},null,8,["modelValue"])]),_:1}),l(i,{label:"手机号码",prop:"phone"},{default:t(()=>[l(m,{modelValue:u.phone,"onUpdate:modelValue":a[2]||(a[2]=e=>u.phone=e),placeholder:"手机号码[模糊搜索]",clearable:""},null,8,["modelValue"])]),_:1}),l(i,{label:"用户状态",prop:"status"},{default:t(()=>[l(R,{modelValue:u.status,"onUpdate:modelValue":a[3]||(a[3]=e=>u.status=e),placeholder:"请选择用户状态",clearable:""},{default:t(()=>[(v(!0),S(F,null,L(C(Q),e=>(v(),T(A,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"用户备注",prop:"remark"},{default:t(()=>[l(m,{modelValue:u.remark,"onUpdate:modelValue":a[4]||(a[4]=e=>u.remark=e),placeholder:"用户备注[模糊搜索]",clearable:""},null,8,["modelValue"])]),_:1}),l(i,null,{default:t(()=>[l(c,{type:"primary",onClick:w},{default:t(()=>[s(" 查询 ")]),_:1}),l(c,{onClick:a[5]||(a[5]=e=>W(j.value))},{default:t(()=>[s(" 重置 ")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(P,{style:{width:"100%"}},{default:t(()=>[pe((v(),T(te,{border:"",data:z.value,style:{width:"100%"},size:"large"},{default:t(()=>[l(n,{prop:"avatar",label:"用户头像",fixed:"",width:"120"},{default:t(e=>[l(le,{src:e.row.avatar},null,8,["src"])]),_:1}),l(n,{fixed:"",prop:"username",label:"用户名称",width:"150"}),l(n,{prop:"email",label:"用户邮箱",width:"250",align:"left"}),l(n,{prop:"phone",label:"用户手机号",width:"250",align:"left"},{default:t(e=>{var r;return[s(g(((r=e.row)==null?void 0:r.phone)||"未绑定手机号"),1)]}),_:1}),l(n,{prop:"status",label:"用户状态",width:"120",align:"center"},{default:t(({row:e})=>[l(q,{type:C(ce)[e.status]},{default:t(()=>[s(g(C(be)[e.status]),1)]),_:2},1032,["type"])]),_:1}),l(n,{prop:"balanceInfo.model3Count",label:"基础模型",width:"120",align:"center"}),l(n,{prop:"balanceInfo.model4Count",label:"高级模型",width:"120",align:"center"}),l(n,{prop:"balanceInfo.drawMjCount",label:"绘画余额",width:"120",align:"center"}),s("expirationTime "),l(n,{prop:"balanceInfo.drawMjCount",label:"会员到期时间",width:"170",align:"center"},{default:t(e=>[l(q,{type:"success"},{default:t(()=>{var r,b,B,N;return[s(g((b=(r=e.row)==null?void 0:r.balanceInfo)!=null&&b.expirationTime?C(X)(new Date((N=(B=e.row)==null?void 0:B.balanceInfo)==null?void 0:N.expirationTime)):"非会员"),1)]}),_:2},1024)]),_:1}),l(n,{prop:"balanceInfo.memberModel3Count",label:"基础模型[会员]",width:"120",align:"center"}),l(n,{prop:"balanceInfo.memberModel4Count",label:"高级模型[会员]",width:"120",align:"center"}),l(n,{prop:"balanceInfo.memberDrawMjCount",label:"绘画余额[会员]",width:"120",align:"center"}),l(n,{prop:"balanceInfo.useModel3Count",label:"已用基础模型",width:"160",align:"center"},{default:t(e=>{var r,b;return[s(g(`${((r=e.row.balanceInfo)==null?void 0:r.useModel3Count)||0}次 | ${((b=e.row.balanceInfo)==null?void 0:b.useModel3Token)||0} Token`),1)]}),_:1}),l(n,{prop:"balanceInfo.useModel4Count",label:"已用高级模型",width:"160",align:"center"},{default:t(e=>{var r,b;return[s(g(`${((r=e.row.balanceInfo)==null?void 0:r.useModel4Count)||0}次 | ${((b=e.row.balanceInfo)==null?void 0:b.useModel4Token)||0} Token`),1)]}),_:1}),l(n,{prop:"balanceInfo.useDrawMjToken",label:"已用绘画积分",width:"160",align:"center"},{default:t(e=>{var r;return[s(g(`${((r=e.row.balanceInfo)==null?void 0:r.useDrawMjToken)||0} Token`),1)]}),_:1}),l(n,{prop:"createdAt",label:"注册时间",width:"200",align:"center"},{default:t(e=>[s(g(C(X)(e.row.createdAt,"YYYY-MM-DD hh:mm:ss")),1)]),_:1}),l(n,{prop:"remark",label:"备注信息",width:"120",align:"center"}),l(n,{fixed:"right",label:"操作",width:"250",align:"center"},{default:t(e=>[l(c,{link:"",type:"primary",size:"small",onClick:r=>H(e.row)},{default:t(()=>[s(" 编辑用户 ")]),_:2},1032,["onClick"]),l(ae,{title:"确认重置此用户密码为【123456】?","confirm-button-text":"确认重置",onConfirm:r=>Z(e.row)},{reference:t(()=>[l(c,{link:"",type:"danger"},{default:t(()=>[s(" 重置密码 ")]),_:1})]),_:2},1032,["onConfirm"]),l(c,{link:"",type:"primary",size:"small",onClick:r=>J(e.row)},{default:t(()=>[s(" 赠送卡密 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ue,k.value]]),l(ne,{class:"flex justify-end mt-5"},{default:t(()=>[l(oe,{"current-page":u.page,"onUpdate:currentPage":a[6]||(a[6]=e=>u.page=e),"page-size":u.size,"onUpdate:pageSize":a[7]||(a[7]=e=>u.size=e),class:"mr-5","page-sizes":[15,30,50,100],layout:"total, sizes, prev, pager, next, jumper",total:$.value,onSizeChange:w,onCurrentChange:w},null,8,["current-page","page-size","total"])]),_:1})]),_:1}),l(Y,{modelValue:V.value,"onUpdate:modelValue":a[11]||(a[11]=e=>V.value=e),title:"变更用户状态",width:"500px"},{default:t(()=>[l(I,{model:p,inline:!0},{default:t(()=>[l(i,{label:"用户状态","label-width":"90px",style:{width:"100%"}},{default:t(()=>[l(R,{modelValue:p.status,"onUpdate:modelValue":a[8]||(a[8]=e=>p.status=e),placeholder:"请选择用户状态",clearable:"",style:{width:"100%"}},{default:t(()=>[(v(!0),S(F,null,L(C(Q),e=>(v(),T(A,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"用户备注","label-width":"90px",style:{width:"100%"}},{default:t(()=>[l(m,{modelValue:p.remark,"onUpdate:modelValue":a[9]||(a[9]=e=>p.remark=e),type:"textarea",row:3,placeholder:"请填写备注信息"},null,8,["modelValue"])]),_:1}),l(i,{label:"设为分销人","label-width":"90px",style:{width:"100%"}},{default:t(()=>[l(re,{modelValue:p.isDistribution,"onUpdate:modelValue":a[10]||(a[10]=e=>p.isDistribution=e)},null,8,["modelValue"])]),_:1}),me("div",_e,[l(c,{type:"primary",onClick:K},{default:t(()=>[s(" 确认变更 ")]),_:1})])]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(Y,{modelValue:y.value,"onUpdate:modelValue":a[17]||(a[17]=e=>y.value=e),title:"主动赠送用户",width:"450px",onClose:a[18]||(a[18]=e=>E(x.value))},{footer:t(()=>[l(c,{onClick:a[15]||(a[15]=e=>y.value=!1)},{default:t(()=>[s(" 放弃赠送 ")]),_:1}),l(c,{type:"primary",onClick:a[16]||(a[16]=e=>ee(x.value))},{default:t(()=>[s(" 确认赠送 ")]),_:1})]),default:t(()=>[l(I,{ref_key:"cramiRef",ref:x,model:f,rules:G,"label-width":"115px"},{default:t(()=>[l(i,{label:"基础模型积分",prop:"model3Count"},{default:t(()=>[l(m,{modelValue:f.model3Count,"onUpdate:modelValue":a[12]||(a[12]=e=>f.model3Count=e),modelModifiers:{number:!0},type:"number",placeholder:"赠送基础模型积分"},null,8,["modelValue"])]),_:1}),l(i,{label:"高级模型积分",prop:"model4Count"},{default:t(()=>[l(m,{modelValue:f.model4Count,"onUpdate:modelValue":a[13]||(a[13]=e=>f.model4Count=e),modelModifiers:{number:!0},type:"number",placeholder:"赠送高级模型积分"},null,8,["modelValue"])]),_:1}),l(i,{label:"绘画额度积分",prop:"drawMjCount"},{default:t(()=>[l(m,{modelValue:f.drawMjCount,"onUpdate:modelValue":a[14]||(a[14]=e=>f.drawMjCount=e),modelModifiers:{number:!0},type:"number",placeholder:"赠送绘画额度积分"},null,8,["modelValue"])]),_:1}),l(i,{class:"flex justify-end"})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}});typeof O=="function"&&O(we);export{we as default};
