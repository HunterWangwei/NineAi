
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{_ as me}from"./index-ebfdc92e.js";import{A as W}from"./models-8f9a8bbb.js";import{u as ce}from"./utcformatTime-e76e5157.js";import{f as ye,g as fe,i as ke,M as _e,b as ge,h as be,j as we}from"./index-867b894d.js";import{d as Te,r as h,Q as $,B as L,x as xe,o as p,c as N,e,f as t,R as D,S as R,b as i,k as n,a as _,w as Q,I as g,t as c,J as I,U as ve,E as X,W as he,h as u,X as Ve,q as G}from"./index-4432f6f4.js";const Me={style:{float:"right"}},Ue={class:"overflow-y-scroll w-full whitespace-nowrap"},Ne=_("div",{style:{width:"250px"}}," 账号启用状态、一旦锁定当前key将停止工作！ ",-1),Se=_("div",{style:{width:"250px"}}," 不同模型的设置不同、例如openai仅设置key即可、如果是百度大模型、则填写clientId以及同时需要填写secret。对于OPENAI模型、我们支持批量导入、如果您需要批量导入key、则一行一个key即可、多个key使用换行隔离、其余配置将共享、多个key可以重复选用默认模型。 ",-1),De=_("div",{style:{width:"250px"}}," 不同账号填写的内容不同、但是都代表的是Secret秘钥 ",-1),Re=_("div",{style:{width:"250px"}}," 给定了部分可选的模型列表、你可以可以手动填写您需要调用的模型、请确保填写的模型是当前key支持的类型、否则可能会在调用中出现不可预知错误！ ",-1),Ce=_("div",{style:{width:"250px"}}," 设置当前key的扣费类型、扣除普通余额或是高级余额。 ",-1),qe=_("div",{style:{width:"250px"}}," 设置当前key的单词调用扣除余额、建议同模型或名称key设置相同的金额、避免扣费发生异常！ ",-1),Le=_("div",{style:{width:"250px"}}," 填写此配置可以限制用户在选择模型时候的高级配置中的最大上下文轮次、可以通过限制此数量减少token的损耗、减低上下文的损耗量、 如果设置了模型的最大token和返回量、那么两个限制会同时生效！ ",-1),Ie=_("div",{style:{width:"250px"}}," 当前轮询是根据模型下的列表按顺序调用、如果权重为2则表示轮到此key的时候会调用两次之后再轮询下一个key 保证每个key的调用顺序以及限制每次调用的准确次数 ",-1),Oe=_("div",{style:{width:"250px"}}," 基础绘画来自于OPENAI的DALL-E模型、所以需要为官方的apiKey、请确定至少设置一张key为基础绘画key即可使用绘画功能！同时当前版本的mind思维导图和mj联想绘图等功能都会走当前设置的key，会后后续版本解除此限制！ ",-1),Pe={class:"flex justify-end mr-5"},ze=Te({__name:"key",setup(Ae){const j=h(),B=h(0),V=h(!1),C=h(!1),H=h(!1),y=$({keyType:"",model:"",status:null,page:1,size:10}),O=h(),M=h(0),o=$({keyType:1,modelName:"",key:"",secret:null,status:!0,model:"",isDraw:!1,keyWeight:1,maxModelTokens:4096,maxResponseTokens:2e3,proxyUrl:"",timeout:300,deduct:1,deductType:1,maxRounds:12}),Z=$({keyType:[{required:!0,message:"请填写您的调用模型类型",trigger:"blur"}],modelName:[{required:!0,message:"请填写您的模型名称",trigger:"blur"}],key:[{required:!0,message:"请填写您的调用模型key",trigger:"blur"}],secret:[{required:!0,message:"请填写您的调用模型的secret",trigger:"blur"}],status:[{required:!0,message:"请选择key的启用状态",trigger:"change"}],isDraw:[{required:!0,message:"请选择当前key是否作为基础绘画key",trigger:"change"}],model:[{required:!0,message:"请选择当前key需要绑定的模型",trigger:"change"}],keyWeight:[{required:!0,message:"请填写key的权重值",trigger:"blur"}],maxModelTokens:[{required:!0,message:"请填写模型最大token数",trigger:"blur"}],maxResponseTokens:[{required:!0,message:"请填写允许用户使用的最大回复token数",trigger:"blur"}],proxyUrl:[{required:!1,message:"请填写指定代理地址",trigger:"blur"}],timeout:[{required:!0,message:"请填写超时时间 默认 60 单位（秒）",trigger:"blur"}],deductType:[{required:!0,message:"请选择当前模型扣费类型",trigger:"change"}],deduct:[{required:!0,message:"请填写当前模型扣费金额（需要是正整数）",trigger:"blur"}],maxRounds:[{required:!0,message:"请填写允许用户选择的最大上下文轮次",trigger:"blur"}]});function ee(s){M.value=0,s==null||s.resetFields()}const le=L(()=>ye[o.keyType]),te=L(()=>M.value?"更新秘钥":"新增秘钥"),ae=L(()=>fe[o.keyType]),oe=L(()=>M.value?"确认更新":"确认新增"),E=h([]);async function U(){try{C.value=!0;const s=await W.queryModels(y);C.value=!1;const{rows:a,count:m}=s.data;B.value=m,E.value=a}catch{C.value=!1}}async function re(s){const{id:a}=s;await W.delModels({id:a}),X({type:"success",message:"操作完成！"}),U()}function se(s){M.value=s.id;const{keyType:a,modelName:m,key:v,secret:r,status:f,model:P,keyWeight:k,maxModelTokens:q,maxResponseTokens:S,proxyUrl:z,timeout:w,deductType:d,deduct:A,maxRounds:K,isDraw:Y}=s;he(()=>{Object.assign(o,{keyType:a,modelName:m,key:v,secret:r,status:f,model:P,keyWeight:k,maxModelTokens:q,maxResponseTokens:S,proxyUrl:z,timeout:w,deductType:d,deduct:A,maxRounds:K,isDraw:Y})}),V.value=!0}function de(s){s==null||s.resetFields(),U()}async function ne(s){s==null||s.validate(async a=>{if(a){const m=JSON.parse(JSON.stringify(o));if(delete m.id,M.value&&(m.id=M.value),Number(o.keyType)===1){const r=JSON.parse(JSON.stringify(o.key)).split(`
`);m.key=r}await W.setModels(m),X({type:"success",message:"操作成功！"}),M.value=0,V.value=!1,U()}})}return xe(()=>{U()}),(s,a)=>{const m=u("el-option"),v=u("el-select"),r=u("el-form-item"),f=u("el-button"),P=u("Plus"),k=u("el-icon"),q=u("el-form"),S=me,z=u("el-alert"),w=u("el-tag"),d=u("el-table-column"),A=u("el-popconfirm"),K=u("el-table"),Y=u("el-pagination"),ue=u("el-row"),F=u("el-switch"),T=u("QuestionFilled"),x=u("el-tooltip"),b=u("el-input"),ie=u("el-dialog"),J=Ve("loading");return p(),N("div",null,[e(S,null,{default:t(()=>[e(q,{ref_key:"formRef",ref:j,inline:!0,model:y},{default:t(()=>[e(r,{label:"模型类型",prop:"model"},{default:t(()=>[e(v,{modelValue:y.keyType,"onUpdate:modelValue":a[0]||(a[0]=l=>y.keyType=l),filterable:"","allow-create":"",placeholder:"请选择或填写绑定的模型",clearable:""},{default:t(()=>[(p(!0),N(D,null,R(i(ke),l=>(p(),g(m,{key:l,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"使用模型",prop:"model"},{default:t(()=>[e(v,{modelValue:y.model,"onUpdate:modelValue":a[1]||(a[1]=l=>y.model=l),filterable:"","allow-create":"",placeholder:"请选择或填写绑定的模型",clearable:""},{default:t(()=>[(p(!0),N(D,null,R(i(_e),l=>(p(),g(m,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"启用状态",prop:"status"},{default:t(()=>[e(v,{modelValue:y.status,"onUpdate:modelValue":a[2]||(a[2]=l=>y.status=l),placeholder:"请选择key启用状态",clearable:""},{default:t(()=>[(p(!0),N(D,null,R(i(ge),l=>(p(),g(m,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(r,null,{default:t(()=>[e(f,{type:"primary",onClick:U},{default:t(()=>[n(" 查询 ")]),_:1}),e(f,{onClick:a[3]||(a[3]=l=>de(i(j)))},{default:t(()=>[n(" 重置 ")]),_:1})]),_:1}),_("span",Me,[e(f,{type:"success",onClick:a[4]||(a[4]=l=>V.value=!0)},{default:t(()=>[n(" 添加模型Key "),e(k,{class:"ml-3"},{default:t(()=>[e(P)]),_:1})]),_:1})])]),_:1},8,["model"])]),_:1}),e(S,null,{default:t(()=>[e(z,{"show-icon":"",title:"KEY池说明",description:"所有key会根据你所选的模型自动分类、会以第一个加入的key为标准、建议所有同模型的key参数配置相同、否则可能特殊场景会有迷惑性。不同模型可以设置不同的扣费类型以及单次调用扣除的额度、额度不再以次为单位、改为(积分)概念！你可以设置模型最大上限和回复上限、以及最大轮次用以限制用户的最大上下文、当限制token后、用户端可选范围受其影响、轮次同理、到达轮次之后会移除掉更靠前的上下文！",type:"success"})]),_:1}),e(S,{style:{width:"100%"}},{default:t(()=>[Q((p(),g(K,{border:"",data:i(E),style:{width:"100%"},size:"large"},{default:t(()=>[e(d,{prop:"keyType",label:"模型类型",width:"120"},{default:t(l=>[e(w,{type:"success"},{default:t(()=>[n(c(i(be)[l.row.keyType]),1)]),_:2},1024)]),_:1}),e(d,{prop:"modelName",label:"模型名称",width:"180"}),e(d,{prop:"status",align:"center",label:"启用状态",width:"90"},{default:t(l=>[e(w,{type:l.row.status?"success":"danger"},{default:t(()=>[n(c(l.row.status?"使用中":"已暂停"),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"key",label:"模型KEY",width:"460"},{default:t(l=>[_("div",Ue,c(l.row.key),1)]),_:1}),e(d,{prop:"keyWeight",label:"模型权重",width:"90",align:"center"}),e(d,{prop:"model",align:"center",label:"绑定模型",width:"180"},{default:t(l=>[e(w,{type:l.row.model.includes("gpt-4")?"success":""},{default:t(()=>[n(c(l.row.model),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"isDraw",align:"center",label:"是否绘画KEY",width:"120"},{default:t(l=>[e(w,{type:l.row.isDraw?"success":"danger"},{default:t(()=>[n(c(l.row.isDraw?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"deductType",align:"center",label:"扣费类型",width:"90"},{default:t(l=>[e(w,{type:l.row.deductType===1?"success":"warning"},{default:t(()=>[n(c(l.row.deductType===1?"普通余额":"高级余额"),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"deduct",align:"center",label:"单次扣除",width:"90"},{default:t(l=>[e(w,{type:l.row.deductType===1?"success":"warning"},{default:t(()=>[n(c(`${l.row.deduct} 余额`),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"useCount",align:"center",label:"调用次数",width:"90"}),e(d,{prop:"useToken",align:"center",label:"已使用Token",width:"120"}),e(d,{prop:"keyStatus",align:"center",label:"key状态",width:"110"},{default:t(l=>[e(w,{type:l.row.keyStatus===1?"success":"danger"},{default:t(()=>[n(c(l.row.keyStatus===1?"正常工作":l.row.keyStatus===-1?"已被封禁":"余额耗尽 "),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"maxModelTokens",align:"center",label:"模型最大上下文",width:"140"},{default:t(l=>[e(f,{type:"info",text:""},{default:t(()=>[n(c(l.row.maxModelTokens||"-"),1)]),_:2},1024)]),_:1}),e(d,{prop:"maxResponseTokens",align:"center",label:"最大回复Token",width:"160"},{default:t(l=>[e(f,{type:"info",text:""},{default:t(()=>[n(c(l.row.maxResponseTokens||"-"),1)]),_:2},1024)]),_:1}),e(d,{prop:"proxyUrl",align:"center",label:"绑定的代理地址",width:"140"},{default:t(l=>[e(f,{type:"info",text:""},{default:t(()=>[n(c(l.row.proxyUrl||"-"),1)]),_:2},1024)]),_:1}),e(d,{prop:"proxyUrl",align:"center",label:"变更提示信息",width:"180"},{default:t(l=>[n(c(l.row.remark||"-"),1)]),_:1}),e(d,{prop:"createdAt",align:"center",label:"添加时间",width:"120"},{default:t(l=>[n(c(i(ce)(l.row.createdAt,"YYYY-MM-DD")),1)]),_:1}),e(d,{fixed:"right",label:"操作",width:"200"},{default:t(l=>[e(f,{link:"",type:"primary",size:"small",onClick:pe=>se(l.row)},{default:t(()=>[n(" 变更 ")]),_:2},1032,["onClick"]),e(A,{title:"确认删除此秘钥么?",width:"180","icon-color":"red",onConfirm:pe=>re(l.row)},{reference:t(()=>[e(f,{link:"",type:"danger",size:"small"},{default:t(()=>[n(" 删除秘钥 ")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[J,i(C)]]),e(ue,{class:"flex justify-end mt-5"},{default:t(()=>[e(Y,{"current-page":y.page,"onUpdate:currentPage":a[5]||(a[5]=l=>y.page=l),"page-size":y.size,"onUpdate:pageSize":a[6]||(a[6]=l=>y.size=l),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:i(B),onSizeChange:U,onCurrentChange:U},null,8,["current-page","page-size","total"])]),_:1})]),_:1}),e(ie,{modelValue:i(V),"onUpdate:modelValue":a[23]||(a[23]=l=>ve(V)?V.value=l:null),"close-on-click-modal":!1,title:i(te),width:"770",onClose:a[24]||(a[24]=l=>ee(i(O)))},{footer:t(()=>[_("span",Pe,[e(f,{onClick:a[21]||(a[21]=l=>V.value=!1)},{default:t(()=>[n("取消")]),_:1}),e(f,{type:"primary",onClick:a[22]||(a[22]=l=>ne(i(O)))},{default:t(()=>[n(c(i(oe)),1)]),_:1})])]),default:t(()=>[Q((p(),g(q,{ref_key:"formPackageRef",ref:O,"label-position":"right","label-width":"120px",model:o,rules:Z},{default:t(()=>[e(r,{label:"模型启用状态",prop:"status"},{default:t(()=>[e(F,{modelValue:o.status,"onUpdate:modelValue":a[7]||(a[7]=l=>o.status=l)},null,8,["modelValue"]),e(x,{class:"box-item",effect:"dark",placement:"right"},{content:t(()=>[Ne]),default:t(()=>[e(k,{class:"ml-3 cursor-pointer"},{default:t(()=>[e(T)]),_:1})]),_:1})]),_:1}),e(r,{label:"模型中文名称",prop:"modelName"},{default:t(()=>[e(b,{modelValue:o.modelName,"onUpdate:modelValue":a[8]||(a[8]=l=>o.modelName=l),placeholder:"请填写模型中文名称（用户选择的）"},null,8,["modelValue"])]),_:1}),e(r,{label:i(ae),prop:"key"},{default:t(()=>[e(b,{modelValue:o.key,"onUpdate:modelValue":a[9]||(a[9]=l=>o.key=l),type:Number(o.keyType)===1?"textarea":"text",rows:5,placeholder:"请填写模型Key|clientId|AppId",style:{width:"95%"}},null,8,["modelValue","type"]),e(x,{class:"box-item",effect:"dark",placement:"right"},{content:t(()=>[Se]),default:t(()=>[e(k,{class:"ml-3 cursor-pointer"},{default:t(()=>[e(T)]),_:1})]),_:1})]),_:1},8,["label"]),[2].includes(Number(o.keyType))?(p(),g(r,{key:0,label:"SecretKey",prop:"secret"},{default:t(()=>[e(b,{modelValue:o.secret,"onUpdate:modelValue":a[10]||(a[10]=l=>o.secret=l),placeholder:"请填写模型调用所需的Secret[部分类型模型需要]",style:{width:"80%"}},null,8,["modelValue"]),e(x,{class:"box-item",effect:"dark",placement:"right"},{content:t(()=>[De]),default:t(()=>[e(k,{class:"ml-3 cursor-pointer"},{default:t(()=>[e(T)]),_:1})]),_:1})]),_:1})):I("",!0),e(r,{label:"账号关联模型",prop:"model"},{default:t(()=>[e(v,{modelValue:o.model,"onUpdate:modelValue":a[11]||(a[11]=l=>o.model=l),filterable:"",clearable:"",placeholder:"请选用或填写绑定的模型","allow-create":Number(o.keyType)===1,style:{width:"80%"}},{default:t(()=>[(p(!0),N(D,null,R(i(le),l=>(p(),g(m,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue","allow-create"]),e(x,{class:"box-item",effect:"dark",placement:"right"},{content:t(()=>[Re]),default:t(()=>[e(k,{class:"ml-3 cursor-pointer"},{default:t(()=>[e(T)]),_:1})]),_:1})]),_:1}),e(r,{label:"模型扣费类型",prop:"deductType"},{default:t(()=>[e(v,{modelValue:o.deductType,"onUpdate:modelValue":a[12]||(a[12]=l=>o.deductType=l),filterable:"","allow-create":"",clearable:"",placeholder:"请选用模型扣费类型",style:{width:"80%"}},{default:t(()=>[(p(!0),N(D,null,R(i(we),l=>(p(),g(m,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(x,{class:"box-item",effect:"dark",placement:"right"},{content:t(()=>[Ce]),default:t(()=>[e(k,{class:"ml-3 cursor-pointer"},{default:t(()=>[e(T)]),_:1})]),_:1})]),_:1}),e(r,{label:"单次扣除金额",prop:"deduct"},{default:t(()=>[e(b,{modelValue:o.deduct,"onUpdate:modelValue":a[13]||(a[13]=l=>o.deduct=l),modelModifiers:{number:!0},placeholder:"请填写单词调用此key的扣费金额！",style:{width:"80%"}},null,8,["modelValue"]),e(x,{class:"box-item",effect:"dark",placement:"right"},{content:t(()=>[qe]),default:t(()=>[e(k,{class:"ml-3 cursor-pointer"},{default:t(()=>[e(T)]),_:1})]),_:1})]),_:1}),e(r,{label:"上下文限制",prop:"maxRounds"},{default:t(()=>[e(b,{modelValue:o.maxRounds,"onUpdate:modelValue":a[14]||(a[14]=l=>o.maxRounds=l),modelModifiers:{number:!0},placeholder:"请填写允许用户选择的最高上下文轮次！",style:{width:"80%"}},null,8,["modelValue"]),e(x,{class:"box-item",effect:"dark",placement:"right"},{content:t(()=>[Le]),default:t(()=>[e(k,{class:"ml-3 cursor-pointer"},{default:t(()=>[e(T)]),_:1})]),_:1})]),_:1}),e(r,{label:"调用轮询权重",prop:"keyWeight"},{default:t(()=>[e(b,{modelValue:o.keyWeight,"onUpdate:modelValue":a[15]||(a[15]=l=>o.keyWeight=l),modelModifiers:{number:!0},placeholder:"请填写key的权重、数字越大使用评率越高！",style:{width:"80%"}},null,8,["modelValue"]),e(x,{class:"box-item",effect:"dark",placement:"right"},{content:t(()=>[Ie]),default:t(()=>[e(k,{class:"ml-3 cursor-pointer"},{default:t(()=>[e(T)]),_:1})]),_:1})]),_:1}),e(r,{label:"模型最大Token",prop:"maxModelTokens"},{default:t(()=>[e(b,{modelValue:o.maxModelTokens,"onUpdate:modelValue":a[16]||(a[16]=l=>o.maxModelTokens=l),modelModifiers:{number:!0},placeholder:"请填写模型最大Token、不填写默认使用默认！"},null,8,["modelValue"])]),_:1}),e(r,{label:"最大回复Token",prop:"maxResponseTokens"},{default:t(()=>[e(b,{modelValue:o.maxResponseTokens,"onUpdate:modelValue":a[17]||(a[17]=l=>o.maxResponseTokens=l),modelModifiers:{number:!0},placeholder:"请填写最大回复Token、不填写使用默认！"},null,8,["modelValue"])]),_:1}),[1].includes(Number(o.keyType))?(p(),g(r,{key:1,label:"调用超时时间",prop:"timeout"},{default:t(()=>[e(b,{modelValue:o.timeout,"onUpdate:modelValue":a[18]||(a[18]=l=>o.timeout=l),modelModifiers:{number:!0},placeholder:"请填写key的超时时间单位（秒）！"},null,8,["modelValue"])]),_:1})):I("",!0),[1].includes(Number(o.keyType))?(p(),g(r,{key:2,label:"设为特殊key",prop:"isDraw"},{default:t(()=>[e(F,{modelValue:o.isDraw,"onUpdate:modelValue":a[19]||(a[19]=l=>o.isDraw=l)},null,8,["modelValue"]),e(x,{class:"box-item",effect:"dark",placement:"right"},{content:t(()=>[Oe]),default:t(()=>[e(k,{class:"ml-3 cursor-pointer"},{default:t(()=>[e(T)]),_:1})]),_:1})]),_:1})):I("",!0),[1].includes(Number(o.keyType))?(p(),g(r,{key:3,label:"指定代理地址",prop:"proxyUrl"},{default:t(()=>[e(b,{modelValue:o.proxyUrl,"onUpdate:modelValue":a[20]||(a[20]=l=>o.proxyUrl=l),modelModifiers:{number:!0},placeholder:"如需使用代理请填写、不填写默认使用全局配置！"},null,8,["modelValue"])]),_:1})):I("",!0)]),_:1},8,["model","rules"])),[[J,i(H)]])]),_:1},8,["modelValue","title"])])}}});typeof G=="function"&&G(ze);export{ze as default};
