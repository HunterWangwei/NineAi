
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{_ as _e}from"./index-b42478fa.js";import{A as K}from"./models-839c4760.js";import{u as ge}from"./utcformatTime-e76e5157.js";import{g as be,M as ke,b as we}from"./index-f364fcb1.js";import{d as ve,r as _,Q as R,B as S,x as he,o as c,c as q,e,f as l,R as P,S as $,b as s,k as i,a as V,w as j,I as h,t as g,J as Q,U as Te,E as X,W as Ie,h as d,X as Ve,q as E}from"./index-fa2717cc.js";const xe={style:{float:"right"}},Ue=V("div",{style:{width:"250px"}}," 账号启用状态、一旦锁定当前key将停止工作！ ",-1),Ne=V("div",{style:{width:"250px"}}," 不同模型的设置不同、例如openai仅设置key即可、如果是百度大模型、则填写clientId以及同时需要填写secret。对于OPENAI模型、我们支持批量导入、如果您需要批量导入key、则一行一个key即可、多个key使用换行隔离、其余配置将共享、多个key可以重复选用默认模型。 ",-1),Me=V("div",{style:{width:"250px"}}," 当前轮询是根据模型下的列表按顺序调用、如果权重为2则表示轮到此key的时候会调用两次之后再轮询下一个key 保证每个key的调用顺序以及限制每次调用的准确次数 ",-1),Ce=V("div",{style:{width:"250px"}}," 填写的排序值最大当前key的排序越靠前 ",-1),De={class:"flex justify-end mr-5"},Ke=ve({__name:"modelKeys",setup(Se){const Y=_(),B=_(0),b=_(!1),x=_(!1),G=_(!1),z=_([]),y=R({modelTypeId:"",model:"",status:"",page:1,size:10}),L=_(),k=_(0),n=R({modelTypeId:"",key:"",secret:"",status:!0,order:"",keyWeight:1,proxyUrl:""}),U=S(()=>z.value.find(a=>a.id===Number(n.modelTypeId))),H=S(()=>{var o;const a=Number((o=U.value)==null?void 0:o.modelType)||1;return be[a]}),Z=R({modelTypeId:[{required:!0,message:"请填写您的调用模型类型",trigger:"blur"}],modelName:[{required:!0,message:"请填写您的模型名称",trigger:"blur"}],status:[{required:!0,message:"请选择key的启用状态",trigger:"change"}],model:[{required:!0,message:"请选择当前key需要绑定的模型",trigger:"change"}],deductType:[{required:!0,message:"请选择当前模型扣费类型",trigger:"change"}],deduct:[{required:!0,message:"请填写当前模型扣费金额（需要是正整数）",trigger:"blur"}],maxTokens:[{required:!0,message:"请填写模型允许的最大token数",trigger:"blur"}],maxRounds:[{required:!0,message:"请填写允许用户选择的最大上下文轮次",trigger:"blur"}]});function ee(a){k.value=0,a==null||a.resetFields()}const le=S(()=>k.value?"更新模型":"新增模型"),te=S(()=>k.value?"确认更新":"确认新增"),W=_([]);async function w(){try{x.value=!0;const a=await K.queryModelKey(y);x.value=!1;const{rows:o,count:m}=a.data;B.value=m,W.value=o}catch{x.value=!1}}async function oe(){try{const a=await K.queryModelType({size:1e3}),{rows:o}=a.data;z.value=o}catch{x.value=!1}}async function ae(a){const{id:o}=a;await K.delModelKey({id:o}),X({type:"success",message:"操作完成！"}),w()}function ne(a){k.value=a.id;const{modelTypeId:o,key:m,secret:T,status:p,order:f,keyWeight:A,proxyUrl:v}=a;Ie(()=>{Object.assign(n,{modelTypeId:o,key:m,secret:T,status:p,order:f,keyWeight:A,proxyUrl:v})}),b.value=!0}function de(a){a==null||a.resetFields(),w()}async function re(a){a==null||a.validate(async o=>{if(o){const m=JSON.parse(JSON.stringify(n));if(delete m.id,k.value&&(m.id=k.value),Number(U.value.modelType)===1){const p=JSON.parse(JSON.stringify(n.key)).split(`
`);m.key=p}await K.setModelKey(m),X({type:"success",message:"操作成功！"}),k.value=0,b.value=!1,w()}})}return he(()=>{w(),oe()}),(a,o)=>{const m=d("el-option"),T=d("el-select"),p=d("el-form-item"),f=d("el-button"),A=d("Plus"),v=d("el-icon"),F=d("el-form"),O=_e,se=d("el-alert"),u=d("el-table-column"),I=d("el-tag"),ue=d("el-popconfirm"),ie=d("el-table"),pe=d("el-pagination"),me=d("el-row"),ce=d("el-switch"),M=d("QuestionFilled"),C=d("el-tooltip"),N=d("el-input"),ye=d("el-dialog"),J=Ve("loading");return c(),q("div",null,[e(O,null,{default:l(()=>[e(F,{ref_key:"formRef",ref:Y,inline:!0,model:y},{default:l(()=>[e(p,{label:"模型名称",prop:"model"},{default:l(()=>[e(T,{modelValue:y.model,"onUpdate:modelValue":o[0]||(o[0]=t=>y.model=t),filterable:"","allow-create":"",placeholder:"请选择或填写绑定的模型",clearable:""},{default:l(()=>[(c(!0),q(P,null,$(s(ke),t=>(c(),h(m,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"启用状态",prop:"status"},{default:l(()=>[e(T,{modelValue:y.status,"onUpdate:modelValue":o[1]||(o[1]=t=>y.status=t),placeholder:"请选择模型启用状态",clearable:""},{default:l(()=>[(c(!0),q(P,null,$(s(we),t=>(c(),h(m,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(p,null,{default:l(()=>[e(f,{type:"primary",onClick:w},{default:l(()=>[i(" 查询 ")]),_:1}),e(f,{onClick:o[2]||(o[2]=t=>de(s(Y)))},{default:l(()=>[i(" 重置 ")]),_:1})]),_:1}),V("span",xe,[e(f,{type:"success",onClick:o[3]||(o[3]=t=>b.value=!0)},{default:l(()=>[i(" 添加模型 "),e(v,{class:"ml-3"},{default:l(()=>[e(A)]),_:1})]),_:1})])]),_:1},8,["model"])]),_:1}),e(O,null,{default:l(()=>[e(se,{"show-icon":"",title:"模型说明",description:"所有开启的模型将会直接应用到客户端供用户选择使用、请注意在添加模型时候如果您需要使用DALL-E绘画你需要特别指定模型为绘画KEY、同时例如思维导图、应用、翻译、联想等功能【目前绑定为OPENAI类目】请在添加模型的时候勾选上设置为工具Key、届时调用此类功能将使用我们指定的模型、同时绘画KEY和工具KEY可同时设定、建议仅设置一个列表为绘画key、并且绘画key与工具key不会被给到前台供用户选择！",type:"success"})]),_:1}),e(O,{style:{width:"100%"}},{default:l(()=>[j((c(),h(ie,{border:"",data:s(W),style:{width:"100%"},size:"large"},{default:l(()=>[e(u,{prop:"id",label:"ID",width:"50"}),e(u,{prop:"modelInfo.modelName",label:"自定义模型名称",width:"200"}),e(u,{prop:"status",align:"center",label:"启用状态",width:"90"},{default:l(t=>[e(I,{type:t.row.status?"success":"danger"},{default:l(()=>[i(g(t.row.status?"使用中":"已暂停"),1)]),_:2},1032,["type"])]),_:1}),e(u,{prop:"model",align:"center",label:"指定模型",width:"150"},{default:l(t=>[e(I,{type:t.row.modelInfo.model.includes("gpt-4")?"success":""},{default:l(()=>[i(g(t.row.modelInfo.model),1)]),_:2},1032,["type"])]),_:1}),e(u,{prop:"key",align:"center",label:"Key",width:"450"}),e(u,{prop:"isDallDraw",align:"center",label:"支持DALL",width:"120"},{default:l(t=>[e(I,{type:t.row.modelInfo.isDallDraw?"success":"danger"},{default:l(()=>[i(g(t.row.modelInfo.isDallDraw?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),e(u,{prop:"isUseTool",align:"center",label:"绑定工具专用",width:"120"},{default:l(t=>[e(I,{type:t.row.modelInfo.isUseTool?"success":"danger"},{default:l(()=>[i(g(t.row.modelInfo.isUseTool?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),e(u,{prop:"deductType",align:"center",label:"扣费类型",width:"120"},{default:l(t=>[e(I,{type:t.row.modelInfo.deductType===1?"info":"danger"},{default:l(()=>[i(g(t.row.modelInfo.deductType===1?"普通余额":"高级余额"),1)]),_:2},1032,["type"])]),_:1}),e(u,{prop:"deduct",align:"center",label:"单次扣除",width:"100"},{default:l(t=>[e(I,{type:t.row.modelInfo.deductType===1?"success":"warning"},{default:l(()=>[i(g(`${t.row.modelInfo.deduct} 积分`),1)]),_:2},1032,["type"])]),_:1}),e(u,{prop:"order",align:"center",label:"排序ID",width:"90"}),e(u,{prop:"modelInfo.useCount",align:"center",label:"调用次数",width:"90"}),e(u,{prop:"modelInfo.useToken",align:"center",label:"调用Token",width:"120"}),e(u,{prop:"modelInfo.maxRounds",align:"center",label:"限制上下文轮次",width:"160"},{default:l(t=>[i(g(t.row.modelInfo.maxRounds||"-"),1)]),_:1}),e(u,{prop:"createdAt",align:"center",label:"添加时间",width:"120"},{default:l(t=>[i(g(s(ge)(t.row.createdAt,"YYYY-MM-DD")),1)]),_:1}),e(u,{fixed:"right",label:"操作",width:"200"},{default:l(t=>[e(f,{link:"",type:"primary",size:"small",onClick:D=>ne(t.row)},{default:l(()=>[i(" 变更 ")]),_:2},1032,["onClick"]),e(ue,{title:"确认删除此模型么?",width:"180","icon-color":"red",onConfirm:D=>ae(t.row)},{reference:l(()=>[e(f,{link:"",type:"danger",size:"small"},{default:l(()=>[i(" 删除模型 ")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[J,s(x)]]),e(me,{class:"flex justify-end mt-5"},{default:l(()=>[e(pe,{"current-page":y.page,"onUpdate:currentPage":o[4]||(o[4]=t=>y.page=t),"page-size":y.size,"onUpdate:pageSize":o[5]||(o[5]=t=>y.size=t),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:s(B),onSizeChange:w,onCurrentChange:w},null,8,["current-page","page-size","total"])]),_:1})]),_:1}),e(ye,{modelValue:s(b),"onUpdate:modelValue":o[15]||(o[15]=t=>Te(b)?b.value=t:null),"close-on-click-modal":!1,title:s(le),width:"770",onClose:o[16]||(o[16]=t=>ee(s(L)))},{footer:l(()=>[V("span",De,[e(f,{onClick:o[13]||(o[13]=t=>b.value=!1)},{default:l(()=>[i("取消")]),_:1}),e(f,{type:"primary",onClick:o[14]||(o[14]=t=>re(s(L)))},{default:l(()=>[i(g(s(te)),1)]),_:1})])]),default:l(()=>[j((c(),h(F,{ref_key:"formPackageRef",ref:L,"label-position":"right","label-width":"120px",model:n,rules:Z},{default:l(()=>{var t,D;return[e(p,{label:"模型选择",prop:"modelTypeId"},{default:l(()=>[e(T,{modelValue:n.modelTypeId,"onUpdate:modelValue":o[6]||(o[6]=r=>n.modelTypeId=r),placeholder:"请选择模型类型",style:{width:"100%"}},{default:l(()=>[(c(!0),q(P,null,$(s(z),r=>(c(),h(m,{key:r.id,label:r.modelName,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"Key启用状态",prop:"status"},{default:l(()=>[e(ce,{modelValue:n.status,"onUpdate:modelValue":o[7]||(o[7]=r=>n.status=r)},null,8,["modelValue"]),e(C,{class:"box-item",effect:"dark",placement:"right"},{content:l(()=>[Ue]),default:l(()=>[e(v,{class:"ml-3 cursor-pointer"},{default:l(()=>[e(M)]),_:1})]),_:1})]),_:1}),e(p,{label:s(H),prop:"key"},{default:l(()=>{var r;return[e(N,{modelValue:n.key,"onUpdate:modelValue":o[8]||(o[8]=fe=>n.key=fe),type:Number((r=s(U))==null?void 0:r.modelType)===1?"textarea":"text",rows:5,placeholder:"请填写模型Key|clientId|AppId",style:{width:"95%"}},null,8,["modelValue","type"]),e(C,{class:"box-item",effect:"dark",placement:"right"},{content:l(()=>[Ne]),default:l(()=>[e(v,{class:"ml-3 cursor-pointer"},{default:l(()=>[e(M)]),_:1})]),_:1})]}),_:1},8,["label"]),[2].includes(Number((t=s(U))==null?void 0:t.modelType))?(c(),h(p,{key:0,label:"key秘钥",prop:"secret"},{default:l(()=>[e(N,{modelValue:n.secret,"onUpdate:modelValue":o[9]||(o[9]=r=>n.secret=r),placeholder:"请填写模型中key秘钥、部分模型需要"},null,8,["modelValue"])]),_:1})):Q("",!0),e(p,{label:"调用轮询权重",prop:"keyWeight"},{default:l(()=>[e(N,{modelValue:n.keyWeight,"onUpdate:modelValue":o[10]||(o[10]=r=>n.keyWeight=r),modelModifiers:{number:!0},placeholder:"请填写key的权重、数字越大使用评率越高！",style:{width:"80%"}},null,8,["modelValue"]),e(C,{class:"box-item",effect:"dark",placement:"right"},{content:l(()=>[Me]),default:l(()=>[e(v,{class:"ml-3 cursor-pointer"},{default:l(()=>[e(M)]),_:1})]),_:1})]),_:1}),e(p,{label:"自定义排序",prop:"order"},{default:l(()=>[e(N,{modelValue:n.order,"onUpdate:modelValue":o[11]||(o[11]=r=>n.order=r),modelModifiers:{number:!0},placeholder:"请填写order排序值！",style:{width:"80%"}},null,8,["modelValue"]),e(C,{class:"box-item",effect:"dark",placement:"right"},{content:l(()=>[Ce]),default:l(()=>[e(v,{class:"ml-3 cursor-pointer"},{default:l(()=>[e(M)]),_:1})]),_:1})]),_:1}),[1].includes(Number((D=s(U))==null?void 0:D.modelType))?(c(),h(p,{key:1,label:"指定代理地址",prop:"proxyUrl"},{default:l(()=>[e(N,{modelValue:n.proxyUrl,"onUpdate:modelValue":o[12]||(o[12]=r=>n.proxyUrl=r),modelModifiers:{number:!0},placeholder:"如需使用代理请填写、不填写默认使用全局配置！"},null,8,["modelValue"])]),_:1})):Q("",!0)]}),_:1},8,["model","rules"])),[[J,s(G)]])]),_:1},8,["modelValue","title"])])}}});typeof E=="function"&&E(Ke);export{Ke as default};
