
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{_ as S}from"./index-ebfdc92e.js";import{J as B}from"./style-36d8fc5f.js";import{d as j,y as E,Q as M,B as D,r as y,x as P,o as R,c as F,e,f as o,a as V,k as H,b as w,E as p,a1 as J,h as a,q as x}from"./index-4432f6f4.js";import{a as v}from"./config-9151dae9.js";const K={class:"flex justify-between"},Q=V("b",null,"公共公告设置",-1),$=j({__name:"notice",setup(z){const I=E(),s=M({isAutoOpenNotice:"",noticeInfo:"",noticeTitle:""}),C=D(()=>I.settings.app.colorScheme),N=y({noticeTitle:[{required:!0,trigger:"blur",message:"请填写公告标题"}],noticeInfo:[{required:!0,trigger:"blur",message:"请填写公告具体信息"}]}),b=y();async function h(){const l=await v.queryConfig({keys:["noticeInfo","noticeTitle","isAutoOpenNotice"]}),{noticeInfo:t,noticeTitle:r,isAutoOpenNotice:i}=l.data;t&&Object.assign(s,{noticeInfo:t,noticeTitle:r,isAutoOpenNotice:i})}function O(){var l;(l=b.value)==null||l.validate(async t=>{if(t){try{await v.setConfig({settings:A(s)}),p.success("变更配置信息成功")}catch{}h()}else p.error("请填写完整信息")})}const T=y("/api/upload/file");function A(l){return Object.keys(l).map(t=>({configKey:t,configVal:l[t]}))}async function k(l,t){const r=await Promise.all(Array.from(l).map(i=>new Promise(async(_,g)=>{var c,f,d;const u=new FormData;u.append("file",i);try{const n=await J.post(T.value,u,{headers:{"Content-Type":"multipart/form-data"}});(c=n==null?void 0:n.data)!=null&&c.data||p.error("图片上传失败、请检查您的配置信息！"),_(n.data.data)}catch(n){p.error(((d=(f=n==null?void 0:n.response)==null?void 0:f.data)==null?void 0:d.message)||"图片上传失败、请检查您的配置信息！"),g(n)}})));t(r.map(i=>i)),p({message:"图片上传成功！",type:"success"})}return P(()=>{h()}),(l,t)=>{const r=a("el-alert"),i=S,_=a("el-button"),g=a("el-input"),u=a("el-form-item"),c=a("el-col"),f=a("el-switch"),d=a("el-tooltip"),n=a("el-row"),U=a("el-form"),q=a("el-card");return R(),F("div",null,[e(i,null,{default:o(()=>[e(r,{closable:!1,"show-icon":"",title:"公告设置说明",description:"这里的公告设置是对应用户端的公告页面的、你可以使用MD语法或直接使用Html标签进行发布、您也可以直接粘贴上传图片、作为图床使用、其他地方比如上传商品等地方的图片也可以暂时在此作为临时方案。",type:"success"})]),_:1}),e(q,{style:{margin:"20px"}},{header:o(()=>[V("div",K,[Q,e(_,{class:"button",text:"",onClick:O},{default:o(()=>[H(" 保存设置 ")]),_:1})])]),default:o(()=>[e(U,{ref_key:"formRef",ref:b,rules:N.value,model:s,"label-width":"120px"},{default:o(()=>[e(n,null,{default:o(()=>[e(c,{xs:24,md:20,lg:15,xl:10},{default:o(()=>[e(u,{label:"公告标题",prop:"noticeTitle"},{default:o(()=>[e(g,{modelValue:s.noticeTitle,"onUpdate:modelValue":t[0]||(t[0]=m=>s.noticeTitle=m),rows:1,placeholder:"公告标题",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{offset:2,xs:24,md:20,lg:15,xl:10},{default:o(()=>[e(u,{label:"自动打开公告",prop:"isAutoOpenNotice"},{default:o(()=>[e(d,{content:"设为自动打开则网站初始化会打开、用户仍可以选择24小时不再查看、选择关闭则不会主动打开！",placement:"top","show-after":500},{default:o(()=>[e(f,{modelValue:s.isAutoOpenNotice,"onUpdate:modelValue":t[1]||(t[1]=m=>s.isAutoOpenNotice=m),"active-value":"1","inactive-value":"0"},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{xs:24,md:20,lg:15,xl:12})]),_:1})]),_:1}),e(n,null,{default:o(()=>[e(c,{span:24},{default:o(()=>[e(u,{label:"公告信息",prop:"noticeInfo"},{default:o(()=>[e(w(B),{modelValue:s.noticeInfo,"onUpdate:modelValue":t[2]||(t[2]=m=>s.noticeInfo=m),style:{"min-height":"80vh"},theme:w(C),onOnUploadImg:k},null,8,["modelValue","theme"])]),_:1})]),_:1})]),_:1})]),_:1},8,["rules","model"])]),_:1})])}}});typeof x=="function"&&x($);export{$ as default};
