
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{_ as ge}from"./index-b234788e.js";import{A as z}from"./models-29d727d7.js";import{u as be}from"./utcformatTime-e76e5157.js";import{g as ke,b as we}from"./index-ec4ac0e2.js";import{d as ve,r as k,Q as Y,B as A,x as he,o as _,c as L,e,f as l,R as $,S as B,b as u,k as m,a as U,w as X,I as V,t as w,J as E,U as Te,E as G,W as Ie,h as s,X as Ve,q as H}from"./index-ae0f759d.js";const xe={style:{float:"right"}},Ne=U("div",{style:{width:"250px"}}," 账号启用状态、一旦锁定当前key将停止工作！ ",-1),Ue=U("div",{style:{width:"250px"}}," 不同模型的设置不同、例如openai仅设置key即可、如果是百度大模型、则填写clientId以及同时需要填写secret。对于OPENAI模型、我们支持批量导入、如果您需要批量导入key、则一行一个key即可、多个key使用换行隔离、其余配置将共享、多个key可以重复选用默认模型。 ",-1),Ce=U("div",{style:{width:"250px"}}," 当前轮询是根据模型下的列表按顺序调用、如果权重为2则表示轮到此key的时候会调用两次之后再轮询下一个key 保证每个key的调用顺序以及限制每次调用的准确次数 ",-1),De=U("div",{style:{width:"250px"}}," 填写的排序值最大当前key的排序越靠前 ",-1),Ke={class:"flex justify-end mr-5"},Me=ve({__name:"modelKeys",setup(Se){const W=k(),F=k(0),v=k(!1),C=k(!1),Z=k(!1),M=k([]),g=Y({modelTypeId:"",model:"",status:"",page:1,size:10}),O=k(),h=k(0),r=Y({modelTypeId:"",key:"",secret:"",status:!0,order:"",keyWeight:1,proxyUrl:""}),D=A(()=>M.value.find(n=>n.id===Number(r.modelTypeId))),ee=A(()=>{var o;const n=Number((o=D.value)==null?void 0:o.modelType)||1;return ke[n]}),le=Y({modelTypeId:[{required:!0,message:"请填写您的调用模型类型",trigger:"blur"}],modelName:[{required:!0,message:"请填写您的模型名称",trigger:"blur"}],status:[{required:!0,message:"请选择key的启用状态",trigger:"change"}],model:[{required:!0,message:"请选择当前key需要绑定的模型",trigger:"change"}],deductType:[{required:!0,message:"请选择当前模型扣费类型",trigger:"change"}],deduct:[{required:!0,message:"请填写当前模型扣费金额（需要是正整数）",trigger:"blur"}],maxTokens:[{required:!0,message:"请填写模型允许的最大token数",trigger:"blur"}],maxRounds:[{required:!0,message:"请填写允许用户选择的最大上下文轮次",trigger:"blur"}]});function te(n){h.value=0,n==null||n.resetFields()}const oe=A(()=>h.value?"更新模型":"新增模型"),ae=A(()=>h.value?"确认更新":"确认新增"),J=k([]);async function T(){try{C.value=!0;const n=await z.queryModelKey(g);C.value=!1;const{rows:o,count:f}=n.data;F.value=f,J.value=o}catch{C.value=!1}}async function ne(){try{const n=await z.queryModelType({size:1e3}),{rows:o}=n.data;M.value=o}catch{C.value=!1}}async function de(n){const{id:o}=n;await z.delModelKey({id:o}),G({type:"success",message:"操作完成！"}),T()}function re(n){h.value=n.id;const{modelTypeId:o,key:f,secret:x,status:c,order:b,keyWeight:R,proxyUrl:I}=n;Ie(()=>{Object.assign(r,{modelTypeId:o,key:f,secret:x,status:c,order:b,keyWeight:R,proxyUrl:I})}),v.value=!0}function se(n){n==null||n.resetFields(),T()}async function ue(n){n==null||n.validate(async o=>{if(o){const f=JSON.parse(JSON.stringify(r));if(delete f.id,h.value&&(f.id=h.value),Number(D.value.modelType)===1){const c=JSON.parse(JSON.stringify(r.key)).split(`
`);f.key=c}await z.setModelKey(f),G({type:"success",message:"操作成功！"}),h.value=0,v.value=!1,T()}})}return he(()=>{T(),ne()}),(n,o)=>{const f=s("el-option"),x=s("el-select"),c=s("el-form-item"),b=s("el-button"),R=s("Plus"),I=s("el-icon"),j=s("el-form"),P=ge,ie=s("el-alert"),p=s("el-table-column"),N=s("el-tag"),pe=s("el-popconfirm"),me=s("el-table"),ce=s("el-pagination"),ye=s("el-row"),fe=s("el-switch"),S=s("QuestionFilled"),q=s("el-tooltip"),K=s("el-input"),_e=s("el-dialog"),Q=Ve("loading");return _(),L("div",null,[e(P,null,{default:l(()=>[e(j,{ref_key:"formRef",ref:W,inline:!0,model:g},{default:l(()=>[e(c,{label:"模型类别",prop:"model"},{default:l(()=>[e(x,{modelValue:g.modelTypeId,"onUpdate:modelValue":o[0]||(o[0]=t=>g.modelTypeId=t),filterable:"","allow-create":"",placeholder:"请选择或填写绑定的模型",clearable:""},{default:l(()=>[(_(!0),L($,null,B(u(M),t=>(_(),V(f,{key:t.id,label:t.modelName,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"启用状态",prop:"status"},{default:l(()=>[e(x,{modelValue:g.status,"onUpdate:modelValue":o[1]||(o[1]=t=>g.status=t),placeholder:"请选择模型启用状态",clearable:""},{default:l(()=>[(_(!0),L($,null,B(u(we),t=>(_(),V(f,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(c,null,{default:l(()=>[e(b,{type:"primary",onClick:T},{default:l(()=>[m(" 查询 ")]),_:1}),e(b,{onClick:o[2]||(o[2]=t=>se(u(W)))},{default:l(()=>[m(" 重置 ")]),_:1})]),_:1}),U("span",xe,[e(b,{type:"success",onClick:o[3]||(o[3]=t=>v.value=!0)},{default:l(()=>[m(" 添加模型 "),e(I,{class:"ml-3"},{default:l(()=>[e(R)]),_:1})]),_:1})])]),_:1},8,["model"])]),_:1}),e(P,null,{default:l(()=>[e(ie,{"show-icon":"",title:"模型说明",description:"所有开启的模型将会直接应用到客户端供用户选择使用、请注意在添加模型时候如果您需要使用DALL-E绘画你需要特别指定模型为绘画KEY、同时例如思维导图、应用、翻译、联想等功能【目前绑定为OPENAI类目】请在添加模型的时候勾选上设置为工具Key、届时调用此类功能将使用我们指定的模型、同时绘画KEY和工具KEY可同时设定、建议仅设置一个列表为绘画key、并且绘画key与工具key不会被给到前台供用户选择！",type:"success"})]),_:1}),e(P,{style:{width:"100%"}},{default:l(()=>[X((_(),V(me,{border:"",data:u(J),style:{width:"100%"},size:"large"},{default:l(()=>[e(p,{prop:"id",label:"ID",width:"50"}),e(p,{prop:"modelInfo.modelName",label:"自定义模型名称",width:"200"}),e(p,{prop:"status",align:"center",label:"启用状态",width:"90"},{default:l(t=>[e(N,{type:t.row.status?"success":"danger"},{default:l(()=>[m(w(t.row.status?"使用中":"已暂停"),1)]),_:2},1032,["type"])]),_:1}),e(p,{prop:"model",align:"center",label:"指定模型",width:"150"},{default:l(t=>{var d,a;return[e(N,{type:(a=(d=t.row)==null?void 0:d.modelInfo)!=null&&a.model.includes("gpt-4")?"success":""},{default:l(()=>{var i,y;return[m(w((y=(i=t.row)==null?void 0:i.modelInfo)==null?void 0:y.model),1)]}),_:2},1032,["type"])]}),_:1}),e(p,{prop:"key",align:"center",label:"Key",width:"450"}),e(p,{prop:"isDallDraw",align:"center",label:"支持DALL",width:"120"},{default:l(t=>{var d,a;return[e(N,{type:(a=(d=t.row)==null?void 0:d.modelInfo)!=null&&a.isDallDraw?"success":"danger"},{default:l(()=>{var i,y;return[m(w((y=(i=t.row)==null?void 0:i.modelInfo)!=null&&y.isDallDraw?"是":"否"),1)]}),_:2},1032,["type"])]}),_:1}),e(p,{prop:"isUseTool",align:"center",label:"绑定工具专用",width:"120"},{default:l(t=>{var d,a;return[e(N,{type:(a=(d=t.row)==null?void 0:d.modelInfo)!=null&&a.isUseTool?"success":"danger"},{default:l(()=>{var i,y;return[m(w((y=(i=t.row)==null?void 0:i.modelInfo)!=null&&y.isUseTool?"是":"否"),1)]}),_:2},1032,["type"])]}),_:1}),e(p,{prop:"deductType",align:"center",label:"扣费类型",width:"120"},{default:l(t=>{var d,a;return[e(N,{type:((a=(d=t.row)==null?void 0:d.modelInfo)==null?void 0:a.deductType)===1?"info":"danger"},{default:l(()=>{var i,y;return[m(w(((y=(i=t.row)==null?void 0:i.modelInfo)==null?void 0:y.deductType)===1?"普通余额":"高级余额"),1)]}),_:2},1032,["type"])]}),_:1}),e(p,{prop:"deduct",align:"center",label:"单次扣除",width:"100"},{default:l(t=>{var d,a;return[e(N,{type:((a=(d=t.row)==null?void 0:d.modelInfo)==null?void 0:a.deductType)===1?"success":"warning"},{default:l(()=>{var i,y;return[m(w(`${(y=(i=t.row)==null?void 0:i.modelInfo)==null?void 0:y.deduct} 积分`),1)]}),_:2},1032,["type"])]}),_:1}),e(p,{prop:"order",align:"center",label:"排序ID",width:"90"}),e(p,{prop:"modelInfo.useCount",align:"center",label:"调用次数",width:"90"}),e(p,{prop:"modelInfo.useToken",align:"center",label:"调用Token",width:"120"}),e(p,{prop:"modelInfo.maxRounds",align:"center",label:"限制上下文轮次",width:"160"},{default:l(t=>{var d,a;return[m(w(((a=(d=t.row)==null?void 0:d.modelInfo)==null?void 0:a.maxRounds)||"-"),1)]}),_:1}),e(p,{prop:"createdAt",align:"center",label:"添加时间",width:"120"},{default:l(t=>[m(w(u(be)(t.row.createdAt,"YYYY-MM-DD")),1)]),_:1}),e(p,{fixed:"right",label:"操作",width:"200"},{default:l(t=>[e(b,{link:"",type:"primary",size:"small",onClick:d=>re(t.row)},{default:l(()=>[m(" 变更 ")]),_:2},1032,["onClick"]),e(pe,{title:"确认删除此模型么?",width:"180","icon-color":"red",onConfirm:d=>de(t.row)},{reference:l(()=>[e(b,{link:"",type:"danger",size:"small"},{default:l(()=>[m(" 删除KEY ")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[Q,u(C)]]),e(ye,{class:"flex justify-end mt-5"},{default:l(()=>[e(ce,{"current-page":g.page,"onUpdate:currentPage":o[4]||(o[4]=t=>g.page=t),"page-size":g.size,"onUpdate:pageSize":o[5]||(o[5]=t=>g.size=t),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:u(F),onSizeChange:T,onCurrentChange:T},null,8,["current-page","page-size","total"])]),_:1})]),_:1}),e(_e,{modelValue:u(v),"onUpdate:modelValue":o[15]||(o[15]=t=>Te(v)?v.value=t:null),"close-on-click-modal":!1,title:u(oe),width:"770",onClose:o[16]||(o[16]=t=>te(u(O)))},{footer:l(()=>[U("span",Ke,[e(b,{onClick:o[13]||(o[13]=t=>v.value=!1)},{default:l(()=>[m("取消")]),_:1}),e(b,{type:"primary",onClick:o[14]||(o[14]=t=>ue(u(O)))},{default:l(()=>[m(w(u(ae)),1)]),_:1})])]),default:l(()=>[X((_(),V(j,{ref_key:"formPackageRef",ref:O,"label-position":"right","label-width":"120px",model:r,rules:le},{default:l(()=>{var t,d;return[e(c,{label:"模型选择",prop:"modelTypeId"},{default:l(()=>[e(x,{modelValue:r.modelTypeId,"onUpdate:modelValue":o[6]||(o[6]=a=>r.modelTypeId=a),placeholder:"请选择模型类型",style:{width:"100%"}},{default:l(()=>[(_(!0),L($,null,B(u(M),a=>(_(),V(f,{key:a.id,label:a.modelName,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"Key启用状态",prop:"status"},{default:l(()=>[e(fe,{modelValue:r.status,"onUpdate:modelValue":o[7]||(o[7]=a=>r.status=a)},null,8,["modelValue"]),e(q,{class:"box-item",effect:"dark",placement:"right"},{content:l(()=>[Ne]),default:l(()=>[e(I,{class:"ml-3 cursor-pointer"},{default:l(()=>[e(S)]),_:1})]),_:1})]),_:1}),e(c,{label:u(ee),prop:"key"},{default:l(()=>{var a;return[e(K,{modelValue:r.key,"onUpdate:modelValue":o[8]||(o[8]=i=>r.key=i),type:Number((a=u(D))==null?void 0:a.modelType)===1?"textarea":"text",rows:5,placeholder:"请填写模型Key|clientId|AppId",style:{width:"95%"}},null,8,["modelValue","type"]),e(q,{class:"box-item",effect:"dark",placement:"right"},{content:l(()=>[Ue]),default:l(()=>[e(I,{class:"ml-3 cursor-pointer"},{default:l(()=>[e(S)]),_:1})]),_:1})]}),_:1},8,["label"]),[2].includes(Number((t=u(D))==null?void 0:t.modelType))?(_(),V(c,{key:0,label:"key秘钥",prop:"secret"},{default:l(()=>[e(K,{modelValue:r.secret,"onUpdate:modelValue":o[9]||(o[9]=a=>r.secret=a),placeholder:"请填写模型中key秘钥、部分模型需要"},null,8,["modelValue"])]),_:1})):E("",!0),e(c,{label:"调用轮询权重",prop:"keyWeight"},{default:l(()=>[e(K,{modelValue:r.keyWeight,"onUpdate:modelValue":o[10]||(o[10]=a=>r.keyWeight=a),modelModifiers:{number:!0},placeholder:"请填写key的权重、数字越大使用评率越高！",style:{width:"80%"}},null,8,["modelValue"]),e(q,{class:"box-item",effect:"dark",placement:"right"},{content:l(()=>[Ce]),default:l(()=>[e(I,{class:"ml-3 cursor-pointer"},{default:l(()=>[e(S)]),_:1})]),_:1})]),_:1}),e(c,{label:"自定义排序",prop:"order"},{default:l(()=>[e(K,{modelValue:r.order,"onUpdate:modelValue":o[11]||(o[11]=a=>r.order=a),modelModifiers:{number:!0},placeholder:"请填写order排序值！",style:{width:"80%"}},null,8,["modelValue"]),e(q,{class:"box-item",effect:"dark",placement:"right"},{content:l(()=>[De]),default:l(()=>[e(I,{class:"ml-3 cursor-pointer"},{default:l(()=>[e(S)]),_:1})]),_:1})]),_:1}),[1].includes(Number((d=u(D))==null?void 0:d.modelType))?(_(),V(c,{key:1,label:"指定代理地址",prop:"proxyUrl"},{default:l(()=>[e(K,{modelValue:r.proxyUrl,"onUpdate:modelValue":o[12]||(o[12]=a=>r.proxyUrl=a),modelModifiers:{number:!0},placeholder:"如需使用代理请填写、不填写默认使用全局配置！"},null,8,["modelValue"])]),_:1})):E("",!0)]}),_:1},8,["model","rules"])),[[Q,u(Z)]])]),_:1},8,["modelValue","title"])])}}});typeof H=="function"&&H(Me);export{Me as default};
